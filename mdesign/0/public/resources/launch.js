var MCAPTURE_ProcessProvisioned_count=0;var MCAPTURE_ProcessProvisioning_count=0;var MCAPTURE_ProvisioningAborted=false;(function(f,k){var d;var g=5*1000;var b;function c(){var m=localStorage.getItem("lastManifestGuid");var n=MCAPTURE_CFG.lastManifestGuid;var q=MCAPTURE_CFG.clearType;function r(){window.locationUtils.setHref("../../clear.html?newGuid=no&amp;clearType="+q)}if(q!="no-navigate"&&typeof m=="string"&&m.length>0&&n!=m){var p="Later version(s) of the pr ocess(es) being tested have been downloaded. ";var o=q=="full"?"All data for this application will now be cleared.":"The application will now be reloaded.";mCapture.fl.msgboxasync(r,p+o);window.localStorage.setItem("lastManifestGuid",n);window.MCAPTURE_ProvisioningAborted=true;return true}else{window.localStorage.setItem("lastManifestGuid",n);return false}}function l(n){b=true;function m(o){log.debug("On our way home to "+o)}log.debug("Process provisioning error - server did not send all processes");if(typeof(k)!=="undefined"){k.msgBox(function(o){log.debug("Calling mc.fl.gotoprovisioningurl");k.fl.gotoprovisioningurl(m)},"Provisioning Error","You must retry the operation. Reason: "+n,"OK")}else{window.location.setHref("../../index.html")}}function h(q){function r(o){var y,z,x;if(o<0){o=0}if(o>100){o=100}y=document.getElementById("provProgressBar");if(y!=null){if(y.tagName==="PROGRESS"){y.value=o}else{x=""+o+"%";z=document.getElementById("provProgressComplete");if(z!=null){z.style.width=x}}}}if(d){clearTimeout(d);d=undefined}if(q&&q.hasOwnProperty("message")){log.debug("Provisioned process error"+q.message)}if(b){return}if(q&&q.hasOwnProperty("delay")){var u=parseFloat(q.delay);log.debug("Provisioning process requested delay: "+q.delay);if(u.constructor!==Number){u=g}else{if(u<=g){u=g}}log.debug("Provisioning process waiting: "+u);d=setTimeout(h,u);return}if(q&&q.hasOwnProperty("name")&&q.hasOwnProperty("value")){log.debug("Provisioned process "+q.name);d=setTimeout(h,g);MCAPTURE_ProcessProvisioned_count+=1;var v=(MCAPTURE_ProcessProvisioned_count*100)/MCAPTURE_ProcessProvisioning_count;r(v)}else{if(q&&q.hasOwnProperty("message")){l("Provisioning error: "+q.message)}else{if(q&&q.hasOwnProperty("alreadyProvisioned")){}else{if(MCAPTURE_ProcessProvisioning_count>0){l("timeout waiting for process");return}}}}if(MCAPTURE_ProcessProvisioned_count<MCAPTURE_ProcessProvisioning_count){return}if(d){clearTimeout(d);d=undefined}log.debug("All proceses have been provisioned");e=localStorage.setItem("provisionedState","provisioned");if(k.phonegapPresent()){function t(){if(window.plugins&&window.plugins.provisioner){window.plugins.provisioner.setComplete()}n()}function m(){if(window.cordova){document.addEventListener("deviceready",t,false)}else{setTimeout(m,100)}}m()}else{n()}function n(){if(k.db.getExpansionError()!==undefined){k.msgBox(function(o){window.MCAPTURE_ProvisioningAborted||w()},"Error expanding the database","You may not be able to use the application fully. Reason: "+k.db.getExpansionError(),"OK")}else{MCAPTURE_ProvisioningAborted||w()}}function w(){var x;function o(y){if(y.direction==="in"){}else{if(x){x.unbind("jmuiPageAnimationEnd",o)}p()}}x=f("#InitAppPage");if(MCAPTURE_CFG.haveHomeProcess){p()}else{if(q&&q.hasOwnProperty("alreadyProvisioned")){p()}else{if(x){x.bind("jmuiPageAnimationEnd",o);f.ui.gotoPage(f("#processesPage"),"jmuiSlide",true)}}}}function s(C,A){var y;function o(){k.ppa.loadData(MCAPTURE_CFG.deviceType,MCAPTURE_CFG.ppaRelativePath,B,z)}function z(){if(C){f.ui.gotoPage(f("#processesPage"),"jmuiSlide",false)}else{A()}}function B(D){var F,G,E;if(D<0){D=0}if(D>100){D=100}F=document.getElementById("ppaProgressBar");if(F&&F.tagName==="PROGRESS"){F.value=D}else{E=""+D+"%";G=document.getElementById("ppaProgressComplete");if(G){G.style.width=E}}}function x(D){if(D.direction==="in"){o()}else{y.unbind("jmuiPageAnimationEnd",x);A()}}if(MCAPTURE_CFG.appType=="ppa"&&MCAPTURE_CFG.havePpaData){if(k.ppa.dataLoadRequired()){log.debug("in ppaLoadData");y=f("#ppaLoadingPage");y.bind("jmuiPageAnimationEnd",x);f.ui.gotoPage(y,"jmuiSlide",true)}else{A()}}else{A()}}function p(){delete window.MCAPTURE_Provisioning_Processes;if(MCAPTURE_CFG.haveHomeProcess){if(MCAPTURE_CFG.homeProcessURL!=""){if(MCAPTURE_ProcessProvisioning_count>0){(function(y,A){function o(B){s(false,function(){window.locationUtils.setHref(MCAPTURE_CFG.homeProcessURL)})}function x(){if(MCAPTURE_CFG.deviceFormat=="tablet"){A.ready(false,1024,768,undefined,o)}else{A.ready(false,320,480,undefined,o)}}try{y.ready(x)}catch(z){x()}}(window.jmfw,window.mCapture))}}else{alert("The home process url is missing from the processes.xml")}}if(!MCAPTURE_CFG.haveHomeProcess||MCAPTURE_CFG.isMisconfiguration){(function(y,B){var A,o;A={hidden:true,home:true,id:"ProcessZero",title:"Process Zero",url:"../../launch/0/launch.html",version:"1",pages:{}};A.devPlatform=MCAPTURE_CFG.deviceType.trim().toLowerCase();A.deviceClient=MCAPTURE_CFG.deviceClient;A.devClient=(MCAPTURE_CFG.deviceClient=="unrestricted")?"u":"r";A.deviceType=MCAPTURE_CFG.deviceType.trim();A.deviceFormat=MCAPTURE_CFG.deviceFormat;A.devFormat=(A.deviceFormat=="tablet")?"t":"n";A.deviceScreen=MCAPTURE_CFG.deviceScreen;if(MCAPTURE_CFG.isMisconfiguration){A.pages={errorPage:{qIdMap:{launchError:"launchError"}}};A.dataIdMap={launchError:{qIds:["launchError"]}};A.questions={launchError:{defval:function(C){make_formula(function(D){return this.done(MCAPTURE_CFG.launchPageMsg)}).execute(function(D){C(D)},function(){alert("Asynchronous Function Failure")})}}}}else{if(MCAPTURE_CFG.processCount==0){A.pages={errorPage:{qIdMap:{launchError:"launchError"}}};A.dataIdMap={launchError:{qIds:["launchError"]}};A.questions={launchError:{defval:function(C){make_formula(function(D){return this.done("There are no processes deployed to you.<br></br><br></br>Please use the 'Reload' button.")}).execute(function(D){C(D)},function(){alert("Asynchronous Function Failure")})}}}}else{if(MCAPTURE_CFG.hasHomeProcess){}else{A.pages={processesPage:{qIdMap:{inlineProcessSelector:"inlineProcessSelector"}},subjectsPage:{qIdMap:{inlineSubjectSelector:"inlineSubjectSelector"}}};A.dataIdMap={inlineProcessSelector:{qIds:["inlineProcessSelector"]},inlineSubjectSelector:{qIds:["inlineSubjectSelector"]},};A.questions={inlineProcessSelector:{template:'<li class="processRow" style="background-image: url(<%=data.icon%>);"> <%=data.title%> </li>'},inlineSubjectSelector:{summaryNames:["name","ishidden"],tableTemplate:"<table><thead><tr><th>Name</th></tr></thead><tbody></tbody></table>",rowTemplate:"<tr><td class=&quot;jmuiArrow&quot;><span class=&quot;subjectDelete&quot;></span><%=data.name%></td></tr>",selection:"action_inlineSubjectSelector_select"}}}}}function x(){function E(G){s(true,G)}function D(G){log.debug("On our way home to "+G)}function C(I){function H(){log.debug("mc.db.clear success. Calling localStorage.clear ");localStorage.clear();log.debug("Calling mc.db.deleteAllCookies");B.db.deleteAllCookies();log.debug("Calling mc.fl.gotoprovisioningurl");B.fl.gotoprovisioningurl(D)}function G(J){logerror(J.message);alert(J.message)}if(I.returnValue===true){I.preventDefault()}B.msgBox(function(J){if(J==="Yes"){window.locationUtils.setHref("../../clear.html?newGuid=yes&amp;clearType=full")}},"Confirm","Clear all data?","Yes","No")}function F(G){if(G.returnValue===true){G.preventDefault();log.debug("Calling mc.fl.gotoprovisioningurl");B.fl.gotoprovisioningurl(D)}}if(!MCAPTURE_CFG.isMisconfiguration&&!MCAPTURE_CFG.haveHomeProcess&&MCAPTURE_CFG.processCount!=0){B.fl.action_processesPage_pageForward=function(G){return this.done("subjectsPage")};B.fl.action_inlineSubjectSelector_select=function(G){var I=this.getvar("_arg1");if(I.ishidden){var K=I.ishidden.toLowerCase();if(K==="true"){return this.done(false)}}var J=this.getvar("_arg2").toLowerCase();var H=I.processId.toLowerCase();return this.done(H===J)}}B.fl.preNotification=function(G){return this.done(false)};B.fl.postNotification=function(G){return this.done(false)};if(!MCAPTURE_CFG.haveHomeProcess||MCAPTURE_CFG.isMisconfiguration){B.fl.repl_defaultRepProfile=function(){alert("who called this?")};B.fl.replContext_defaultRepProfile={type:"normal",context:{username:"$username",password:"$password",token:"$token",subject:"$subject",query:""}}}if(MCAPTURE_CFG.deviceFormat=="tablet"){B.ready(false,1024,768,A,E)}else{B.ready(false,320,480,A,E)}if(MCAPTURE_CFG.isMisconfiguration){button=y(".jmuiCancelButton");button.bind(y.ui.tapEvent,C)}else{if(MCAPTURE_CFG.processCount==0){button=y(".jmuiCancelButton");button.bind(y.ui.tapEvent,F)}}}try{y.ready(x)}catch(z){x()}}(window.jmfw,window.mCapture))}}}MCAPTURE_Provisioning_Processes=true;MCAPTURE_ProcessProvisioned=h;if(MCAPTURE_CFG.isMisconfiguration){MCAPTURE_ProcessProvisioning_count=0;sessionStorage.deployedProcesses=JSON.stringify([])}else{MCAPTURE_ProcessProvisioning_count=MCAPTURE_CFG.processCount;sessionStorage.deployedProcesses=JSON.stringify(MCAPTURE_CFG.processes)}if(c()){return}function j(){function m(o){if(o){var n=document.createElement("script");n.src=o;n.onload=function(){};document.head.appendChild(n)}}if(d===undefined){d=setTimeout(h,g)}MCAPTURE_CFG.processJsFiles.forEach(m)}function i(n){if(n.direction==="in"){var m=f("#InitAppPage");if(m){m.unbind("jmuiPageAnimationEnd",i)}j()}else{}}var e=localStorage.getItem("provisionedState");if(e=="provisioned"){MCAPTURE_ProcessProvisioned_count=MCAPTURE_ProcessProvisioning_count;h({alreadyProvisioned:true})}else{if(MCAPTURE_ProcessProvisioning_count>0){var a=f("#InitAppPage");if(a){a.bind("jmuiPageAnimationEnd",i);f.ui.gotoPage(a,"jmuiSlide",true)}else{j()}}else{h()}}}(window.jmfw,window.mCapture));