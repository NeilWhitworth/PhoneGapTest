if(!this.JSON){this.JSON={}}(function(){function f(n){return n<10?"0"+n:n}var isBlackberry=(/blackberry/gi).test(window.navigator.appVersion);if(isBlackberry||typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==="string"){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());Date.CultureInfo={name:"en-GB",englishName:"English (United Kingdom)",nativeName:"English (United Kingdom)",dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbreviatedDayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],shortestDayNames:["Su","Mo","Tu","We","Th","Fr","Sa"],firstLetterDayNames:["S","M","T","W","T","F","S"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],abbreviatedMonthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],amDesignator:"AM",pmDesignator:"PM",firstDayOfWeek:1,twoDigitYearMax:2029,dateElementOrder:"dmy",formatPatterns:{shortDate:"dd/MM/yyyy",longDate:"dd MMMM yyyy",shortTime:"HH:mm",longTime:"HH:mm:ss",fullDateTime:"dd MMMM yyyy HH:mm:ss",sortableDateTime:"yyyy-MM-ddTHH:mm:ss",universalSortableDateTime:"yyyy-MM-dd HH:mm:ssZ",rfc1123:"ddd, dd MMM yyyy HH:mm:ss GMT",monthDay:"dd MMMM",yearMonth:"MMMM yyyy"},regexPatterns:{jan:/^jan(uary)?/i,feb:/^feb(ruary)?/i,mar:/^mar(ch)?/i,apr:/^apr(il)?/i,may:/^may/i,jun:/^jun(e)?/i,jul:/^jul(y)?/i,aug:/^aug(ust)?/i,sep:/^sep(t(ember)?)?/i,oct:/^oct(ober)?/i,nov:/^nov(ember)?/i,dec:/^dec(ember)?/i,sun:/^su(n(day)?)?/i,mon:/^mo(n(day)?)?/i,tue:/^tu(e(s(day)?)?)?/i,wed:/^we(d(nesday)?)?/i,thu:/^th(u(r(s(day)?)?)?)?/i,fri:/^fr(i(day)?)?/i,sat:/^sa(t(urday)?)?/i,future:/^next/i,past:/^last|past|prev(ious)?/i,add:/^(\+|after|from)/i,subtract:/^(\-|before|ago)/i,yesterday:/^yesterday/i,today:/^t(oday)?/i,tomorrow:/^tomorrow/i,now:/^n(ow)?/i,millisecond:/^ms|milli(second)?s?/i,second:/^sec(ond)?s?/i,minute:/^min(ute)?s?/i,hour:/^h(ou)?rs?/i,week:/^w(ee)?k/i,month:/^m(o(nth)?s?)?/i,day:/^d(ays?)?/i,year:/^y((ea)?rs?)?/i,shortMeridian:/^(a|p)/i,longMeridian:/^(a\.?m?\.?|p\.?m?\.?)/i,timezone:/^((e(s|d)t|c(s|d)t|m(s|d)t|p(s|d)t)|((gmt)?\s*(\+|\-)\s*\d\d\d\d?)|gmt)/i,ordinalSuffix:/^\s*(st|nd|rd|th)/i,timeContext:/^\s*(\:|a|p)/i},abbreviatedTimeZoneStandard:{GMT:"-000",EST:"-0400",CST:"-0500",MST:"-0600",PST:"-0700"},abbreviatedTimeZoneDST:{GMT:"-000",EDT:"-0500",CDT:"-0600",MDT:"-0700",PDT:"-0800"}};Date.getMonthNumberFromName=function(b){var e=Date.CultureInfo.monthNames,a=Date.CultureInfo.abbreviatedMonthNames,d=b.toLowerCase();for(var c=0;c<e.length;c++){if(e[c].toLowerCase()==d||a[c].toLowerCase()==d){return c}}return -1};Date.getDayNumberFromName=function(b){var f=Date.CultureInfo.dayNames,a=Date.CultureInfo.abbreviatedDayNames,e=Date.CultureInfo.shortestDayNames,d=b.toLowerCase();for(var c=0;c<f.length;c++){if(f[c].toLowerCase()==d||a[c].toLowerCase()==d){return c}}return -1};Date.isLeapYear=function(a){return(((a%4===0)&&(a%100!==0))||(a%400===0))};Date.getDaysInMonth=function(a,b){return[31,(Date.isLeapYear(a)?29:28),31,30,31,30,31,31,30,31,30,31][b]};Date.getTimezoneOffset=function(a,b){return(b||false)?Date.CultureInfo.abbreviatedTimeZoneDST[a.toUpperCase()]:Date.CultureInfo.abbreviatedTimeZoneStandard[a.toUpperCase()]};Date.getTimezoneAbbreviation=function(b,d){var c=(d||false)?Date.CultureInfo.abbreviatedTimeZoneDST:Date.CultureInfo.abbreviatedTimeZoneStandard,a;for(a in c){if(c[a]===b){return a}}return null};Date.prototype.clone=function(){return new Date(this.getTime())};Date.prototype.compareTo=function(a){if(isNaN(this)){throw new Error(this)}if(a instanceof Date&&!isNaN(a)){return(this>a)?1:(this<a)?-1:0}else{throw new TypeError(a)}};Date.prototype.equals=function(a){return(this.compareTo(a)===0)};Date.prototype.between=function(c,a){var b=this.getTime();return b>=c.getTime()&&b<=a.getTime()};Date.prototype.addMilliseconds=function(a){this.setMilliseconds(this.getMilliseconds()+a);return this};Date.prototype.addSeconds=function(a){return this.addMilliseconds(a*1000)};Date.prototype.addMinutes=function(a){return this.addMilliseconds(a*60000)};Date.prototype.addHours=function(a){return this.addMilliseconds(a*3600000)};Date.prototype.addDays=function(a){return this.addMilliseconds(a*86400000)};Date.prototype.addWeeks=function(a){return this.addMilliseconds(a*604800000)};Date.prototype.addMonths=function(a){var b=this.getDate();this.setDate(1);this.setMonth(this.getMonth()+a);this.setDate(Math.min(b,this.getDaysInMonth()));return this};Date.prototype.addYears=function(a){return this.addMonths(a*12)};Date.prototype.add=function(b){if(typeof b=="number"){this._orient=b;return this}var a=b;if(a.millisecond||a.milliseconds){this.addMilliseconds(a.millisecond||a.milliseconds)}if(a.second||a.seconds){this.addSeconds(a.second||a.seconds)}if(a.minute||a.minutes){this.addMinutes(a.minute||a.minutes)}if(a.hour||a.hours){this.addHours(a.hour||a.hours)}if(a.month||a.months){this.addMonths(a.month||a.months)}if(a.year||a.years){this.addYears(a.year||a.years)}if(a.day||a.days){this.addDays(a.day||a.days)}return this};Date._validate=function(d,c,a,b){if(typeof d!="number"){throw new TypeError(d+" is not a Number.")}else{if(d<c||d>a){throw new RangeError(d+" is not a valid value for "+b+".")}}return true};Date.validateMillisecond=function(a){return Date._validate(a,0,999,"milliseconds")};Date.validateSecond=function(a){return Date._validate(a,0,59,"seconds")};Date.validateMinute=function(a){return Date._validate(a,0,59,"minutes")};Date.validateHour=function(a){return Date._validate(a,0,23,"hours")};Date.validateDay=function(c,a,b){return Date._validate(c,1,Date.getDaysInMonth(a,b),"days")};Date.validateMonth=function(a){return Date._validate(a,0,11,"months")};Date.validateYear=function(a){return Date._validate(a,1,9999,"seconds")};Date.prototype.set=function(b){var a=b;if(!a.millisecond&&a.millisecond!==0){a.millisecond=-1}if(!a.second&&a.second!==0){a.second=-1}if(!a.minute&&a.minute!==0){a.minute=-1}if(!a.hour&&a.hour!==0){a.hour=-1}if(!a.day&&a.day!==0){a.day=-1}if(!a.month&&a.month!==0){a.month=-1}if(!a.year&&a.year!==0){a.year=-1}if(a.millisecond!=-1&&Date.validateMillisecond(a.millisecond)){this.addMilliseconds(a.millisecond-this.getMilliseconds())}if(a.second!=-1&&Date.validateSecond(a.second)){this.addSeconds(a.second-this.getSeconds())}if(a.minute!=-1&&Date.validateMinute(a.minute)){this.addMinutes(a.minute-this.getMinutes())}if(a.hour!=-1&&Date.validateHour(a.hour)){this.addHours(a.hour-this.getHours())}if(a.month!==-1&&Date.validateMonth(a.month)){this.addMonths(a.month-this.getMonth())}if(a.year!=-1&&Date.validateYear(a.year)){this.addYears(a.year-this.getFullYear())}if(a.day!=-1&&Date.validateDay(a.day,this.getFullYear(),this.getMonth())){this.addDays(a.day-this.getDate())}if(a.timezone){this.setTimezone(a.timezone)}if(a.timezoneOffset){this.setTimezoneOffset(a.timezoneOffset)}return this};Date.prototype.clearTime=function(){this.setHours(0);this.setMinutes(0);this.setSeconds(0);this.setMilliseconds(0);return this};Date.prototype.isLeapYear=function(){var a=this.getFullYear();return(((a%4===0)&&(a%100!==0))||(a%400===0))};Date.prototype.isWeekday=function(){return !(this.is().sat()||this.is().sun())};Date.prototype.getDaysInMonth=function(){return Date.getDaysInMonth(this.getFullYear(),this.getMonth())};Date.prototype.moveToFirstDayOfMonth=function(){return this.set({day:1})};Date.prototype.moveToLastDayOfMonth=function(){return this.set({day:this.getDaysInMonth()})};Date.prototype.moveToDayOfWeek=function(a,b){var c=(a-this.getDay()+7*(b||+1))%7;return this.addDays((c===0)?c+=7*(b||+1):c)};Date.prototype.moveToMonth=function(c,a){var b=(c-this.getMonth()+12*(a||+1))%12;return this.addMonths((b===0)?b+=12*(a||+1):b)};Date.prototype.getDayOfYear=function(){return Math.floor((this-new Date(this.getFullYear(),0,1))/86400000)};Date.prototype.getWeekOfYear=function(a){var h=this.getFullYear(),c=this.getMonth(),f=this.getDate();var k=a||Date.CultureInfo.firstDayOfWeek;var e=7+1-new Date(h,0,1).getDay();if(e==8){e=1}var b=((Date.UTC(h,c,f,0,0,0)-Date.UTC(h,0,1,0,0,0))/86400000)+1;var j=Math.floor((b-e+7)/7);if(j===k){h--;var g=7+1-new Date(h,0,1).getDay();if(g==2||g==8){j=53}else{j=52}}return j};Date.prototype.isDST=function(){console.log("isDST");return this.toString().match(/(E|C|M|P)(S|D)T/)[2]=="D"};Date.prototype.getTimezone=function(){return Date.getTimezoneAbbreviation(this.getUTCOffset,this.isDST())};Date.prototype.setTimezoneOffset=function(b){var a=this.getTimezoneOffset(),c=Number(b)*-6/10;this.addMinutes(c-a);return this};Date.prototype.setTimezone=function(a){return this.setTimezoneOffset(Date.getTimezoneOffset(a))};Date.prototype.getUTCOffset=function(){var b=this.getTimezoneOffset()*-10/6,a;if(b<0){a=(b-10000).toString();return a[0]+a.substr(2)}else{a=(b+10000).toString();return"+"+a.substr(1)}};Date.prototype.getDayName=function(a){return a?Date.CultureInfo.abbreviatedDayNames[this.getDay()]:Date.CultureInfo.dayNames[this.getDay()]};Date.prototype.getMonthName=function(a){return a?Date.CultureInfo.abbreviatedMonthNames[this.getMonth()]:Date.CultureInfo.monthNames[this.getMonth()]};Date.prototype._toString=Date.prototype.toString;Date.prototype.toString=function(c){var a=this;var b=function b(d){return(d.toString().length==1)?"0"+d:d};return c?c.replace(/dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?/g,function(d){switch(d){case"hh":return b(a.getHours()<13?a.getHours():(a.getHours()-12));case"h":return a.getHours()<13?a.getHours():(a.getHours()-12);case"HH":return b(a.getHours());case"H":return a.getHours();case"mm":return b(a.getMinutes());case"m":return a.getMinutes();case"ss":return b(a.getSeconds());case"s":return a.getSeconds();case"yyyy":return a.getFullYear();case"yy":return a.getFullYear().toString().substring(2,4);case"dddd":return a.getDayName();case"ddd":return a.getDayName(true);case"dd":return b(a.getDate());case"d":return a.getDate().toString();case"MMMM":return a.getMonthName();case"MMM":return a.getMonthName(true);case"MM":return b((a.getMonth()+1));case"M":return a.getMonth()+1;case"t":return a.getHours()<12?Date.CultureInfo.amDesignator.substring(0,1):Date.CultureInfo.pmDesignator.substring(0,1);case"tt":return a.getHours()<12?Date.CultureInfo.amDesignator:Date.CultureInfo.pmDesignator;case"zzz":case"zz":case"z":return""}}):this._toString()};Date.now=function(){return new Date()};Date.today=function(){return Date.now().clearTime()};Date.prototype._orient=+1;Date.prototype.next=function(){this._orient=+1;return this};Date.prototype.last=Date.prototype.prev=Date.prototype.previous=function(){this._orient=-1;return this};Date.prototype._is=false;Date.prototype.is=function(){this._is=true;return this};Number.prototype._dateElement="day";Number.prototype.fromNow=function(){var a={};a[this._dateElement]=this;return Date.now().add(a)};Number.prototype.ago=function(){var a={};a[this._dateElement]=this*-1;return Date.now().add(a)};(function(){var g=Date.prototype,a=Number.prototype;var q=("sunday monday tuesday wednesday thursday friday saturday").split(/\s/),o=("january february march april may june july august september october november december").split(/\s/),n=("Millisecond Second Minute Hour Day Week Month Year").split(/\s/),m;var l=function(j){return function(){if(this._is){this._is=false;return this.getDay()==j}return this.moveToDayOfWeek(j,this._orient)}};for(var f=0;f<q.length;f++){g[q[f]]=g[q[f].substring(0,3)]=l(f)}var h=function(j){return function(){if(this._is){this._is=false;return this.getMonth()===j}return this.moveToMonth(j,this._orient)}};for(var d=0;d<o.length;d++){g[o[d]]=g[o[d].substring(0,3)]=h(d)}var e=function(k){return function(){if(k.substring(k.length-1)!="s"){k+="s"}return this["add"+k](this._orient)}};var b=function(j){return function(){this._dateElement=j;return this}};for(var c=0;c<n.length;c++){m=n[c].toLowerCase();g[m]=g[m+"s"]=e(n[c]);a[m]=a[m+"s"]=b(m)}}());Date.prototype.toJSONString=function(){return this.toString("yyyy-MM-ddThh:mm:ssZ")};Date.prototype.toShortDateString=function(){return this.toString(Date.CultureInfo.formatPatterns.shortDatePattern)};Date.prototype.toLongDateString=function(){return this.toString(Date.CultureInfo.formatPatterns.longDatePattern)};Date.prototype.toShortTimeString=function(){return this.toString(Date.CultureInfo.formatPatterns.shortTimePattern)};Date.prototype.toLongTimeString=function(){return this.toString(Date.CultureInfo.formatPatterns.longTimePattern)};Date.prototype.getOrdinal=function(){switch(this.getDate()){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th"}};(function(){Date.Parsing={Exception:function(j){this.message="Parse error at '"+j.substring(0,10)+" ...'"}};var a=Date.Parsing;var c=a.Operators={rtoken:function(j){return function(k){var l=k.match(j);if(l){return([l[0],k.substring(l[0].length)])}else{throw new a.Exception(k)}}},token:function(j){return function(k){return c.rtoken(new RegExp("^s*"+k+"s*"))(k)}},stoken:function(j){return c.rtoken(new RegExp("^"+j))},until:function(j){return function(k){var l=[],n=null;while(k.length){try{n=j.call(this,k)}catch(m){l.push(n[0]);k=n[1];continue}break}return[l,k]}},many:function(j){return function(k){var n=[],l=null;while(k.length){try{l=j.call(this,k)}catch(m){return[n,k]}n.push(l[0]);k=l[1]}return[n,k]}},optional:function(j){return function(k){var l=null;try{l=j.call(this,k)}catch(m){return[null,k]}return[l[0],l[1]]}},not:function(j){return function(k){try{j.call(this,k)}catch(l){return[null,k]}throw new a.Exception(k)}},ignore:function(j){return j?function(k){var l=null;l=j.call(this,k);return[null,l[1]]}:null},product:function(){var k=arguments[0],l=Array.prototype.slice.call(arguments,1),m=[];for(var j=0;j<k.length;j++){m.push(c.each(k[j],l))}return m},cache:function(l){var j={},k=null;return function(m){try{k=j[m]=(j[m]||l.call(this,m))}catch(n){k=j[m]=n}if(k instanceof a.Exception){throw k}else{return k}}},any:function(){var j=arguments;return function(l){var m=null;for(var k=0;k<j.length;k++){if(j[k]==null){continue}try{m=(j[k].call(this,l))}catch(n){m=null}if(m){return m}}throw new a.Exception(l)}},each:function(){var j=arguments;return function(l){var o=[],m=null;for(var k=0;k<j.length;k++){if(j[k]==null){continue}try{m=(j[k].call(this,l))}catch(n){throw new a.Exception(l)}o.push(m[0]);l=m[1]}return[o,l]}},all:function(){var k=arguments,j=j;return j.each(j.optional(k))},sequence:function(j,k,l){k=k||c.rtoken(/^\s*/);l=l||null;if(j.length==1){return j[0]}return function(t){var u=null,v=null;var x=[];for(var o=0;o<j.length;o++){try{u=j[o].call(this,t)}catch(w){break}x.push(u[0]);try{v=k.call(this,u[1])}catch(n){v=null;break}t=v[1]}if(!u){throw new a.Exception(t)}if(v){throw new a.Exception(v[1])}if(l){try{u=l.call(this,u[1])}catch(m){throw new a.Exception(u[1])}}return[x,(u?u[1]:t)]}},between:function(k,l,j){j=j||k;var m=c.each(c.ignore(k),l,c.ignore(j));return function(n){var o=m.call(this,n);return[[o[0][0],r[0][2]],o[1]]}},list:function(j,k,l){k=k||c.rtoken(/^\s*/);l=l||null;return(j instanceof Array?c.each(c.product(j.slice(0,-1),c.ignore(k)),j.slice(-1),c.ignore(l)):c.each(c.many(c.each(j,c.ignore(k))),px,c.ignore(l)))},set:function(j,k,l){k=k||c.rtoken(/^\s*/);l=l||null;return function(C){var m=null,o=null,n=null,t=null,u=[[],C],B=false;for(var w=0;w<j.length;w++){n=null;o=null;m=null;B=(j.length==1);try{m=j[w].call(this,C)}catch(z){continue}t=[[m[0]],m[1]];if(m[1].length>0&&!B){try{n=k.call(this,m[1])}catch(A){B=true}}else{B=true}if(!B&&n[1].length===0){B=true}if(!B){var x=[];for(var v=0;v<j.length;v++){if(w!=v){x.push(j[v])}}o=c.set(x,k).call(this,n[1]);if(o[0].length>0){t[0]=t[0].concat(o[0]);t[1]=o[1]}}if(t[1].length<u[1].length){u=t}if(u[1].length===0){break}}if(u[0].length===0){return u}if(l){try{n=l.call(this,u[1])}catch(y){throw new a.Exception(u[1])}u[1]=n[1]}return u}},forward:function(j,k){return function(l){return j[k].call(this,l)}},replace:function(k,j){return function(l){var m=k.call(this,l);return[j,m[1]]}},process:function(k,j){return function(l){var m=k.call(this,l);return[j.call(this,m[0]),m[1]]}},min:function(j,k){return function(l){var m=k.call(this,l);if(m[0].length<j){throw new a.Exception(l)}return m}}};var h=function(j){return function(){var k=null,n=[];if(arguments.length>1){k=Array.prototype.slice.call(arguments)}else{if(arguments[0] instanceof Array){k=arguments[0]}}if(k){for(var m=0,l=k.shift();m<l.length;m++){k.unshift(l[m]);n.push(j.apply(null,k));k.shift();return n}}else{return j.apply(null,arguments)}}};var g="optional not ignore cache".split(/\s/);for(var d=0;d<g.length;d++){c[g[d]]=h(c[g[d]])}var f=function(j){return function(){if(arguments[0] instanceof Array){return j.apply(null,arguments[0])}else{return j.apply(null,arguments)}}};var e="each any all".split(/\s/);for(var b=0;b<e.length;b++){c[e[b]]=f(c[e[b]])}}());(function(){var f=function(k){var l=[];for(var g=0;g<k.length;g++){if(k[g] instanceof Array){l=l.concat(f(k[g]))}else{if(k[g]){l.push(k[g])}}}return l};Date.Grammar={};Date.Translator={hour:function(g){return function(){this.hour=Number(g)}},minute:function(g){return function(){this.minute=Number(g)}},second:function(g){return function(){this.second=Number(g)}},meridian:function(g){return function(){this.meridian=g.slice(0,1).toLowerCase()}},timezone:function(g){return function(){var k=g.replace(/[^\d\+\-]/g,"");if(k.length){this.timezoneOffset=Number(k)}else{this.timezone=g.toLowerCase()}}},day:function(g){var k=g[0];return function(){this.day=Number(k.match(/\d+/)[0])}},month:function(g){return function(){this.month=((g.length==3)?Date.getMonthNumberFromName(g):(Number(g)-1))}},year:function(g){return function(){var k=Number(g);this.year=((g.length>2)?k:(k+(((k+2000)<Date.CultureInfo.twoDigitYearMax)?2000:1900)))}},rday:function(g){return function(){switch(g){case"yesterday":this.days=-1;break;case"tomorrow":this.days=1;break;case"today":this.days=0;break;case"now":this.days=0;this.now=true;break}}},finishExact:function(g){g=(g instanceof Array)?g:[g];var k=new Date();this.year=k.getFullYear();this.month=k.getMonth();this.day=1;this.hour=0;this.minute=0;this.second=0;for(var l=0;l<g.length;l++){if(g[l]){g[l].call(this)}}this.hour=(this.meridian=="p"&&this.hour<13)?this.hour+12:this.hour;if(this.day>Date.getDaysInMonth(this.year,this.month)){throw new RangeError(this.day+" is not a valid value for days.")}var m=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second);if(this.timezone){m.set({timezone:this.timezone})}else{if(this.timezoneOffset){m.set({timezoneOffset:this.timezoneOffset})}}return m},finish:function(g){g=(g instanceof Array)?f(g):[g];if(g.length===0){return null}for(var n=0;n<g.length;n++){if(typeof g[n]=="function"){g[n].call(this)}}if(this.now){return new Date()}var k=Date.today();var s=null;var o=!!(this.days!=null||this.orient||this.operator);if(o){var q,m,l;l=((this.orient=="past"||this.operator=="subtract")?-1:1);if(this.weekday){this.unit="day";q=(Date.getDayNumberFromName(this.weekday)-k.getDay());m=7;this.days=q?((q+(l*m))%m):(l*m)}if(this.month){this.unit="month";q=(this.month-k.getMonth());m=12;this.months=q?((q+(l*m))%m):(l*m);this.month=null}if(!this.unit){this.unit="day"}if(this[this.unit+"s"]==null||this.operator!=null){if(!this.value){this.value=1}if(this.unit=="week"){this.unit="day";this.value=this.value*7}this[this.unit+"s"]=this.value*l}return k.add(this)}else{if(this.meridian&&this.hour){this.hour=(this.hour<13&&this.meridian=="p")?this.hour+12:this.hour}if(this.weekday&&!this.day){this.day=(k.addDays((Date.getDayNumberFromName(this.weekday)-k.getDay()))).getDate()}if(this.month&&!this.day){this.day=1}return k.set(this)}}};var b=Date.Parsing.Operators,e=Date.Grammar,d=Date.Translator,j;e.datePartDelimiter=b.rtoken(/^([\s\-\.\,\/\x27]+)/);e.timePartDelimiter=b.stoken(":");e.whiteSpace=b.rtoken(/^\s*/);e.generalDelimiter=b.rtoken(/^(([\s\,]|at|on)+)/);var a={};e.ctoken=function(n){var m=a[n];if(!m){var o=Date.CultureInfo.regexPatterns;var l=n.split(/\s+/),k=[];for(var g=0;g<l.length;g++){k.push(b.replace(b.rtoken(o[l[g]]),l[g]))}m=a[n]=b.any.apply(null,k)}return m};e.ctoken2=function(g){return b.rtoken(Date.CultureInfo.regexPatterns[g])};e.h=b.cache(b.process(b.rtoken(/^(0[0-9]|1[0-2]|[1-9])/),d.hour));e.hh=b.cache(b.process(b.rtoken(/^(0[0-9]|1[0-2])/),d.hour));e.H=b.cache(b.process(b.rtoken(/^([0-1][0-9]|2[0-3]|[0-9])/),d.hour));e.HH=b.cache(b.process(b.rtoken(/^([0-1][0-9]|2[0-3])/),d.hour));e.m=b.cache(b.process(b.rtoken(/^([0-5][0-9]|[0-9])/),d.minute));e.mm=b.cache(b.process(b.rtoken(/^[0-5][0-9]/),d.minute));e.s=b.cache(b.process(b.rtoken(/^([0-5][0-9]|[0-9])/),d.second));e.ss=b.cache(b.process(b.rtoken(/^[0-5][0-9]/),d.second));e.hms=b.cache(b.sequence([e.H,e.mm,e.ss],e.timePartDelimiter));e.t=b.cache(b.process(e.ctoken2("shortMeridian"),d.meridian));e.tt=b.cache(b.process(e.ctoken2("longMeridian"),d.meridian));e.z=b.cache(b.process(b.rtoken(/^(\+|\-)?\s*\d\d\d\d?/),d.timezone));e.zz=b.cache(b.process(b.rtoken(/^(\+|\-)\s*\d\d\d\d/),d.timezone));e.zzz=b.cache(b.process(e.ctoken2("timezone"),d.timezone));e.timeSuffix=b.each(b.ignore(e.whiteSpace),b.set([e.tt,e.zzz]));e.time=b.each(b.optional(b.ignore(b.stoken("T"))),e.hms,e.timeSuffix);e.d=b.cache(b.process(b.each(b.rtoken(/^([0-2]\d|3[0-1]|\d)/),b.optional(e.ctoken2("ordinalSuffix"))),d.day));e.dd=b.cache(b.process(b.each(b.rtoken(/^([0-2]\d|3[0-1])/),b.optional(e.ctoken2("ordinalSuffix"))),d.day));e.ddd=e.dddd=b.cache(b.process(e.ctoken("sun mon tue wed thu fri sat"),function(g){return function(){this.weekday=g}}));e.M=b.cache(b.process(b.rtoken(/^(1[0-2]|0\d|\d)/),d.month));e.MM=b.cache(b.process(b.rtoken(/^(1[0-2]|0\d)/),d.month));e.MMM=e.MMMM=b.cache(b.process(e.ctoken("jan feb mar apr may jun jul aug sep oct nov dec"),d.month));e.y=b.cache(b.process(b.rtoken(/^(\d\d?)/),d.year));e.yy=b.cache(b.process(b.rtoken(/^(\d\d)/),d.year));e.yyy=b.cache(b.process(b.rtoken(/^(\d\d?\d?\d?)/),d.year));e.yyyy=b.cache(b.process(b.rtoken(/^(\d\d\d\d)/),d.year));j=function(){return b.each(b.any.apply(null,arguments),b.not(e.ctoken2("timeContext")))};e.day=j(e.d,e.dd);e.month=j(e.M,e.MMM);e.year=j(e.yyyy,e.yy);e.orientation=b.process(e.ctoken("past future"),function(g){return function(){this.orient=g}});e.operator=b.process(e.ctoken("add subtract"),function(g){return function(){this.operator=g}});e.rday=b.process(e.ctoken("yesterday tomorrow today now"),d.rday);e.unit=b.process(e.ctoken("minute hour day week month year"),function(g){return function(){this.unit=g}});e.value=b.process(b.rtoken(/^\d\d?(st|nd|rd|th)?/),function(g){return function(){this.value=g.replace(/\D/g,"")}});e.expression=b.set([e.rday,e.operator,e.value,e.unit,e.orientation,e.ddd,e.MMM]);j=function(){return b.set(arguments,e.datePartDelimiter)};e.mdy=j(e.ddd,e.month,e.day,e.year);e.ymd=j(e.ddd,e.year,e.month,e.day);e.dmy=j(e.ddd,e.day,e.month,e.year);e.date=function(g){return((e[Date.CultureInfo.dateElementOrder]||e.mdy).call(this,g))};e.format=b.process(b.many(b.any(b.process(b.rtoken(/^(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?)/),function(g){if(e[g]){return e[g]}else{throw Date.Parsing.Exception(g)}}),b.process(b.rtoken(/^[^dMyhHmstz]+/),function(g){return b.ignore(b.stoken(g))}))),function(g){return b.process(b.each.apply(null,g),d.finishExact)});var h={};var c=function(g){return h[g]=(h[g]||e.format(g)[0])};e.formats=function(k){if(k instanceof Array){var l=[];for(var g=0;g<k.length;g++){l.push(c(k[g]))}return b.any.apply(null,l)}else{return c(k)}};e._formats=e.formats(["yyyy-MM-ddTHH:mm:ss","ddd, MMM dd, yyyy H:mm:ss tt","ddd MMM d yyyy HH:mm:ss zzz","d"]);e._start=b.process(b.set([e.date,e.time,e.expression],e.generalDelimiter,e.whiteSpace),d.finish);e.start=function(g){try{var k=e._formats.call({},g);if(k[1].length===0){return k}}catch(l){}return e._start.call({},g)}}());Date._parse=Date.parse;Date.parse=function(a){var b=null;if(!a){return null}try{b=Date.Grammar.start.call({},a)}catch(c){return null}return((b[1].length===0)?b[0]:null)};Date.getParseFunction=function(b){var a=Date.Grammar.formats(b);return function(c){var d=null;try{d=a.call({},c)}catch(f){return null}return((d[1].length===0)?d[0]:null)}};Date.parseExact=function(a,b){return Date.getParseFunction(b)(a)};
/*!
 *
 * Copyright 2009-2012 Kris Kowal under the terms of the MIT
 * license found at http://github.com/kriskowal/q/raw/master/LICENSE
 *
 * With parts by Tyler Close
 * Copyright 2007-2009 Tyler Close under the terms of the MIT X license found
 * at http://www.opensource.org/licenses/mit-license.html
 * Forked at ref_send.js version: 2009-05-11
 *
 * With parts by Mark Miller
 * Copyright (C) 2011 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */
(function(a){if(typeof bootstrap==="function"){bootstrap("promise",a)}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=a()}else{if(typeof define==="function"&&define.amd){define(a)}else{if(typeof ses!=="undefined"){if(!ses.ok()){return}else{ses.makeQ=a}}else{if(typeof self!=="undefined"){self.Q=a()}else{throw new Error("This environment was not anticiapted by Q. Please file a bug.")}}}}}})(function(){var H=false;try{throw new Error()}catch(ak){H=!!ak.stack}var x=Z();var k;var ag=function(){};var al=(function(){var ar={task:void 0,next:null};var aq=ar;var au=false;var Q=void 0;var ap=false;function e(){while(ar.next){ar=ar.next;var av=ar.task;ar.task=void 0;var aw=ar.domain;if(aw){ar.domain=void 0;aw.enter()}try{av()}catch(ax){if(ap){if(aw){aw.exit()}setTimeout(e,0);if(aw){aw.enter()}throw ax}else{setTimeout(function(){throw ax},0)}}if(aw){aw.exit()}}au=false}al=function(av){aq=aq.next={task:av,domain:ap&&process.domain,next:null};if(!au){au=true;Q()}};if(typeof process!=="undefined"&&process.nextTick){ap=true;Q=function(){process.nextTick(e)}}else{if(typeof setImmediate==="function"){if(typeof window!=="undefined"){Q=setImmediate.bind(window,e)}else{Q=function(){setImmediate(e)}}}else{if(typeof MessageChannel!=="undefined"){var at=new MessageChannel();at.port1.onmessage=function(){Q=ao;at.port1.onmessage=e;e()};var ao=function(){at.port2.postMessage(0)};Q=function(){setTimeout(e,0);ao()}}else{Q=function(){setTimeout(e,0)}}}}return al})();var a=Function.call;function s(e){return function(){return a.apply(e,arguments)}}var ae=s(Array.prototype.slice);var c=s(Array.prototype.reduce||function(ap,ao){var e=0,Q=this.length;if(arguments.length===1){do{if(e in this){ao=this[e++];break}if(++e>=Q){throw new TypeError()}}while(1)}for(;e<Q;e++){if(e in this){ao=ap(ao,this[e],e)}}return ao});var U=s(Array.prototype.indexOf||function(Q){for(var e=0;e<this.length;e++){if(this[e]===Q){return e}}return -1});var b=s(Array.prototype.map||function(ap,Q){var e=this;var ao=[];c(e,function(at,ar,aq){ao.push(ap.call(Q,ar,aq,e))},void 0);return ao});var K=Object.create||function(Q){function e(){}e.prototype=Q;return new e()};var D=s(Object.prototype.hasOwnProperty);var J=Object.keys||function(e){var ao=[];for(var Q in e){if(D(e,Q)){ao.push(Q)}}return ao};var an=s(Object.prototype.toString);function Y(e){return e===Object(e)}function z(e){return(an(e)==="[object StopIteration]"||e instanceof L)}var L;if(typeof ReturnValue!=="undefined"){L=ReturnValue}else{L=function(e){this.value=e}}var ab="From previous event:";function n(e,aq){if(H&&aq.stack&&typeof e==="object"&&e!==null&&e.stack&&e.stack.indexOf(ab)===-1){var ao=[];for(var ap=aq;!!ap;ap=ap.source){if(ap.stack){ao.unshift(ap.stack)}}ao.unshift(e.stack);var Q=ao.join("\n"+ab+"\n");e.stack=N(Q)}}function N(ap){var Q=ap.split("\n");var aq=[];for(var ao=0;ao<Q.length;++ao){var e=Q[ao];if(!g(e)&&!ac(e)&&e){aq.push(e)}}return aq.join("\n")}function ac(e){return e.indexOf("(module.js:")!==-1||e.indexOf("(node.js:")!==-1}function ai(e){var ap=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(e);if(ap){return[ap[1],Number(ap[2])]}var ao=/at ([^ ]+):(\d+):(?:\d+)$/.exec(e);if(ao){return[ao[1],Number(ao[2])]}var Q=/.*@(.+):(\d+)$/.exec(e);if(Q){return[Q[1],Number(Q[2])]}}function g(Q){var ao=ai(Q);if(!ao){return false}var ap=ao[0];var e=ao[1];return ap===k&&e>=x&&e<=v}function Z(){if(!H){return}try{throw new Error()}catch(aq){var Q=aq.stack.split("\n");var ao=Q[0].indexOf("@")>0?Q[1]:Q[2];var ap=ai(ao);if(!ap){return}k=ap[0];return ap[1]}}function F(ao,e,Q){return function(){if(typeof console!=="undefined"&&typeof console.warn==="function"){console.warn(e+" is deprecated, use "+Q+" instead.",new Error("").stack)}return ao.apply(ao,arguments)}}function m(e){if(e instanceof R){return e}if(P(e)){return O(e)}else{return C(e)}}m.resolve=m;m.nextTick=al;m.longStackSupport=false;if(typeof process==="object"&&process&&process.env&&process.env.Q_DEBUG){m.longStackSupport=true}m.defer=h;function h(){var ap=[],ar=[],aq;var Q=K(h.prototype);var au=K(R.prototype);au.promiseDispatch=function(aw,ax,av){var e=ae(arguments);if(ap){ap.push(e);if(ax==="when"&&av[1]){ar.push(av[1])}}else{m.nextTick(function(){aq.promiseDispatch.apply(aq,e)})}};au.valueOf=function(){if(ap){return au}var e=M(aq);if(B(e)){aq=e}return e};au.inspect=function(){if(!aq){return{state:"pending"}}return aq.inspect()};if(m.longStackSupport&&H){try{throw new Error()}catch(at){au.stack=at.stack.substring(at.stack.indexOf("\n")+1)}}function ao(e){aq=e;au.source=e;c(ap,function(aw,av){m.nextTick(function(){e.promiseDispatch.apply(e,av)})},void 0);ap=void 0;ar=void 0}Q.promise=au;Q.resolve=function(e){if(aq){return}ao(m(e))};Q.fulfill=function(e){if(aq){return}ao(C(e))};Q.reject=function(e){if(aq){return}ao(G(e))};Q.notify=function(e){if(aq){return}c(ar,function(aw,av){m.nextTick(function(){av(e)})},void 0)};return Q}h.prototype.makeNodeResolver=function(){var e=this;return function(Q,ao){if(Q){e.reject(Q)}else{if(arguments.length>2){e.resolve(ae(arguments,1))}else{e.resolve(ao)}}}};m.Promise=W;m.promise=W;function W(ao){if(typeof ao!=="function"){throw new TypeError("resolver must be a function.")}var e=h();try{ao(e.resolve,e.reject,e.notify)}catch(Q){e.reject(Q)}return e.promise}W.race=o;W.all=A;W.reject=G;W.resolve=m;m.passByCopy=function(e){return e};R.prototype.passByCopy=function(){return this};m.join=function(e,Q){return m(e).join(Q)};R.prototype.join=function(e){return m([this,e]).spread(function(Q,ao){if(Q===ao){return Q}else{throw new Error("Can't join: not the same: "+Q+" "+ao)}})};m.race=o;function o(e){return W(function(aq,ap){for(var ao=0,Q=e.length;ao<Q;ao++){m(e[ao]).then(aq,ap)}})}R.prototype.race=function(){return this.then(m.race)};m.makePromise=R;function R(Q,aq,ap){if(aq===void 0){aq=function(ar){return G(new Error("Promise does not support operation: "+ar))}}if(ap===void 0){ap=function(){return{state:"unknown"}}}var ao=K(R.prototype);ao.promiseDispatch=function(av,aw,at){var ar;try{if(Q[aw]){ar=Q[aw].apply(ao,at)}else{ar=aq.call(ao,aw,at)}}catch(au){ar=G(au)}if(av){av(ar)}};ao.inspect=ap;if(ap){var e=ap();if(e.state==="rejected"){ao.exception=e.reason}ao.valueOf=function(){var ar=ap();if(ar.state==="pending"||ar.state==="rejected"){return ao}return ar.value}}return ao}R.prototype.toString=function(){return"[object Promise]"};R.prototype.then=function(aq,ar,Q){var at=this;var au=h();var ao=false;function ap(ax){try{return typeof aq==="function"?aq(ax):ax}catch(aw){return G(aw)}}function av(aw){if(typeof ar==="function"){n(aw,at);try{return ar(aw)}catch(ax){return G(ax)}}return G(aw)}function e(aw){return typeof Q==="function"?Q(aw):aw}m.nextTick(function(){at.promiseDispatch(function(aw){if(ao){return}ao=true;au.resolve(ap(aw))},"when",[function(aw){if(ao){return}ao=true;au.resolve(av(aw))}])});at.promiseDispatch(void 0,"when",[void 0,function(aw){var ay;var az=false;try{ay=e(aw)}catch(ax){az=true;if(m.onerror){m.onerror(ax)}else{throw ax}}if(!az){au.notify(ay)}}]);return au.promise};m.tap=function(e,Q){return m(e).tap(Q)};R.prototype.tap=function(e){e=m(e);return this.then(function(Q){return e.fcall(Q).thenResolve(Q)})};m.when=S;function S(ao,e,Q,ap){return m(ao).then(e,Q,ap)}R.prototype.thenResolve=function(e){return this.then(function(){return e})};m.thenResolve=function(Q,e){return m(Q).thenResolve(e)};R.prototype.thenReject=function(e){return this.then(function(){throw e})};m.thenReject=function(Q,e){return m(Q).thenReject(e)};m.nearer=M;function M(Q){if(B(Q)){var e=Q.inspect();if(e.state==="fulfilled"){return e.value}}return Q}m.isPromise=B;function B(e){return e instanceof R}m.isPromiseAlike=P;function P(e){return Y(e)&&typeof e.then==="function"}m.isPending=af;function af(e){return B(e)&&e.inspect().state==="pending"}R.prototype.isPending=function(){return this.inspect().state==="pending"};m.isFulfilled=T;function T(e){return !B(e)||e.inspect().state==="fulfilled"}R.prototype.isFulfilled=function(){return this.inspect().state==="fulfilled"};m.isRejected=X;function X(e){return B(e)&&e.inspect().state==="rejected"}R.prototype.isRejected=function(){return this.inspect().state==="rejected"};var ad=[];var am=[];var q=true;function aj(){ad.length=0;am.length=0;if(!q){q=true}}function E(Q,e){if(!q){return}am.push(Q);if(e&&typeof e.stack!=="undefined"){ad.push(e.stack)}else{ad.push("(no stack) "+e)}}function l(Q){if(!q){return}var e=U(am,Q);if(e!==-1){am.splice(e,1);ad.splice(e,1)}}m.resetUnhandledRejections=aj;m.getUnhandledReasons=function(){return ad.slice()};m.stopUnhandledRejectionTracking=function(){aj();q=false};aj();m.reject=G;function G(Q){var e=R({when:function(aq){if(aq){l(this)}return aq?aq(Q):this}},function ap(){return this},function ao(){return{state:"rejected",reason:Q}});E(e,Q);return e}m.fulfill=C;function C(e){return R({when:function(){return e},get:function(ao){return e[ao]},set:function(ao,ap){e[ao]=ap},"delete":function(ao){delete e[ao]},post:function(ap,ao){if(ap===null||ap===void 0){return e.apply(void 0,ao)}else{return e[ap].apply(e,ao)}},apply:function(ap,ao){return e.apply(ap,ao)},keys:function(){return J(e)}},void 0,function Q(){return{state:"fulfilled",value:e}})}function O(Q){var e=h();m.nextTick(function(){try{Q.then(e.resolve,e.reject,e.notify)}catch(ao){e.reject(ao)}});return e.promise}m.master=y;function y(e){return R({isDef:function(){}},function Q(ap,ao){return aa(e,ap,ao)},function(){return m(e).inspect()})}m.spread=f;function f(ao,e,Q){return m(ao).spread(e,Q)}R.prototype.spread=function(e,Q){return this.all().then(function(ao){return e.apply(void 0,ao)},Q)};m.async=V;function V(e){return function(){function ao(av,at){var ar;if(typeof StopIteration==="undefined"){try{ar=ap[av](at)}catch(au){return G(au)}if(ar.done){return m(ar.value)}else{return S(ar.value,aq,Q)}}else{try{ar=ap[av](at)}catch(au){if(z(au)){return m(au.value)}else{return G(au)}}return S(ar,aq,Q)}}var ap=e.apply(this,arguments);var aq=ao.bind(ao,"next");var Q=ao.bind(ao,"throw");return aq()}}m.spawn=u;function u(e){m.done(m.async(e)())}m["return"]=j;function j(e){throw new L(e)}m.promised=t;function t(e){return function(){return f([this,A(arguments)],function(Q,ao){return e.apply(Q,ao)})}}m.dispatch=aa;function aa(Q,ao,e){return m(Q).dispatch(ao,e)}R.prototype.dispatch=function(ap,ao){var Q=this;var e=h();m.nextTick(function(){Q.promiseDispatch(e.resolve,ap,ao)});return e.promise};m.get=function(e,Q){return m(e).dispatch("get",[Q])};R.prototype.get=function(e){return this.dispatch("get",[e])};m.set=function(e,Q,ao){return m(e).dispatch("set",[Q,ao])};R.prototype.set=function(e,Q){return this.dispatch("set",[e,Q])};m.del=m["delete"]=function(e,Q){return m(e).dispatch("delete",[Q])};R.prototype.del=R.prototype["delete"]=function(e){return this.dispatch("delete",[e])};m.mapply=m.post=function(ao,Q,e){return m(ao).dispatch("post",[Q,e])};R.prototype.mapply=R.prototype.post=function(Q,e){return this.dispatch("post",[Q,e])};m.send=m.mcall=m.invoke=function(Q,e){return m(Q).dispatch("post",[e,ae(arguments,2)])};R.prototype.send=R.prototype.mcall=R.prototype.invoke=function(e){return this.dispatch("post",[e,ae(arguments,1)])};m.fapply=function(Q,e){return m(Q).dispatch("apply",[void 0,e])};R.prototype.fapply=function(e){return this.dispatch("apply",[void 0,e])};m["try"]=m.fcall=function(e){return m(e).dispatch("apply",[void 0,ae(arguments,1)])};R.prototype.fcall=function(){return this.dispatch("apply",[void 0,ae(arguments)])};m.fbind=function(Q){var ap=m(Q);var e=ae(arguments,1);return function ao(){return ap.dispatch("apply",[this,e.concat(ae(arguments))])}};R.prototype.fbind=function(){var ao=this;var e=ae(arguments);return function Q(){return ao.dispatch("apply",[this,e.concat(ae(arguments))])}};m.keys=function(e){return m(e).dispatch("keys",[])};R.prototype.keys=function(){return this.dispatch("keys",[])};m.all=A;function A(e){return S(e,function(ap){var ao=0;var Q=h();c(ap,function(au,at,ar){var aq;if(B(at)&&(aq=at.inspect()).state==="fulfilled"){ap[ar]=aq.value}else{++ao;S(at,function(av){ap[ar]=av;if(--ao===0){Q.resolve(ap)}},Q.reject,function(av){Q.notify({index:ar,value:av})})}},void 0);if(ao===0){Q.resolve(ap)}return Q.promise})}R.prototype.all=function(){return A(this)};m.allResolved=F(d,"allResolved","allSettled");function d(e){return S(e,function(Q){Q=b(Q,m);return S(A(b(Q,function(ao){return S(ao,ag,ag)})),function(){return Q})})}R.prototype.allResolved=function(){return d(this)};m.allSettled=w;function w(e){return m(e).allSettled()}R.prototype.allSettled=function(){return this.then(function(e){return A(b(e,function(ao){ao=m(ao);function Q(){return ao.inspect()}return ao.then(Q,Q)}))})};m.fail=m["catch"]=function(e,Q){return m(e).then(void 0,Q)};R.prototype.fail=R.prototype["catch"]=function(e){return this.then(void 0,e)};m.progress=I;function I(e,Q){return m(e).then(void 0,void 0,Q)}R.prototype.progress=function(e){return this.then(void 0,void 0,e)};m.fin=m["finally"]=function(e,Q){return m(e)["finally"](Q)};R.prototype.fin=R.prototype["finally"]=function(e){e=m(e);return this.then(function(Q){return e.fcall().then(function(){return Q})},function(Q){return e.fcall().then(function(){throw Q})})};m.done=function(ao,e,ap,Q){return m(ao).done(e,ap,Q)};R.prototype.done=function(e,ap,ao){var Q=function(ar){m.nextTick(function(){n(ar,aq);if(m.onerror){m.onerror(ar)}else{throw ar}})};var aq=e||ap||ao?this.then(e,ap,ao):this;if(typeof process==="object"&&process&&process.domain){Q=process.domain.bind(Q)}aq.then(void 0,Q)};m.timeout=function(ao,Q,e){return m(ao).timeout(Q,e)};R.prototype.timeout=function(ao,Q){var e=h();var ap=setTimeout(function(){if(!Q||"string"===typeof Q){Q=new Error(Q||"Timed out after "+ao+" ms");Q.code="ETIMEDOUT"}e.reject(Q)},ao);this.then(function(aq){clearTimeout(ap);e.resolve(aq)},function(aq){clearTimeout(ap);e.reject(aq)},e.notify);return e.promise};m.delay=function(e,Q){if(Q===void 0){Q=e;e=void 0}return m(e).delay(Q)};R.prototype.delay=function(e){return this.then(function(ao){var Q=h();setTimeout(function(){Q.resolve(ao)},e);return Q.promise})};m.nfapply=function(Q,e){return m(Q).nfapply(e)};R.prototype.nfapply=function(Q){var e=h();var ao=ae(Q);ao.push(e.makeNodeResolver());this.fapply(ao).fail(e.reject);return e.promise};m.nfcall=function(Q){var e=ae(arguments,1);return m(Q).nfapply(e)};R.prototype.nfcall=function(){var Q=ae(arguments);var e=h();Q.push(e.makeNodeResolver());this.fapply(Q).fail(e.reject);return e.promise};m.nfbind=m.denodeify=function(Q){var e=ae(arguments,1);return function(){var ap=e.concat(ae(arguments));var ao=h();ap.push(ao.makeNodeResolver());m(Q).fapply(ap).fail(ao.reject);return ao.promise}};R.prototype.nfbind=R.prototype.denodeify=function(){var e=ae(arguments);e.unshift(this);return m.denodeify.apply(void 0,e)};m.nbind=function(ao,e){var Q=ae(arguments,2);return function(){var ar=Q.concat(ae(arguments));var ap=h();ar.push(ap.makeNodeResolver());function aq(){return ao.apply(e,arguments)}m(aq).fapply(ar).fail(ap.reject);return ap.promise}};R.prototype.nbind=function(){var e=ae(arguments,0);e.unshift(this);return m.nbind.apply(void 0,e)};m.nmapply=m.npost=function(ao,Q,e){return m(ao).npost(Q,e)};R.prototype.nmapply=R.prototype.npost=function(ao,Q){var ap=ae(Q||[]);var e=h();ap.push(e.makeNodeResolver());this.dispatch("post",[ao,ap]).fail(e.reject);return e.promise};m.nsend=m.nmcall=m.ninvoke=function(ao,Q){var ap=ae(arguments,2);var e=h();ap.push(e.makeNodeResolver());m(ao).dispatch("post",[Q,ap]).fail(e.reject);return e.promise};R.prototype.nsend=R.prototype.nmcall=R.prototype.ninvoke=function(Q){var ao=ae(arguments,1);var e=h();ao.push(e.makeNodeResolver());this.dispatch("post",[Q,ao]).fail(e.reject);return e.promise};m.nodeify=ah;function ah(Q,e){return m(Q).nodeify(e)}R.prototype.nodeify=function(e){if(e){this.then(function(Q){m.nextTick(function(){e(null,Q)})},function(Q){m.nextTick(function(){e(Q)})})}else{return this}};var v=Z();return m});(function(){var e,h,j,b,g,l,f,k,c,d;function m(q,n){var o,s;s=this;s.element=typeof q=="object"?q:document.getElementById(q);s.wrapper=s.element.parentNode;s.element.style.webkitTransitionProperty="-webkit-transform";s.element.style.webkitTransitionTimingFunction="cubic-bezier(0,0,0.25,1)";s.element.style.webkitTransitionDuration="0";s.element.style.webkitTransform=k+"0,0"+c;s.options={bounce:e,momentum:e,checkDOMChanges:true,topOnDOMChanges:false,hScrollbar:e,vScrollbar:e,fadeScrollbar:j||!b,shrinkScrollbar:j||!b,desktopCompatibility:false,overflow:"auto",snap:false,bounceLock:false,scrollbarColor:"rgba(0,0,0,0.5)",onScrollEnd:function(){}};if(typeof n=="object"){for(o in n){s.options[o]=n[o]}}if(s.options.desktopCompatibility){s.options.overflow="hidden"}s.onScrollEnd=s.options.onScrollEnd;delete s.options.onScrollEnd;s.wrapper.style.overflow=s.options.overflow;s.refresh();window.addEventListener(window.hasOwnProperty("onorientationchange")?"orientationchange":"resize",s,false);if(b||s.options.desktopCompatibility){s.element.addEventListener(g,s,false);s.element.addEventListener(l,s,false);s.element.addEventListener(f,s,false)}if(s.options.checkDOMChanges){s.element.addEventListener("DOMSubtreeModified",s,false)}}function a(o,v,u,q,n){var t,s;s=this;t=document;s.dir=o;s.fade=u;s.shrink=q;s.uid=++d;s.bar=t.createElement("div");s.bar.style.cssText="position:absolute;top:0;left:0;-webkit-transition-timing-function:cubic-bezier(0,0,0.25,1);pointer-events:none;-webkit-transition-duration:0;-webkit-transition-delay:0;-webkit-transition-property:-webkit-transform;z-index:10;background:"+n+";-webkit-transform:"+k+"0,0"+c+";"+(o=="horizontal"?"-webkit-border-radius:3px 2px;min-width:6px;min-height:5px":"-webkit-border-radius:2px 3px;min-width:5px;min-height:6px");s.wrapper=t.createElement("div");s.wrapper.style.cssText="-webkit-mask:-webkit-canvas(scrollbar"+s.uid+s.dir+");position:absolute;z-index:10;pointer-events:none;overflow:hidden;opacity:0;-webkit-transition-duration:"+(u?"300ms":"0")+";-webkit-transition-delay:0;-webkit-transition-property:opacity;"+(s.dir=="horizontal"?"bottom:2px;left:2px;right:7px;height:5px":"top:2px;right:2px;bottom:7px;width:5px;");s.wrapper.appendChild(s.bar);v.appendChild(s.wrapper)}m.prototype={x:0,y:0,enabled:true,handleEvent:function(o){var n=this;switch(o.type){case g:n.touchStart(o);break;case l:n.touchMove(o);break;case f:n.touchEnd(o);break;case"webkitTransitionEnd":n.transitionEnd();break;case"orientationchange":case"resize":if(h){window.setTimeout(function(){n.refresh()},200)}else{n.refresh()}break;case"DOMSubtreeModified":n.onDOMModified(o);break}},onDOMModified:function(o){var n=this;if(o.target.parentNode!=n.element){return}setTimeout(function(){n.refresh()},0);if(n.options.topOnDOMChanges&&(n.x!=0||n.y!=0)){n.scrollTo(0,0,"0")}},refresh:function(){var s,q,n,o;o=this;s=o.x;q=o.y;o.scrollWidth=o.wrapper.clientWidth;o.scrollHeight=o.wrapper.clientHeight;o.scrollerWidth=o.element.offsetWidth;o.scrollerHeight=o.element.offsetHeight;o.maxScrollX=o.scrollWidth-o.scrollerWidth;o.maxScrollY=o.scrollHeight-o.scrollerHeight;o.directionX=0;o.directionY=0;if(o.scrollX){if(o.maxScrollX>=0){s=0}else{if(o.x<o.maxScrollX){s=o.maxScrollX}}}if(o.scrollY){if(o.maxScrollY>=0){q=0}else{if(o.y<o.maxScrollY){q=o.maxScrollY}}}if(o.options.snap){o.maxPageX=-Math.floor(o.maxScrollX/o.scrollWidth);o.maxPageY=-Math.floor(o.maxScrollY/o.scrollHeight);n=o.snap(s,q);s=n.x;q=n.y}if(s!=o.x||q!=o.y){o.setTransitionTime("0");o.setPosition(s,q,true)}o.scrollX=o.scrollerWidth>o.scrollWidth;o.scrollY=(!o.options.bounceLock&&!o.scrollX)||o.scrollerHeight>o.scrollHeight;if(o.options.hScrollbar&&o.scrollX){o.scrollBarX=o.scrollBarX||new a("horizontal",o.wrapper,o.options.fadeScrollbar,o.options.shrinkScrollbar,o.options.scrollbarColor);o.scrollBarX.init(o.scrollWidth,o.scrollerWidth)}else{if(o.scrollBarX){o.scrollBarX=o.scrollBarX.remove()}}if(o.options.vScrollbar&&o.scrollY&&o.scrollerHeight>o.scrollHeight){o.scrollBarY=o.scrollBarY||new a("vertical",o.wrapper,o.options.fadeScrollbar,o.options.shrinkScrollbar,o.options.scrollbarColor);o.scrollBarY.init(o.scrollHeight,o.scrollerHeight)}else{if(o.scrollBarY){o.scrollBarY=o.scrollBarY.remove()}}},setPosition:function(n,s,q){var o=this;o.x=n;o.y=s;o.element.style.webkitTransform=k+o.x+"px,"+o.y+"px"+c;if(!q){if(o.scrollBarX){o.scrollBarX.setPosition(o.x)}if(o.scrollBarY){o.scrollBarY.setPosition(o.y)}}},setTransitionTime:function(o){var n=this;o=o||"0";n.element.style.webkitTransitionDuration=o;if(n.scrollBarX){n.scrollBarX.bar.style.webkitTransitionDuration=o;n.scrollBarX.wrapper.style.webkitTransitionDuration=e&&n.options.fadeScrollbar?"300ms":"0"}if(n.scrollBarY){n.scrollBarY.bar.style.webkitTransitionDuration=o;n.scrollBarY.wrapper.style.webkitTransitionDuration=e&&n.options.fadeScrollbar?"300ms":"0"}},touchStart:function(q){var n,o;o=this;if(!o.enabled){return}q.stopPropagation();o.scrolling=true;o.moved=false;o.distX=0;o.distY=0;o.setTransitionTime("0");if(o.options.momentum||o.options.snap){n=new window.WebKitCSSMatrix(window.getComputedStyle(o.element).webkitTransform);if(n.e!=o.x||n.f!=o.y){document.removeEventListener("webkitTransitionEnd",o,false);o.setPosition(n.e,n.f);o.moved=true}}o.touchStartX=b?q.changedTouches[0].pageX:q.pageX;o.scrollStartX=o.x;o.touchStartY=b?q.changedTouches[0].pageY:q.pageY;o.scrollStartY=o.y;o.scrollStartTime=q.timeStamp;o.directionX=0;o.directionY=0},touchMove:function(v){var o,w,u,s,q,t,n;if(!this.scrolling){return}t=this;s=b?v.changedTouches[0].pageX:v.pageX;q=b?v.changedTouches[0].pageY:v.pageY;o=t.scrollX?s-t.touchStartX:0;n=t.scrollY?q-t.touchStartY:0;w=t.x+o;u=t.y+n;v.preventDefault();v.stopPropagation();t.touchStartX=s;t.touchStartY=q;if(w>=0||w<t.maxScrollX){w=t.options.bounce?Math.round(t.x+o/3):(w>=0||t.maxScrollX>=0)?0:t.maxScrollX}if(u>=0||u<t.maxScrollY){u=t.options.bounce?Math.round(t.y+n/3):(u>=0||t.maxScrollY>=0)?0:t.maxScrollY}if(t.distX+t.distY>5){if(t.distX-3>t.distY){u=t.y;n=0}else{if(t.distY-3>t.distX){w=t.x;o=0}}t.setPosition(w,u);t.moved=true;t.directionX=o>0?-1:1;t.directionY=n>0?-1:1}else{t.distX+=Math.abs(o);t.distY+=Math.abs(n)}},touchEnd:function(x){var o,n,q,w,u,y,t,v,s;if(!this.scrolling){return}v=this;s=x.timeStamp-v.scrollStartTime;y=b?x.changedTouches[0]:x;q=0;w=v.x;u=v.y;v.scrolling=false;if(!v.moved){v.resetPosition();return}if(!v.options.snap&&s>250){v.resetPosition();return}if(v.options.momentum){o=v.scrollX===true?v.momentum(v.x-v.scrollStartX,s,v.options.bounce?-v.x+v.scrollWidth/5:-v.x,v.options.bounce?v.x+v.scrollerWidth-v.scrollWidth+v.scrollWidth/5:v.x+v.scrollerWidth-v.scrollWidth):{dist:0,time:0};n=v.scrollY===true?v.momentum(v.y-v.scrollStartY,s,v.options.bounce?-v.y+v.scrollHeight/5:-v.y,v.options.bounce?(v.maxScrollY<0?v.y+v.scrollerHeight-v.scrollHeight:0)+v.scrollHeight/5:v.y+v.scrollerHeight-v.scrollHeight):{dist:0,time:0};q=Math.max(Math.max(o.time,n.time),1);w=v.x+o.dist;u=v.y+n.dist}if(v.options.snap){t=v.snap(w,u);w=t.x;u=t.y;q=Math.max(t.time,q)}v.scrollTo(w,u,q+"ms")},transitionEnd:function(){var n=this;document.removeEventListener("webkitTransitionEnd",n,false);n.resetPosition()},resetPosition:function(){var q,o,n;n=this;q=n.x;o=n.y;if(n.x>=0){q=0}else{if(n.x<n.maxScrollX){q=n.maxScrollX}}if(n.y>=0||n.maxScrollY>0){o=0}else{if(n.y<n.maxScrollY){o=n.maxScrollY}}if(q!=n.x||o!=n.y){n.scrollTo(q,o)}else{if(n.moved){n.onScrollEnd();n.moved=false}if(n.scrollBarX){n.scrollBarX.hide()}if(n.scrollBarY){n.scrollBarY.hide()}}},snap:function(n,s){var o,q;o=this;if(o.directionX>0){n=Math.floor(n/o.scrollWidth)}else{if(o.directionX<0){n=Math.ceil(n/o.scrollWidth)}else{n=Math.round(n/o.scrollWidth)}}o.pageX=-n;n=n*o.scrollWidth;if(n>0){n=o.pageX=0}else{if(n<o.maxScrollX){o.pageX=o.maxPageX;n=o.maxScrollX}}if(o.directionY>0){s=Math.floor(s/o.scrollHeight)}else{if(o.directionY<0){s=Math.ceil(s/o.scrollHeight)}else{s=Math.round(s/o.scrollHeight)}}o.pageY=-s;s=s*o.scrollHeight;if(s>0){s=o.pageY=0}else{if(s<o.maxScrollY){o.pageY=o.maxPageY;s=o.maxScrollY}}q=Math.round(Math.max(Math.abs(o.x-n)/o.scrollWidth*500,Math.abs(o.y-s)/o.scrollHeight*500));return{x:n,y:s,time:q}},scrollTo:function(o,n,s){var q=this;if(q.x==o&&q.y==n){q.resetPosition();return}q.moved=true;q.setTransitionTime(s||"350ms");q.setPosition(o,n);if(s==="0"||s=="0s"||s=="0ms"){q.resetPosition()}else{document.addEventListener("webkitTransitionEnd",q,false)}},scrollToPage:function(q,o,t){var n,s;s=this;if(!s.options.snap){s.pageX=-Math.round(s.x/s.scrollWidth);s.pageY=-Math.round(s.y/s.scrollHeight)}if(q=="next"){q=++s.pageX}else{if(q=="prev"){q=--s.pageX}}if(o=="next"){o=++s.pageY}else{if(o=="prev"){o=--s.pageY}}q=-q*s.scrollWidth;o=-o*s.scrollHeight;n=s.snap(q,o);q=n.x;o=n.y;s.scrollTo(q,o,t||"500ms")},scrollToElement:function(o,s){var q,n,t;o=typeof o=="object"?o:this.element.querySelector(o);if(!o){return}q=this;n=q.scrollX?-o.offsetLeft:0;t=q.scrollY?-o.offsetTop:0;if(n>=0){n=0}else{if(n<q.maxScrollX){n=q.maxScrollX}}if(t>=0){t=0}else{if(t<q.maxScrollY){t=q.maxScrollY}}q.scrollTo(n,t,s)},momentum:function(w,q,u,n){var v,t,s,x,o;t=2.5;v=1.2;o=Math.abs(w)/q*1000;s=o*o/t/1000;x=0;if(w>0&&s>u){o=o*u/s/t;s=u}else{if(w<0&&s>n){o=o*n/s/t;s=n}}s=s*(w<0?-1:1);x=o/v;return{dist:Math.round(s),time:Math.round(x)}},destroy:function(n){var o=this;window.removeEventListener(window.hasOwnProperty("onorientationchange")?"orientationchange":"resize",o,false);o.element.removeEventListener(g,o,false);o.element.removeEventListener(l,o,false);o.element.removeEventListener(f,o,false);document.removeEventListener("webkitTransitionEnd",o,false);if(o.options.checkDOMChanges){o.element.removeEventListener("DOMSubtreeModified",o,false)}if(o.scrollBarX){o.scrollBarX=o.scrollBarX.remove()}if(o.scrollBarY){o.scrollBarY=o.scrollBarY.remove()}if(n){o.wrapper.parentNode.removeChild(o.wrapper)}return null}};a.prototype={init:function(n,q){var o,u,t,s;s=this;u=document;t=Math.PI;if(s.dir=="horizontal"){if(s.maxSize!=s.wrapper.offsetWidth){s.maxSize=s.wrapper.offsetWidth;o=u.getCSSCanvasContext("2d","scrollbar"+s.uid+s.dir,s.maxSize,5);o.fillStyle="rgb(0,0,0)";o.beginPath();o.arc(2.5,2.5,2.5,t/2,-t/2,false);o.lineTo(s.maxSize-2.5,0);o.arc(s.maxSize-2.5,2.5,2.5,-t/2,t/2,false);o.closePath();o.fill()}}else{if(s.maxSize!=s.wrapper.offsetHeight){s.maxSize=s.wrapper.offsetHeight;o=u.getCSSCanvasContext("2d","scrollbar"+s.uid+s.dir,5,s.maxSize);o.fillStyle="rgb(0,0,0)";o.beginPath();o.arc(2.5,2.5,2.5,t,0,false);o.lineTo(5,s.maxSize-2.5);o.arc(2.5,s.maxSize-2.5,2.5,0,t,false);o.closePath();o.fill()}}s.size=Math.max(Math.round(s.maxSize*s.maxSize/q),6);s.maxScroll=s.maxSize-s.size;s.toWrapperProp=s.maxScroll/(n-q);s.bar.style[s.dir=="horizontal"?"width":"height"]=s.size+"px"},setPosition:function(o){var n=this;if(n.wrapper.style.opacity!="1"){n.show()}o=Math.round(n.toWrapperProp*o);if(o<0){o=n.shrink?o+o*3:0;if(n.size+o<7){o=-n.size+6}}else{if(o>n.maxScroll){o=n.shrink?o+(o-n.maxScroll)*3:n.maxScroll;if(n.size+n.maxScroll-o<7){o=n.size+n.maxScroll-6}}}o=n.dir=="horizontal"?k+o+"px,0"+c:k+"0,"+o+"px"+c;n.bar.style.webkitTransform=o},show:function(){if(e){this.wrapper.style.webkitTransitionDelay="0"}this.wrapper.style.opacity="1"},hide:function(){if(e){this.wrapper.style.webkitTransitionDelay="350ms"}this.wrapper.style.opacity="0"},remove:function(){this.wrapper.parentNode.removeChild(this.wrapper);return null}};e=(window.hasOwnProperty("WebKitCSSMatrix")&&(new window.WebKitCSSMatrix()).hasOwnProperty("m11"));h=(/android/gi).test(window.navigator.appVersion);j=(/iphone|ipad/gi).test(navigator.appVersion);isWp8=(/msie/gi).test(window.navigator.appVersion);b="ontouchstart" in document.documentElement;g=b?"touchstart":"mousedown";l=b?"touchmove":"mousemove";f=b?"touchend":"mouseup";k="translate"+(e?"3d(":"(");c=e?",0)":")";d=0;window.iScroll=m}());var SpinningWheel={cellHeight:44,friction:0.003,slotData:[],evtStart:window.hasOwnProperty("ontouchstart")?"touchstart":"mousedown",evtMove:window.hasOwnProperty("ontouchstart")?"touchmove":"mousemove",evtEnd:window.hasOwnProperty("ontouchstart")?"touchend":"mouseup",mouseToTouch:function(a){if(!a.targetTouches){a.targetTouches=[{clientX:a.clientX,clientY:a.clientY}]}},handleEvent:function(b){var a;if(b.type===this.evtStart&&b.currentTarget===document){a=b.target.nodeType===1?b.target:b.target.parentElement;if(!a.id||a.id.slice(0,3)!=="sw-"){this.done()}}if(b.type==this.evtStart){this.lockScreen(b);if(b.currentTarget.id=="sw-cancel"||b.currentTarget.id=="sw-done"){this.tapDown(b)}else{if(b.currentTarget.id=="sw-frame"){this.scrollStart(b)}}}else{if(b.type==this.evtMove){this.lockScreen(b);if(b.currentTarget.id=="sw-cancel"||b.currentTarget.id=="sw-done"){this.tapCancel(b)}else{if(b.currentTarget.id=="sw-frame"){this.scrollMove(b)}}}else{if(b.type==this.evtEnd||b.type=="click"){if(b.currentTarget.id=="sw-cancel"||b.currentTarget.id=="sw-done"){this.tapUp(b)}else{if(b.currentTarget.id=="sw-frame"){this.scrollEnd(b)}}}else{if(b.type=="webkitTransitionEnd"){if(b.target.id=="sw-wrapper"){this.destroy()}else{this.backWithinBoundaries(b)}}else{if(b.type=="orientationchange"){this.onOrientationChange(b)}else{if(b.type=="scroll"){this.onScroll(b)}}}}}}},onOrientationChange:function(){window.scrollTo(0,0);this.swWrapper.style.top=window.innerHeight+window.pageYOffset+"px";this.calculateSlotsWidth()},onScroll:function(){this.swWrapper.style.top=window.innerHeight+window.pageYOffset+"px"},lockScreen:function(){},reset:function(){this.slotEl=[];this.activeSlot=null;this.swWrapper=undefined;this.swSlotWrapper=undefined;this.swSlots=undefined;this.swFrame=undefined},calculateSlotsWidth:function(){var b,a;b=this.swSlots.getElementsByTagName("div");for(a=0;a<b.length;a+=1){this.slotEl[a].slotWidth=b[a].offsetWidth}},create:function(){var d,a,b,c,e;this.reset();e=document.createElement("div");e.id="sw-wrapper";e.style.top=window.innerHeight+window.pageYOffset+"px";e.style.webkitTransitionProperty="-webkit-transform";e.innerHTML='<div id="sw-header"><div id="sw-cancel">Cancel</div><div id="sw-done">Done</div></div><div id="sw-slots-wrapper"><div id="sw-slots"></div></div><div id="sw-frame"></div>';document.body.appendChild(e);this.swWrapper=e;this.swSlotWrapper=document.getElementById("sw-slots-wrapper");this.swSlots=document.getElementById("sw-slots");this.swFrame=document.getElementById("sw-frame");for(a=0;a<this.slotData.length;a+=1){c=document.createElement("ul");b="";for(d in this.slotData[a].values){b+="<li>"+this.slotData[a].values[d]+"</li>"}c.innerHTML=b;e=document.createElement("div");e.className=this.slotData[a].style;e.appendChild(c);this.swSlots.appendChild(e);c.slotPosition=a;c.slotYPosition=0;c.slotWidth=0;c.slotMaxScroll=this.swSlotWrapper.clientHeight-c.clientHeight-86;c.style.webkitTransitionTimingFunction="cubic-bezier(0, 0, 0.2, 1)";this.slotEl.push(c);if(this.slotData[a].defaultValue){this.scrollToValue(a,this.slotData[a].defaultValue)}}this.calculateSlotsWidth();document.addEventListener(this.evtStart,this,true);document.addEventListener(this.evtMove,this,false);window.addEventListener("orientationchange",this,true);window.addEventListener("scroll",this,true);if(window.hasOwnProperty("ontouchstart")){document.getElementById("sw-cancel").addEventListener(this.evtStart,this,false);document.getElementById("sw-done").addEventListener(this.evtStart,this,false)}else{document.getElementById("sw-cancel").addEventListener("click",this,false);document.getElementById("sw-done").addEventListener("click",this,false)}this.swFrame.addEventListener(this.evtStart,this,false)},open:function(){this.create();this.swWrapper.style.webkitTransitionTimingFunction="ease-out";this.swWrapper.style.webkitTransitionDuration="400ms";this.swWrapper.style.webkitTransform="translate3d(0, -260px, 0)"},destroy:function(){this.swWrapper.removeEventListener("webkitTransitionEnd",this,false);this.swFrame.removeEventListener(this.evtStart,this,false);document.getElementById("sw-cancel").removeEventListener(this.evtStart,this,false);document.getElementById("sw-done").removeEventListener(this.evtStart,this,false);if(!(window.hasOwnProperty("ontouchstart"))){document.getElementById("sw-cancel").removeEventListener("click",this,false);document.getElementById("sw-done").removeEventListener("click",this,false)}document.removeEventListener(this.evtStart,this,true);document.removeEventListener(this.evtMove,this,false);window.removeEventListener("orientationchange",this,true);window.removeEventListener("scroll",this,true);this.slotData=[];this.cancelAction=function(){return false};this.cancelDone=function(){return true};this.reset();document.body.removeChild(document.getElementById("sw-wrapper"))},close:function(){this.swWrapper.style.webkitTransitionTimingFunction="ease-in";this.swWrapper.style.webkitTransitionDuration="400ms";this.swWrapper.style.webkitTransform="translate3d(0, 0, 0)";this.swWrapper.addEventListener("webkitTransitionEnd",this,false)},addSlot:function(b,d,a){var c,e;if(!d){d=""}d=d.split(" ");for(c=0;c<d.length;c+=1){d[c]="sw-"+d[c]}d=d.join(" ");e={values:b,style:d,defaultValue:a};this.slotData.push(e)},getSelectedValues:function(){var c,f,d,a,e=[],b=[];for(d in this.slotEl){this.slotEl[d].removeEventListener("webkitTransitionEnd",this,false);this.slotEl[d].style.webkitTransitionDuration="0";if(this.slotEl[d].slotYPosition>0){this.setPosition(d,0)}else{if(this.slotEl[d].slotYPosition<this.slotEl[d].slotMaxScroll){this.setPosition(d,this.slotEl[d].slotMaxScroll)}}c=-Math.round(this.slotEl[d].slotYPosition/this.cellHeight);f=0;for(a in this.slotData[d].values){if(f==c){e.push(a);b.push(this.slotData[d].values[a]);break}f+=1}}return{keys:e,values:b}},setPosition:function(b,a){this.slotEl[b].slotYPosition=a;this.slotEl[b].style.webkitTransform="translate3d(0, "+a+"px, 0)"},scrollStart:function(c){var a,f,b,d;this.mouseToTouch(c);d=c.targetTouches[0].clientX-this.swSlots.offsetLeft;f=0;for(a=0;a<this.slotEl.length;a+=1){f+=this.slotEl[a].slotWidth;if(d<f){this.activeSlot=a;break}}if(this.slotData[this.activeSlot].style.match("readonly")){this.swFrame.removeEventListener(this.evtMove,this,false);this.swFrame.removeEventListener(this.evtEnd,this,false);return false}this.slotEl[this.activeSlot].removeEventListener("webkitTransitionEnd",this,false);this.slotEl[this.activeSlot].style.webkitTransitionDuration="0";b=window.getComputedStyle(this.slotEl[this.activeSlot]).webkitTransform;b=new window.WebKitCSSMatrix(b).m42;if(b!=this.slotEl[this.activeSlot].slotYPosition){this.setPosition(this.activeSlot,b)}this.startY=c.targetTouches[0].clientY;this.scrollStartY=this.slotEl[this.activeSlot].slotYPosition;this.scrollStartTime=c.timeStamp;this.swFrame.addEventListener(this.evtMove,this,false);this.swFrame.addEventListener(this.evtEnd,this,false);return true},scrollMove:function(b){this.mouseToTouch(b);var a=b.targetTouches[0].clientY-this.startY;if(this.slotEl[this.activeSlot].slotYPosition>0||this.slotEl[this.activeSlot].slotYPosition<this.slotEl[this.activeSlot].slotMaxScroll){a/=2}this.setPosition(this.activeSlot,this.slotEl[this.activeSlot].slotYPosition+a);this.startY=b.targetTouches[0].clientY;if(b.timeStamp-this.scrollStartTime>80){this.scrollStartY=this.slotEl[this.activeSlot].slotYPosition;this.scrollStartTime=b.timeStamp}},scrollEnd:function(f){var b,c,d,a,g;this.swFrame.removeEventListener(this.evtMove,this,false);this.swFrame.removeEventListener(this.evtEnd,this,false);if(this.slotEl[this.activeSlot].slotYPosition>0||this.slotEl[this.activeSlot].slotYPosition<this.slotEl[this.activeSlot].slotMaxScroll){this.scrollTo(this.activeSlot,this.slotEl[this.activeSlot].slotYPosition>0?0:this.slotEl[this.activeSlot].slotMaxScroll);return false}a=this.slotEl[this.activeSlot].slotYPosition-this.scrollStartY;if(a<this.cellHeight/1.5&&a>-this.cellHeight/1.5){if(this.slotEl[this.activeSlot].slotYPosition%this.cellHeight){this.scrollTo(this.activeSlot,Math.round(this.slotEl[this.activeSlot].slotYPosition/this.cellHeight)*this.cellHeight,"100ms")}return false}g=f.timeStamp-this.scrollStartTime;b=(2*a/g)/this.friction;d=(this.friction/2)*(b*b);if(b<0){b=-b;d=-d}c=this.slotEl[this.activeSlot].slotYPosition+d;if(c>0){c/=2;b/=3;if(c>this.swSlotWrapper.clientHeight/4){c=this.swSlotWrapper.clientHeight/4}}else{if(c<this.slotEl[this.activeSlot].slotMaxScroll){c=(c-this.slotEl[this.activeSlot].slotMaxScroll)/2+this.slotEl[this.activeSlot].slotMaxScroll;b/=3;if(c<this.slotEl[this.activeSlot].slotMaxScroll-this.swSlotWrapper.clientHeight/4){c=this.slotEl[this.activeSlot].slotMaxScroll-this.swSlotWrapper.clientHeight/4}}else{c=Math.round(c/this.cellHeight)*this.cellHeight}}this.scrollTo(this.activeSlot,Math.round(c),Math.round(b)+"ms");return true},scrollTo:function(c,a,b){this.slotEl[c].style.webkitTransitionDuration=b||"100ms";this.setPosition(c,a||0);if(this.slotEl[c].slotYPosition>0||this.slotEl[c].slotYPosition<this.slotEl[c].slotMaxScroll){this.slotEl[c].addEventListener("webkitTransitionEnd",this,false)}},scrollToValue:function(e,d){var c,b,a;this.slotEl[e].removeEventListener("webkitTransitionEnd",this,false);this.slotEl[e].style.webkitTransitionDuration="0";b=0;for(a in this.slotData[e].values){if(a==d){c=b*this.cellHeight;this.setPosition(e,c);break}b-=1}},backWithinBoundaries:function(a){a.target.removeEventListener("webkitTransitionEnd",this,false);this.scrollTo(a.target.slotPosition,a.target.slotYPosition>0?0:a.target.slotMaxScroll,"150ms");return false},tapDown:function(a){a.currentTarget.addEventListener(this.evtMove,this,false);a.currentTarget.addEventListener(this.evtEnd,this,false);a.currentTarget.className="sw-pressed"},tapCancel:function(a){a.currentTarget.removeEventListener(this.evtMove,this,false);a.currentTarget.removeEventListener(this.evtEnd,this,false);a.currentTarget.className=""},tapUp:function(a){this.done(a)},setCancelAction:function(a){this.cancelAction=a},setDoneAction:function(a){this.doneAction=a},cancelAction:function(){return false},cancelDone:function(){return true},done:function(a){if(this.swWrapper){if(!a){a={currentTarget:document.getElementById("sw-done")}}this.tapCancel(a);if(a.currentTarget.id=="sw-cancel"){this.cancelAction()}else{this.doneAction()}this.close()}}};(function(){var h,k;function b(t,w){var y;function Q(Y,X){var W;if(typeof Y==="string"&&X===undefined){if(y.length>0){return window.getComputedStyle(y[0],null).getPropertyValue(Y)}}if(typeof Y!=="object"){W=Y;Y={};Y[W]=X}return y.each(function(){var Z;for(Z in Y){if(Y.hasOwnProperty(Z)){this.style[Z]=Y[Z]}}})}function S(W){if(!W){W="block"}return Q("display",W)}function D(){var W;W=arguments;h(W).each(function(){var X=this;y.each(function(){if(!h.hasClass(this,X)){this.className=this.className?this.className+" "+X:X}})});return y}function L(W,X){if(X===undefined){if(y.length>0){return y[0].getAttribute(W)}}else{y.each(function(){this.setAttribute(W,X)})}}function V(Y,X,W){return y.each(function(){this.removeEventListener(Y,X,W?true:false);this.addEventListener(Y,X,W?true:false)})}function N(){return y.each(function(){this.blur()})}function u(W){return h.each(y,W)}function A(){return y.each(function(){while(this.firstChild){this.removeChild(this.firstChild)}})}function I(Y){var X,W;X=[];W=[];y.each(function(){X.push(b(this,Y))});h(X).each(function(){this.each(function(){if(!this.jmfwCounted){this.jmfwCounted=true;W.push(this)}})});return h(W).each(function(){delete this.jmfwCounted})}function J(){if(y.length>0){y[0].focus()}return y}function s(W){if(y.length>0){return h.hasClass(y[0],W)}}function H(W){if(W===undefined){if(y.length>0){return y[0].clientHeight}}return y.each(function(){this.style.height=W===""?"":W+"px"})}function B(){return S("none")}function C(W){if(W===undefined){if(y.length>0){return y[0].innerHTML}}return y.each(function(){if(window.WinJS!=undefined){WinJS.Utilities.setInnerHTMLUnsafe(this,W)}else{this.innerHTML=W}})}function R(W){if(y.length>W){return h(y[W])}}function x(){var X,W;X={left:0,top:0};if(y.length>0){for(W=y[0];W;W=W.offsetParent){X.left+=W.offsetLeft;X.top+=W.offsetTop}}return X}function z(){var W;W=[];y.each(function(){var X;X=this.parentNode;if(!X.jmfwCounted){W.push(X);X.jmfwCounted=true}});return h(W).each(function(){delete this.jmfwCounted})}function T(W){if(W===undefined){return y.each(function(){this.parentNode.removeChild(this)})}return y.find(W).remove()}function M(W){return y.each(function(){this.removeAttribute(W)})}function F(){var W;W=arguments;h(W).each(function(){var X=this;y.each(function(){this.className=this.className.replace(new RegExp("(^|\\s+)"+X+"(\\s+|$)")," ")})});return y}function E(W){if(W===undefined){if(y.length>0){return y[0].textContent||y[0].innerText}}return y.each(function(){this.textContent=W})}function P(){var W;W=arguments;h(W).each(function(){var X=this;y.each(function(){var Y=h(this);if(Y.hasClass(X)){Y.removeClass(X)}else{Y.addClass(X)}})});return y}function G(Z,W){var X,Y;X=window.document.createEvent("Events");X.initEvent(Z,true,true);if(W&&typeof W==="object"){for(Y in W){if(W.hasOwnProperty(Y)){X[Y]=W[Y]}}}return y.each(function(){this.dispatchEvent(X)})}function v(Y,X,W){return y.each(function(){this.removeEventListener(Y,X,W?true:false)})}function U(W){if(W===undefined){if(y.length>0){return y[0].value}}else{y.each(function(){this.value=W})}}function K(W){if(W===undefined){if(y.length>0){return y[0].clientWidth}}return y.each(function(){this.style.width=W+"px"})}if(!w){return null}if(w.nodeType||w===window){w=[w]}else{if(typeof w==="string"){w=t.querySelectorAll(w);var q=[];for(var O=0;O<w.length;++O){q.push(w[O])}w=q}else{if(!(w instanceof Array)&&w.length===undefined){return null}}}y=w;y.addClass=D;y.attr=L;y.bind=V;y.blur=N;y.each=u;y.empty=A;y.find=I;y.focus=J;y.hasClass=s;y.height=H;y.hide=B;y.html=C;y.item=R;y.offset=x;y.parent=z;y.remove=T;y.removeAttr=M;y.removeClass=F;y.show=S;y.style=Q;y.text=E;y.toggleClass=P;y.trigger=G;y.unbind=v;y.val=U;y.width=K;return y}function g(q){return b(window.document,q)}function c(){setTimeout(function(){var q,s;s=k.length;for(q=0;q<s;q+=1){k[q]()}k=null},100);window.document.removeEventListener("DOMContentLoaded",c,false)}function o(s,t){var q;if(s.length!==undefined){for(q=0;q<s.length;q+=1){if(t.call(s[q],q,s[q])===false){break}}}else{for(q in s){if(s.hasOwnProperty(q)){if(t.call(s[q],q,s[q])===false){break}}}}return s}function j(s,q){return new RegExp("(^|\\s)"+q+"(\\s|$)").test(s.className)}function d(q){var t;if(q!==undefined&&q!==null&&typeof q==="string"){t=JSON.parse(q,function(u,v){var s;u=undefined;if(typeof v==="string"){s=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)Z$/.exec(v);if(s){return new Date(Date.UTC(+s[1],+s[2]-1,+s[3],+s[4],+s[5],+s[6]))}}return v})}return t||undefined}function l(q){return JSON.stringify(q)}function f(q){return d(l(q))}function e(u,s){var q,t;q=[];if(u){for(t in u){if(s||u.hasOwnProperty(t)){q.push(t)}}q.sort(function(w,y){var v,x;v=w.toLowerCase();x=y.toLowerCase();return(v===x)?0:(v<x)?-1:1})}return q}function n(q){if(k.length===0){window.document.addEventListener("DOMContentLoaded",c,false)}k.push(q)}function m(t,u){var q=new Function("$","data","var p=[];p.push('"+t.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');return p.join('');");return u?q(h,u):q}function a(q){var t=q.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'");return t.split("<").join("&lt;").split(">").join("&gt;")}k=[];h=g;h.isAndroid=(/android/gi).test(window.navigator.appVersion);h.isBlackberry=(/blackberry/gi).test(window.navigator.appVersion);h.isHashChangeAware=(window.onhashchange!==undefined);h.isIE=(/msie/gi).test(window.navigator.appVersion)||(/trident/gi).test(window.navigator.appVersion)||(/windows/gi).test(window.navigator.appVersion);h.isWindows8=(/msapphost/gi).test(window.navigator.appVersion);h.isIpad=(/ipad/gi).test(window.navigator.appVersion);h.isIphone=(/iphone/gi).test(window.navigator.appVersion);h.isOrientationAware=(window.onorientationchange!==undefined);h.isStandalone=window.navigator.standalone;h.isTouch=(window.ontouchstart!==undefined);h.isZetakey=(/zetakey/gi).test(window.navigator.userAgent);h.has3d=(window.WebKitCSSMatrix!==undefined&&new window.WebKitCSSMatrix().m11!==undefined);h.hasAnimation=(window.WebKitAnimationEvent!==undefined||window.AnimationEvent!==undefined);h.hasClass=j;h.each=o;h.jsonParse=d;h.jsonStringify=l;h.jsonCopy=f;h.members=e;h.ready=n;h.tmpl=m;h.tmplString=a;window.jmfw=h}());(function(L){var y,G,s,A;function T(Z){if(Z.hasOwnProperty("returnValue")){return !Z.returnValue}return !!Z.defaultPrevented}function Q(Z){Z.preventDefault();Z.stopPropagation()}function I(ab){var Z,ac;try{Z=ab.parentElement.parentElement.previousElementSibling;if(Z&&Z.nodeName==="H2"){ac=Z.innerText}else{ac=""}}catch(aa){ac=""}return ac}function N(aa,ab){var Z;Z=aa;while(Z&&!L.hasClass(Z,ab)){Z=Z.parentElement}return Z}function M(ab){if(jmfw.isIE){jQuery(".jmuiFooter").css({position:"fixed",left:"0px",bottom:"0px",});return}var af,aa,ae,Z,ad,ac;ad=ab.find(".jmuiScroller, .jmuiNativeScroller");if(ad.length){ae=ab.find(".jmuiHeader");segmentHeader=ab.find(".jmuiSegmentHeader");segmentPanel=ab.find(".jmuiSegmentPanel");af=ab.find(".jmuiFooter");Z=ae.length>0?ae[0].offsetHeight:0;segmentHHeight=segmentHeader.length>0?segmentHeader[0].offsetHeight:0;segmentHOffset=segmentHeader.length>0?segmentHeader[0].offsetTop:0;aa=af.length>0?af[0].offsetHeight:0;ac=window.innerHeight-Z-aa;if(jmfw.isIE){if(L(".jmuiCurrent > .jmuiHeader").length<1){L("div.jmuiPage.jmuiCurrent").style("padding-top",0)}if(L(".jmuiCurrent > .jmuiFooter").length<1){L("div.jmuiPage.jmuiCurrent").style("padding-bottom",0)}}ad.height(ac);if(segmentHHeight>0){segmentPanel.height(window.innerHeight-(segmentHOffset+segmentHHeight)-aa)}}if(jQuery("input:focus, textarea:focus").length>0){jmfw.ui.scrollToElement(jQuery("input:focus, textarea:focus")[0])}}function k(ab){var aa,Z;Z=N(ab,"jmuiScroller");if(Z){if(Z&&Z.firstElementChild&&Z.firstElementChild.jmuiScroller){aa=k(Z.parentElement);aa.x+=Z.firstElementChild.jmuiScroller.x;aa.y+=Z.firstElementChild.jmuiScroller.y}else{aa={x:0,y:0}}aa.iScroll=true}else{Z=L("body");if(Z&&Z.length){aa={x:Z[0].scrollLeft,y:Z[0].scrollTop}}else{aa={x:0,y:0}}aa.pageScroll=!!N(ab,"jmuiPageScroller")}return aa}function q(aa){var Z;aa=undefined;function ab(ac){setTimeout(M(ac),500)}if(L.isAndroid){L("div").each(function(){if(this.hasOwnProperty("scrollLeft")&&this.scrollLeft!==0){this.scrollLeft=0}if(this.hasOwnProperty("scrollTop")&&this.scrollTop!==0){this.scrollTop=0}});Z=L(".jmuiLayout.jmuiCurrent");Z.find(".jmuiPage.jmuiCurrent").each(function(){ab(L(this))})}else{Z=L(".jmuiLayout.jmuiCurrent");Z.find(".jmuiPage.jmuiCurrent").each(function(){ab(L(this))})}}function o(aa,Z){return aa.each(function(){var af,ar,ak,am,an,ad,au,ah,al,ab,aq,ao;var ag=false;function aj(ax){var ay,aw,az,av;if(typeof jQuery!=="undefined"&&jQuery(au).parents(".jmuiNativeScroller").length>0){return true}av=50;if(ax.changedTouches&&ax.changedTouches.length===1){ax=ax.changedTouches[0]}ay=au.offset();aw=k(au[0]);if(L.isAndroid){return true}if(L.isIE){return true}az={x:ax.pageX+aw.x,y:ax.pageY-aw.y};return az.x>=(ay.left-av)&&az.x<(au[0].offsetWidth+ay.left+av)&&az.y>=(ay.top-av)&&az.y<(au[0].offsetHeight+ay.top+av)}function at(){if(ad!==undefined){window.clearTimeout(ad);ad=undefined}}function ap(aw){var av;at();av=k(au[0]);if(ab){ag=true}if(al.x===av.x&&al.y===av.y&&aj(aw)===true){if(ab){af.addClass("jmuiPressed");if(ag){if(!au.hasClass("md_toolbarButton")){au.unbind(ar,ae,true);af.removeClass("jmuiPressed")}}}}else{af.removeClass("jmuiPressed")}}function ae(ax){var aw,av;at();aw=k(au[0]);au.unbind(ak,ap,true);au.unbind(ar,ae,true);au.unbind(am,ah,false);setTimeout(function(){af.removeClass("jmuiPressed")},600);if(al.x===aw.x&&al.y===aw.y&&aj(ax)===true){av={};av.jmuiTarget=ax.target;if(ax.changedTouches&&ax.changedTouches.length===1){av.pageX=ax.changedTouches[0].pageX;av.pageY=ax.changedTouches[0].pageY}else{av.pageX=ax.pageX;av.pageY=ax.pageY}if(!au.hasClass("jmuiClicked")){au.addClass("jmuiClicked");au.trigger("jmuiTap",av);setTimeout(function(){au.removeClass("jmuiClicked")},600)}}}function ai(){var av;ad=undefined;av={};av.jmuiTarget=au[0];au.unbind(ak,ap,true);au.unbind(ar,ae,true);au.unbind(am,ah,false);af.removeClass("jmuiPressed");au.trigger("jmuiTapAndHold")}function ac(){ab=false;al=k(au[0]);af.addClass("jmuiPressed");ab=true;au.bind(ak,ap,true);au.bind(ar,ae,true);au.bind(am,ah,false);ad=window.setTimeout(ai,1000)}ah=function(av){av=undefined;au.unbind(ak,ap,true);au.unbind(ar,ae,true);au.unbind(am,ah,false);af.removeClass("jmuiPressed")};if(Z){if(this.jmuiTap){L(this).unbind(this.jmuiTap.event,this.jmuiTap.handler,false)}}else{if(!this.jmuiTap){if(window.jQuery){aq=jQuery(this).parents(".jmuiHeader,.jmuiFooter").length<1}au=L(this);af=au.hasClass("jmuiMask")?au.parent():au;if(L.isTouch){an="touchstart";ak="touchmove";ar="touchend";am="mouseout"}else{an="mousedown";ak="mousemove";ar="mouseup";am="mouseout"}au.bind(an,ac,false);this.jmuiTap={event:an,handler:ac}}}})}function B(aa){function Z(){var ab;ab=aa.find(".jmuiScroller > div");if(ab.length&&ab[0].jmuiScroller){ab[0].jmuiScroller.refresh()}}if(L.isAndroid){setTimeout(Z,500)}else{Z()}}function X(ac){var aa,Z;function ad(ae){ae=undefined;setTimeout(function(){if(L(":focus").length===0){var ah,af,ag;af=Z[0].parentElement;if(af){ah=af.scrollLeft;ag=af.scrollTop;af.scrollLeft=0;af.scrollTop=0;Z[0].jmuiScroller.scrollTo(-ah,-ag,"0")}q()}},0)}function ab(){M(ac);if(Z.length&&Z[0].jmuiScroller){Z[0].jmuiScroller.refresh()}}Z=ac.find(".jmuiScroller > div");if(Z.length){Z[0].jmuiScroller=new L.iScroll(Z[0],{desktopCompatibility:true,bounce:!L.isAndroid});Z.find("img").bind("load",ab);if(L.isAndroid||L.isIpad||L.isIphone){Z.find("input,textarea,select").bind("blur",ad)}}else{Z=undefined}ac.bind("jmuiPageAnimationStart",function(ae){if(Z&&Z.length&&ae.direction==="in"){ab()}else{}});aa=L("body")}function S(aj,ad,ah,af){var ae,ai,ak,aa,ag,ab;function ac(){G=true;window.location.hash=aj[0].id;if(ai){aa.unbind(A,ac);aa.unbind(y,ac);aj.removeClass("jmuiStart","jmuiIn",ad);aa.removeClass("jmuiStart","jmuiOut","jmuiCurrent",ad);if(ah){aj.toggleClass("jmuiReverse");aa.toggleClass("jmuiReverse")}}else{aa.removeClass("jmuiCurrent")}if(!af&&!ak){aj.trigger("jmuiPageAnimationEnd",{direction:"in",reverse:ah});aa.trigger("jmuiPageAnimationEnd",{direction:"out",reverse:ah})}}function Z(){if(ae){ak.unbind(A,Z);ak.unbind(y,Z);ab.removeClass("jmuiStart","jmuiIn",ad);ak.removeClass("jmuiStart","jmuiOut","jmuiCurrent",ad);if(ah){ab.toggleClass("jmuiReverse");ak.toggleClass("jmuiReverse")}}else{ak.removeClass("jmuiCurrent")}if(!af){ab.trigger("jmuiLayoutAnimationEnd",{direction:"in",reverse:ah});ak.trigger("jmuiLayoutAnimationEnd",{direction:"out",reverse:ah})}}if(!aj||aj.length===0){log.error("Target page to animate to is missing.");return false}if(aj.length>1){aj=aj.item(0)}ag=aj.parent();ab=ag.parent();if(!ab.hasClass("jmuiCurrent")){ak=L(".jmuiLayout.jmuiCurrent")}if(!aj.hasClass("jmuiCurrent")){aa=ag.find(".jmuiCurrent")}if(ak||aa){L(":focus").blur();if(aa){ai=L.hasAnimation&&ad&&!ak;if(ai&&aa.attr("id")!="Start"){if(ah){aj.toggleClass("jmuiReverse");aa.toggleClass("jmuiReverse")}aa.bind(A,ac);aa.bind(y,ac);aj.addClass(ad,"jmuiIn","jmuiCurrent");aa.addClass(ad,"jmuiOut");window.setTimeout(function(){aj.trigger("jmuiPageBind");if(!af&&!ak){aa.trigger("jmuiPageAnimationStart",{direction:"out"});aj.trigger("jmuiPageAnimationStart",{direction:"in"})}aj.addClass("jmuiStart");aa.addClass("jmuiStart")},100)}else{aj.trigger("jmuiPageBind");aj.addClass("jmuiCurrent");if(!af&&!ak){aa.trigger("jmuiPageAnimationStart",{direction:"out"});aj.trigger("jmuiPageAnimationStart",{direction:"in"})}ac()}}if(ak){ae=L.hasAnimation&&ad;if(ae){if(ah){ab.toggleClass("jmuiReverse");ak.toggleClass("jmuiReverse")}ak.bind(A,Z);ak.bind(y,Z);ab.addClass(ad,"jmuiIn","jmuiCurrent");ak.addClass(ad,"jmuiOut");window.setTimeout(function(){if(!af){ak.trigger("jmuiLayoutAnimationStart",{direction:"out"});ab.trigger("jmuiLayoutAnimationStart",{direction:"in"})}ab.addClass("jmuiStart");ak.addClass("jmuiStart")},0)}else{ab.addClass("jmuiCurrent");if(!af){ak.trigger("jmuiLayoutAnimationStart",{direction:"out"});ab.trigger("jmuiLayoutAnimationStart",{direction:"in"})}Z()}}}}function J(Z){return N(Z,"jmuiColumn")}function v(Z){return N(Z,"jmuiLayout")}function P(Z){return N(Z,"jmuiPage")}function H(ab){var Z;Z=L(P(ab)).find(".jmuiScroller > div");nscroller=L(P(ab)).find(".jmuiNativeScroller > div");if(Z.length){Z[0].jmuiScroller.scrollToElement(ab)}else{if(nscroller.length){if(L.isIE){var aa=ab.offsetTop;if(L(".jmuiPage.jmuiCurrent .jmuiHeader").length>0){aa-=L(".jmuiPage.jmuiCurrent .jmuiHeader").height()}nscroller.parent()[0].scrollTop=aa}else{if(ab.scrollIntoViewIfNeeded){ab.scrollIntoViewIfNeeded(true)}else{ab.scrollIntoView(true)}}}}}function F(ac){var aa,ab,Z;Z=L("#"+ac);if(Z&&Z.length){ab=L(N(Z[0],"jmuiSegmentGroup"));if(ab&&ab.length){aa=ab.find("[jmuiSegmentId="+ac+"]");if(aa&&aa.length&&!aa.hasClass("jmuiSelected")){ab.find(".jmuiSegmentButton.jmuiSelected").removeClass("jmuiSelected");aa.addClass("jmuiSelected")}ab.find(".jmuiSegmentPanel.jmuiSelected").removeClass("jmuiSelected");ab.find("#"+ac).addClass("jmuiSelected");B(L(P(ab[0])));ab.trigger("jmuiChange",{segmentId:ac})}}}function Y(aa){var ab,ac,Z;ac={x:0,y:0};if(aa.offsetX!==undefined){ac.x=aa.offsetX;ac.y=aa.offsetY}else{ab=L(aa.target).offset();ac.x=aa.pageX-ab.left;ac.y=aa.pageY-ab.top;Z=L(P(aa.target)).find(".jmuiScroller > div");if(Z.length){if(Z[0].jmuiScroller.x){ac.x+=Z[0].jmuiScroller.x}if(Z[0].jmuiScroller.y){ac.y-=Z[0].jmuiScroller.y}}}return ac}function W(aa,aj,ab,ag,Z,ah){var ak,af,ad;function ac(){var am,an,al;ak.unbind(L.ui.tapEvent,ac);al=ad.find(".jmuiTick");if(al.length===1){am={label:al.text(),value:al[0].jmuiValue};an=al[0].jmuiIndex}ah(an,am)}function ae(){var al;al=ad.find(".jmuiTick");al.each(function(){L(this).removeClass("jmuiTick")});L(this).addClass("jmuiTick");if(al.length===0||al[0]!==this){ac()}}function ai(an,am){var al;al=L(window.document.createElement("li"));al.text(am.label);al[0].jmuiValue=am.value;al[0].jmuiIndex=an;if(am.value===ab){al.addClass("jmuiTick")}ad[0].appendChild(al[0]);o(al);al.bind(L.ui.tapEvent,ae)}if(!ag||ag.constructor!==String){ag=""}if(!Z||Z.constructor!==String){Z="Back"}af=aa.find(".jmuiListPage");if(!af||af.length<=0){af=L(window.document.createElement("div"));af.addClass("jmuiPage","jmuiListPage");if(L.ui.isScrollable){if(L.isIE){af.addClass("jmuiPageScroller")}if(L.isIE||L.isBlackberry){af.html('<div class="jmuiHeader"><div class="jmuiToolbar"><h1>List</h1><div class="jmuiGoBack jmuiBackButton">Back</div></div></div><div class="jmuiNativeScroller"><div><div class="md_listPageContainer"><ul></ul></div></div></div>')}else{af.html('<div class="jmuiHeader"><div class="jmuiToolbar"><h1>List</h1><div class="jmuiGoBack jmuiBackButton">Back</div></div></div><div class="jmuiScroller"><div><div class="md_listPageContainer"><ul></ul></div></div></div>')}X(af)}else{af.html('<div class="jmuiHeader"><div class="jmuiToolbar"><h1>List</h1><div class="jmuiGoBack jmuiBackButton">Back</div></div></div><ul></ul>')}aa[0].appendChild(af[0])}ad=af.find("ul");ad.empty();ak=af.find(".jmuiBackButton");ak.text(Z);o(ak);ak.bind(L.ui.tapEvent,ac);af.find(".jmuiToolbar > h1").text(ag);L(aj).each(ai);S(af,"jmuiSlide",false,false);af.trigger("jmuiPageAnimationStart",{direction:"in",reverse:false})}function d(ac,aa,ab){var Z;if(L("#sw-wrapper").length===0){Z={};L(ac).each(function(ae,ad){ae=undefined;Z[ad.value]=ad.label});L.spinningWheel.addSlot(Z,"",aa);L.spinningWheel.setCancelAction(function(){L(window.document).unbind("touchmove",Q)});L.spinningWheel.setDoneAction(function(){var ad,af,ae;L(window.document).unbind("touchmove",Q);ae=L.spinningWheel.getSelectedValues();ad={value:ae.keys[0],label:ae.values[0]};for(af=0;af<ac.length;af+=1){if(ac[af].value===ad.value){break}}ab(af>=ac.length?0:af,ad)});L(window.document).bind("touchmove",Q);L.spinningWheel.open()}}function u(Z,ac,af,aa,ai){var ak,ag,aj;function ad(){var al;al="";aj.find(".jmuiSlot div:nth-child(2)").each(function(){al+=L(this).text()+" "});ag.text(al)}function ae(ap,aw){var am,aA,aq,al,ay,ax,at,ar;function ao(){var aB,aC;aC=0;if(ay){aC=aw.staticSlot.length}else{for(aB=0;aB<aw.choices.length;aB+=1){if(aw.choices[aB].label.length>aC){aC=aw.choices[aB].label.length}}}aC=(aC*0.75).toString()+"em";return aC}function av(aB){aq+=aB;if(aq>=aw.choices.length){aq=0}else{if(aq<0){aq=aw.choices.length-1}}ar.val(aw.choices[aq].value);ar.text(aw.choices[aq].label);ad()}function au(){if(at){clearTimeout(at);at=undefined}if(al){clearInterval(al);al=undefined}}function an(aC){var aB;if(!L.ui.defaultPrevented(aC)){au();Q(aC);aB=this===aA[0]?1:-1;L(this).addClass("jmuiPressed");at=setTimeout(function(){av(aB);at=setTimeout(function(){at=undefined;al=setInterval(function(){av(aB)},100)},400)},1)}}function az(aB){Q(aB);au();L(this).removeClass("jmuiPressed")}ay=!!aw.staticSlot;aq=aw.index||0;ax=L(window.document.createElement("div"));ax.addClass("jmuiSlot");if(ay){ax.addClass("jmuiStatic")}ax.style("width",ao());aA=L(window.document.createElement("div"));aA.html(ay?"&nbsp;":"+");ax[0].appendChild(aA[0]);ar=L(window.document.createElement("div"));if(ay){ar.text(aw.staticSlot)}else{if(aw.choices.length>0){ar.val(aw.choices[aq].value);ar.text(aw.choices[aq].label)}}ax[0].appendChild(ar[0]);am=L(window.document.createElement("div"));am.html(ay?"&nbsp;":"-");ax[0].appendChild(am[0]);ap[0].appendChild(ax[0]);if(ay||aw.choices.length>0){if(L.isTouch){aA.bind("touchstart",ay?Q:an);aA.bind("touchend",ay?Q:az);am.bind("touchstart",ay?Q:an);am.bind("touchend",ay?Q:az)}else{aA.bind("mousedown",ay?Q:an);aA.bind("mouseup",ay?Q:az);aA.bind("mouseout",ay?Q:az);am.bind("mousedown",ay?Q:an);am.bind("mouseup",ay?Q:az);am.bind("mouseout",ay?Q:az)}}if(L.isTouch){ar.bind("touchstart",Q);ar.bind("touchend",Q)}else{ar.bind("mousedown",Q);ar.bind("mouseup",Q)}}function ah(){var am,al;al=aj.find(".jmuiSlotMachine");al.empty();for(am=0;am<ac.length;am+=1){ae(al,ac[am])}}function ab(){var al;al=[];aj.find(".jmuiSlot div:nth-child(2)").each(function(){al.push(L(this).val())});if(parseInt(al[0])>Date.getDaysInMonth(al[2],al[1])){window.mCapture.msgBox(function(){},"Invalid Date","Please enter a valid day for the selected month","OK");return}else{ak.unbind(L.ui.tapEvent,ab);ai(al)}}if(!af||af.constructor!==String){af=""}if(!aa||aa.constructor!==String){aa="Back"}aj=Z.find(".jmuiSlotPage");if(!aj||aj.length<=0){aj=L(window.document.createElement("div"));aj.addClass("jmuiPage","jmuiSlotPage");aj.html('<div class="jmuiHeader"><div class="jmuiToolbar"><h1>List</h1><div class="jmuiGoBack jmuiBackButton">Back</div></div></div><div class="jmuiNativeScroller"><div><div class="md_slotContainer"><h2></h2><ul><li class="jmuiColorPress"></li></ul></div><div class="jmuiSlotMachine"></div></div></div>');X(aj);Z[0].appendChild(aj[0])}ag=aj.find("li");aj.find("h2").text(af);ak=aj.find(".jmuiBackButton");ak.text(aa);o(ak);ak.bind(L.ui.tapEvent,ab);aj.find(".jmuiToolbar > h1").text(af);ah();ad();S(aj,"jmuiSlide",false,true)}function V(ae,ac,ah,ab,aj){var am,af,ad,aa,al,ai,ag,Z;function ak(an){ac=new Date(an[Z],an[ad],an[am]);aj(ac)}aa=new Date();am=Date.CultureInfo.dateElementOrder.indexOf("d");ad=Date.CultureInfo.dateElementOrder.indexOf("m");Z=Date.CultureInfo.dateElementOrder.indexOf("y");ag=[{choices:[],index:0},{choices:[],index:0},{choices:[],index:0}];ai=ag[am];for(af=1;af<=31;af+=1){al=(af<10)?"0"+af.toString():af.toString();ai.choices.push({label:al,value:al})}ai.index=ac.getDate()-1;ai=ag[ad];for(af=0;af<12;af+=1){ai.choices.push({label:Date.CultureInfo.monthNames[af],value:af.toString()})}ai.index=ac.getMonth();ai=ag[Z];for(af=aa.getFullYear()-100;af<=aa.getFullYear()+100;af+=1){ai.choices.push({label:af.toString(),value:af.toString()})}ai.index=100+ac.getFullYear()-aa.getFullYear();u(ae,ag,ah,ab,ak)}function c(aa,ag,ab,ad,ah,ae,Z,ai){var ac,af;function aj(ak){ai(ak[0])}af={choices:[],index:0};for(ac=ab;ac<=ad;ac+=ah){af.choices.push({label:ac.toString(),value:ac.toString()});if(ac===ag){af.index=af.choices.length-1}}u(aa,[af],ae,Z,aj)}function E(ab,aa,ag,ae,Z,ah){var ac,aj,af,ad;function ai(ak){var al;al=new Date();al.setHours(ak[0]);al.setMinutes(ak[2]);ah(al)}ad=[{choices:[],index:0},{staticSlot:":"},{choices:[],index:0}];af=ad[0];for(ac=0;ac<24;ac+=1){aj=(ac<10)?"0"+ac.toString():ac.toString();af.choices.push({label:aj,value:aj})}af.index=aa.getHours();af=ad[2];for(ac=0;ac<60;ac+=ag){aj=(ac<10)?"0"+ac.toString():ac.toString();af.choices.push({label:aj,value:aj});if(ac===aa.getMinutes()){af.index=af.choices.length-1}}u(ab,ad,ae,Z,ai)}function a(aa,af,ab){var ah,ac,Z,ad;function ae(aj,ak){var ai;aj=undefined;ai={label:ak.innerText,value:aa[0].nodeName==="SELECT"?ak.value:ak.innerText};ah.push(ai)}function ag(aj,ai){if(aa[0].nodeName==="SELECT"){if(aj!==null&&aj!==undefined){aa[0].selectedIndex=aj;aa.trigger("change")}}else{if(ai!==null&&ai!==undefined){aa[0].value=ai.label;aa.trigger("change")}}function ak(al){if(al.direction==="in"){Z.unbind("jmuiPageAnimationEnd",ak);L(".jmuiPage.jmuiCurrent .jmuiFooter")[0].style.cssText=ad;jmfw.ui.setScrollerHeight(jmfw("div.jmuiCurrent.jmuiPage"));if(L.isAndroid&&parseFloat(navigator.userAgent.match(/Android\s+([\d\.]+)/)[1])<4.4){jQuery(aa.parent().parent()[0]).focus()}else{L.ui.scrollToElement(aa.parent().parent()[0])}}}Z.bind("jmuiPageAnimationEnd",ak);S(Z,"jmuiSlide",true,false)}if(!af||af.constructor!==String){af=""}if(!ab||ab.constructor!==String){ab="Back"}Z=L(P(aa[0]));ac=L(Z[0].parentElement);ah=[];if(aa[0].nodeName==="SELECT"){aa.find("option").each(ae)}else{L(aa[0].previousElementSibling).find("option").each(ae)}if(aa.hasClass("jmuiTumblers")){d(ah,aa[0].value,ag)}else{W(ac,ah,aa[0].value,af,ab,ag)}ad=L(".jmuiPage.jmuiCurrent .jmuiFooter")[0].style.cssText;L(".jmuiPage.jmuiCurrent .jmuiFooter").hide()}function D(aa,ae,ab){var Z,ad,ac;function af(ag){aa.text(ag.toString(Date.CultureInfo.formatPatterns.longDate));aa.trigger("change");S(ac,"jmuiSlide",true,true)}if(!ae||ae.constructor!==String){ae=""}if(!ab||ab.constructor!==String){ab="Back"}ac=L(P(aa[0]));Z=L(ac[0].parentElement);ad=new Date(aa.text());ad=isNaN(ad.getTime())?new Date():ad;V(Z,ad,ae,ab,af)}function x(aa,ae,ab){var af,ac,ad,Z,ag;function ah(ai){aa.text(ai.toString(Date.CultureInfo.formatPatterns.shortTime));aa.trigger("change");S(Z,"jmuiSlide",true,true)}if(!ae||ae.constructor!==String){ae=""}if(!ab||ab.constructor!==String){ab="Back"}Z=L(P(aa[0]));ac=L(Z[0].parentElement);ag=parseInt(aa.attr("increment"),10)%60||5;ad=new Date();af=aa.text().split(":",2);if(af.length===2){ad=new Date(ad.getYear(),ad.getMonth(),ad.getDate(),af[0],af[1],0,0);ad=isNaN(ad.getTime())?new Date():ad}ad.setMinutes(ad.getMinutes()-ad.getMinutes()%ag);E(ac,ad,ag,ae,ab,ah)}function K(aa,af,ab){var ac,Z,ah,ad,ae,ag;function ai(aj){aa.text(aj.toString());aa.trigger("change");S(Z,"jmuiSlide",true,true)}if(!af||af.constructor!==String){af=""}if(!ab||ab.constructor!==String){ab="Back"}Z=L(P(aa[0]));ac=L(Z[0].parentElement);ah=parseInt(aa.attr("increment"),10)||1;ad=parseInt(aa.attr("min"),10)||0;ae=parseInt(aa.attr("max"),10)||ad+ah*100;if(ae<ad){ae=ad}ag=parseInt(aa.text(),10);c(ac,ag,ad,ae,ah,af,ab,ai)}function R(Z){Z=!Z?L(window.document):Z;o(Z.find(".jmuiToolButton, .jmuiDeleteButton, .jmuiCancelButton, .jmuiBackButton, .jmuiAddButton, .jmuiActionButton"))}function n(Z){Z=!Z?L(window.document):Z;Z.find('input[type="checkbox"]').each(function(){var aa,ab;if(this.parentElement.tagName==="LI"){ab=L(this);ab.bind("click",Q);aa=L(this.parentElement);o(aa);aa.bind(L.ui.tapEvent,function(ac){if(!L.ui.defaultPrevented(ac)){ac.preventDefault();ab[0].checked=!ab[0].checked;ab.trigger("jmuiChange")}})}})}function l(Z){var ab;function aa(af){var ac,ad,ag,ae;if(!L.ui.defaultPrevented(af)){ag=L(af.target);ae=ag.attr("jmuiTarget");ac=ag.hasClass("jmuiGoBack");if(!ae&&ac===true&&ab.length>0){ad=ab.pop();ae=ad.selector}if(ae){if(ac===false){ad={animation:ag.hasClass("jmuiAddButton")?"jmuiSlideup":"jmuiSlide",selector:"#"+Z.find(".jmuiCurrent")[0].id};ab.push(ad)}S(L(ae),ad.animation,ac)}}}ab=[];Z.find(".jmuiGoTo, .jmuiGoBack").each(function(){var ac;ac=L(this);ac.unbind(L.ui.tapEvent,aa);ac.bind(L.ui.tapEvent,aa)})}function C(Z){Z=!Z?L(window.document):Z;Z.find(".jmuiColumn").each(function(){l(L(this))})}function z(ac){var ad,aa,ab,Z;if(Date.hasOwnProperty("CultureInfo")){ac=!ac?L(window.document):ac;Z={};for(aa=0;aa<12;aa+=1){Z[aa]=Date.CultureInfo.monthNames[aa]}ab=[31,28,31,30,31,30,31,31,30,31,30,31];ad={};for(aa=1;aa<=31;aa+=1){ad[aa]=aa}ac.find(".jmuiCompositeDate").each(function(){var af,ag,ae,ah;ag=L(this);ae=L(this.parentElement);ae.addClass("jmuiColorPress");ah=L(L.ui.parentPage(ae[0]));o(ae);ae.bind(L.ui.tapEvent,function(ai){var aj;if(L(ai.jmuiTarget).hasClass("jmuiCompositeClear")!==true){aj=I(ag[0]);D(ag,aj,ah.find(".jmuiToolbar > h1").text())}});if(ag[0].previousElementSibling){af=L(ag[0].previousElementSibling);if(af&&af.hasClass("jmuiCompositeClear")){o(af);af.bind(L.ui.tapEvent,function(){if(ag.html()!=="&nbsp;"){ag.html("&nbsp;");ag.trigger("change")}})}}})}}function g(Z){Z=!Z?L(window.document):Z;Z.find(".jmuiMask").each(function(){var ae,ac,aa,ad,af;function ab(){if(ae.hasClass("jmuiCompositeClear")){ac[0].value=""}else{if(ae.hasClass("jmuiCompositeArrow")){af=I(aa[0]);a(ac,af,ad.find(".jmuiToolbar > h1").text())}}}aa=L(this);ad=L(P(this));o(aa);ac=L(aa[0].previousElementSibling);if(ac&&ac.hasClass("jmuiCompositeInput")){ae=L(ac[0].previousElementSibling);if(ae&&ae.length){ad.bind("jmuiPageAnimationStart",function(){aa.style("right",ae[0].offsetWidth+"px")});aa.style("right",ae[0].offsetWidth+"px");o(ae);ae.bind(L.ui.tapEvent,ab)}ac=L(ac[0].firstElementChild);while(ac&&ac.length===1&&ac.style("display")==="none"){ac=L(ac[0].nextElementSibling)}}aa.bind(L.ui.tapEvent,function(){var ag;if(ac[0].nodeName==="SELECT"){ag=I(aa[0]);a(ac,ag,ad.find(".jmuiToolbar > h1").text())}else{ac[0].focus()}});aa.bind("click",function(ag){if(ac[0].nodeName==="SELECT"){Q(ag)}else{ac[0].focus()}});if(L.isIE&&ac[0].nodeName==="SELECT"){ac.removeAttr("disabled");aa.remove()}});L('.jmuiLayout textarea, .jmuiLayout input[type="text"], .jmuiLayout input[type="password"]').each(function(){var aa,ac;function ab(ae,ad,af){ae.find('textarea, input[type="text"], input[type="password"], select').each(function(){if(!af||!af.length||this!==af[0]){if(ad){if(this.hasOwnProperty("jmuiDisabled")){this.disabled=this.jmuiDisabled;delete this.jmuiDisabled}else{this.disabled=false}}else{this.jmuiDisabled=this.disabled;this.disabled=true}}})}if(N(this,"jmuiScroller")){ac=L(this);if(L(this.parentElement).hasClass("jmuiCompositeInput")){aa=this.parentElement.nextElementSibling}else{aa=this.nextElementSibling}if(aa){ac.bind("focus",function(){aa.style.left=ac.width()+ac[0].offsetLeft+"px";ab(L(L.ui.parentPage(this)),false,ac)});ac.bind("blur",function(){aa.style.left="0px";ab(L(L.ui.parentPage(this)),true,ac)})}}})}function f(aa){var Z;aa=!aa?L(window.document):aa;Z={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9};aa.find(".jmuiCompositeNumber").each(function(){var ac,ad,ab,ae;ad=L(this);ab=L(this.parentElement);ab.addClass("jmuiColorPress");ae=L(L.ui.parentPage(ab[0]));o(ab);ab.bind(L.ui.tapEvent,function(af){var ag;if(L(af.jmuiTarget).hasClass("jmuiCompositeClear")!==true){ag=I(ad[0]);K(ad,ag,ae.find(".jmuiToolbar > h1").text())}});if(ad[0].previousElementSibling){ac=L(ad[0].previousElementSibling);if(ac&&ac.hasClass("jmuiCompositeClear")){o(ac);ac.bind(L.ui.tapEvent,function(){if(ad.html()!=="&nbsp;"){ad.html("&nbsp;");ad.trigger("change")}})}}})}function j(Z){Z=!Z?L(window.document):Z;Z.find('.jmuiLayout input[type="radio"]').each(function(){var aa,ab;ab=L(this);ab.bind("click",Q);aa=L(this.parentElement);o(aa);aa.bind(L.ui.tapEvent,function(){if(!ab[0].checked){ab[0].checked=true;ab.trigger("change")}})})}function w(Z){Z=!Z?L(window.document):Z;if(Z.hasClass("jmuiPage")){X(Z)}else{Z.find(".jmuiPage").each(function(){X(L(this))})}}function U(aa){aa=!aa?L(window.document):aa;function Z(){var ac,ab;ac=L(this);if(!ac.hasClass("jmuiSelected")){ab=ac.attr("jmuiSegmentId");F(ab)}}o(aa.find(".jmuiSegmentButton").bind(L.ui.tapEvent,Z))}function h(ab){var Z,aa;ab=!ab?L(window.document):ab;Z={0:"00",1:"01",2:"02",3:"03",4:"04",5:"05",6:"06",7:"07",8:"08",9:"09",10:"10",11:"11",12:"12",13:"13",14:"14",15:"15",16:"16",17:"17",18:"18",19:"19",20:"20",21:"21",22:"22",23:"23"};aa={0:"00",5:"05",10:"10",15:"15",20:"20",25:"25",30:"30",35:"35",40:"40",45:"45",50:"50",55:"55"};ab.find(".jmuiCompositeTime").each(function(){var ad,ae,ac,af;ae=L(this);ac=L(this.parentElement);ac.addClass("jmuiColorPress");af=L(L.ui.parentPage(ac[0]));o(ac);ac.bind(L.ui.tapEvent,function(ag){var ah;if(L(ag.jmuiTarget).hasClass("jmuiCompositeClear")!==true){ah=I(ae[0]);x(ae,ah,af.find(".jmuiToolbar > h1").text())}});if(ae[0].previousElementSibling){ad=L(ae[0].previousElementSibling);if(ad&&ad.hasClass("jmuiCompositeClear")){o(ad);ad.bind(L.ui.tapEvent,function(){if(ae.html()!=="&nbsp;"){ae.html("&nbsp;");ae.trigger("change")}})}}})}function m(ab){var aa;function ac(){aa=true;R(ab);w(ab);g(ab);n(ab);j(ab);z(ab);h(ab);f(ab);U(ab)}function Z(ad){ad=undefined;if(!aa){ac();ab.unbind("jmuiPageBind",Z)}}aa=false;if(ab.hasClass("jmuiCurrent")){ac()}else{ab.bind("jmuiPageBind",Z)}}function O(Z){Z.find(".jmuiPage").each(function(){m(L(this))})}function b(Z){Z.bind("jmuiLayoutAnimationStart",function(aa){if(!L.ui.defaultPrevented(aa)){aa.preventDefault();Z.find(".jmuiPage.jmuiCurrent").trigger("jmuiPageAnimationStart",{direction:aa.direction,reverse:aa.reverse})}});Z.bind("jmuiLayoutAnimationEnd",function(aa){if(!L.ui.defaultPrevented(aa)){aa.preventDefault();Z.find(".jmuiPage.jmuiCurrent").trigger("jmuiPageAnimationEnd",{direction:aa.direction,reverse:aa.reverse})}});O(Z)}function t(Z){Z=!Z?L(window.document):Z;Z.find(".jmuiLayout").each(function(){b(L(this))})}function e(){function Z(aa){var ab;aa=undefined;if(G){G=false}else{ab=L(".jmuiLayout.jmuiCurrent .jmuiPage.jmuiCurrent")[0].id;location.hash=ab}}L(window).bind("resize",q);L(window).bind("hashchange",Z);G=true;q();t();C()}if(L.isIE){L("body").addClass("jmuiWp8")}if(window.AnimationEvent!==undefined){y="animationend"}else{if(window.WebKitAnimationEvent!==undefined){y="webkitAnimationEvent"}}if(window.TransitionEvent!==undefined){A="transitionend"}else{if(window.WebKitTransitionEvent!==undefined){A="webkitTransitionEnd"}}L(window.document).bind("touchmove",function(ab){var aa,Z;if(!L.ui.defaultPrevented(ab)){aa=P(ab.srcElement);if(aa){Z=L(aa).find(".jmuiScroller");if(Z.length>0){ab.preventDefault()}}}});L.ready(e);if(window.iScroll){L.iScroll=window.iScroll;delete window.iScroll}if(window.SpinningWheel){L.spinningWheel=window.SpinningWheel;delete window.SpinningWheel}s="&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;";L.ui={bindCheckboxes:n,bindColumn:l,bindColumns:C,bindDates:z,bindLayout:b,bindLayouts:t,bindMasks:g,bindNumbers:f,bindPage:m,bindRadios:j,bindScrollers:w,bindSegments:U,bindTimes:h,cancelEvent:Q,defaultPrevented:T,eventPosition:Y,generateTaps:o,gotoPage:S,isScrollable:true,parentColumn:J,parentElement:N,parentLayout:v,parentPage:P,passwordMask:s,refreshScroller:B,scrollOrigin:k,scrollToElement:H,setScrollerHeight:M,showListPage:W,showSlotPage:u,showSegment:F,tapAndHoldEvent:"jmuiTapAndHold",tapEvent:"jmuiTap"}}(window.jmfw));var mCapture;if(typeof Object.create!=="function"){Object.create=function(b){function a(){}a.prototype=b;return new a()}}mCapture=(function(F){var o,U,C,A,t,K,c,f,l=false,u,g="MCAPTURE_ProcessProvisioning_cacheCheckingEvents";function R(){l=true;var Y=device.version.split(".");var X="version_";if(Y.length>=1){X+=Y[0];if(Y.length>=2){X+="_"+Y[1]}}if(Y.length>=2&&device.platform.toLowerCase()==="android"){if(Y[0]=="4"&&Y[1]>=1&&Y[1]<=3){F("body").addClass("version_4_1_to_4_3")}}F("body").addClass("platform_"+device.platform.toLowerCase());F("body").addClass(X);if(device.model){F("body").addClass("model_"+device.model.replace(/\s+/g,"_").toLowerCase())}}window.document.addEventListener("deviceready",R,false);function L(){return !!window.localStorage.phonegapPresent}function y(){return window.localStorage.shellType}function P(){var ac,Y;function X(ad){ac=!!ad;Y={}}function aa(){return Y}function ab(ad,ag){var af,ae;if(ac){af=new Date()}ae=ag();if(ac){af=(new Date()-af)/1000;Y[ad]=af}return ae}function Z(ae,ag){var af;function ad(){if(ac){af=(new Date()-af)/1000;Y[ae]=af}}if(ac){af=new Date()}return ag(ad)}X(false);return{clear:X,getResults:aa,profileAsync:Z,profileSync:ab}}function B(aa){var Y;if(aa===null){return"null"}Y=typeof aa;if(Y!=="object"){if(Y==="number"&&isNaN(aa)){return"nan"}return Y.toLowerCase()}if(aa.constructor){if(aa.constructor.name){return aa.constructor.name.toLowerCase()}}switch(aa.constructor){case Array:return"array";case String:return"string";case Function:return"function";case Number:return"number";case Boolean:return"boolean";case Date:return"date";default:if(aa.constructor.toString()){var Z=aa.constructor.toString();var X;if(Z.charAt(0)=="["){X=Z.match(/\[\w+\s*(\w+)\]/)}else{X=Z.match(/function\s*(\w+)/)}if(X&&X.length==2){return X[1]}return aa.constructor.toString()}}return"???"}function j(X){if(X===undefined){return t.db.getMetaValue("currentPageId")}t.db.setMetaValue("currentPageId",X)}function b(Z){function Y(aa){log.warn(aa);D(false)}function X(aa){if(aa){D(false)}else{E()}}if(!Z.defaultPrevented&&Z.jmuiTarget&&(Z.jmuiTarget.nodeName==="H1"||F(Z.jmuiTarget).hasClass("jmuiToolbar"))){Z.preventDefault();if(t.fl.postNotification){t.fl.execFormula("postNotification",X,Y,true)}else{Y("No notification tap handler installed")}}}function D(X){if(X){F("body").addClass("mdcUnreadNotifications");F.ui.generateTaps(F(".jmuiCurrent h1")).bind(F.ui.tapEvent,b)}else{F("body").removeClass("mdcUnreadNotifications");F(".jmuiCurrent h1").unbind(F.ui.tapEvent,b)}}function E(){var X;X=t.db.getUserInfo();t.notify.service.getUnreadMessages(X.mSuiteUserName,X.mSuiteUserName,undefined,function(Z,Y){D(Y&&Y.length)})}function H(){var X;if(C<=0){C=1;F(":focus").blur();X=F(document.createElement("div"));X.addClass("activity");if(!jmfw.isIE){U=setTimeout(function(){U=undefined;o=true;X.html("<div></div>")},500)}else{X.html("<div></div>")}document.body.appendChild(X[0])}else{C+=1;K+=1}}function q(X){if(X){C=0;K=0}else{C-=1;K-=1}if(C<=0){C=0;if(U!==undefined){clearTimeout(U);U=undefined}o=false;F(".activity").remove()}}function T(ag,ah,ai){var Z,ad,X,ac,ab,Y,af,aa;log.debug("msbox - caption : "+ah+" message : "+ai);q(true);function ae(ak){var aj,al;log.debug("msbox button clicked : "+ak);if(!F.ui.defaultPrevented(ak)){ak.preventDefault();ak.stopPropagation();aj=F(this);al=aj.text();ad.find(".msgBoxButton").unbind("click",ae);ad.find(".msgBoxButton").unbind("touchstart",ae);setTimeout(function(){log.debug("msbox remove");if(aa){aa.remove()}if(K){H();C=K}X.remove();af.remove();if(ag){ag(al)}},100)}}X=F("#msgBoxContainer");if(X.length){log.error("msbox function called whilst already displaying a message - caption : "+ah+" message : "+ai);ag("");return}F(":focus").blur();af=F(document.createElement("div"));af[0].id="msgBoxSplash";X=F(document.createElement("div"));X[0].id="msgBoxContainer";ad=F(X[0].appendChild(document.createElement("div")));if(ah){ad[0].appendChild(document.createElement("h1")).innerText=ah}if(ai){Y=ai.split("|");if(Y.constructor===Array){for(ab=0;ab<Y.length;ab++){ad[0].appendChild(document.createElement("p")).innerText=Y[ab]}}else{ad[0].appendChild(document.createElement("p")).innerText=ai}}for(ac=3;ac<arguments.length;ac+=1){Z=F(ad[0].appendChild(document.createElement("div")));Z.addClass("msgBoxButton");Z.text(arguments[ac]);F.ui.generateTaps(Z.bind(F.ui.tapEvent,ae))}document.body.appendChild(af[0]);document.body.appendChild(X[0]);aa=F(document.createElement("div"));aa[0].id="msgBoxContainerHider";document.body.appendChild(aa[0]);F("#msgBoxContainerHider").bind("click",function(aj){console.log("Clicked the hider panel")});if(F.isAndroid){X.style("left","1px");setTimeout(function(){X.style("left","0px")},0)}K=C;if(K){C=1;q()}}function d(){return A}function S(){return c}function s(X){N();if(X>0){localStorage[g]=parseFloat(localStorage[g])+1}else{localStorage[g]=0}}function N(){if(localStorage[g]===undefined){localStorage[g]=0}return parseFloat(localStorage[g])}function z(){function Y(){s(0)}var X=window.ctAppCache;if(X){X.addEventListener("checking",Y,false);X.addEventListener("downloading",Y,false);X.addEventListener("noupdate",Y,false);X.addEventListener("updateready",Y,false);X.addEventListener("progress",Y,false);X.addEventListener("cached",Y,false);log.debug("Added cache listeners")}}function h(ag,Y){var Z,ap,ak,am,aa,ac;function ah(au){aborted=true;function at(av){log.debug("On our way home to "+av)}log.debug("Process provisioning error - "+au);if(typeof(t)!=="undefined"){t.msgBox(function(av){log.debug("Calling mc.fl.gotoprovisioningurl");t.fl.gotoprovisioningurl(at)},"Provisioning Error","You must retry the operation. Reason: "+au,"OK")}else{log.debug("Changing location to ../../index.html");window.locationUtils.setHref("../../index.html")}}function ai(){t.fl.msgboxasync(O,"There may be new process versions to be tested. The application will now be reloaded")}function ab(aw){function au(){return window.localStorage.getItem("isTesting")==="yes"}log.debug("Check if cache update required gotoUrl");var at=window.ctAppCache;try{log.debug("Current cache status="+at.status);switch(at.status){case 0:log.debug("Current cache status uncached");s(0);break;case 1:log.debug("Current cache status idle");s(0);break;case 2:log.debug("Current cache status checking for update");break;case 3:log.debug("Current cache status downloading");break;case 4:log.debug("Current cache status update ready");s(0);at.swapCache();if(au()){ai();return}break;case 5:log.debug("Current cache status obsolete");s(0);break;default:log.debug("Current cache status unknown = "+at.status);s(0);break}}catch(av){log.error("gotoUrl : Cache Error : "+av);ah(av);return}aw()}function ae(){var at=false;if(ag.indexOf("visualize.html")>=0){at=t.db.getProcess(ag.substring(6).replace("/visualize.html","").replace("/"," ")).home}if(ag.indexOf("launch.html")>=0){at=true}return at}function al(){if(ae()){ab(ar)}else{ar()}}function ad(au){var at=false;return at;try{if(typeof au=="undefined"){at=true}else{if(au&&au.closed){at=false}else{if(au&&au.outerWidth==0){at=true}else{if(au&&au.test){at=false}else{at=true}}}}}catch(av){}if(at){alert("The popup was blocked. You must allow popups to use this site.")}else{au.focus()}t.hideActivity(true)}function ao(at){setTimeout(function(){ad(at)},5000)}function aq(au){alert("You must allow popups to use site '"+au+"'");var at="userConsole";var av=window.open(au,at,"width=1000, height=700, left=24, top=24, scrollbars, resizable");ao(av)}function X(at){if(at.toLowerCase().indexOf("cthttp")===0){return false}else{if(at.toLowerCase().indexOf("exhttp")===0){return false}else{if(at.toLowerCase().indexOf(":")!==-1){return false}}}return true}function aj(){try{return(t.db.getCurrentProcess().id==="Visualization")}catch(at){log.debug("Error testing for for visualization "+at);return false}}function af(){try{return(cordova!==undefined&&cordova.exec!==undefined&&window.plugins!==undefined&&window.plugins.settings!==undefined)}catch(at){log.debug("Error testing for shell "+at);return false}}function ar(){log.debug("Navigating to "+ag);if(aj()||!af()){log.debug("Testing or visualization showing externallink "+ag);if(ag.toLowerCase().indexOf("cthttp")===0){aa=ag.substr(2,ag.length-2);aq(aa);return}else{if(ag.toLowerCase().indexOf("exhttp")===0){aa=ag.substr(2,ag.length-2);aq(aa);return}}}if(ak.length<=1&&ae()){t.fl.clearsubjectstack();window.locationUtils.setHref("../../launch/0/launch.html")}else{window.locationUtils.setHref(ag)}if(!X(ag)){t.hideActivity(true)}}function an(){log.debug("After stopping notifications, will navigate to "+ag);t.showActivity();a(al)}ak=t.db.getJsonItem("subjectStack")||[];if(!X(ag)||aj()){ar(ag);return}Z=t.db.getCurrentProcess();if(Z!==undefined){ap=t.db.getCurrentSubjectGuid();if(Z.notClientCreatable&&t.fl.isclientsubject()){t.db.deleteSubject(ap,an)}else{if((Z.singleSubject&&Z.deleteOnClose)){if(ak.length===0||ap!==ak[ak.length-1]){t.db.deleteSubject(t.db.getCurrentSubjectGuid(),an)}else{t.db.evaluateSummaryValues(Z.summaryMap,t.fl.summaries,an)}}else{t.db.evaluateSummaryValues(Z.summaryMap,t.fl.summaries,an)}}}else{an()}}function k(af){var Z,Y;Y="../../index.html";function aa(){if(Z!==undefined){clearTimeout(Z);Z=undefined}}function ac(ah){aa();t.fl.clearsubjectstack();t.gotoUrl(ah,true);if(af!==undefined){if(typeof af==="function"){af(ah)}else{if(typeof af.resume==="function"){af.resume(ah)}else{log.error("Unable to exit from provisioning url reason: invalid callback")}}}else{log.debug("Unable to exit from provisioning url reason: callback undefined")}}function X(){log.debug("User agent: "+window.navigator.appVersion);var ai,ah;if(F.isAndroid){ai="Android"}else{if(F.isWp8){ai="WP8"}else{if(F.isIpad||F.isIphone){ai="IOS"}else{ai="Unknown"}}}ah=t.version.getversion("framework");return"X-mDesign-"+ai+"-Code-Version="+ah}function ag(ah){aa();log.info("Provisioning url from shell : "+ah);Y=ah+"&"+X();log.info("Provisioning url request : "+Y);ac(Y)}function ad(ah){aa();log.error("Unable to get provisioning url from shell reason: "+ah);Y=Y+"?"+X();log.info("Provisioning url derived : "+Y);ac(Y)}function ae(){aa();log.debug("timeout: plugin did not return");ad("getProvisioningURL - timeout")}if(l){if(window.plugins!==undefined&&window.plugins.settings!==undefined){if(typeof(window.plugins.settings.getProvisioningURL)==="function"){try{Z=setTimeout(ae,2*1000);window.plugins.settings.getProvisioningURL(ag,ad);log.debug("Provisioning URL requested from shell")}catch(ab){ad(ab)}return}log.debug("typeof(window.plugins.settings.getProvisioningURL) = "+typeof(window.plugins.settings.getProvisioningURL));ad("getProvisioningURL missing or invalid");return}log.debug("plugins not ready: "+typeof(window.plugins)+" - "+typeof(window.plugins.settings));ad("getProvisioningURL - plugins not ready")}else{log.debug("cordova not ready ");ac(Y+"?redetect-device=no&"+X())}}function O(){var X;X=t.db.getHomeProcess();if(X&&X.url){t.fl.clearsubjectstack();h(X.url,!X.urlProcess)}}function M(){F(".preventDefaultTouch").bind("touchstart",F.ui.cancelEvent).bind("touchmove",F.ui.cancelEvent).bind("touchend",F.ui.cancelEvent)}function V(){F(".pageBack").bind(F.ui.tapEvent,function(X){if(!F.ui.defaultPrevented(X)&&!F(this).attr("disabled")){X.preventDefault();j(F.ui.parentPage(this).id);t.fl.pageback()}});F(".pageForward").bind(F.ui.tapEvent,function(X){if(!F.ui.defaultPrevented(X)&&!F(this).attr("disabled")){X.preventDefault();j(F.ui.parentPage(this).id);t.fl.pagenext()}});F(".pageHome").bind(F.ui.tapEvent,function(X){if(!F.ui.defaultPrevented(X)&&!F(this).attr("disabled")){X.preventDefault();j(F.ui.parentPage(this).id);t.fl.pagehome()}});F(".jmuiToolButton[id],.jmuiDeleteButton[id],.jmuiCancelButton[id],.jmuiBackButton[id],.jmuiAddButton[id],.jmuiActionButton[id]").bind(F.ui.tapEvent,function(Y){if(!F.ui.defaultPrevented(Y)&&!F(this).attr("disabled")){var X;Y.preventDefault();X=this;F(X).attr("disabled",true);if(jQuery("input:focus, textarea:focus").length>0){jQuery("input:focus, textarea:focus").blur()}t.fl.execFormula("action_"+this.id,function(Z){F(X).removeAttr("disabled")},function(Z){F(X).removeAttr("disabled");alert(Z)},true)}})}function v(){var X;X=t.db.getMetaValue("currentCss");if(X){t.fl.switchcss(X)}}function a(Z){var Y,X;X=t.db.getUserInfo();Y=X.mSuiteUserName;t.notify.service.cancelInboxChanges(Y,Z)}function G(ad){var ac,X;function ab(ai,ag){function af(aj){log.warn(aj);D(true);c-=1}function ah(aj){if(aj){log.debug("preNotifySuccess - rec: "+ac+" id: "+ag.message.id);t.notify.service.messageReceivedAck(ac,ag.message.id);E()}else{D(true)}c-=1}if(!ai&&ag&&ag.message&&ag.message.channel===ad){log.info("Inbox change action: "+ag.action);switch(ag.action){case"create":log.debug("Inbox create to be actioned r = "+JSON.stringify(ag));if(!t.notify.handleMessage(ag.message)){c+=1;t.fl.execFormula("preNotification",ah,af,true,ag.message)}else{log.warn("Inbox change not handled")}break;case"update":break;case"delete":E();break;default:log.warn("Inbox change - unknown action: "+ag.action);break}}else{if(ai){log.warn("Inbox change error: "+ai)}else{log.warn("Inbox change not actioned r = "+JSON.stringify(ag))}}}X=t.db.getUserInfo();function ae(af){if(X.mSuiteUserName!==""){if(X.mSuiteUserName!==ad){ac=X.mSuiteUserName;log.info("Cancel inbox changes:"+ac);t.notify.service.cancelInboxChanges(ac,function(){log.warn("Remove current system channel user:"+ac);t.notify.service.removeChannel(ac,function(ag){if(ag){log.warn(ag)}X.receveInboxChanges=false;X.mSuiteUserName="";t.db.setUserInfo(X);log.info("Setup new user:"+ad);af()})})}else{log.info("Old is not changed:"+ad);af()}}else{log.info("Old user is blank - setup new user:"+ad);af()}}function Z(){log.info("Receive inbox changes for user:"+ad);ac=ad;if(window.receveInboxChanges!==ac){window.receveInboxChanges=ac;t.notify.service.receiveInboxChanges(ac,ab);X.receveInboxChanges=true;t.db.setUserInfo(X)}else{log.info("Receive inbox changes for user:"+ad+" no change")}t.refreshNotificationIndicator()}function Y(){if(ad!==""){if(!X.receveInboxChanges||X.mSuiteUserName!==ad){log.info("Add new system channel user:"+ad);t.notify.service.addChannel(ad,function(af){if(af){log.warn(af)}X.mSuiteUserName=ad;Z();return})}else{log.info("No change to system channel");Z();return}}else{log.warn("No user name so cannot set up notifications system channel")}t.refreshNotificationIndicator()}function aa(af){if(af&&af.indexOf(ad)<0){log.info("Change system channel from:"+X.mSuiteUserName+" to :"+ad);ae(Y)}else{log.info("System channel already set to:"+ad);ae(Y)}}if(X){if(!X.receveInboxChanges){log.info("Initialize system channel to :"+ad);Y()}else{t.notify.service.listChannels(aa)}}else{log.warn("No user info so cannot set up notifications system channel")}}function Q(Y,ad){var ae,ab,af,ai,ak,ah,ac;function aa(){var al;for(al=0;al<ab.length;al+=1){ab[al].deleteValue()}}function aj(am){var al=t.q(ae,am);if(al){ab[ab.push(al)-1].initialize();al.getQuestionObject().bind("questionLoaded",function(){F.ui.refreshScroller(ae)})}else{log.warn("Failed to create question object for id: "+am.attr("id"))}}function ag(){var at,am,ap,ao,an,au,av;function aw(){this.removeEventListener("questionLoaded",aw);an-=1;if(an<=0){t.fl.refreshhidden()}}j(Y);au=ae.attr("rowIndex");at=ae.find(".jmuiHeader");if(at.length===1){am=at.find(".extra");ap=ai?F.tmpl(ai,t.db.getCurrentSubject()):"";if(ap&&am.length===0){am=F(window.document.createElement("div"));am.addClass("extra");at[0].appendChild(am[0])}am.html(ap||"");am=at.find(".buttonExtra.head.left");ap=ah?F.tmpl(ah,t.db.getCurrentSubject()):"";am.html(ap||"");am=at.find(".buttonExtra.head.right");ap=ac?F.tmpl(ac,t.db.getCurrentSubject()):"";am.html(ap||"")}at=ae.find(".jmuiFooter");if(at.length===1){am=at.find(".extra");ap=ak?F.tmpl(ak,t.db.getCurrentSubject()):"";if(ap&&am.length===0){am=F(window.document.createElement("div"));am.addClass("extra");av=at.find(".jmuiToolbar");if(av.length===0){at[0].appendChild(am[0])}else{at[0].insertBefore(am[0],av[0])}}am.html(ap||"");if(ad.footerButtonTemplateList){for(btnSpec in ad.footerButtonTemplateList){var al,ar;al=at.find(".md_toolbarButton_"+btnSpec+" > .buttonExtra");if(al.length===1){ar=ad.footerButtonTemplateList[btnSpec];ap=ar?F.tmpl(ar,t.db.getCurrentSubject()):"";al.html(ap||"")}}}}F.ui.setScrollerHeight(ae);try{an=ab.length;for(ao=0;ao<ab.length;ao+=1){ab[ao].getQuestionObject()[0].addEventListener("questionLoaded",aw);ab[ao].setRowIndex(au);ab[ao].load()}}catch(aq){log.warn("Exception caught loading question")}if(af&&af.constructor===Function){ae.find(".jmuiToolbar > div").removeAttr("disabled");ae.find(".gridInline, .popupQuestions li").removeAttr("disabled")}}function X(al){var am;if(al===undefined||al.direction==="in"){if(af&&af.constructor===Function){ae.find(".jmuiToolbar > div").attr("disabled","disabled");ae.find(".gridInline, .popupQuestions li").attr("disabled","disabled");af(ag)}else{ag()}}else{if(al.direction==="out"){log.debug("Unloading page "+Y);F(".pageBack,.pageForward,.pageHome").attr("disabled",true);for(am=0;am<ab.length;am+=1){ab[am].unload()}log.debug("Done unloading page "+Y)}}}function Z(al){var am;if(al===undefined||al.direction==="in"){for(am=0;am<ab.length;am+=1){ab[am].postLoad()}}else{if(al.direction==="out"){for(am=0;am<ab.length;am+=1){ab[am].postUnload()}log.debug("Enabling buttons"+Y);F('div.jmuiHeader > div[disabled="true"],.pageBack,.pageForward,.pageHome').removeAttr("disabled")}}}log.debug("Initializing page "+Y);if(ad){af=ad.query;ai=ad.headerTemplate;ak=ad.footerTemplate;ah=ad.topLeftButtonTemplate;ac=ad.topRightButtonTemplate}ae=F("#"+Y);ab=[];ae.bind("jmuiPageAnimationStart",X);ae.bind("jmuiPageAnimationEnd",Z);ae.find("ul[id]").each(function(){aj(F(this))});ae.find("li[id]").each(function(){aj(F(this))});ae.find(".jmuiDeleteButton").bind(F.ui.tapEvent,function(am){var al;if(!am.ignoreDelete&&!F.ui.defaultPrevented(am)){am.preventDefault();al=F(this);T(function(an){if(an==="Yes"){aa();al.trigger(F.ui.tapEvent,{jmuiTarget:am.jmuiTarget,ignoreDelete:true})}},"Confirm","Delete","Yes","No")}});if(ae.hasClass("jmuiCurrent")===true){X();Z()}log.debug("Done initializing page "+Y)}function w(){var aa,Z,Y;function ab(ac){var ae,ad;if(ac<0){ac=0}if(ac>100){ac=100}ad="";ad+=ac+"%";ae=F("#replicateProgressComplete");ae.style("width",ad)}function X(ac){if(ac.overall!==undefined){ab(ac.overall)}if(ac.action!==undefined){Y.text(ac.action)}}aa=F("#replicatePage");aa.bind("jmuiPageAnimationStart",function(ac){if(ac.direction==="in"){Y.text("");ab(0);if(t.replInfo!==undefined&&t.replInfo.title!==undefined){aa.find("h1").html(t.replInfo.title)}else{aa.find("h1").html("Syncing")}aa.find(".jmuiCancelButton").removeAttr("disabled")}});aa.bind("jmuiPageAnimationEnd",function(ad){function ac(ah){var ai,ae,af;Z=ah;if(t.replInfo){ai=t.replInfo.callback;ae=t.replInfo.url;af=t.replInfo.page;delete t.replInfo}if(ai){ai.resume(Z);ai=undefined}else{if(ae){try{h(ae,false)}catch(ag){O()}}else{if(t.db.getCurrentProcess().replicator){O()}else{if(af){F.ui.gotoPage(F("#"+af),"jmuiSlide",true)}else{F.ui.gotoPage(F("#processesPage"),"jmuiSlide",true)}}}}}if(ad.direction==="in"){if(!t.repl.isReplicating()){if(!t.replInfo){t.replInfo=t.db.getJsonItem("mcReplInfo");t.db.deleteJsonItem("mcReplInfo")}t.repl.subscribeStatus(X);q(true);t.repl.replicate(ac,t.replInfo)}}});aa.find(".jmuiCancelButton").bind(F.ui.tapEvent,function(ae){var ac,ad;if(!F.ui.defaultPrevented(ae)){ae.preventDefault();ad=F(this);ac=ad.attr("disabled");if(ac===undefined||ac===null){ad.attr("disabled","disabled");t.repl.abortReplication()}}});Y=aa.find(".statusText")}function n(X){var Y,aa,Z;w();if(X){if(X.constructor===Object){for(Z in X){if(X.hasOwnProperty(Z)){Q(Z,X[Z])}}}else{if(X.constructor===Array){aa=X.length;for(Y=0;Y<aa;Y+=1){Q(X[Y])}}}}}function W(aa,X){var Y,Z;Y=window.outerWidth-window.innerWidth;Z=window.outerHeight-window.innerHeight;Y=Y+aa;Z=Z+X;window.resizeTo&&window.resizeTo(Y,Z)}function I(X){var Z={delay:"100"};log.debug("IN mc.provision :"+X.id);function Y(aa){log.debug("IN mc.provision.provisioned :"+X.id);if(window.MCAPTURE_ProcessProvisioned&&window.MCAPTURE_ProcessProvisioned.constructor===Function){window.MCAPTURE_ProcessProvisioned(aa)}else{log.error("mc.provision cant complete:"+X.id);log.debug("mc.provision completion function:"+window.MCAPTURE_ProcessProvisioned)}}log.debug("mc.provision "+JSON.stringify(Z));if(window.MCAPTURE_ProcessProvisioned&&window.MCAPTURE_ProcessProvisioned.constructor===Function){window.MCAPTURE_ProcessProvisioned(Z)}t.db.createProcess(X,Y)}function x(){var ae={};ae.resume=function Y(af){};var aa=localStorage.searchString;localStorage.removeItem("searchString");if(aa){var ad=aa.substr(1);var ac=ad.split("&");var X={};for(var Z=0;Z<ac.length;Z++){var ab=ac[Z].split("=");if(ab.length>1){X[ab[0]]=ab[1]}else{X[ab[0]]=""}}if(X.replicate=="true"){t.fl.replicatedialog()}}}function m(){if(!u){var Y=window.locationUtils.getURI().path();var X=Y.toLowerCase().lastIndexOf("/mdesign/")+1;u=Y.substr(0,X).replace("/^/*/","/")}return u}function J(Y){if(window.plugins&&window.plugins.settings){window.plugins.settings.getApplicationID(Y,function(){log.error("Failed to retrieve ApplicationID from call to window.plugins.settings.getApplicationID")})}else{var X=window.localStorage.applicationID;if(!X){X=window.localStorage.applicationID=t.db.guid()}Y(X)}}function e(Z,ac,Y,X,ab){var aa;log.debug("IN mc.ready");setTimeout(function(){var ad;if(X){log.debug("IN DOM ready for "+X.id);if(X.useAnimation===false){F.hasAnimation=false}}else{log.debug("IN DOM ready for undefined process")}F(window).bind("load",function(){F(window).trigger("resize")});if(ac>0&&Y>0){W(ac,Y+1)}var ag=function(){var aj,ah;log.debug("IN DB ready");log.debug("File System is "+(t.fs.available?"":"not ")+"available.");log.debug("File System is "+(t.fs.availableForAtts?"":"not ")+"available for attachments.");function ai(){if(!X){log.error("initComplete called for undefined process");return}t.q.ready(X.questions);ad=j();V();n(X.pages);M();v();ah=t.db.getUserInfo();if(ah&&ah.mSuiteUserName!==""){G(ah.mSuiteUserName)}if(ad){aj=F("#"+ad);if(!aj.hasClass("jmuiCurrent")){F.ui.gotoPage(aj)}}else{if(!F(".jmuiPage.jmuiCurrent").length){F.ui.gotoPage(F(".jmuiLayout.jmuiCurrent .jmuiPage"))}}t.hideActivity(true);log.debug("Triggering mcready");F(document).trigger("mcready");log.debug("OUT DB ready");x()}if(ab){ab(ai)}else{ai()}};t.db.ready(Z,X,ag);function ae(){F("div.jmuiPage").removeClass("jmuiKeyboardUp");aa=setTimeout(function(){jmfw.ui.setScrollerHeight(jmfw("div.jmuiPage.jmuiCurrent"))},1500)}function af(){F("div.jmuiPage").addClass("jmuiKeyboardUp");clearTimeout(aa)}if(F.isAndroid){document.addEventListener("hidekeyboard",ae,false);document.addEventListener("showkeyboard",af,false)}else{if(!jmfw.isIE){F("input, textarea").bind("focus",af);F("input, textarea").bind("blur",ae)}}log.debug("OUT DOM ready for "+X.id)},100);z();log.debug("OUT mc.ready")}C=0;c=0;A="d MM, yy";f=(window.navigator.userAgent.toLowerCase().indexOf("cttesting")>=0);t={currentPage:j,db:undefined,fl:undefined,getDateFormat:d,getLongDateFormat:d,getPreNotifyCount:S,getRootPath:m,getApplicationID:J,getShortDateFormat:d,goHome:O,gotoUrl:h,gotoProvisioningUrl:k,hideActivity:q,initnotifications:G,msgBox:T,provision:I,q:undefined,ready:e,refreshNotificationIndicator:E,showActivity:H,showNotificationIndicator:D,sid:undefined,unrestricted:window.plugins&&window.plugins.settings,testingInBrowser:f,phonegapPresent:L,getShellType:y,getobjectclass:B};t.profiler=P();return t}(window.jmfw));(function(aE,aB){var Q,aS,t,G,C,aj,a;function aL(a3,a6,a5,a0){var aZ,a7;function a4(a8){a7=true;a6(a8)}function a1(a8){if(a5){log.error("Supplied transaction failed callback error : "+a8);a5(a8)}else{log.error("Supplied transaction no error callback failed "+a8)}}function a2(){if(a7){if(a0){a0()}}else{aZ+=1;if(aZ<3){log.debug("Supplied transaction function not called. Will retry, failCount: "+aZ);G[a3](a4,a1,a2)}else{log.error("Supplied transaction function not called. Exceeded retry count, failCount: "+aZ);if(a0){a0()}}}}a7=false;aZ=0;G[a3](a4,a1,a2)}function aA(aZ){G=aZ}function ag(aZ){if(aZ){t=aZ}return t}function v(a1,a2,a7){var a0,a5;a5=false;function a6(a9){if(a7){if(!a5){a5=true;a7(a9)}}}function a3(a9,ba){a9=undefined;a6(ba)}function a8(ba,a9){ba=undefined;a9=undefined;a6()}function a4(a9){a6(a9)}function aZ(){a6()}a0=[a1];aL("transaction",function(a9){if(!a2){a9.executeSql("DELETE FROM attachment WHERE subjectGuid=?;",a0);if(aB.fs.availableForAtts){aB.fs.deleteAttachments(a1)}}a9.executeSql("DELETE FROM subject WHERE guid=?;",a0,a8,a3)},a4,aZ)}function at(a0,aZ,a2,a6){var a5;function a4(a7){if(a6){a6(a7)}}function a1(a7,a8){a7=undefined;a4(a8)}function a3(a8,a7){a8=undefined;a7=undefined;a4()}a5=[aZ];if(!a2){a0.executeSql("DELETE FROM attachment WHERE subjectGuid=?;",a5);if(aB.fs.availableForAtts){aB.fs.deleteAttachments(aZ)}}a0.executeSql("DELETE FROM subject WHERE guid=?;",a5,a3,a1)}function W(aZ,a0){aL("transaction",function(a1){a1.executeSql(aZ,[],a0,a0)})}function ax(a4,a3){var a5,a0,aZ,a2,a1,a7,a6;a7=a4.split(".");a6=a3.split(".");a2=a7.length;a1=a6.length;aZ=a2<a1?a2:a1;for(a0=0;a0<aZ;a0+=1){a5=parseInt(a7[a0],10)-parseInt(a6[a0],10);if(a5<0){return -1}if(a5>0){return 1}}if(a2<a1){return -1}if(a2>a1){return 1}return 0}function I(aZ){var a0;a0=aB.profiler.profileSync("getJsonItemRead",function(){return localStorage.getItem(aZ)});if(a0!==undefined&&a0!==null){a0=aB.profiler.profileSync("getJsonItemParse",function(){return aE.jsonParse(a0)})}return a0||undefined}function X(aZ){if(aZ&&aZ.constructor===Object){aZ=aZ._meta.guid}return aZ}function am(aZ){return aB.profiler.profileSync("getProcess",function(){return aB.db.getJsonItem(aZ)})}function aT(){return aB.db.getJsonItem("processNames")}function ab(a1){var aZ=[],a0;a0=aB.db.getProcessNames();if(a0!==undefined){aE.each(a0,function(a3,a4){var a6,a5,a2;a3=undefined;a5=a4.split(" ");a6=a5[0];a2=a5[1];if(a1===a6){aZ.push(a2)}})}return aZ}function H(a1){var a0,aZ;aZ=aB.db.getProcessVersions(a1);if(aZ!==undefined){aE.each(aZ,function(a2,a3){a2=undefined;if(a0!==undefined){if(ax(a0,a3)<0){a0=a3}}else{a0=a3}})}return a0}function f(aZ,a1){var a0;a0=aB.profiler.profileSync("setJsonItemStringify",function(){return aE.jsonStringify(a1)});aB.profiler.profileSync("setJsonItemWrite",function(){try{localStorage.setItem(aZ,a0)}catch(a2){if(a2.code===22){localStorage.removeItem(aZ);localStorage.setItem(aZ,a0)}else{throw (a2)}}})}function aY(aZ,a0){log.debug("IN mc.db.setProcess");aB.profiler.profileSync("setProcess",function(){log.debug("OUT mc.db.setProcess profiler");aB.db.setJsonItem(aZ,a0)})}function b(aZ){aB.db.setJsonItem("processNames",aZ)}function aX(aZ){var a0;a0="";if(aZ&&aZ.id&&aZ.version){a0=aZ.id.replace(" ","_");a0+=" "+aZ.version.replace(" ","_")}return a0}function aJ(aZ,a1,a0){if(a1&&typeof a1==="function"){if(aZ&&aZ.constructor===String){if(!a0&&t&&aZ===t.guid){a1(t.value)}else{aL("readTransaction",function(a7){var a3,a6,a5;function a4(a9,a8){var ba;a9=undefined;if(a8&&a8.rows.length>0){ba=aE.jsonParse(a8.rows.item(0).answers);if(a0){a0=a8.rows.item(0);delete a0.answers}}a1(ba,undefined,a0)}function a2(a8,a9){a8=undefined;a1(undefined,a9)}a6=[aZ];a5="SELECT answers ";if(a0){for(a3=0;a3<50;a3+=1){a5+=", col"+a3.toString()}}a5+=" FROM subject WHERE guid = ?";a7.executeSql(a5,a6,a4,a2)})}}else{a1(aZ)}}}function P(a1){var aZ;function a0(a2){if(!aZ){aZ=true;a1(a2)}}if(a1&&typeof a1==="function"){aL("readTransaction",function(a2){var a5;function a4(a7,a6){var a8,bb,bc={};a7=undefined;if(a6&&a6.rows&&a6.rows.length){for(a8=0;a8<a6.rows.length;a8+=1){var a9,ba;bb=a6.rows.item(a8);a9=aX({id:bb.processId,version:bb.processVersion});ba=am(a9);if(ba.home){continue}if(ba.singleSubject&&(ba.deleteOnClose||ba.deleteOnOpen)){continue}if(bc[bb.processId]===undefined){bc[bb.processId]=[bb.processVersion]}else{bc[bb.processId].push(bb.processVersion)}}}a0(bc)}function a3(a6,a7){a6=undefined;a7=undefined;a0({})}a5="SELECT DISTINCT processId, processVersion FROM subject WHERE backupGuid IS NULL";a2.executeSql(a5,[],a4,a3)},function(){a0({})})}}function aC(aZ,a1,a2){var a0;if(a1===undefined||a1===null){a2=-1;a1=""}a0=new Date();a0.setDate(a0.getDate()+a2);document.cookie=aZ+"="+window.escape(a1)+((a2===undefined)?"":";expires="+a0.toUTCString())+"; path=/"}function n(aZ){aB.db.getUsedProcessVersions(function(a0){aB.db.setCookie("usedProcessVersions",aE.jsonStringify(a0));if(window.plugins&&window.plugins.settings&&window.plugins.settings.setPreference){window.plugins.settings.setPreference(function(){log.debug("Set usedProcessVersions to: "+aE.jsonStringify(a0))},function(){log.error("Failed to set usedProcessVersions preference")},"usedProcessVersions",aE.jsonStringify(a0))}aZ()})}function aG(a1){var aZ,a3,a2,a0;a2=aB.db.getProcess(a1);a0=aB.db.getProcessNames();if(a0){a3=a0.length;for(aZ=0;aZ<a3;aZ+=1){if(a0[aZ]===a1){a0.splice(aZ,1);break}}b(a0)}}function aQ(aZ,a1,a0){aB.db.getSubject(aZ,function(a4,a7){var a3,a8,a6,a5;function a2(a9){if(!a9){if(!a0&&aB.replstore!==undefined){aB.replstore.delete_attachment_date(aZ)}if(a6&&a6.version!==aB.db.getLatestProcessVersion(a6.id)){if(a6.subjectGuids===undefined||a6.subjectGuids.length===0){aG(a5)}}n(function(){if(a1){a1()}})}else{if(a1){a1(a9)}}}aZ=aB.db.getSubjectGuid(aZ);if(a4!==undefined&&a4!==null){a5=aB.db.makeProcessName({id:a4._meta.processId,version:a4._meta.processVersion});if(aS!==undefined&&aS.name!==undefined&&aS.name===a5){a6=aS.value}else{a6=aB.db.getProcess(a5)}if(a6!==undefined){if(a6.subjectGuids!==undefined){a8=a6.subjectGuids.length;for(a3=0;a3<a8;a3+=1){if(a6.subjectGuids[a3]===aZ){a6.subjectGuids.splice(a3,1);if(a6.currentSubjectGuid===aZ){delete a6.currentSubjectGuid}aB.db.setProcess(a5,a6);break}}}}aB.db._deleteSubject(aZ,a0,a2)}else{if(a1){a1(a7)}}})}function l(a0,a5){var a1,a4,a3;function aZ(a6,a7){a6=undefined;a7=undefined;a5()}function a2(a7,a6){var a8;a7=undefined;a1=[];if(a6.rows&&a6.rows.length){for(a8=0;a8<a6.rows.length;a8+=1){a1.push(a6.rows.item(a8).guid)}}a5(a1)}a4=[];a3="SELECT guid FROM subject WHERE backupGuid=?;";a4.push(a0);aL("readTransaction",function(a6){a6.executeSql(a3,a4,a2,aZ)})}function F(aZ,a0,a1){if(a1&&typeof a1==="function"){log.debug("getAttachment "+aZ+" "+a0);aL("readTransaction",function(a2){var a6,a5;function a4(a8,a7){a8=undefined;if(a7&&a7.rows.length>0){a1(a7.rows.item(0).data)}else{a1()}}function a3(a7,a8){a7=undefined;a1(undefined,a8)}a6=[aB.db.getSubjectGuid(aZ),a0];a5="SELECT data FROM attachment WHERE subjectGuid=? AND name=?";a2.executeSql(a5,a6,a4,a3)})}}function u(a3,aZ,a4,a0,a6){var a1,a8;function a7(a9,ba){a9=undefined;ba=undefined;if(a0){aB.replstore.store_attachment_date(a3,aZ,new Date())}if(a6){a6()}}function a5(a9,ba){a9=undefined;if(a6){a6(ba)}}log.debug("setAttachment "+a3+" "+aZ);function a2(a9){a8="UPDATE attachment SET data=? WHERE subjectGuid=? AND name=?";a1=[a4,a3,aZ];a9.executeSql(a8,a1,a7,a5)}a8="INSERT INTO attachment (subjectGuid,name,data) VALUES(?,?,?)";a1=[aB.db.getSubjectGuid(a3),aZ,a4];aL("transaction",function(a9){a9.executeSql(a8,a1,function(bb,ba){if(ba&&ba.rowsAffected===1){a7(bb,ba)}else{a2(bb)}},a2)},function(a9){a5(undefined,a9)})}function U(aZ,a0){if(a0&&typeof a0==="function"){aL("readTransaction",function(a1){var a5,a4;function a3(a7,a6){var a9,a8,ba;a7=undefined;if(!a6){a0()}else{a9=[];for(a8=0;a8<a6.rows.length;a8+=1){ba=a6.rows.item(a8);a9.push({subjectGuid:ba.subjectGuid,name:ba.name})}a0(a9)}}function a2(a6,a7){a6=undefined;a0(undefined,a7)}a5=[];a4="SELECT subjectGuid, name FROM attachment";if(aZ){a4+=" WHERE subjectGuid=?";a5.push(aZ)}a1.executeSql(a4,a5,a3,a2)})}}function ac(aZ){if(aZ._meta===undefined){aZ._meta={}}if(aZ._meta.syncInfo===undefined){aZ._meta.syncInfo={}}if(aZ._meta.syncInfo.cseq===undefined){aZ._meta.syncInfo.cseq=1}if(aZ._meta.syncInfo.sseq===undefined){aZ._meta.syncInfo.cseq=0}}function y(a4,ba,bb,be,a8){var a5,a7,a1,a3,a0,a6,aZ,a2;function bd(bf,bg){bf=undefined;bg=undefined;if(be){be()}}function a9(bf,bg){bf=undefined;if(be){be(bg)}}function bc(bf){aZ+="answers,guid) VALUES (";a1=a3.length;for(a5=0;a5<a1;a5+=1){aZ+=a5?",?":"?"}aZ+=")";bf.executeSql(aZ,a3,bd,a9)}if(bb!==true){ba._meta.modified=new Date();aB.db.ensureReplDataPresent(ba);ba._meta.syncInfo.cseq++}a4=aB.db.getSubjectGuid(a4);a6="UPDATE subject SET ";aZ="INSERT INTO subject (";a7=["processId","processVersion","created","modified"];a1=a7.length;a3=[];for(a5=0;a5<a1;a5+=1){if(ba._meta.hasOwnProperty(a7[a5])){a6+=a7[a5]+"=?,";aZ+=a7[a5]+",";a3.push(ba._meta[a7[a5]])}}if(a8){for(a5=0;a5<a8.length;a5+=1){if(a8[a5]!==undefined&&a8[a5]!==null){aZ+="col"+a5+",";a6+="col"+a5+"=?,";a3.push(a8[a5])}}}a6+="serverId=?,";aZ+="serverId,";a2=ba._meta.syncInfo;if(a2!==undefined){a0=a2.ServerId;if(a0!==undefined){a3.push(a0)}else{a3.push(null)}}else{a3.push(null)}a6+="backupGuid=?,";aZ+="backupGuid,";a3.push(ba._meta.backupGuid||null);a6+=" answers=? WHERE guid=?";a3.push(aE.jsonStringify(ba));a3.push(a4);aL("transaction",function(bf){bf.executeSql(a6,a3,function(bh,bg){if(bg&&bg.rowsAffected===1){bd(bh,bg)}else{bc(bf)}},bc)});if(t&&t.guid&&t.guid===a4){t.value=ba}}function ai(a1,a2,a4,aZ,a0){function a3(a7,ba,a6){var bc;ba=undefined;function a5(be,bd,bf){aB.att.duplicateAttachment(be,bd,a7._meta.guid,bd,bf)}function bb(bd,bf){function be(bj){var bi,bh;function bg(){bi-=1;if(bi<=0){bf()}}bi=0;if(bj&&bj.length){bi=bj.length;for(bh=0;bh<bj.length;bh+=1){a5(bj[bh].subjectGuid,bj[bh].name,bg)}}else{bf()}}aB.db.getAttachmentList(bd,be)}if(a7){a1=aB.db.getSubjectGuid(a1);if(a7===t.value||a7===Q){a7=aE.jsonCopy(a7)}if(aZ){a7._meta.guid=aZ}else{bc=new Date();a7._meta.created=bc;a7._meta.modified=bc;a7._meta.completed=false;a7._meta.deleted=false;delete a7._meta.pageStack;delete a7._meta.syncInfo.ServerId;delete a7._meta.syncInfo.SyncData;delete a7._meta.syncInfo.timeout;a7._meta.syncInfo.cseq=1;a7._meta.syncInfo.sseq=0;a7._meta.guid=aB.db.guid();var a8=aB.db.makeProcessName({id:a7._meta.processId,version:a7._meta.processVersion});var a9=aB.db.getProcess(a8);a9.subjectGuids.push(a7._meta.guid);aB.db.setProcess(a8,a9)}if(a0){a7._meta.backupGuid=a1}else{delete a7._meta.backupGuid}if(a2){bb(a1,function(){var bd,be;if(a6){bd=[];for(be=0;be<50;be+=1){bd[be]=a6["col"+be.toString()]}}aB.db.setSubject(a7._meta.guid,a7,true,function(){a4(a7)},bd)})}else{a4(a7)}}else{a4()}}aB.db.getSubject(a1,a3,true)}function j(a1){function aZ(a5){var a4,a3;function a2(){a4-=1;if(a4<=0){a1()}}if(a5&&a5.length){a4=a5.length;for(a3=0;a3<a5.length;a3+=1){aB.db.deleteSubject(a5[a3],a2)}}else{a1()}}Q=undefined;try{l(t.guid,aZ)}catch(a0){a1()}}function aW(aZ){aB.db.deleteBackup(function(){aB.db.cloneSubject(t.value,true,function(a0){Q=a0;aZ(a0)},undefined,true)})}function ao(a3,a0){log.debug("IN mc.db.createDb");var a2;function a4(a8){var a5,a7,a6;a6=0;a7="CREATE TABLE IF NOT EXISTS subject (id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, processId TEXT NOT NULL, processVersion TEXT NOT NULL, type INTEGER, guid TEXT NOT NULL, backupGuid TEXT, serverId TEXT, created DATETIME, modified DATETIME, answers TEXT";for(a5=0;a5<50;a5+=1){a7+=", col"+a5+" TEXT"}a7+=");";a8.executeSql(a7,undefined,undefined,a0);for(a5=0;a5<10;a5+=1){a7="CREATE INDEX IF NOT EXISTS col"+a5+" ON subject(col"+a5+");";a8.executeSql(a7,undefined,undefined,a0)}a7="CREATE UNIQUE INDEX IF NOT EXISTS subjectByGuid ON subject(guid);";a8.executeSql(a7,undefined,undefined,a0);a7="CREATE TABLE IF NOT EXISTS attachment (id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, subjectGuid TEXT NOT NULL, name TEXT NOT NULL, data BLOB);";a8.executeSql(a7,undefined,undefined,a0);a7="CREATE UNIQUE INDEX IF NOT EXISTS subjectByGuid ON subject(guid);";a8.executeSql(a7,undefined,undefined,a0);a7="CREATE UNIQUE INDEX IF NOT EXISTS attachmentByGuidName ON attachment(subjectGuid,name);";a8.executeSql(a7,undefined,undefined,a0)}function a1(bd,ba,a8){var be=window.deviceOptions,bf,a5={delay:""};if(!be||!be.expandDatabaseTo||be.expandDatabaseTo<1){log.debug("Initial database expansion not requested.");ba();return}bf=be.expandDatabaseTo;log.debug("Initial database expansion requested: "+bf+"MB");if(aB.testingInBrowser){log.debug("Database expansion skipped (testing in browser).");ba();return}function a9(bg){a5.delay="400";MCAPTURE_ProcessProvisioned(a5);a=JSON.stringify(bg);log.error("Error expanding initial database"+a);ba()}function bb(){log.debug("Database expansion complete.");a5.delay="300";MCAPTURE_ProcessProvisioned(a5);ba()}function a6(bg){log.debug("IN mc.db.createDb.drop");a5.delay="10000";MCAPTURE_ProcessProvisioned(a5);bd.transaction(function(bh){var bi="DROP TABLE IF EXISTS expandDB";bh.executeSql(bi,[])},a9,bg)}function a7(bg){log.debug("IN mc.db.createDb.create");a5.delay="100";MCAPTURE_ProcessProvisioned(a5);bd.transaction(function(bh){var bi="CREATE TABLE IF NOT EXISTS expandDB (data BLOB)";bh.executeSql(bi,[])},a9,bg)}function bc(bk){log.debug("IN mc.db.createDb.fill");var bh=Array(128*1024+1).join("a");var bj="INSERT INTO expandDB (data) VALUES (?)";var bi=[bh];var bg=4*bf;bd.transaction(function(bm){function bl(){log.debug("Expanding initial database ("+bg+")");a5.delay=bg.toString();MCAPTURE_ProcessProvisioned(a5);if(bg===0){return}bg--;bm.executeSql(bj,bi,bl)}bl()},a9,bk)}a6(function(){a7(function(){bc(function(){a6(bb)})})})}function aZ(){log.debug("IN mc.db.createDb.openDb");try{G=window.openDatabase("mDesign","","mDesign",1048576);switch(G.version){case"":function a6(a7){a1(G,a3,a0)}G.changeVersion("","1.0",a4,a0,a6);break;case"1.0":a3();break;default:a0({message:"Invalid database version: "+G.version});break}}catch(a5){a2-=1;if(a2>0){log.error("Failed to open database, will retry in 500ms.");setTimeout(aZ,500)}else{log.error("Failed to open database, retryCount exceeded. Exception: "+a5.message);a0(a5)}}}if(!G){a2=3;aZ()}else{a3()}}function al(a3,a1){log.debug("IN mc.db.clear");function a4(){var a8;function a6(){if(++a8===4){G.changeVersion(G.version,"",function(){},a1,a3)}}function a7(ba,a9){ba=undefined;a9=undefined;a6()}function a5(a9,ba){a9=undefined;if(ba.code===1){a6()}else{a1(ba)}}if(G){a8=0;aL("transaction",function(a9){a9.executeSql("DROP TABLE IF EXISTS subject",undefined,a7,a5);a9.executeSql("DROP TABLE IF EXISTS attachment",undefined,a7,a5);a9.executeSql("DROP INDEX IF EXISTS subjectByName",undefined,a7,a5);a9.executeSql("DROP INDEX IF EXISTS attachmentByGuidName",undefined,a7,a5)})}else{a1({message:"SQLite db not created, unknown error."})}}function a2(a5,a6){a5=undefined;a1(a6)}function a0(){log.debug("clear[db]");if(G===undefined){aB.db.createDb(a4,a2)}else{a4()}}function aZ(){log.debug("clear[fs]");aB.fs.clear(a0,function(a5){a1({message:"File System not cleared, error "+a5.code})})}aB.fs.availableForAtts?aZ():a0()}function T(){function aZ(){return(((1+Math.random())*65536)|0).toString(16).substring(1)}return(aZ()+aZ()+"-"+aZ()+"-"+aZ()+"-"+aZ()+"-"+aZ()+aZ()+aZ())}function L(a1,aZ,a2){log.debug("IN mc.db.getSubjectGuids");if(a2&&typeof a2==="function"){if(G){function a0(){log.error("mc.db.getSubjectGuids - transaction callback");a2([])}aL("readTransaction",function(a3){var a7,a6;function a5(a9,a8){var bb,ba;a9=undefined;bb=[];if(a8&&a8.rows&&a8.rows.length){for(ba=0;ba<a8.rows.length;ba+=1){bb.push(a8.rows.item(ba).guid)}}a2(bb)}function a4(a8,a9){a8=undefined;a9=undefined;a2([])}a7=[];a6="SELECT guid FROM subject WHERE backupGuid IS NULL";if(a1||aZ){a6+=" AND";if(a1){a6+=" processId = ?";a7.push(a1);if(aZ){a6+=" AND"}}if(aZ){a6+=" processVersion = ?";a7.push(aZ)}}a3.executeSql(a6,a7,a5,a4)},a0)}else{log.error("mc.db.getSubjectGuids - no database");a2([])}}else{log.error("mc.db.getSubjectGuids - no callback")}}function an(aZ,a2){log.debug("IN mc.db.createProcess");function a1(a3){log.debug("IN mc.db.createProcess.dbError : "+a3);if(a2){a2(a3)}}function a0(){log.debug("IN mc.db.createProcess.dbCreated");var a3,a8,a7,a5,a4,a6;a5=aB.db.makeProcessName(aZ);a4=aB.db.getProcessNames()||[];a8=a4.length;log.debug("mc.db.createProcess.dbCreated count: "+a8);for(a3=0;a3<a8;a3+=1){log.debug("mc.db.createProcess.dbCreated process "+a4[a3]);if(a4[a3]===a5){a7=aB.db.getProcess(a5);if(a7===undefined){log.debug("mc.db.createProcess.dbCreated process not found");a4.splice(a3,1);a8-=1}break}}if(a7===undefined){log.debug("mc.db.createProcess.dbCreated process not defined");a7=aZ;a7.visualizationSubjectGuid=aB.db.guid();a4.push(a5);b(a4);aB.db.getSubjectGuids(aZ.id,aZ.version,function(a9){log.debug("IN mc.db.createProcess gotSubjectGuids");a7.subjectGuids=a9;aY(a5,a7);if(a2){a2({name:a5,value:a7})}else{log.debug("mc.db.createProcess goSubjectGuids no callback")}})}else{log.debug("mc.db.createProcess.dbCreated copy process");for(a6 in aZ){if(aZ.hasOwnProperty(a6)){a7[a6]=aZ[a6]}}aB.db.setProcess(a5,a7);if(a2){a2({name:a5,value:a7})}else{log.debug("mc.db.createProcess no callback")}}}if(!G){aB.db.createDb(a0,a1)}else{a0()}}function aK(a1,aZ,a2,a0){aB.profiler.profileAsync("getSubjectInTransaction",function(a4){var a5,a8,a7;function a6(ba,a9){var bb;if(a9&&a9.rows.length>0){bb=aB.profiler.profileSync("getSubjectParse",function(){return aE.jsonParse(a9.rows.item(0).answers)});if(a0){a0=a9.rows.item(0);delete a0.answers}}a4();a2(ba,bb,undefined,a0)}function a3(a9,ba){a9=undefined;a4();a2(undefined,ba)}if(a2&&typeof a2==="function"){if(aZ&&aZ.constructor===String){if(!a0&&t&&aZ===t.guid){a4();a2(a1,t.value)}else{a8=[aZ];a7="SELECT answers ";if(a0){for(a5=0;a5<50;a5+=1){a7+=", col"+a5.toString()}}a7+=" FROM subject WHERE guid = ?";a1.executeSql(a7,a8,a6,a3)}}else{a4();a2(a1,aZ)}}else{a4()}})}function ay(a2,aZ,a0,a1,a4,a3){aB.profiler.profileAsync("setSubjectInTransaction",function(a5){var bb,bd,a8,ba,a7,bc,a6,a9;function bg(bh,bi){bh=undefined;bi=undefined;a5();if(a4){a4()}}function be(bh,bi){bh=undefined;a5();if(a4){a4(bi)}}function bf(bh){a6+="answers,guid) VALUES (";a8=ba.length;for(bb=0;bb<a8;bb+=1){a6+=bb?",?":"?"}a6+=")";bh.executeSql(a6,ba,bg,be)}if(a1!==true){a0._meta.modified=new Date();aB.db.ensureReplDataPresent(a0);a0._meta.syncInfo.cseq++}aZ=aB.db.getSubjectGuid(aZ);bc="UPDATE subject SET ";a6="INSERT INTO subject (";bd=["processId","processVersion","created","modified"];a8=bd.length;ba=[];for(bb=0;bb<a8;bb+=1){if(a0._meta.hasOwnProperty(bd[bb])){bc+=bd[bb]+"=?,";a6+=bd[bb]+",";ba.push(a0._meta[bd[bb]])}}if(a3){for(bb=0;bb<a3.length;bb+=1){if(a3[bb]!==undefined&&a3[bb]!==null){a6+="col"+bb+",";bc+="col"+bb+"=?,";ba.push(a3[bb])}}}bc+="serverId=?,";a6+="serverId,";a9=a0._meta.syncInfo;if(a9!==undefined){a7=a9.ServerId;if(a7!==undefined){ba.push(a7)}else{ba.push(null)}}else{ba.push(null)}bc+="backupGuid=?,";a6+="backupGuid,";ba.push(a0._meta.backupGuid||null);bc+=" answers=? WHERE guid=?";aB.profiler.profileSync("setSubjectStringify",function(){ba.push(aE.jsonStringify(a0))});ba.push(aZ);a2.executeSql(bc,ba,function(bi,bh){if(bh&&bh.rowsAffected===1){bg(bi,bh)}else{bf(bi)}},bf);if(t&&t.guid&&t.guid===aZ){t.value=a0}})}function aH(a2,a1,a0,aZ,a3){aB.profiler.profileAsync("createSubjectInTransaction",function(a5){var a7,a6;function a4(a8,ba,bb){var bc,a9,bd;bb=undefined;if(a7&&a7.subjectGuids!==undefined){bd=a7.subjectGuids.length;for(a9=0;a9<bd;a9+=1){if(a7.subjectGuids[a9]===aZ){if(ba===undefined){a7.subjectGuids.splice(a9,1)}break}}}if(ba===undefined){bc=new Date();ba={_meta:{completed:false,created:bc,deleted:false,guid:aZ,modified:bc,processId:a1,processVersion:a0,summaries:{processid:a1},syncInfo:{cseq:1,sseq:0}}};if(t&&t.guid){if(!ba._meta.syncInfo){ba._meta.syncInfo={parentguid:t.guid}}else{if(!ba._meta.syncInfo.parentguid){ba._meta.syncInfo.parentguid=t.guid}}}if(a7&&aZ!==a7.visualizationSubjectGuid){a7.subjectGuids.push(aZ)}if(a7){aB.db.setProcess(a6,a7)}aB.db.setSubjectInTransaction(a2,aZ,ba,false,function(be,bf){a5();be=undefined;bf=undefined;a3({guid:aZ,value:ba})})}else{a5();a3({guid:aZ,value:ba})}}a6=aB.db.makeProcessName({id:a1,version:a0});if(aS!==undefined&&aS.name!==undefined&&a6===aS.name){a7=aS.value}else{a7=aB.db.getProcess(a6)}aZ=aB.db.getSubjectGuid(aZ);if(aZ===undefined){aZ=aB.db.guid()}aB.db.getSubjectInTransaction(a2,aZ,a4)})}function au(a3,a2,aZ,a5){var a1,a0;function a4(a7,a8){var a9,a6,ba;a8=undefined;if(a1&&a1.subjectGuids!==undefined){ba=a1.subjectGuids.length;for(a6=0;a6<ba;a6+=1){if(a1.subjectGuids[a6]===aZ){if(a7===undefined){a1.subjectGuids.splice(a6,1)}break}}}if(a7===undefined){a9=new Date();a7={_meta:{completed:false,created:a9,deleted:false,guid:aZ,modified:a9,processId:a3,processVersion:a2,summaries:{processid:a3},syncInfo:{cseq:1,sseq:0}}};if(t&&t.guid){if(!a7._meta.syncInfo){a7._meta.syncInfo={parentguid:t.guid}}else{if(!a7._meta.syncInfo.parentguid){a7._meta.syncInfo.parentguid=t.guid}}}if(a1&&aZ!==a1.visualizationSubjectGuid){a1.subjectGuids.push(aZ)}if(a1){aB.db.setProcess(a0,a1)}aB.db.setSubject(aZ,a7,false,function(bb){if(!bb){n(function(){a5({guid:aZ,value:a7})})}else{a5({guid:aZ,value:a7})}})}else{n(function(){a5({guid:aZ,value:a7})})}}a0=aB.db.makeProcessName({id:a3,version:a2});if(aS!==undefined&&aS.name!==undefined&&a0===aS.name){a1=aS.value}else{a1=aB.db.getProcess(a0)}aZ=aB.db.getSubjectGuid(aZ);if(aZ===undefined){aZ=aB.db.guid()}aB.db.getSubject(aZ,a4)}function ah(a1,a0,a2){function aZ(a6){var a4,a5;function a3(){if(!--a5){a2()}}if(a6&&a6.length){log.info("found "+a6.length+" subjects to delete");a5=a6.length;for(a4=0;a4<a6.length;a4+=1){aB.db.deleteSubject(a6[a4],a3)}}else{a2()}}log.info("Deleting all subjects from process "+a1+" version "+a0);aB.db.getSubjectGuids(a1,a0,aZ)}function aI(a0,a2,a6){var a5,a4;function aZ(){aB.replstore.delete_attachment_date(a0,a2);if(a6){a6()}}function a1(a7,a8){a7=undefined;if(a6){a6(a8)}}function a3(a8,a7){a8=undefined;a7=undefined;if(aB.fs.availableForAtts){log.debug("deleteAttachment[fs data] "+a0+" "+a2);aB.fs.deleteAttachment(a0,a2,aZ,function(a9){log.debug("unable to delete data from file system - code "+a9.code);aZ()})}else{aZ()}}log.debug("deleteAttachment[db/fs] "+a0+" "+a2);a0=aB.db.getSubjectGuid(a0);a4="DELETE FROM attachment WHERE subjectGuid=? AND name=?;";a5=[a0,a2];aL("transaction",function(a7){a7.executeSql(a4,a5,a3,a1)})}function h(a5,aZ,a1,a6){var a4,a3;function a2(a8,a7){aB.replstore.delete_attachment_date(aZ,a1);if(a6){a6()}}function a0(a7,a8){a7=undefined;if(a6){a6(a8)}}log.debug("deleteAttachmentInTransaction[db/fs] "+aZ+" "+a1);aZ=aB.db.getSubjectGuid(aZ);a3="DELETE FROM attachment WHERE subjectGuid=? AND name=?;";a4=[aZ,a1];a5.executeSql(a3,a4,a2,a0)}function K(aZ){delete localStorage[aZ]}function d(a1,aZ,a2,a0){aB.db.getSubjectInTransaction(a1,aZ,function(a7,a5,a9){var a4,ba,a8,a6;a7=undefined;function a3(bb){if(!bb){if(!a0&&aB.replstore!==undefined){aB.replstore.delete_attachment_date(aZ)}if(a8&&a8.version!==aB.db.getLatestProcessVersion(a8.id)){if(a8.subjectGuids===undefined||a8.subjectGuids.length===0){aG(a6)}}if(a2){a2()}n(function(){})}else{if(a2){a2(bb)}}}aZ=aB.db.getSubjectGuid(aZ);if(a5!==undefined&&a5!==null){a6=aB.db.makeProcessName({id:a5._meta.processId,version:a5._meta.processVersion});if(aS!==undefined&&aS.name!==undefined&&aS.name===a6){a8=aS.value}else{a8=aB.db.getProcess(a6)}if(a8!==undefined){if(a8.subjectGuids!==undefined){ba=a8.subjectGuids.length;for(a4=0;a4<ba;a4+=1){if(a8.subjectGuids[a4]===aZ){a8.subjectGuids.splice(a4,1);if(a8.currentSubjectGuid===aZ){delete a8.currentSubjectGuid}aB.db.setProcess(a6,a8);break}}}}aB.db._deleteSubjectInTransaction(a1,aZ,a0,a3)}else{if(a2){a2(a9)}}})}function s(a1,a0,a2){var aZ;if(a0!==undefined&&a0!==null){if(a0.constructor===String){a0=parseInt(a0,10)}aZ=t.value[a1];if(aZ!==undefined&&aZ!==null&&aZ.constructor===Array){aZ.splice(a0,1);t.value[a1]=aZ}else{delete t.value[a1]}}else{delete t.value[a1]}aB.db.setSubject(t.guid,t.value,false,a2)}function aO(aZ,a5,a7){var a4,a2,a3,a6;function a0(){if(a2===a4){aB.db.setSubject(t.guid,t.value,true,a7,a6)}}function a1(a8){function ba(bb){a6[a8]=bb;t.value._meta.summaries[aZ[a8]]=bb;a2+=1;a0()}function a9(bb){log.error("Exception: "+bb.name+". "+bb.message);a2+=1;a0()}window.make_formula(a5[aZ[a8]]).execute(ba,a9)}a6=[];a4=1;a2=0;t.value._meta.summaries={processid:t.value._meta.processId};if(aZ!==undefined&&a5!==undefined){for(a3=0;a3<aZ.length;a3+=1){if(aZ[a3]&&a5.hasOwnProperty(aZ[a3])){a4+=1;a1(a3)}}}a4-=1;a0()}function w(a5,a6,a4,a0,a7){var a1;function a3(){if(a4!==undefined&&a4!==null){if(a4.constructor===String){a4=parseInt(a4,10)}var a8=t.value[a5];if(a8!==undefined&&a8!==null&&a8.constructor===Array){a8[a4]=a6}else{a8=[];a8[a4]=a6}return a8}else{return a6}}function a2(){var a8;if(a0===true){if(t.value._meta.positions===undefined){t.value._meta.positions={}}a8=R();if(a8){t.value._meta.positions[a5]=a8}else{delete t.value._meta.positions[a5]}}}function aZ(){t.value[a5]=a1;a2();aB.db.setSubject(t.guid,t.value,false,a7)}a1=a3();aU(t.value,a5,a1,a4,aZ)}function N(a1,a0){var aZ;if(t!==undefined&&t.value!==undefined){aZ=t.value[a1];if(a0!==undefined&&a0!==null){if(aZ===undefined||aZ===null||aZ.constructor!==Array){aZ=[]}if(aZ.length<=a0){aB.db.setValue(a1,null,a0)}}else{if(!t.value.hasOwnProperty(a1)){aB.db.setValue(a1,null)}}}}function af(a1,a0){var aZ;if(t!==undefined&&t.value!==undefined){aZ=t.value[a1];if(a0!==undefined&&a0!==null){if(aZ!==undefined&&aZ!==null&&aZ.constructor===Array){aZ=aZ[a0]}else{aZ=undefined}}}return aZ}function V(a0){var aZ;aZ=aB.db.getValue(a0);if(aZ&&aZ.constructor===Array){return aZ.length}return -1}function R(){var aZ;aZ=I("cachedPosition");return aZ}function ae(aZ){f("cachedPosition",aZ)}function z(a0){var a1,aZ,a2;if(document.cookie!==undefined&&document.cookie.length>0){a2=document.cookie.indexOf(a0+"=");if(a2!==-1){a2+=a0.length+1;aZ=document.cookie.indexOf(";",a2);if(aZ===-1){aZ=document.cookie.length}a1=window.unescape(document.cookie.substring(a2,aZ))}}return a1}function k(){if(aS!==undefined){return aS.value}return undefined}function q(){return t.value}function ad(){var aZ;if(t!==undefined){aZ=t.guid}return aZ}function o(){return a}function O(){var aZ=aB.db.getJsonItem("HomeProcess");if(aZ){return aB.db.getJsonItem(aZ)}}function aP(){var a3,aZ,a2,a0,a1;aZ={};a2=aB.db.getProcessNames();if(a2!==undefined){aE.each(a2,function(a5,a6){var a7,a8,a4;a5=undefined;a7=a6.split(" ");a8=a7[0];a4=a7[1];if(aZ[a8]!==undefined&&a4!==undefined){if(ax(aZ[a8],a4)<0){aZ[a8]=a4}}else{aZ[a8]=a4}})}a1=[];for(a3 in aZ){if(aZ.hasOwnProperty(a3)){if(aZ[a3]!==undefined){a0=aB.db.makeProcessName({id:a3,version:aZ[a3]});a1.push({name:a0,value:aB.db.getProcess(a0)})}}}return a1}function aD(){var a5,aZ,a4,a1,a3,a0,a2;aZ={};a4=[];a3=aB.db.getProcessNames();if(a3!==undefined){aE.each(a3,function(a7,a8){var a9,ba,a6;a7=undefined;a9=a8.split(" ");ba=a9[0];a6=a9[1];if(aZ[ba]!==undefined&&a6!==undefined){if(ax(aZ[ba],a6)<0){a1=aB.db.makeProcessName({id:ba,version:aZ[ba]});a4.push(a1);aZ[ba]=a6}else{a4.push(a8)}}else{aZ[ba]=a6}})}a2=[];aE.each(a4,function(a6,a7){log.info("found old process: "+a7);a2.push({name:a7,value:aB.db.getProcess(a7)})});return a2}function aR(aZ){var a0;try{a0=t.value._meta[aZ]}catch(a1){a0=undefined}return a0}function aa(){var aZ,a3,a2,a1,a0;a0=aB.db.getProcessNames();a1=[];if(a0!==undefined){a3=a0.length;for(aZ=0;aZ<a3;aZ+=1){a2=aB.db.getProcess(a0[aZ]);if(a2!==undefined){a1.push({name:a0[aZ],value:a2})}}}return a1}function A(a4){var a0,a5,a3,a2,aZ,a1;aZ=aB.db.getLatestProcessVersion(a4);a1=aB.db.makeProcessName({id:a4,version:aZ});a3=aB.db.getProcess(a1);return a3}function aw(a0,aZ,a1){if(a1&&typeof a1==="function"){if(G){aL("readTransaction",function(a2){var a5;function a4(a7,a6){var a8;a7=undefined;if(a6&&a6.rows&&a6.rows.length){a8=a6.rows.item(0).guid}a1(a8)}function a3(a6,a7){a6=undefined;a7=undefined;a1("")}a5="SELECT guid FROM subject WHERE backupGuid IS NULL AND lower(processId) = lower(?) AND serverId = ? ORDER BY processVersion DESC";a2.executeSql(a5,[a0,aZ],a4,a3)},function(){a1("")})}else{a1("")}}}function D(aZ,a9,a1,a5,bc){var ba,a6,a4,a3,a7,a0,bb,a8;function a2(bd){a0.result=a0.result.concat(bd);a0.count-=1;if(a0.count<=0){a0.result.sort(function(bf,be){for(ba=0;ba<a1.length;ba++){if(bf[a1[ba]]===null){return -1}if(be[a1[ba]]===null){return 1}if(bf[a1[ba]].toLowerCase()>be[a1[ba]].toLowerCase()){return 1}if(bf[a1[ba]].toLowerCase()<be[a1[ba]].toLowerCase()){return -1}}return 0});bc(a0.result)}}if(bc&&typeof bc==="function"){if(G){if(!aZ){aZ=aB.db.getCurrentProcess().id}if(aZ.constructor===Array){if(!a9||a9.constructor!==Array){a9=[]}a0={};a0.count=aZ.length;a0.result=[];for(ba=0;ba<aZ.length;ba+=1){aB.db.getSubjectSummaries(aZ[ba],a9[ba],a1,a5,a2)}return}a7=aB.db.makeProcessName({id:aZ,version:a9||aB.db.getLatestProcessVersion(aZ)});a3=aB.db.getProcess(a7);if(a3&&a3.summaryMap&&a3.summaryMap.length){aL("readTransaction",function(bd){var bg,bf,bh,bk,bj;function bi(bn,bl){var bm,bs,bo,bq,br,bp;bn=undefined;bm=[];if(bl&&bl.rows&&bl.rows.length){for(bo=0;bo<bl.rows.length;bo+=1){bq={};bp=bl.rows.item(bo);bq.guid=bp.guid;bq.processId=aZ;for(br in bp){if(br.indexOf("col")===0&&bp.hasOwnProperty(br)){bs=parseInt(br.slice(3),10);if(bp[br]===null){bq[a3.summaryMap[bs]]="undefined - please fix your summary item formula"}else{bq[a3.summaryMap[bs]]=bp[br]}}}bm.push(bq)}if(a0===undefined){bm.sort(function(bu,bt){for(bo=0;bo<a1.length;bo++){if(bu[a1[bo]]===null){return -1}if(bt[a1[bo]]===null){return 1}if(bu[a1[bo]].toLowerCase()>bt[a1[bo]].toLowerCase()){return 1}if(bu[a1[bo]].toLowerCase()<bt[a1[bo]].toLowerCase()){return -1}}return 0})}}bc(bm)}function be(bl,bm){bl=undefined;bm=undefined;bc([])}bk=[];bj="SELECT guid";a8="";a6=" ORDER BY ";a4=0;if(a1!==undefined){for(bg=0;bg<a1.length;bg+=1){bf=a3.summaryMap.indexOf(a1[bg]);if(bf>=0){bj+=",col"+bf;if(a4<3){if(a4>0){a6+=","}a6+="col"+bf;a4+=1}}}}bj+=" FROM subject WHERE backupGuid IS NULL AND processId=?";bk.push(aZ);if(a9){bj+=" AND processVersion=?";bk.push(a9)}for(bh in a5){if(a5.hasOwnProperty(bh)){bf=a3.summaryMap.indexOf(bh);if(bf>=0){a8+=" AND col"+bf+"=?";bk.push(a5[bh])}}}bj+=a8;if(a4){bj+=a6}bd.executeSql(bj,bk,bi,be)},function(){bc([])})}else{bc([])}}else{bc([])}}}function ap(a0,aZ,a2){function a1(a3){var a4;if(a3&&a3._meta&&a3._meta.summaries){a4=a3._meta.summaries[aZ]}if(a4===undefined||a4===null){a4=""}a2(a4)}aB.db.getSubject(a0,a1)}function J(a3,aZ){var a0,a1;function a2(a6){var a5,a4;a4=[];if(a6&&a6._meta&&a6._meta.summaries){for(a5=0;a5<a1.length;a5+=1){a4.push(a6._meta.summaries[a1[a5]])}}a3.apply(window,a4)}a1=[];for(a0=2;a0<arguments.length;a0+=1){a1[a0-2]=arguments[a0]}aB.db.getSubject(aZ,a2)}function B(){return aB.db.getJsonItem("mSuiteUser")||{mSuiteUserName:"",mSuiteSerialNo:"0"}}function M(a2){var a0,aZ,a3,a1;a0=false;if(sessionStorage.deployedProcesses!==undefined){a1=JSON.parse(sessionStorage.deployedProcesses);if(a1.constructor===Array){a3=a1.length;for(aZ=0;aZ<a3;aZ+=1){if(a2===a1[aZ]){a0=true;break}}}}return a0}function g(a1){var aZ,a0;aZ=false;a0=aB.db.getCookie("usedProcessVersions");if(a0!==undefined){a0=JSON.parse(a0);if(a0&&a0[a1]!==undefined){aZ=true}}return aZ}function aN(a0){var aZ,a1,a3,a4,a2;aZ=false;if(a0!==undefined){if(a0.locationRequired===true){aZ=true}else{if(a0.questions!==undefined){for(a3 in a0.questions){if(a0.questions.hasOwnProperty(a3)&&((a0.questions[a3].stamps===true)||(a0.questions[a3].myLocationRequired===true))){aZ=true;break}}}}}if(!aZ){if(a0.home===true){a2=aa();if(a2&&a2.length){for(a1=0;a1<a2.length;a1+=1){a4=a2[a1].value;if(a4&&a4.home!==true&&aN(a4)){aZ=true;break}}}}}return aZ}function aq(){if(navigator.geolocation&&aj){navigator.geolocation.clearWatch(aj);aj=undefined}}function S(){var a4,aZ,bb,a7=10000,bc=60000,a3=false;function a6(){if(aZ){navigator.geolocation.clearWatch(aZ)}}function a0(){if(bb){navigator.geolocation.clearWatch(bb)}}function a5(){if(navigator.geolocation){a4={};a4.enableHighAccuracy=true;a4.maximumAge=bc;a4.timeout=a7;bb=navigator.geolocation.watchPosition(a8,a2,a4)}}function ba(){a3=true;a4={};a4.enableHighAccuracy=false;a4.maximumAge=bc;a4.timeout=a7;aZ=navigator.geolocation.watchPosition(a8,a1,a4)}function a9(bd){var be="Failed to get GPS: "+bd.message+" - ";if(bd.code==1){be+="PERMISSION_DENIED"}else{if(bd.code==2){be+="POSITION_UNAVAILABLE"}else{if(bd.code==3){be+="TIMEOUT"}}}log.error(be)}var a2=function(bd){a9(bd);if(bd.code==window.PositionError.TIMEOUT){if(!a3){log.info("Failed to receive high accuracy GPS within the timeout period.  Will try low accuracy");ba()}else{if(a7<bc){log.info("Failed to receive high accuracy GPS within the timeout period.  Will try higher timeout");a0();a7=a7+10000;a5()}}}else{a0()}};var a1=function(bd){a6();a9(bd);if(bd.code==window.PositionError.TIMEOUT){log.info("Failed to receive low accuracy GPS within the timeout perid.  Will try high accuracy");a5()}};var a8=function(be){log.info("Caching new GPS position");var bd;if(aE.isIE){bd={coords:{accuracy:be.coords.accuracy,altitude:be.coords.altitude,altitudeAccuracy:be.coords.altitudeAccuracy,heading:be.coords.heading,latitude:be.coords.latitude,longitude:be.coords.longitude,speed:be.coords.speed},timestamp:be.timestamp}}else{bd=be}if(bd!==undefined){if(bd.coords!==undefined){if(bd.coords.latitude!==undefined){ae(bd);log.info("Cached location Lat:"+bd.coords.latitude+"Long:"+bd.coords.longitude)}else{log.info("new GPS latitude is undefined")}}else{log.info("new GPS coord is undefined")}}else{log.info("new GPS position is undefined")}};a5()}function e(aZ,a0,a8,a3,a7,a4,a6,a9){var a2,a5,a1;a2={};a2.id=aZ;a2.version="";a2.version+=aB.db.getLatestProcessVersion(aZ);a5=aB.db.makeProcessName(a2);a1=aB.db.getProcess(a5);if(a9&&a9.constructor===Function){if(a1&&G){aL("readTransaction",function(ba){var bc,bf,be;function bd(bi,bg){var bh,bn,bk,bj,bm,bl;bi=undefined;bh=[];if(bg&&bg.rows){for(bk=0;bk<bg.rows.length;bk+=1){bl=bg.rows.item(bk);bm={guid:bl.guid};for(bj=0;bj<a0.length;bj+=1){bn="col"+a1.summaryMap.indexOf(a0[bj]);bm[a0[bj]]=bl[bn]}bh.push(bm)}}a9(bh)}function bb(bg,bh){bg=undefined;log.error("Exception in mc.db.querySummaries: "+bh.name+". "+bh.message);a9([])}bf="SELECT";be=[];if(a3){bf+=" DISTINCT"}bf+=" guid";for(bc=0;bc<a0.length;bc+=1){bf+=", col"+a1.summaryMap.indexOf(a0[bc])}bf+=" FROM subject WHERE backupGuid IS NULL AND processId = ?";be.push(aZ);for(bc=0;bc<a8.length;bc+=1){bf+=" AND ";switch(a8[bc].condition){case"begins":bf+="col"+a1.summaryMap.indexOf(a8[bc].summaryName)+" LIKE ?";be.push(a8[bc].value+"%");break;case"ends":bf+="col"+a1.summaryMap.indexOf(a8[bc].summaryName)+" LIKE ?";be.push("%"+a8[bc].value);break;case"contains":bf+="col"+a1.summaryMap.indexOf(a8[bc].summaryName)+" LIKE ?";be.push("%"+a8[bc].value+"%");break;default:bf+="col"+a1.summaryMap.indexOf(a8[bc].summaryName)+" = '"+a8[bc].value+"'";break}}if(a7){if(a7.column){bf+=" ORDER BY col"+a1.summaryMap.indexOf(a7.column);if(a7.order){bf+=" "+a7.order}}}bf+=" LIMIT "+a4+" OFFSET "+a6;ba.executeSql(bf,be,bd,bb)},function(){log.error("DB Transaction failed in mc.db.querySummaries");a9([])})}else{if(a1){log.error("Database was not set up: mc.db.querySummaries");a9([])}else{log.error("Process was not set up: mc.db.querySummaries");a9([])}}}else{log.error("Was not provided with a valid callback: mc.db.querySummaries");a9([])}}function c(a5,a0,a1,a3,aZ,a4,a6){function a2(bk){var bp,bs,a9,bo,bn,bt,bm,bl,bj,bd,bh,bc,bb,br,be,bg,bf,bi,a8,a7,ba,bq;bp=[];for(bc=0;bc<bk.length;bc+=1){bs=(new window.DOMParser()).parseFromString("<data>"+bk[bc][a0]+"</data>","text/xml");if(!bi){bi=[];ba=[];a7=bs.getElementsByTagName("row")[0];for(a8=0;a8<a7.attributes.length;++a8){for(bo=0;bo<a3.length;bo+=1){if(a3[bo].summaryName.toLowerCase()==a7.attributes[a8].name.toLowerCase()){bq={summaryName:a7.attributes[a8].name,condition:a3[bo].condition,value:a3[bo].value};bi.push(bq)}}for(bo=0;bo<a1.length;bo+=1){if(a1[bo].toLowerCase()==a7.attributes[a8].name.toLowerCase()){ba.push(a7.attributes[a8].name)}}}}jQuery(bs).find("row").each(function(){var bw,bv,bA,bC,by,bB,bx,bu,bz;bw=this;for(bC=0;bC<bi.length;bC+=1){bA=bw.attributes[bi[bC].summaryName];if(bA){bu=bA.value.toLowerCase();bx=false;bz=bi[bC].value.toLowerCase();switch(bi[bC].condition){case"begins":if(bz==bu.substr(0,bz.length)){bx=true}break;case"ends":if((bu.length-bz.length)==bu.lastIndexOf(bz)){bx=true}break;case"contains":if(-1!=bu.indexOf(bz)){bx=true}break;default:if(bu==bz){bx=true}break}if(bx){by={};for(bB=0;bB<ba.length;++bB){by[ba[bB]]=bw.attributes[ba[bB]].value}bp.push(by);return}}}})}a6(bp)}aB.db.querySummaries(a5,[a0],[],false,undefined,-1,0,a2)}function aF(aZ,a5,a1,a2,a4,a8){var a7,a0,a3,a6;a0={};a0.id=aZ;a0.version="";a0.version+=aB.db.getLatestProcessVersion(aZ);a3=aB.db.makeProcessName(a0);a6=aB.db.getProcess(a3);if(a8&&typeof a8==="function"){if(a6&&G){a7="col"+a6.summaryMap.indexOf(a5);aL("readTransaction",function(a9){var bd,bc;function bb(bg,bf){var be,bh,bi;bg=undefined;be=[];if(bf&&bf.rows&&bf.rows.length){for(bh=0;bh<bf.rows.length;bh+=1){bi=bf.rows.item(bh)[a7];if(bi!==null){be.push(bf.rows.item(bh)[a7])}}}a8(be)}function ba(be,bf){be=undefined;log.error("Exception in mc.db.querySummaryData: "+bf.name+". "+bf.message);a8([])}bd=[];if(a2){bc="SELECT DISTINCT("+a7+") FROM subject WHERE backupGuid IS NULL AND processId = ?"}else{bc="SELECT "+a7+" FROM subject WHERE backupGuid IS NULL AND processId = ?"}bd.push(aZ);aE.each(a1,function(be,bf){if(be%2===0){bc+=" AND col"+a6.summaryMap.indexOf(bf)}else{if(a4!==undefined&&a4.length===1){bc+=" LIKE ?";bd.push("%"+a4+bf)}else{bc+=" = ?";bd.push(bf)}}});a9.executeSql(bc,bd,bb,ba)},function(){log.error("DB Transaction failed in mc.db.querySummaryData");a8([])})}else{if(a6){log.error("Database was not set up: mc.db.querySummaryData");a8([])}else{log.error("Process was not set up: mc.db.querySummaryData");a8([])}}}else{log.error("Was not provided with a valid callback: mc.db.querySummaryData");a8([])}}function E(a0,aZ,a3){function a2(){var a4;function a5(a6){t=a6;if(aS.value.currentSubjectGuid!==t.guid){aS.value.currentSubjectGuid=t.guid;aB.db.setProcess(aS.name,aS.value)}if(aZ.home===true){aB.db.setJsonItem("HomeProcess",aS.name)}if(aN(aZ)){S()}if(aZ.revertable){aB.db.backupCurrentSubject(function(a7){a7=undefined;a3()})}else{a3()}}if(!aZ){return a3()}aB.db.createProcess(aZ,function(a7){function a6(a8){aB.db.createSubject(aZ.id,aZ.version,a8,a5)}aS=a7;if(a0){a4=aS.value.visualizationSubjectGuid;a6(a4)}else{a4=aS.value.currentSubjectGuid;if(!a4&&aS.value.singleSubject){aB.db.getSubjectGuids(aZ.id,aZ.version,function(a8){if(a8&&a8.length){a4=a8[0]}a6(a4)})}else{a6(a4)}}})}function a1(a4){log.error(a4.message);a3(a4)}aB.db.createDb(a2,a1)}function ak(aZ){if(Q){aB.db.cloneSubject(Q,true,function(a0){t={value:a0,guid:a0._meta.guid};aZ(t.value)},t.guid)}else{aZ()}}function Y(a0,a4,aZ,a5,a1,a8){var a2,a9;function a7(ba,bb){ba=undefined;bb=undefined;if(a1){aB.replstore.store_attachment_date(a4,aZ,new Date())}if(a8){a8()}}function a6(ba,bb){ba=undefined;if(a8){a8(bb)}}function a3(ba){a9="UPDATE attachment SET data=? WHERE subjectGuid=? AND name=?";a2=[a5,a4,aZ];ba.executeSql(a9,a2,a7,a6)}a9="INSERT INTO attachment (subjectGuid,name,data) VALUES(?,?,?)";a2=[aB.db.getSubjectGuid(a4),aZ,a5];a0.executeSql(a9,a2,function(bb,ba){if(ba&&ba.rowsAffected===1){a7(bb,ba)}else{a3(bb)}},a3)}function az(aZ,a0,a1,a2){if(t){if(!t.value._meta){t.value._meta={guid:t.guid}}if(t.value._meta[aZ]!==a0){t.value._meta[aZ]=a0;if(a1===undefined){a1=true}aB.db.setSubject(t.guid,t.value,a1,a2)}else{if(a2){a2()}}}else{if(a2){a2(C)}}}function aV(aZ){aB.db.setJsonItem("mSuiteUser",aZ)}function x(a2,a0){function aZ(a3){log.error("Transaction Failed: "+a3.code+": "+a3.message)}function a1(a3){log.debug("Transaction completed OK");a0(a3)}aL("transaction",function(a3){log.debug("Starting Transaction");a2(a3)},aZ,a1)}function ar(aZ,a9,a6){var a5,a3,a8,a2;function a7(ba){var bb=a9.summaryNames;if(typeof bb=="string"||bb instanceof String){bb=[bb]}if(a9.summaryName){bb=[a9.summaryName]}var bc=[];aE.each(ba,function(be,bf){var bh,bd,bg;bg=bf[bb[0]];bh=bg;bd=bg;if(a2!==undefined&&a2.length>0&&bg.indexOf(a2)>=0&&bg.indexOf(a2)<bg.length){bh=bg.substring(0,bg.indexOf(a2));bd=bg.substring(1+bg.indexOf(a2))}bc.push({label:bh,value:bd})});return bc}function a1(be){var bf="<xml>"+be+"</xml>";var bg=new X2JS();var bh=bg.xml_str2json(bf);var bd=a9.summaryNames;var bc,bb;if(typeof bd=="string"||bd instanceof String){bd=[bd]}if(a9.summaryName){bd=[a9.summaryName]}var ba=[];aE.each(bh.xml.row,function(bk,bp){function bj(br,bq){return br.indexOf(bq)===0}function bo(br,bq){return br.match(bq+"$")==bq}function bn(br,bq){return br.indexOf(bq)>=0}var bl=false;if(a9&&a9.filters&&(typeof a9.filters=="array"||a9.filters instanceof Array)){aE.each(a9.filters,function(bq,br){if(typeof br.summaryValue=="array"||br.summaryValue instanceof Array){if(bp["_"+br.summaryName]!==br.summaryValue[0]){bl=true}}else{if(bp["_"+br.summaryName]!==br.summaryValue){bl=true}}})}if(a9&&a9.conditions&&(typeof a9.conditions=="array"||a9.conditions instanceof Array)){aE.each(a9.conditions,function(bq,br){switch(br.condition){case"begins":if(!bj(bp["_"+br.summaryName],br.value)){bl=true}break;case"ends":if(!bo(bp["_"+br.summaryName],br.value)){bl=true}break;case"contains":if(!bn(bp["_"+br.summaryName],br.value)){bl=true}break;default:if(bp["_"+br.summaryName]!==br.value){bl=true}break}})}if(bl){return true}var bi={};if(!a9||!a9.summaryNames){aE.each(bp,function(bq,br){bi[bq.substring(1)]=br})}else{if(typeof a9.summaryNames=="string"||a9.summaryNames instanceof String){bi[a9.summaryNames]=bp["_"+a9.summaryNames]}else{if(typeof a9.summaryNames=="array"||a9.summaryNames instanceof Array){aE.each(a9.summaryNames,function(bq,br){bi[br]=bp["_"+br]})}else{console.error("summaryNames option not valid")}}}var bm=false;if(a9.unique||a9.distinct){aE.each(ba,function(br,bs){var bq=true;aE.each(bd,function(bt,bu){if(bi[bu]!==bs[bu]){bq=false}});if(bq){bm=true}})}if(!bm){ba.push(bi)}});if(a9.sort){if(a9.sort.column){bc=a5.summaryMap.indexOf(a9.sort.column);if(bc>-1){bc=a9.sort.column;if(a9.sort.order){bb=a9.sort.order.toLowerCase()}else{bb="asc"}ba.sort(function(bj,bi){var bl,bk;bl=bj[bc];bk=bi[bc];if(bl===null){return(bb=="desc"?1:-1)}if(bk===null){return(bb=="desc"?-1:1)}bl=bl.toLowerCase();bk=bk.toLowerCase();if(bl>bk){return(bb=="desc"?-1:1)}if(bl<bk){return(bb=="desc"?1:-1)}return 0})}else{log.error("Unknown sort column in summaryQueryCompressed: "+a9.sort.column+". Must be summary item name!")}}}if(a9.choices){if(a6){a6(a7(ba))}return}if(a6){a6(ba)}}function a0(){var ba;ba="col"+a5.summaryMap.indexOf("__CD__Data");aL("readTransaction",function(bb){var be=[];function bd(bh,bg){var bf,bi,bj;bh=undefined;bf=[];if(bg&&bg.rows&&bg.rows.length){a1(bg.rows.item(0)[ba])}else{log.warn("No results found in summaryQueryCompressed");a6([])}}function bc(bf,bg){bf=undefined;log.error("Exception in summaryQueryCompressed: "+bg.name+". "+bg.message);a6([])}a8="SELECT "+ba+" FROM subject WHERE backupGuid IS NULL AND processId = ?";be.push(aZ);bb.executeSql(a8,be,bd,bc)})}function a4(){var ba,bb=a9.summaryNames||a9.summaryName;if(!bb){bb=a5.summaryMap}if(typeof bb=="string"||bb instanceof String){bb=[bb]}aL("readTransaction",function(bc){var be,bh,bg;function bf(bk,bi){var bj,bp,bm,bl,bo,bn;bk=undefined;bj=[];if(bi&&bi.rows){for(bm=0;bm<bi.rows.length;bm+=1){bn=bi.rows.item(bm);bo={guid:bn.guid};for(bl=0;bl<bb.length;bl+=1){bp="col"+a5.summaryMap.indexOf(bb[bl]);bo[bb[bl]]=bn[bp]}bj.push(bo)}}if(a9.choices){if(a6){a6(a7(bj))}return}a6(bj)}function bd(bi,bj){bi=undefined;log.error("Exception in mc.db.querySummaries: "+bj.name+". "+bj.message);a6([])}bh="SELECT";bg=[];if(a9.distinct||a9.unique){bh+=" DISTINCT"}else{bh+=" guid,"}ba="";for(be=0;be<bb.length;be+=1){bh+=ba+" col"+a5.summaryMap.indexOf(bb[be]);ba=","}bh+=" FROM subject WHERE backupGuid IS NULL AND processId = ?";bg.push(aZ);if(a9.conditions){for(be=0;be<a9.conditions.length;be+=1){bh+=" AND ";switch(a9.conditions[be].condition){case"begins":bh+="col"+a5.summaryMap.indexOf(a9.conditions[be].summaryName)+" LIKE ?";bg.push(a9.conditions[be].value+"%");break;case"ends":bh+="col"+a5.summaryMap.indexOf(a9.conditions[be].summaryName)+" LIKE ?";bg.push("%"+a9.conditions[be].value);break;case"contains":bh+="col"+a5.summaryMap.indexOf(a9.conditions[be].summaryName)+" LIKE ?";bg.push("%"+a9.conditions[be].value+"%");break;default:bh+="col"+a5.summaryMap.indexOf(a9.conditions[be].summaryName)+" = '"+a9.conditions[be].value+"'";break}}}else{if(a9.filters){aE.each(a9.filters,function(bi,bj){bh+=" AND ";bh+="col"+a5.summaryMap.indexOf(bj.summaryName)+" = '"+bj.summaryValue+"'"})}}if(a9.sort){if(a9.sort.column){bh+=" ORDER BY col"+a5.summaryMap.indexOf(a9.sort.column);if(a9.sort.order){bh+=" "+a9.sort.order}}}if(a9.limit){bh+=" LIMIT "+a9.limit}if(a9.offset){bh+=" OFFSET "+a9.offset}bc.executeSql(bh,bg,bf,bd)},function(){log.error("DB Transaction failed in mc.db.querySummaries");a6([])})}a5=mCapture.db.getProcess(mCapture.db.makeProcessName({id:aZ,version:H(aZ)}));if(!a5){log.error("Couldn't find dataset: "+aZ);a6();return}a3=!a5.isaprocess&&a5.pages.DATA.qIdMap.__CD__Data&&a5.pages.DATA.qIdMap.__CD__Data==="__CD__Data";a2="";if(a5!==undefined&&a5.separator!==undefined){a2=a5.separator}if(a3){a0()}else{a4()}}var m;function av(a3,a1,aZ,a2,a0,a4){if(a1>=aZ){a4();return}aB.profiler.clear(true);aB.db.createSubjectInTransaction(a3,a2,a0,undefined,function(a5){var a6,a7;a6=a5.guid;a7=a5.value;aB.db.setSubjectInTransaction(a3,a6,a7,false,function(a8){if(a8!==undefined){alert(a8)}aB.db.getSubjectInTransaction(a3,a6,function(ba,a9){if(a9===undefined){alert("could not retrieve subject")}m.push(aB.profiler.getResults());av(a3,++a1,aZ,a2,a0,a4)})})})}function aU(ba,a5,a2,a9,bc){function a0(){var bd=aX({id:ba._meta.processId,version:ba._meta.processVersion});return aB.db.getProcess(bd)}function a4(bd){if(a9!==null&&a9!==undefined){if(a9.constructor===String){a9=parseInt(a9,10)}if(bd===undefined||bd===null||bd.constructor!==Array){return undefined}else{return bd[a9]}}else{return bd}}function bb(be){function bd(){return"extraPhotoOptions" in be}function bf(){return be.type==="att"}return bd()||bf()}function a6(){bc&&bc()}var a1=a0();var a7=a1.dataIdMap[a5];if(!a7){throw Error("No item exists with id "+a5)}var a8=a7.qIds.map(function(bd){return a1.questions[bd]}).some(function(bd){return bd&&bb(bd)});if(a8){var a3=a4(ba[a5]),aZ=a4(a2);if(a3&&a3!==aZ){aI(ba._meta.guid,a3,function(){a6()})}else{a6()}}else{a6()}}function aM(a5,aZ,a2){var a1,a3,a6,a0;function a4(a8){function a7(){var ba,a9;a1+=a8;if(a1<aZ){a4(a8)}else{ba=(new Date()-a3)/1000;a9=aB.db.getProcesses()[0].value.subjectGuids.length;alert(a9+" subjects in "+ba);aB.db.setJsonItem("dbTestResults",m);aB.profiler.clear(false);n(function(){a5(true)})}}aL("transaction",function(a9){av(a9,0,a8,a6,a0,a7)})}a1=0;m=[];a3=new Date();a6=aB.db.getProcesses()[0].value.id;a0=aB.db.getProcessVersions(a6)[0];a4(a2||100)}function Z(){var a1,a2,a0,a3,aZ;a2=document.cookie.split(";");for(a0=0;a0<a2.length;a0++){a1=a2[a0];a3=a1.indexOf("=");aZ=a3>-1?a1.substr(0,a3):a1;while(aZ.substring(0,1)===" "){aZ=aZ.substring(1,aZ.length)}document.cookie=aZ+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/"}}C={code:-1,message:"No current subject"};aB.db={_currentSubject:ag,_deleteSubject:v,_deleteSubjectInTransaction:at,backupCurrentSubject:aW,clear:al,cloneSubject:ai,createDb:ao,createProcess:an,createSubject:au,createSubjectInTransaction:aH,dbTest:aM,deleteAllCookies:Z,deleteAllSubjects:ah,deleteAttachment:aI,deleteAttachmentInTransaction:h,deleteBackup:j,deleteJsonItem:K,deleteSubject:aQ,deleteSubjectInTransaction:d,deleteValue:s,evaluateSummaryValues:aO,ensureReplDataPresent:ac,ensureValue:N,executeQuery:W,getAttachment:F,getAttachmentList:U,getCachedPosition:R,getCookie:z,getCurrentProcess:k,getCurrentSubject:q,getCurrentSubjectGuid:ad,getExpansionError:o,getHomeProcess:O,getJsonItem:I,getLatestProcesses:aP,getLatestProcessById:A,getLatestProcessVersion:H,getMetaValue:aR,getOldProcesses:aD,getProcess:am,getProcesses:aa,getProcessNames:aT,getProcessVersions:ab,getSubject:aJ,getSubjectGuid:X,getSubjectGuidFromReplID:aw,getSubjectGuids:L,getSubjectInTransaction:aK,getSubjectSummaries:D,getSummaryValue:ap,getSummaryValues:J,getUsedProcessVersions:P,getUserInfo:B,getValue:af,getValueArrayLength:V,guid:T,isProcessDeployed:M,isProcessInUse:g,makeProcessName:aX,querySummaries:e,querySummaryData:aF,queryXmlSummaries:c,ready:E,restoreCurrentSubject:ak,setAttachment:u,setAttachmentInTransaction:Y,setCookie:aC,setDb:aA,setJsonItem:f,setMetaValue:az,setSubject:y,setSubjectInTransaction:ay,setProcess:aY,setUserInfo:aV,setValue:w,startTransaction:x,summaryQuery:ar,valueChanging:aU}}(window.jmfw,window.mCapture));(function(A,s){var j={UNREQUESTED:0,REQUESTED:1,SUCCESS:2,ERROR:3},H=j.UNREQUESTED,g=[],B=null,J=null;function C(P,Q){function R(T){H=j.SUCCESS;B=T;for(var U=0;U<g.length;U++){var V=g[U].success;V&&V(B)}}function S(T){H=j.ERROR;B=T;for(var U=0;U<g.length;U++){var V=g[U].error;V&&V(B)}}switch(H){case j.UNREQUESTED:if(s.fs.available){H=j.REQUESTED;g.push({success:P,error:Q});window.requestFileSystem(LocalFileSystem.PERSISTENT,0,R,S)}else{H=j.ERROR;Q({message:"file system is not available - phonegap is not present"})}break;case j.REQUESTED:g.push({success:P,error:Q});break;case j.SUCCESS:P(B);break;case j.ERROR:Q(B);break}}function a(T,Q,S,P,R){C(function(U){log.debug("moving temporary file..."+JSON.stringify([T,Q,S]));function V(W){log.debug("got subject attachments directory... "+W.fullPath);function X(Z){log.debug("got moved file entry... "+Z.fullPath);P(Z.fullPath)}function Y(aa){log.debug("got file entry... "+aa.fullPath);var Z=t(S);aa.moveTo(W,Z,X,R)}F(T,Y,R)}D(U,Q,true,V,R)},R)}function d(T,Q,S,P,R){C(function(U){log.debug("copying temporary file..."+JSON.stringify([T,Q,S]));function V(X){log.debug("got subject attachments directory... "+X.fullPath);function W(Z){log.debug("got copied file entry... "+Z.fullPath);P(Z.fullPath)}function Y(aa){log.debug("got file entry... "+aa.fullPath);var Z=t(S);aa.copyTo(X,Z,W,R)}F(T,Y,R)}D(U,Q,true,V,R)},R)}function e(Q,S,P,R){C(function(T){log.debug("getAttachmentPath "+JSON.stringify([Q,S]));function U(V){var W=V.fullPath.replace(/\/*$/,"/"+t(S));log.debug("got attachment path: "+W);P(W)}D(T,Q,true,U,R)},R)}function c(P,Q){var R="subjects\\"+P+"\\"+Q;R=window.makeBinary(R,true);return window.encode_base64(R)}function b(P){P=window.makeBinary(P,true);return window.encode_base64(P)}function x(R,T,P,S){function Q(V){var X,U,W;X=c(R,T);U=V+"/download-sync-data?ItemId="+encodeURIComponent(X);log.debug("downloadUri: "+U);var W=new XMLHttpRequest();W.onload=function(){var Y=window.decode_utf8(W.responseText);P(Y)};W.onerror=function(Y){if(Y&&Y.target){S("Error "+Y.target.statusText+" ("+Y.target.status+") occurred while receiving the document.")}else{S(Y)}};W.open("GET",U,true);W.send()}f(Q)}function f(P){if(J){P(J)}else{window.plugins.settings.getURL(function(Q){P(Q)})}}function l(Q,S,P,R){C(function(T){function U(V){function W(Y){function Z(ac){var ad=new FileTransfer();var ab=c(Q,S);var aa=encodeURI(V+"/download-attachment");aa+="?ItemId="+encodeURIComponent(ab);ac=h(T,ac);if(A.isIE){ac=ac.replace("/","\\")}ad.download(aa,ac,X,R)}function X(aa){log.debug("downloaded attachment file: "+aa.fullPath);P(Y)}e(Q,S,Z,R)}x(Q,S,W,R)}f(U)},R)}function n(Q,T,S,P,R){C(function(U){function V(X){var Y=new FileTransfer();var W=encodeURI(S);X=h(U,X);Y.download(W,X,P,R)}log.debug("IN mc.fs.downloadAttachmentURL :"+S);e(Q,T,V,R)},R)}function N(Q,S,T,P,R){function U(V){if(window.plugins&&window.plugins.resource){window.plugins.resource.copyAssetFromWWWFolder(T,V,P,R)}else{R("Download failed: the resource plugin is not available")}}log.debug("IN mc.fs.downloadAttachmentResource :"+T);e(Q,S,U,R)}function k(Q,S,T,P,R){C(function(U){function W(Y){function X(aa){var ab=t(S);function Z(af){var ae=new FileUploadOptions();ae.fileKey="file";ae.fileName=ab;ae.mimeType="application/octet-stream";var aj=new FileTransfer();var ag=encodeURI(aa+"/upload-attachment");var ad=c(Q,S);ag+="?ItemId="+encodeURIComponent(ad);if(T){var ac=b(T);ag+="&SyncData="+encodeURIComponent(ac)}var ah=0;function ai(){ah++;var ak=(ah==3)?R:ai;aj.upload(o(af),ag,V,ak,ae)}ai()}Y.getFile(ab,{create:false},Z,R)}f(X)}function V(X){X=window.decodeURIComponent(X.response);P(X)}D(U,Q,true,W,R)},R)}function L(Q,S,P,R){C(function(T){function V(W){var X=t(S);W.getFile(X,{create:false},U,R)}function U(W){W.remove(P,R)}D(T,Q,false,V,R)},R)}function w(Q,P,R){C(function(S){function T(U){U.removeRecursively(P,R)}D(S,Q,false,T,R)},R)}function K(T,U,Q,R,P,S){C(function(V){function W(Z){function X(ab){function aa(ad){var ae=t(R);fileEntry.copyTo(ad,R,ac,S)}function ac(ad){P()}D(V,Q,true,aa,S)}var Y=t(U);Z.getFile(Y,{create:false},X,S)}D(V,T,false,W,S)},S)}function m(Q,S,P,R){C(function(U){function T(Y){var X=new FileReader();X.onload=function(Z){P(Z.target.result)};X.onerror=function(Z){R(Z.target.error)};X.readAsDataURL(Y)}function V(X){X.file(T,R)}function W(X){var Y=t(S);X.getFile(Y,{create:false},V,R)}D(U,Q,false,W,R)},R)}function v(R,S,P,Q){C(function(U){function V(X){X.onwriteend=function(){P()};X.write(S)}function T(X){X.createWriter(V,Q)}function W(X){X.getFile(R,{create:true,exclusive:false},T,Q)}z(U,true,W,Q)},Q)}function O(R,P,Q){C(function(T){function S(X){var W=new FileReader();W.onload=function(Y){P(Y.target.result)};W.onerror=function(Y){Q(Y.target.error)};W.readAsText(X)}function V(W){W.file(S,Q)}function U(W){W.getFile(R,{create:false},V,Q)}z(T,false,U,Q)},Q)}function y(S,Q,P,R){C(function(T){function U(W){function V(Y){var X=s.db.guid();Y.copyTo(W,X,function(){P(X)},R)}S=S.replace(/^\/*/,"");T.root.getFile(S,{create:false},V,R)}D(T,Q,true,U,R)},R)}function E(P,Q){C(function(R){function S(T){T.removeRecursively(P,Q)}I(R,S,Q)},Q)}function D(Q,R,T,P,S){function U(V){V.getDirectory(R,{create:T},P,S)}I(Q,U,S)}function I(Q,P,R){function S(T){u(Q.root,["mDesign",T,"attachments"],true,P,R)}s.getApplicationID(S)}function z(Q,T,P,R){function S(U){u(Q.root,["mDesign",U,"userdata"],T,P,R)}s.getApplicationID(S)}function u(S,U,R,P,Q){var T=U.shift();if(T){S.getDirectory(T,{create:R},function(V){u(V,U,R,P,Q)},Q)}else{P(S)}}function t(P){return P}function q(T,Y,R,P,U,Z){function Q(aa){log.error("Failed to create attachment. Error:"+JSON.stringify(aa))}function X(aa){aa.onwriteend=function(ab){function ac(){s.att.setAttachment(T,Y,"",true,Z)}s.fl.dsksetdata({resume:ac},T,R,Y)};aa.write(U)}function V(aa){aa.createWriter(X,Q)}function W(aa){var ab=aa.fullPath+"/"+Y;log.debug("got attachment path: "+ab);aa.getFile(Y,{create:true,exclusive:false},V,Q)}if(s.fs.availableForAtts){C(function(aa){D(aa,T,true,W,Q)},Q)}else{function S(){if(P===undefined){P="application/octet-stream"}var aa="data:"+P+";base64,"+btoa(U);s.db.setAttachment(T,Y,aa,true,Z)}s.fl.dsksetdata({resume:S},T,R,Y)}}function F(Q,R,P){if(window.resolveLocalFileSystemURL){resolveLocalFileSystemURL(Q,R,P)}else{window.resolveLocalFileSystemURI(Q,R,P)}}function o(P){if(P.toURL){return P.toURL()}else{return P.fullPath}}function h(P,Q){if(P.__format__){return P.__format__(Q)}else{return Q}}function G(){return s.phonegapPresent()}function M(){return G()&&s.getShellType()!=="phonegap"}s.fs={available:G(),availableForAtts:M(),getAttachmentPath:e,moveTemporaryFile:a,copyTemporaryFile:d,deleteAttachment:L,deleteAttachments:w,duplicateAttachment:K,uploadAttachment:k,downloadAttachment:l,downloadAttachmentURL:n,downloadAttachmentResource:N,getAttachmentData:m,clear:E,createNewAttachment:q,copyFileAsAttachment:y,readUserData:O,saveUserData:v}}(window.jmfw,window.mCapture));(function(g,k){function j(){var n;function m(B,C){}function z(B,C){}function y(B){}function t(B,C){}function x(C,B,D){}function q(D,C,B,E){}function s(C,B){}function w(D,C,B,E){}function v(C,B,D){}function A(B,C){}function o(B){}function u(B,C){}function l(B,C){}n={addChannel:m,cancelAllMessageNotifications:o,cancelInboxChanges:l,cancelMessageNotification:A,deleteMessage:s,getMessages:x,getUnreadMessages:q,listChannels:y,messageReceivedAck:v,receiveMessageNotification:w,receiveInboxChanges:u,removeChannel:z,sendMessage:t};return n}function f(){var m,q;function l(D,E){if(typeof(window.plugins)!=="undefined"&&typeof(window.plugins.notify)!=="undefined"){if(typeof(window.plugins.notify[D])==="function"){return true}}log.warn("Unable to use notifications system "+D);if(typeof(E)!=="undefined"){E("Notification system missing")}return false}function o(D,E){if(l("addChannel",E)){window.plugins.notify.addChannel(D,E)}}function B(D,E){if(l("removeChannel",E)){window.plugins.notify.removeChannel(D,E)}}function A(D){if(l("listChannels",D)){window.plugins.notify.listChannels(D)}}function v(D,E){if(l("sendMessage",E)){window.plugins.notify.sendMessage(D,E)}}function z(E,D,F){if(l("getMessages",F)){window.plugins.notify.getMessages(E,D,F)}}function u(F,E,D,G){if(l("getUnreadMessages",G)){window.plugins.notify.getUnreadMessages(F,E,D,G)}}function t(E,D){if(l("deleteMessage",D)){window.plugins.notify.deleteMessage(E,D)}}function y(F,E,D,G){if(l("receiveMessageNotification",G)){return window.plugins.notify.receiveMessageNotification(F,E,D,G)}}function x(E,D,F){if(l("messageReceivedAck",F)){return window.plugins.notify.messageReceivedAck(E,D,F)}}function C(D,E){if(l("cancelMessageNotification",E)){window.plugins.notify.cancelMessageNotification(D,E)}}function s(D){if(l("cancelAllMessageNotifications",D)){window.plugins.notify.cancelAllMessageNotifications(D)}}function w(D,E){if(l("receiveInboxChanges",E)){window.plugins.notify.receiveInboxChanges(D,E)}}function n(D,E){if(l("cancelInboxChanges",E)){window.plugins.notify.cancelInboxChanges(D,E)}}m=true;q=j();if(m){q.addChannel=o;q.cancelAllMessageNotifications=s;q.cancelInboxChanges=n;q.cancelMessageNotification=C;q.deleteMessage=t;q.getMessages=z;q.getUnreadMessages=u;q.listChannels=A;q.messageReceivedAck=x;q.receiveMessageNotification=y;q.receiveInboxChanges=w;q.removeChannel=B;q.sendMessage=v}k.notify.service=q;return q}function h(l){switch(l){case"cordova":that=f();break;case"pubnub":that=j();break;case"pusher":that=j();break;case"azure":that=j();case"chrome":that=chromeNotificationService();break}return that}function d(m){try{return g.jsonParse(m)}catch(l){return m}}function b(t){var o,s,n,u;log.info("logchange notification: name: "+t.name+". logLevel: "+t.level+". removeAllAppenders: "+t.removeAllAppenders+". removeAppender: "+t.removeAppender+". addAppender: "+t.addAppender);if(t.name==="application"){n=window.applog}else{if(t.name==="framework"){n=window.log}else{log.error('Unable to resolve log name "'+t.name+'" during a log change notification')}}if(n){if(t.level&&t.level.constructor===String){u=t.level.toUpperCase();if(u==="ALL"||u==="TRACE"||u==="DEBUG"||u==="INFO"||u==="WARN"||u==="ERROR"||u==="FATAL"||u==="OFF"){n.setLevel(log4javascript.Level[u])}else{log.error('Unable to set invalid log level "'+t.level+'" during a logchange notification')}}if(t.removeAllAppenders){n.removeAllAppenders()}if(t.removeAppender&&log4javascript.hasOwnProperty(t.removeAppender)){try{o=n.getEffectiveAppenders();if(o&&o.length){for(s=0;s<o.length;s+=1){try{if(o[s] instanceof log4javascript[t.removeAppender]){n.removeAppender(o[s])}}catch(q){}}}}catch(q){log.error('Unable to remove invalid appender "'+t.removeAppender+'" during a logchange notification')}}if(t.addAppender&&log4javascript.hasOwnProperty(t.addAppender)){try{var m=new log4javascript[t.addAppender]();if(t.addAppender==="NotifyLogAppender"){m.configure(t.responseChannel,t.responseSubchannel,t.responseNotification,t.responseTimeToLive)}n.addAppender(m)}catch(q){log.error('Unable to add invalid appender "'+t.addAppender+'" during a logchange notification. '+q.message)}}}return true}function a(s){var l,o,m,n,q;log.info("logstaterequest notification: name: "+s.name+". responseChannel: "+s.responseChannel+". responseSubchannel: "+s.responseSubchannel+". responseNotification: "+s.responseNotification+". responseTimeToLive: "+s.responseTimeToLive);if(s.responseChannel){if(s.responseSubchannel){if(s.responseNotification){if(s.responseTimeToLive){if(s.name==="application"){n=[{name:s.name,log:window.applog}]}else{if(s.name==="framework"){n=[{name:s.name,log:window.log}]}else{n=[{name:"application",log:window.applog},{name:"framework",log:window.log}]}}for(o=0;o<n.length;o+=1){q={};q.channel=s.responseChannel;q.subchannel=s.responseSubchannel;q.notification=s.responseNotification;q.expiry=(new Date()).addHours(s.responseTimeToLive).getTime();q.content={};q.content.verb="logstateresponse";q.content.name=n[o].name;q.content.appenders=[];l=n[o].log.getEffectiveAppenders();for(m=0;m<l.length;m+=1){q.content.appenders.push(l[m].toString())}q.content.level=n[o].log.getEffectiveLevel().name;k.notify.service.sendMessage(q)}}else{log.error("Unable to post a log state response due to a missing responseTimeToLive in a logstaterequest notification")}}else{log.error("Unable to post a log state response due to a missing responseNotification in a logstaterequest notification")}}else{log.error("Unable to post a log state response due to a missing responseSubchannel in a logstaterequest notification")}}else{log.error("Unable to post a log state response due to a missing responseChannel in a logstaterequest notification")}return true}function e(n,o){var m,l;l=false;if(n.content&&n.subchannel==="system"){m=n.content;if(m){switch(m.verb){case"logchange":l=b(m);break;case"logstaterequest":l=a(m);break;default:break}}}else{}if(l){k.notify.service.deleteMessage(n.id)}return l}function c(l,q,o,m){var n;if(m&&m._channel&&m._subchannel&&m._notification&&m._timeToLive){n={};n.channel=m._channel;n.subchannel=m._subchannel;n.notification=m._notification;n.expiry=(new Date()).addHours(m._timeToLive).getTime();n.content={};n.content.verb="logmessage";n.content.name=l;n.content.level=q;n.content.message=o;k.notify.service.sendMessage(n)}}k.notify={createNotificationService:h,handleMessage:e,parseMessageContent:d,sendLogMessage:c};k.notify.createNotificationService("cordova")}(window.jmfw,window.mCapture));(function(c,j){var b=320,e=200,f=50;function d(m,n){function l(o){log.error("Error generating thumbnail: "+JSON.stringify(o))}if(window.plugins&&window.plugins.thumbnail){window.plugins.thumbnail.getThumbnail(m,b,e,f,n,l)}else{n(m)}}function g(l,m,n){if(j.fs.availableForAtts){j.fs.getAttachmentData(l,m,n)}else{j.db.getAttachment(l,m,n)}}function h(l,m,n){if(j.fs.availableForAtts){j.fs.getAttachmentPath(l,m,function(o){d(o,n)})}else{j.db.getAttachment(l,m,n)}}function a(l,m,n,q,o){if(j.fs.availableForAtts){n=""}j.db.setAttachment(l,m,n,q,o)}function k(n,q,l,m,t){if(j.fs.availableForAtts){function s(){t()}function o(u){t("Failed to duplicate attachment: "+u.toString())}j.fs.duplicateAttachment(n,q,l,m,s,o)}else{j.db.getAttachment(n,q,function(u){j.db.setAttachment(l,m,u,false,t)})}}j.att={getThumbnail:d,getAttachmentData:g,getAttachment:h,setAttachment:a,duplicateAttachment:k}}(window.jmfw,window.mCapture));(function($,mc){function activityStart(){mc.showActivity()}function activityStop(force){mc.hideActivity(force)}function makeError(name,message){var e=new Error(message);e.name=name;return e}function argumentCountError(message){return makeError("argumentCountError",message)}function argumentTypeError(message){return makeError("argumentTypeError",message)}function validateArgs(args,name,min,max,types){var e,i;i=0;if(args.length<min){throw argumentCountError('Too few arguments in function "'+name+'". Requires between '+min+" and "+max)}if(args.length>max){throw argumentCountError('Too many arguments in function "'+name+'". Requires between '+min+" and "+max)}if(types!==undefined){for(i=0;i<args.length;i+=1){if(types[i]!==null&&types[i]!==undefined){if(args[i]===undefined&&i>=min){continue}if(args[i]===null||args[i]===undefined||args[i].constructor!==types[i]){e='Incorrect argument type in function "'+name+'". Argument: '+(i+1)+"  actual: ";if(args[i]===null){e+="null"}else{if(args[i]===undefined){e+="undefined"}else{e+=mc.getobjectclass(args[i])+" - object = "+args[i].constructor}}e+="  expected: "+types[i].name;throw argumentTypeError(e)}}}}}function msgBox(message,title,buttons,icon,defaultButton){var result,text,u;validateArgs(arguments,"msgBox",1,5,[String,String,Number,null,null]);text=(title!==undefined?title:"MDC")+"\n"+message;if(buttons===undefined||buttons===0){alert(text);return true}result=confirm(text);switch(buttons){case 0:return 0;case 1:if(result){return 0}return 2;case 2:alert("Unsupported ABORTRETRYIGNORE");return 3;case 3:alert("Unsupported YESNOCANCEL");return 2;case 4:if(result){return 6}return 7;case 5:if(result){return 4}return 2}u=icon;u=defaultButton}function getAnswer(callback,dataId,pageId,questionId,index,columnId,ignoreDefault){var designData,i,process,value;function gotValue(value){if(value&&columnId){if(value.constructor===Array){designData=designData||process.questions[dataId];if(designData&&designData.columns&&designData.columns.constructor===Array){for(i=0;i<designData.columns.length;i+=1){if(designData.columns[i].id&&designData.columns[i].id===columnId){value=value[i];break}}if(i>=designData.columns.length){value=undefined}}else{value=undefined}}else{value=undefined}}callback.resume(value)}function gotDefaultValue(value){if(value!==undefined){mc.db.setValue(dataId,value,index,designData.stamps)}gotValue(value)}process=mc.db.getCurrentProcess();if(!dataId){if(process.pages[pageId]===undefined){msgBox("Page ["+pageId+"] not found (id's are case sensitive)","Error",0);return gotValue(undefined)}if(process.pages[pageId].qIdMap[questionId]===undefined){msgBox("Question ["+questionId+"] on page ["+pageId+"] not found (id's are case sensitive)","Error",0);return gotValue(undefined)}dataId=process.pages[pageId].qIdMap[questionId]}value=mc.db.getValue(dataId,index);if(value===undefined&&ignoreDefault!==true){designData=process.questions[dataId];if(designData){value=designData.defval;if(value&&value.constructor===Function){value(gotDefaultValue)}else{gotDefaultValue(value)}}else{gotValue(value)}}else{gotValue(value)}}function getFileReference(callback,subjectGuid,dataId,index,columnId,context){function done(result){if(callback.constructor===Function){callback(result)}else{callback.resume(result)}}function onSuccess(path){var contextString;if(context===undefined){done("#fileref:"+path)}else{try{contextString=JSON.stringify(context)}catch(e){contextString=context.toString()}done("#fileref:"+path+"#"+contextString)}}function onError(error){log.error("Unable to get file reference: "+JSON.stringify(error));done(null)}function gotData(name){if(name){mc.fs.getAttachmentPath(subjectGuid,name,onSuccess,onError)}else{done(null)}}validateArgs(arguments,"getFileReference",3,6,[null,String,String,Number,String,null]);if(mc.fs.availableForAtts){dskData(gotData,subjectGuid,dataId,index,columnId)}else{done(null)}}function attachFileByReference(callback,fileReference,subjectGuid,dataId,index,columnId){function done(){if(callback.constructor===Function){callback()}else{callback.resume()}}function copySuccess(attachmentName){function attachmentSet(){done()}function answerSet(){mc.db.setAttachment(subjectGuid,attachmentName,"",true,done)}dskSetData({resume:answerSet},subjectGuid,columnId||dataId,attachmentName,index,false)}function copyError(error){log.error("failed to attach file reference "+fileReference+" - "+JSON.stringify(error));done()}validateArgs(arguments,"attachFileByReference",4,6,[null,null,String,String,Number,String]);var fileRefPrefix="#fileref:";if(typeof(fileReference)==="string"&&fileReference.indexOf(fileRefPrefix)===0){var filePath=fileReference.substr(fileRefPrefix.length);if(filePath){var name=mc.db.guid();mc.fs.copyFileAsAttachment(filePath,subjectGuid,copySuccess,copyError)}else{done()}}else{done()}}function execJsAsync(callback,name){var i,params;if(name&&mc.fl[name]!==undefined&&mc.fl[name].constructor===Function){params=[];for(i=2;i<arguments.length;i+=1){params.push(arguments[i])}mc.fl[name](callback,params)}else{callback.resume("Function "+name+" not found.")}}function execJsSync(name){var i,params;if(name&&mc.fl[name]!==undefined&&mc.fl[name].constructor===Function){params=[];for(i=1;i<arguments.length;i+=1){params.push(arguments[i])}return mc.fl[name](params)}return"Function "+name+" not found."}function execJsText(script){if(script){eval(script)}}function getDesignData(page,question){var designData,q;if(question===undefined){designData=mc.q.designData(page)}else{q=mc.q(page,question);if(q){designData=q.designData()}}return designData}function ans(callback,pageId,id1,index,id2,ignoreDefault){var pid,qid1,qid2,v;function ansCallback(value){callback.resume(value)}validateArgs(arguments,"ans",3,6,[null,String,String,Number,String,Boolean]);pid=pageId.replace(" ","_");qid1=id1.replace(" ","_");if(id2){v=qid1;qid1=id2.replace(" ","_");qid2=v}getAnswer({resume:ansCallback},undefined,pid,qid1,index,qid2,ignoreDefault)}function bottom(a,n){validateArgs(arguments,"bottom",2,2,[Array,Number]);return a.slice(0,n)}function isAnswered(callback,pageId,id1,index,id2){validateArgs(arguments,"isanswered",3,5,[null,String,String,Number,String]);function ansCallback(value){if(value===undefined||value===null){callback.resume(false);return}else{if(typeofObject(value)==="array"){if(value.length===0){callback.resume(false);return}else{callback.resume(true);return}}}callback.resume(value.toString()!=="")}ans({resume:ansCallback},pageId,id1,index,id2,true)}function isBoolean(test){validateArgs(arguments,"isBoolean",1,1);try{return test.constructor===Boolean}catch(e){return false}}function getOrientation(){if(window.orientation!==undefined&&(window.orientation==90||window.orientation==-90)){return"l"}return"p"}function canConnectViaWifi(){if(typeof navigator.network=="undefined"){return navigator.onLine}var networkState=navigator.connection.type;return networkState==Connection.WIFI}function getPlatform(){var currentProcess=mc.db.getCurrentProcess();if(typeof currentProcess.devPlatform!="undefined"&&currentProcess.devPlatform!=""){return currentProcess.devPlatform.toLowerCase()}if(typeof device!="undefined"){return device.platform.toLowerCase()}var agent=navigator.userAgent.toLowerCase();if(agent.indexOf("iphone")>=0){return"iphone"}if(agent.indexOf("android")>=0){return"android"}if(agent.indexOf("blackberry")>=0){return"blackberry"}if(agent.indexOf("windows")>=0){return"windows"}return"unknown"}function getCodeType(){var currentProcess=mc.db.getCurrentProcess();if(typeof currentProcess.devClient!="undefined"&&currentProcess.devClient!=""){return currentProcess.devClient.toLowerCase()}if(typeof device!="undefined"){return"u"}var agent=navigator.userAgent.toLowerCase();if(agent.indexOf("ctshell")>=0){return"u"}return"r"}function getFormatType(){var currentProcess=mc.db.getCurrentProcess();if(typeof currentProcess.devFormat!="undefined"&&currentProcess.devFormat!=""){return currentProcess.devFormat.toLowerCase()}var agent=navigator.userAgent.toLowerCase();if(agent.indexOf("xoom")>=0){return"t"}if(agent.indexOf("android")>=0&&(agent.indexOf("sch-i")>=0||agent.indexOf("gt-")>=0||agent.indexOf("kindle fire"))){return"t"}if(agent.indexOf("ipad")>=0){return"t"}if(agent.indexOf("android")>=0&&agent.indexOf("mobile")<0){return"t"}return"n"}function canConnectAtLeast(connectionType){log.info("canConnectAtLeast : "+connectionType);if(typeof navigator.connection=="undefined"){log.info("canConnectAtLeast : navigator.connection undefined - returning online = "+navigator.onLine);return navigator.onLine}var networkState=navigator.connection.type;log.info("canConnectAtLeast : "+networkState);if(networkState==Connection.ETHERNET){return true}if(connectionType==Connection.WIFI){if(networkState==Connection.WIFI){return true}}if(Connection.CELL===undefined){if(connectionType==Connection.CELL_4G){if(networkState==Connection.WIFI||networkState==Connection.CELL_4G){return true}}if(connectionType==Connection.CELL_3G){if(networkState==Connection.WIFI||networkState==Connection.CELL_4G||networkState==Connection.CELL_3G){return true}}if(connectionType==Connection.CELL_2G){if(networkState==Connection.WIFI||networkState==Connection.CELL_4G||networkState==Connection.CELL_3G||networkState==Connection.CELL_2G){return true}}}else{if(connectionType==Connection.CELL_4G){if(networkState==Connection.WIFI||networkState==Connection.CELL_4G||networkState==Connection.CELL){return true}}if(connectionType==Connection.CELL_3G){if(networkState==Connection.WIFI||networkState==Connection.CELL_4G||networkState==Connection.CELL_3G||networkState==Connection.CELL){return true}}if(connectionType==Connection.CELL_2G){if(networkState==Connection.WIFI||networkState==Connection.CELL_4G||networkState==Connection.CELL_3G||networkState==Connection.CELL_2G||networkState==Connection.CELL){return true}}if(connectionType==Connection.CELL){if(networkState==Connection.WIFI||networkState==Connection.CELL_4G||networkState==Connection.CELL_3G||networkState==Connection.CELL_2G||networkState==Connection.CELL){return true}}}log.info("canConnectAtLeast : no");return false}function isReachable(callback,timeout){var url,finished;function success(){if(!finished){finished=true;if(typeof(callback)=="function"){callback(true)}else{callback.resume(true)}}}function error(){if(!finished){finished=true;if(typeof(callback)=="function"){callback(false)}else{callback.resume(false)}}}function connect(serverUrl){if(timeout===undefined){timeout=5000}if(serverUrl){url=serverUrl.trim().replace(/\/+$/,"")+"/mdesign/0/iphone-shell/settings.plist"}else{url="/mdesign/0/iphone-shell/settings.plist"}jQuery.ajax({url:url,timeout:timeout}).done(function(){success()}).fail(function(){error()})}finished=false;if(!canConnectAtLeast("2g")){error()}else{if(window.plugins&&window.plugins.settings){window.plugins.settings.getURL(connect)}else{connect()}}}function isReplicating(){return mc.repl.isReplicating()}function isRestricted(){return !mc.unrestricted}function isDateTime(test){validateArgs(arguments,"isDateTime",1,1);try{return test.constructor===Date}catch(e){return false}}function isError(test){validateArgs(arguments,"isError",1,1);try{return test.constructor===Error}catch(e){return false}}function isHidden(pageId,questionId){validateArgs(arguments,"isHidden",2,2,[String,String]);return mc.q.isHidden(pageId+questionId)}function isList(test){validateArgs(arguments,"isList",1,1);try{return test.constructor===Array}catch(e){return false}}function isNull(test){validateArgs(arguments,"isNull",1,1);try{return test===null}catch(e){return false}}function isNumber(test){validateArgs(arguments,"isNumber",1,1);try{return test.constructor===Number}catch(e){return false}}function isText(test){validateArgs(arguments,"isText",1,1);try{return test.constructor===String}catch(e){return false}}function isXmlDataSet(dataId){var b,designData;validateArgs(arguments,"isXmlDataSet",1,1,[String]);designData=getDesignData(dataId);if(designData!==undefined){b=!!designData.xmlName}else{b=false}return b}function calculate(callback,dataId){execJsAsync(callback,"fn_"+dataId.toLowerCase())}function choicesToText(pageId,questionId){var answer,dataId,designData,i,j,n,result,question;pageId=pageId.replace(" ","_");questionId=pageId+questionId.replace(" ","_");result="";question=mc.q(pageId,questionId);if(question){dataId=question.getDataId();designData=getDesignData(dataId);if(designData!==undefined&&designData.choices!==undefined&&designData.choices.constructor===Array){n=designData.choices.length;answer=mc.db.getValue(dataId);if(answer!==undefined&&answer!==null){switch(answer.constructor){case Array:result=[];for(i=0;i<answer.length;i+=1){for(j=0;j<n;j+=1){if(answer[i]===designData.choices[j].value){result.push(designData.choices[j].label);break}}}result=result.join(", ");break;case String:for(i=0;i<n;i+=1){if(answer===designData.choices[i].value){result=designData.choices[i].label;break}}break}}}}return result}function setAnswer(dataId,pageId,questionId,answer,index){var designData,process,stamp;process=mc.db.getCurrentProcess();if(!dataId){dataId=process.pages[pageId].qIdMap[questionId]}stamp=false;designData=process.questions[dataId];if(designData!==undefined){stamp=designData.stamps}mc.db.setValue(dataId,answer,index,stamp)}function clearAns(pageId,questionId,index){var pid,qid;validateArgs(arguments,"ans",2,3,[String,String,Number]);pid=pageId.replace(" ","_");qid=questionId.replace(" ","_");setAnswer(undefined,pid,qid,null,index);return true}function clearData(dataId,index){validateArgs(arguments,"cleardata",1,2,[String,Number]);setAnswer(dataId,undefined,undefined,null,index);return true}function replicateDialog(callback,processId,profileAlias,title,url,timeout){var s;if(!mc.repl.isReplicating()){if(!mc.getPreNotifyCount()){mc.replInfo={callback:callback,processId:processId,profileAlias:profileAlias,title:title,url:url,timeout:timeout,page:mc.currentPage()};$.ui.gotoPage($("#replicatePage"),"jmuiSlide")}else{s="Cannot start a replication while there are currently running pre-notifications";log.error(s);window.alert(s);callback.resume(false)}}else{s="Cannot start a replication while another replication is in progress";log.error(s);window.alert(s);callback.resume(false)}}function replicate(callback){var s,title,url,timeout;function complete(success){if(callback.constructor===Function){callback(success)}else{callback.resume(success)}delete mc.replInfo}if(!mc.repl.isReplicating()){if(!mc.getPreNotifyCount()){title="replicate";url="";timeout=120;mc.replInfo={callback:callback,processId:"all",profileAlias:"defaultRepProfile",title:title,url:url,timeout:timeout};activityStart();mc.repl.replicate(function(success){activityStop();if(success!==window.ReplicationResult.Completed){mc.msgBox(function(){complete(success)},"Failed to complete replication","Error:","OK")}else{complete(success)}},mc.replInfo)}else{s="Cannot start a replication while there are currently running pre-notifications";log.error(s);window.alert(s);callback.resume(false)}}else{s="Cannot start a replication while another replication is in progress";log.error(s);window.alert(s);callback.resume(false)}}function clearDbAndReplicate(callback,processId,profileAlias,title,url,timeout){var s,userInfo;if(!mc.repl.isReplicating()){if(!mc.getPreNotifyCount()){mc.msgBox(function(text){if(text==="Yes"){if(window.cordova&&window.cordova.exec&&window.plugins&&window.plugins.settings){window.plugins.settings.getClearURL(function(clearUrl){window.locationUtils.setHref(clearUrl+"&newGuid=yes&replicate=true&processId="+processId+"&profileAlias="+encodeURIComponent(profileAlias)+"&title="+encodeURIComponent(title)+"&url="+encodeURIComponent(url)+"&timeout="+timeout)})}else{window.locationUtils.setHref(mc.getRootPath()+"mdesign/0/procs/clear.html?replicate=true&newGuid=yes&processId="+processId+"&profileAlias="+encodeURIComponent(profileAlias)+"&title="+encodeURIComponent(title)+"&url="+encodeURIComponent(url)+"&timeout="+timeout)}}},"Confirm","Clear all data?","Yes","No")}else{s="Cannot start a replication while there are currently running pre-notifications";log.error(s);window.alert(s);callback.resume(false)}}else{s="Cannot start a replication while another replication is in progress";log.error(s);window.alert(s);callback.resume(false)}}function setSubjectValue(callback,name,value,noTouch){var dbCallback;if(noTouch!==true){noTouch=false}if(callback&&callback.hasOwnProperty("resume")){dbCallback=function(){callback.resume()}}mc.db.setMetaValue(name,value,noTouch,dbCallback)}function clearPageStack(){setSubjectValue(undefined,"pageStack",[],true)}function clearSubjectStack(){mc.db.setJsonItem("subjectStack",[])}function cloneSubject(callback,guid,persist){function cloned(subject){callback.resume(subject)}mc.db.cloneSubject(guid,persist,cloned)}function currentSubjectGuid(){var guid;guid=mc.db.getCurrentSubjectGuid();return guid}function cloneCurrentSubject(callback,persist){return cloneSubject(callback,currentSubjectGuid(),persist)}function combineChoices(callback,staticChoices,dynamicChoices,sort){var a;function returnChoices(){if(sort){a.sort(function(l,r){var lhs,rhs;lhs=l.label.toLowerCase();rhs=r.label.toLowerCase();if(lhs<rhs){return -1}if(lhs===rhs){return 0}return 1})}callback.resume(a)}function gotDynamicChoices(choices){a=a.concat(choices);returnChoices()}a=[];if(staticChoices&&staticChoices.constructor===Array){a=a.concat(staticChoices)}if(dynamicChoices&&dynamicChoices.constructor===Function){dynamicChoices(gotDynamicChoices)}else{if(dynamicChoices&&dynamicChoices.constructor===Array){a=a.concat(dynamicChoices)}returnChoices()}}function createChoices(labels,values){var a,i,n,o;a=[];n=Math.max(labels.length,values.length);for(i=0;i<n;i+=1){o={};o.label=i<labels.length?labels[i]:"";o.value=i<values.length?values[i]:"";a.push(o)}return a}function createObject(json){var o;validateArgs(arguments,"createObject",0,1,[null]);if(json){try{o=$.jsonParse(json)}catch(ex){}}if(!o||o.constructor!==Object){o={}}return o}function createSubject(processId,callback){var version,newProcess,message;version=mc.db.getLatestProcessVersion(processId);function createNewSubject(){mc.showActivity();mc.db.createSubject(processId,version,undefined,callback);mc.hideActivity()}if(!processId){processId=mc.db.getCurrentProcess().id;newProcess=mc.db.getCurrentProcess()}else{newProcess=mc.db.getLatestProcessById(processId);if(newProcess!==undefined&&newProcess.notClientCreatable&&mc.fl.isclientsubject()){message="mc.fl.createSubject: Can't create subject, process is 'notClientCreatable'";log.error(message);msgBox(message);throw message}}if(newProcess===undefined){message="mc.fl.createSubject: Can't create subject, process is not available";log.error(message);msgBox(message);throw message}if(newProcess.deleteOnOpen){log.info("mc.fl.createSubject: delete all subjects for single subject delete on open process "+processId);mc.showActivity();mc.db.deleteAllSubjects(processId,version,createNewSubject);mc.hideActivity()}else{createNewSubject()}}function createSubjectGuid(callback,processId){createSubject(processId,function(subject){callback.resume(subject.guid)})}function createSubjectObject(callback,processId){createSubject(processId,function(subject){callback.resume(subject.value)})}function composeEmail(to,cc,subject,body){var params,url;function appendParam(name,value){if(value){params.push(name+"="+window.escape(value))}}url="mailto:";if(to){url+=to}url+="?";params=[];appendParam("cc",cc);appendParam("subject",subject);appendParam("body",body);url+=params.join("&");mc.gotoUrl(url,false)}function contains(textOrList,search){var i;if(!textOrList){return false}validateArgs(arguments,"contains",2,2);switch(textOrList.constructor){case String:return textOrList.indexOf(search)!==-1;case Array:for(i=0;i<textOrList.length;i+=1){if(textOrList[i]===search){return true}}return false;default:throw argumentTypeError('Incorrect argument type. Function: "contains" argument: "1" actual: "'+(mc.getobjectclass(textOrList)+" object = "+textOrList.constructor)+'" expected: "String" or "Array"')}}function created(){var meta;meta=mc.db.getValue("_meta");return meta.created}function currentPage(){return mc.currentPage()}function currentProcessId(){var version,processId;processId=mc.db.getCurrentProcess().id;if(processId!==undefined){version=mc.db.getLatestProcessVersion(processId)}return processId}function currentRowIdx(){var index,page;page=$("#"+currentPage());if(page.length===1){index=page.attr("rowIndex");if(index&&index.constructor===String){index=parseFloat(index)}}return index}function currentSubjectObject(){return mc.db.getCurrentSubject()}function data(callback,dataId,index,columnId,ignoreDefault){validateArgs(arguments,"data",2,5,[null,String,Number,String,Boolean]);getAnswer(callback,dataId,undefined,undefined,index,columnId,ignoreDefault)}function date(dateString,format){var d,day,month,year;validateArgs(arguments,"date",1,2,[String,String]);switch(format){case undefined:if(dateString.length===8){year=parseFloat(dateString.slice(0,4));month=parseFloat(dateString.slice(4,6))-1;day=parseFloat(dateString.slice(6,8));d=new Date(year,month,day)}else{msgBox("date from string can only be yyyyMMdd","Error",0)}break;case"d":try{d=Date.parse(dateString)}catch(e){msgBox(dateString+":"+e,"Date Conversion Error",0)}break;default:try{if(dateString.length===format.length){d=Date.parseExact(dateString,format)}if(d===undefined||d===null){d=Date.parse(dateString)}}catch(ex){msgBox(dateString+":"+ex,"Date Conversion Error",0)}break}if(d===null){d=undefined}return d}function julian(d){var a,dd,ggg,hr,j1,jd,mm,mn,s,sc,yy;yy=d.getUTCFullYear();mm=d.getUTCMonth()+1;dd=d.getUTCDate();hr=d.getUTCHours();mn=d.getUTCMinutes();sc=d.getUTCSeconds();hr+=(mn/60)+(sc/3600);ggg=(yy<=1585)?0:1;jd=-1*Math.floor(7*(Math.floor((mm+9)/12)+yy)/4);s=((mm-9)<0)?-1:1;a=Math.abs(mm-9);j1=Math.floor(yy+s*Math.floor(a/7));j1=-1*Math.floor((Math.floor(j1/100)+1)*3/4);jd+=Math.floor(275*mm/9)+dd+(ggg*j1);jd+=1721027+2*ggg+367*yy-0.5;jd+=hr/24;return jd}function dateDiff(d1,d2,units){validateArgs(arguments,"dateDiff",3,3,[null,null,String]);if(d1===undefined||d2===undefined){return 0}var result,v1,v2;if(units==="seconds"){result=julian(d1)-julian(d2);result=Math.round(result*24*60*60)}else{if(units==="minutes"){result=julian(d1)-julian(d2);result=Math.round(result*24*60)}else{if(units==="hours"){result=julian(d1)-julian(d2);result=Math.round(result*24)}else{if(units==="days"){result=Math.floor(julian(d1)-julian(d2))}else{if(units==="weeks"){result=(d1.getUTCFullYear()-d2.getUTCFullYear())*52;v1=d1.getWeekOfYear();v2=d2.getWeekOfYear();if(v2<=v1){result+=v1-v2}else{result-=v2-v1}}else{if(units==="months"){result=(d1.getUTCFullYear()-d2.getUTCFullYear())*12;v1=d1.getUTCMonth();v2=d2.getUTCMonth();if(v2<=v1){result+=v1-v2}else{result-=v2-v1}}else{if(units==="years"){result=d1.getUTCFullYear()-d2.getUTCFullYear()}else{result=0}}}}}}}return result}function dateAdd(date,years,months,days,hours,minutes,seconds){validateArgs(arguments,"dateAdd",7,7,[null,Number,Number,Number,Number,Number,Number]);if(date===undefined){return date}var d;d=new Date(date);d.addYears(years).addMonths(months).addDays(days).addHours(hours).addMinutes(minutes).addSeconds(seconds);return d}function dateAddTime(date,time){validateArgs(arguments,"dateAddTime",2,2,[null,null]);if(date===undefined||time===undefined){return date}var d;d=new Date(date);d.addHours(time.getHours()).addMinutes(time.getMinutes()).addSeconds(time.getSeconds());return d}function dateFromParts(year,month,day,hour,minute,second){validateArgs(arguments,"dateFromParts",6,6,[Number,Number,Number,Number,Number,Number]);return new Date(year,month,day,hour,minute,second)}function dateParts(d1,units){validateArgs(arguments,"dateParts",2,2,[null,String]);var result=0;if(d1!==undefined){if(units==="seconds"){result=d1.getUTCSeconds()}else{if(units==="minutes"){result=d1.getUTCMinutes()}else{if(units==="hours"){result=d1.getUTCHours()}else{if(units==="days"){result=d1.getUTCDate()}else{if(units==="weeks"){result=d1.getWeekOfYear()}else{if(units==="months"){result=d1.getUTCMonth()}else{if(units==="years"){result=d1.getUTCFullYear()}else{result=0}}}}}}}}return result}function dateSubTime(date,time){validateArgs(arguments,"dateSubTime",2,2,[null,null]);if(date===undefined||time===undefined){return date}var d;d=new Date(date);d.addHours(-time.getHours()).addMinutes(-time.getMinutes()).addSeconds(-time.getSeconds());return d}function dateTimeCombine(date,time){if(date===undefined){return time}if(time===undefined){return date}return dateFromParts(date.getFullYear(),date.getMonth(),date.getDate(),time.getHours(),time.getMinutes(),time.getSeconds())}function getDebugFlag(){return getEnvironment("$$debugFlag")==="1"?true:false}function dbgMsgBox(message,title,buttons,icon,defaultButton){if(getDebugFlag()){return msgBox(message,title,buttons,icon,defaultButton)}return true}function deleteLogFiles(callback){var fail,success;success=function(){callback.resume(true)};fail=function(message){if(message){alert(message)}callback.resume(false)};if(navigator.hasOwnProperty("log")){navigator.log.deleteLogFiles(success,fail)}else{if(window.plugins.log!==undefined){window.plugins.log.deleteLogFiles(success,fail)}else{fail("deleteLogFiles Not available in Restricted Client")}}}function deleteSubject(callback,subjectGuid){validateArgs(arguments,"deleteSubject",2,2,[null,String]);mc.db.deleteSubject(subjectGuid,function(e){callback.resume(e)})}function zumoRequest(callback,channel,subchannel,method,data,ttlHours,notifyResponse){validateArgs(arguments,"zumoRequest",5,7,[null,String,String,String,null,Number,Boolean]);dataProviderRequest(callback,"ZumoRequest",channel,subchannel,method,data,ttlHours,notifyResponse)}function dataRequest(callback,channel,subchannel,method,data,ttlHours,notifyResponse){validateArgs(arguments,"dataRequest",5,7,[null,String,String,String,null,Number,Boolean]);dataProviderRequest(callback,"DataRequest",channel,subchannel,method,data,ttlHours,notifyResponse)}function dataProviderRequest(callback,provider,channel,subchannel,method,data,ttlHours,notifyResponse){validateArgs(arguments,"dataProviderRequest",6,8,[null,String,String,String,String,null,Number,Boolean]);var content={};content.data=data;var pushMessage={};switch(provider){case"DataRequest":pushMessage.provider=provider;content.method=method;break;case"ZumoRequest":pushMessage.provider="zumo";content.transport={};content.transport.type="zumoDirect";content.transport.httpMethod="POST";content.transport.api=method;content.options={};break;default:throw argumentTypeError("Invalid data service provider '"+provider+"'")}function addMinutes(date,minutes){return new Date(date.getTime()+minutes*60000)}if(!ttlHours){ttlHours=0}var now=new Date();var then=addMinutes(now,ttlHours*60);pushMessage.channel=notifyResponse?channel:"ignoreResponse";pushMessage.subchannel=notifyResponse?subchannel:"ignoreResponse";pushMessage.expiry=ttlHours===0?0:then.getTime();pushMessage.content=content;mc.notify.service.sendMessage(pushMessage,function(error,messageId){log.info("mc.fl.dataProviderRequest: "+provider+" message posted, id: "+messageId);callback.resume({error:error,id:messageId})})}function zumoClearToken(callback){var authenticator=plugins.authenticator;if(authenticator===undefined){authenticator=plugins.authenticate}try{authenticator.clearZumoCredentials(function(){log.info("mc.fl.zumoClearToken: Zumo credentials clear has been requested");callback.resume()},function(error){log.info("mc.fl.zumoClearToken: Zumo credentials clear has failed: "+error);callback.resume()})}catch(error){log.error("mc.fl.zumoClearToken: Zumo credentials clear has errored: "+error)}}function dskAns(callback,subjectId,pageId,id1,index,id2,dataId){mc.db.getSubject(subjectId,function(subject,error){var answer,designData,i,process,processName,v;try{processName=mc.db.makeProcessName({id:subject._meta.processId,version:subject._meta.processVersion});if(id2){v=id1;id1=id2;id2=v}process=mc.db.getProcess(processName);if(!dataId){dataId=process.pages[pageId].qIdMap[id1]}answer=subject[dataId];if(index!==undefined&&index!==null){if(answer!==undefined&&answer.constructor===Array){answer=answer[index]}else{answer=undefined}}if(answer&&id2){if(answer.constructor===Array){designData=process.questions[dataId];if(designData&&designData.columns&&designData.columns.constructor===Array){for(i=0;i<designData.columns.length;i+=1){if(designData.columns[i].id&&designData.columns[i].id===id2){answer=answer[i];break}}if(i>=designData.columns.length){answer=undefined}}else{answer=undefined}}else{answer=undefined}}}catch(e){answer=undefined}if(callback.constructor===Function){callback(answer)}else{callback.resume(answer)}error=undefined});subjectId=undefined}function dskCloseSubject(callback,subjectId){mc.db.getSubject(subjectId,function(subject,error){var i,process,processName,summaries;try{processName=mc.db.makeProcessName({id:subject._meta.processId,version:subject._meta.processVersion});process=mc.db.getProcess(processName);summaries=[];if(process.summaryMap){for(i=0;i<process.summaryMap.length;i+=1){summaries[i]=subject._meta.summaries[process.summaryMap[i]]}}mc.db.setSubject(subjectId,subject,true,function(e){callback.resume(e)},summaries)}catch(e){callback.resume(e)}error=undefined})}function dskCurrentPage(callback,subjectId){mc.db.getSubject(subjectId,function(subject,error){var pageId;try{pageId=subject._meta.currentPageId}catch(e){pageId=undefined}callback.resume(pageId);error=undefined})}function dskData(callback,subjectId,dataId,index,columnId){validateArgs(arguments,"dskdata",3,5,[null,String,String,Number,String]);dskAns(callback,subjectId,undefined,columnId,index,"dummyQuestionId",dataId)}function dskGetSummaryValue(callback,guid,name){validateArgs(arguments,"summaryItem",3,3,[null,null,String]);mc.db.getSummaryValue(guid,name,function(value){callback.resume(value)})}function dskHasData(callback,subjectId,dataId,index,columnId){validateArgs(arguments,"dskhasdata",3,5,[null,String,String,Number,String]);try{dskData(function(answer){callback.resume(answer!==undefined&&answer!==null&&answer!=="")},subjectId,dataId,index,columnId)}catch(e){callback.resume(false)}}function dskIsAnswered(callback,subjectId,pageId,id1,index,id2){validateArgs(arguments,"dskisanswered",4,6,[null,String,String,String,Number,String]);try{dskAns(function(answer){callback.resume(answer!==undefined&&answer!==null&&answer!=="")},subjectId,pageId,id1,index,id2)}catch(e){callback.resume(false)}}function dskSetAns(callback,subjectId,pageId,questionId,answer,index,cacheOnly){mc.db.getSubject(subjectId,function(subject,error){function getDataId(){var processName=mc.db.makeProcessName({id:subject._meta.processId,version:subject._meta.processVersion});var process=mc.db.getProcess(processName);pageId=pageId.replace(" ","_");questionId=questionId.replace(" ","_");return process.pages[pageId].qIdMap[questionId]}function createNewValue(dataId){if(index!==undefined&&index!==null){if(index.constructor===String){index=parseInt(index,10)}var a=subject[dataId];if(a===undefined||a===null||a.constructor!==Array){a=[]}a[index]=answer;return a}else{return answer}}try{var dataId=getDataId();newValue=createNewValue(dataId);if(!cacheOnly){mc.db.valueChanging(subject,dataId,newValue,index,function(){subject[dataId]=newValue;mc.db.setSubject(subjectId,subject,true,function(e){callback.resume(e)})})}else{subject[dataId]=newValue;callback.resume()}}catch(e){callback.resume(e)}error=undefined})}function dskCacheAns(callback,subjectId,pageId,questionId,answer,index){dskSetAns(callback,subjectId,pageId,questionId,answer,index,true)}function dskSetData(callback,subjectId,dataId,answer,index,cacheOnly){mc.db.getSubject(subjectId,function(subject,error){function createNewValue(){if(index!==undefined&&index!==null){if(index.constructor===String){index=parseInt(index,10)}var a=subject[dataId];if(a===undefined||a===null||a.constructor!==Array){a=[]}a[index]=answer;return a}else{return answer}}try{var newValue=createNewValue(dataId);if(!cacheOnly){mc.db.valueChanging(subject,dataId,newValue,index,function(){subject[dataId]=newValue;mc.db.setSubject(subjectId,subject,true,function(e){callback.resume(e)})})}else{subject[dataId]=newValue;callback.resume()}}catch(e){callback.resume(e)}error=undefined})}function dskCacheData(callback,subjectId,dataId,answer,index){dskSetData(callback,subjectId,dataId,answer,index,true)}function dskSetSummaryValue(callback,subjectId,name,value,cacheOnly){mc.db.getSubject(subjectId,function(subject,error){var i,process,processName,summaries;try{subject._meta.summaries[name]=value;if(!cacheOnly){processName=mc.db.makeProcessName({id:subject._meta.processId,version:subject._meta.processVersion});process=mc.db.getProcess(processName);summaries=[];if(process.summaryMap){for(i=0;i<process.summaryMap.length;i+=1){summaries[i]=subject._meta.summaries[process.summaryMap[i]]}}mc.db.setSubject(subjectId,subject,true,function(e){callback.resume(e)},summaries)}else{callback.resume()}}catch(e){callback.resume(e)}error=undefined})}function dskCacheSummaryValue(callback,subjectId,name,value){dskSetSummaryValue(callback,subjectId,name,value,true)}function dynamicChoicesToText(callback,pageId,questionId){var dataId,designData,question;function convertChoices(choices){var answer,i,j,n,result;result="";n=choices.length;answer=mc.db.getValue(dataId);if(answer!==undefined&&answer!==null){switch(answer.constructor){case Array:result=[];for(i=0;i<answer.length;i+=1){for(j=0;j<n;j+=1){if(answer[i]===choices[j].value){result.push(choices[j].label);break}}}result=result.join(", ");break;case String:for(i=0;i<n;i+=1){if(answer===choices[i].value){result=choices[i].label;break}}break}}callback.resume(result)}pageId=pageId.replace(" ","_");questionId=pageId+questionId.replace(" ","_");question=mc.q(pageId,questionId);if(question){dataId=question.getDataId();designData=getDesignData(dataId);if(designData!==undefined&&designData.choices!==undefined){switch(designData.choices.constructor){case Array:convertChoices(designData.choices);break;case Function:designData.choices(convertChoices);break;default:callback.resume("")}}else{callback.resume("")}}else{callback.resume("")}}function element(list,index){validateArgs(arguments,"element",2,2,[Array,Number]);return list[index]}function execFormula(name,success,error,async){var formula,i,params;function complete(result){if(async){mc.hideActivity()}if(success&&success.constructor===Function){success(result)}}function fail(e){if(async){mc.hideActivity()}if(error&&error.constructor===Function){error(e)}}if(name&&mc.fl[name]!==undefined&&mc.fl[name].constructor===Function){if(async){mc.showActivity();formula=window.make_formula(mc.fl[name]);params=[complete,fail];for(i=4;i<arguments.length;i+=1){params.push(arguments[i])}formula.execute.apply(formula,params)}else{complete(mc.fl[name]())}}else{if(error&&error.constructor===Function){error("Invalid formula name: "+name)}}}function exitApp(){mc.goHome()}function explode(s,separator){validateArgs(arguments,"explode",2,2,[String,String]);return s.split(separator)}function formulaError(message){return makeError("formulaError",message)}function error(errorString){validateArgs(arguments,"error",1,1,[String]);return formulaError(errorString)}function errorText(e){validateArgs(arguments,"text",1,1,[Error]);return e.message}function format(numberOrDate,formatString){var f,n;validateArgs(arguments,"format",2,2,[null,String]);if(numberOrDate===undefined||numberOrDate===null){return""}if(isNumber(numberOrDate)===true){return numberOrDate.toString()}if(numberOrDate.constructor===String){n=new Date(numberOrDate)}else{if(numberOrDate.constructor===Date){n=numberOrDate}}if(isDateTime(n)){if(Date.hasOwnProperty("CultureInfo")){switch(formatString){case"d":f=Date.CultureInfo.formatPatterns.shortDate;break;case"D":f=Date.CultureInfo.formatPatterns.longDate;break;case"F":f=Date.CultureInfo.formatPatterns.fullDateTime;break;case"m":f=Date.CultureInfo.formatPatterns.monthDay;break;case"r":f=Date.CultureInfo.formatPatterns.rfc1123;break;case"s":f=Date.CultureInfo.formatPatterns.sortableDateTime;break;case"t":f=Date.CultureInfo.formatPatterns.shortTime;break;case"T":f=Date.CultureInfo.formatPatterns.longTime;break;case"u":f=Date.CultureInfo.formatPatterns.universalSortableDateTime;break;case"y":f=Date.CultureInfo.formatPatterns.yearMonth;break;default:f=formatString;break}return n.toString(f)}if(formatString==="d"){return n.toLocaleDateString()}if(formatString==="D"){return n.toLocaleDateString()}if(formatString==="t"){return n.getHours().toString()+":"+n.getMinutes().toString()}if(formatString==="T"){return n.getHours().toString()+":"+n.getMinutes().toString()+":"+n.getSeconds().toString()}throw argumentTypeError('No date/time culture info to convert to "'+formatString+'". Use d|D|t|T')}throw argumentTypeError('Incorrect argument type function: "format" argument: "1" actual: "'+(mc.getobjectclass(n)+" - object = "+args[i].constructor)+'" expected: "Number" or "Date"')}function getCurrentLocation(options){var i,ret,position;if(options===undefined){return undefined}ret={};position=mc.db.getCachedPosition();if(position===undefined){return undefined}for(i=0;i<options.length;i+=1){if(options[i]==="lat"){ret.latitude=position.coords.latitude}else{if(options[i]==="long"){ret.longitude=position.coords.longitude}}}return ret}function getDirections(source,destination){var params,url;function appendParam(name,value){if(value){params.push(name+"="+window.escape(value))}}url="http://maps.google.com/?";params=[];appendParam("sensor","true");appendParam("saddr",source);appendParam("daddr",destination);url+=params.join("&");mc.gotoUrl(url,false)}function getSubjectValue(name){return mc.db.getMetaValue(name)}function getSummaryValue(subject,name){var value;validateArgs(arguments,"getSummaryValue",2,2,[null,String]);if(!subject||subject.constructor!==Object){log.error("mc.fl.getSummaryValue: Parameter 1 is not a valid subject object")}else{if(subject._meta&&subject._meta.constructor===Object&&subject._meta.summaries&&subject._meta.summaries.constructor===Object){value=subject._meta.summaries[name]||""}}if(typeof value!=="string"){value=""}return value}function getSyncInfo(name){var syncInfo,value;syncInfo=getSubjectValue("syncInfo");if(syncInfo){value=syncInfo[name];if(value===undefined){value=syncInfo[name.toLowerCase()];if(value===undefined){try{syncInfo=JSON.parse(JSON.stringify(syncInfo).toLowerCase());value=syncInfo[name.toLowerCase()]}catch(e){log.error("Duplicate lowercase item in subject _meta : "+JSON.stringify(syncInfo))}}}}return value}function getUserName(){return mc.db.getUserInfo().mSuiteUserName||""}function getServiceUserName(callback,service){function fail(e){log.error("getServiceUsername failed: "+e)}function success(){if(typeof(callback)==="function"){callback()}else{if(typeof(callback.resume)==="function"){callback.resume()}else{log.error("Unable to exit from getServiceUserName: invalid callback")}}}validateArgs(arguments,"getserviceusername",2,2,[null,String]);plugins.settings.getServiceUsername(success,fail,service)}function getUserInfo(){return mc.db.getUserInfo()||{}}function getParentSubject(){return getSyncInfo("parentguid")||""}function gotoProvisioningUrl(callback){function exit(provisioningURL){if(typeof(callback)==="function"){callback(provisioningURL)}else{if(typeof(callback.resume)==="function"){callback.resume(provisioningURL)}else{log.error("Unable to exit from provisioning url reason: invalid callback")}}}mc.gotoProvisioningUrl(exit)}function getObjectValue(o,n){if(o[n]!==undefined){return o[n]}return""}function getSelectedRows(pageId,questionId){var i,pid,q,qid,rows,selected;validateArgs(arguments,"getSelectedRows",2,2,[String,String]);pid=pageId.replace(" ","_");qid=pid+questionId.replace(" ","_");selected=[];q=$("#"+qid);rows=q.find(".jmuiSelected");rows.each(function(){i=parseInt($(this).attr("rowIndex"),10);if(typeof i==="number"&&isFinite(i)&&i>=0){selected.push(i)}});return selected}function getSubjectGuid(guid){var s;s=mc.db.getSubjectGuid(guid);return s}function getSubjectObject(callback,guid){function gotSubject(subject){if(subject&&subject.hasOwnProperty("_meta")){callback.resume(subject)}else{throw"Subject not found. Guid: "+guid}}mc.db.getSubject(guid,gotSubject)}function guidFromSyncID(callback,processId,syncId){mc.db.getSubjectGuidFromReplID(processId,syncId,function(guid){if(guid===undefined){callback.resume("")}else{callback.resume(guid)}})}function gotoPage(pageId,backwards){function popSubject(){var guid,processId;processId=mc.db.getCurrentProcess().id;function openSubjectFailed(){mc.goHome()}guid=mc.fl.popsubject();if(guid){mc.fl.opensubject({resume:openSubjectFailed},guid)}else{mc.goHome()}}validateArgs(arguments,"gotoPage",1,2,[String,Boolean]);if(pageId){$.ui.gotoPage($("#"+pageId),"jmuiSlide",backwards)}else{popSubject()}}function gotoUrl(url,popup){var u;validateArgs(arguments,"gotoUrl",1,2,[String,Boolean]);if(url){mc.gotoUrl(url,false)}u=popup}function hasData(callback,dataId,index,columnId){validateArgs(arguments,"hasdata",2,4,[null,String,Number,String]);function dataCallback(value){callback.resume(value!==undefined&&value!==null&&value!=="")}data({resume:dataCallback},dataId,index,columnId,true)}function implode(list,separator){validateArgs(arguments,"implode",2,2,[Array,String]);return list.join(separator)}function isClientSubject(){var serverId;serverId=getSyncInfo("ServerId");return serverId===null||serverId===undefined||serverId===""}function isServerSubject(){return !isClientSubject()}function length(stringOrList){validateArgs(arguments,"length",1,1);if(stringOrList.constructor===String||stringOrList.constructor===Array){return stringOrList.length}throw argumentTypeError('Incorrect argument type function: "length" argument: "1" actual: "'+(mc.getobjectclass(stringOrList)+" - object = "+stringOrList.constructor)+'" expected: "String" or "List"')}function left(s,n){validateArgs(arguments,"left",2,2,[String,Number]);return s.slice(0,n)}function list(){return Array.prototype.slice.call(arguments)}function logTrace(message){applog.trace(message)}function logDebug(message){applog.debug(message)}function logInfo(message){applog.info(message)}function logWarn(message){applog.warn(message)}function logError(message){applog.error(message)}function logFatal(message){applog.fatal(message)}function logGetLevel(){return applog.getLevel().name}function enableLogging(level){window.plugins.log.enableLogging()}function disableLogging(level){window.plugins.log.disableLogging()}function logRemoveAllAppenders(){applog.removeAllAppenders()}function logRemoveAppender(name){var a,i;if(name&&log4javascript.hasOwnProperty(name)){try{a=applog.getEffectiveAppenders();if(a&&a.length){for(i=0;i<a.length;i+=1){try{if(a[i] instanceof log4javascript[name]){applog.removeAppender(a[i])}}catch(ex){}}}}catch(ex){log.error('Unable to remove invalid appender "'+name+'" in mc.fl.logRemoveAppender')}}}function logAddAppender(name,channel,subchannel,notification,timeToLive){var appender;validateArgs(arguments,"logAddAppender",1,5,[String,String,String,String,Number]);if(name&&log4javascript.hasOwnProperty(name)){try{appender=new log4javascript[name]();if(name==="NotifyLogAppender"){validateArgs(arguments,"logAddAppender",5,5,[String,String,String,String,Number]);appender.configure(channel,subchannel,notification,timeToLive)}applog.addAppender(appender)}catch(ex){log.error('Unable to add invalid appender "'+name+'" in mc.fl.logAddAppender')}}}function lookup(callback,processId,profileAlias,timeout){mc.db.setSubject(mc.db.getCurrentSubjectGuid(),mc.db.getCurrentSubject(),false,function(){function complete(success){delete mc.replInfo;callback.resume(success)}var title,url;title="lookup";url="";mc.replInfo={callback:callback,processId:processId,profileAlias:profileAlias,title:title,url:url,timeout:timeout};activityStart();mc.repl.replicate(function(success){activityStop();if(success!==window.ReplicationResult.Completed){complete(success)}else{complete(success)}},mc.replInfo)})}function lowerCase(text){validateArgs(arguments,"lowerCase",1,1,[String]);return text.toLowerCase()}function mailLogs(callback,recipient){validateArgs(arguments,"mailLogs",2,2,[null,String]);if(window.plugins.log.mailLogs){function success(result){if(callback){callback.resume(result)}}function failure(){if(callback){callback.resume(false)}}window.plugins.log.mailLogs(success,failure,recipient)}else{log.error("Missing function: window.plugins.log.mailLogs")}}function makePhoneCall(numberString){mc.gotoUrl("tel:"+numberString,false)}function matchRegEx(text,exp){validateArgs(arguments,"matchRegEx",2,2,[String,String]);return new RegExp(exp).test(text)}function media(value){validateArgs(arguments,"media",1,1,[String]);return"../"+mc.db.getCurrentProcess().version+"/resources/"+value}function modifySubject(callback,guid,pageId,quesitonId,value){function gotSubject(subject){var dataId,process,processName;try{processName=mc.db.makeProcessName({id:subject._meta.processId,version:subject._meta.processVersion});process=mc.db.getProcess(processName);dataId=process.pages[pageId].qIdMap[quesitonId];mc.db.valueChanging(subject,dataId,value,undefined,function(){subject[dataId]=value;mc.db.setSubject(guid,subject,false,function(e){callback.resume(e)})})}catch(e){callback.resume(false)}}validateArgs(arguments,"modifySubject",5,5,[null,null,String,String,null]);mc.db.getSubject(guid,gotSubject)}function modifySubjectSyncInfo(callback,guid,name,value){function gotSubject(subject){try{if(!subject._meta.syncInfo){subject._meta.syncInfo={}}subject._meta.syncInfo[name]=value;mc.db.setSubject(guid,subject,false,function(e){callback.resume(!e)})}catch(e){callback.resume(false)}}validateArgs(arguments,"modifySubjectSyncInfo",4,4,[null,null,String,null]);mc.db.getSubject(guid,gotSubject)}function msgBoxAsync(callback,message,title,buttons,icon,defaultButton){var u;function complete(btnText){var button;button=0;switch(btnText.toLowerCase()){case"ok":button=0;break;case"cancel":button=2;break;case"abort":button=3;break;case"retry":button=4;break;case"ignore":button=5;break;case"yes":button=6;break;case"no":button=7;break}if(callback.constructor===Function){callback(button)}else{callback.resume(button)}}validateArgs(arguments,"msgBoxAsync",1,6,[null,String,String,Number,null,null]);switch(buttons){case 0:mc.msgBox(complete,title,message,"OK");break;case 1:mc.msgBox(complete,title,message,"OK","Cancel");break;case 2:mc.msgBox(complete,title,message,"Abort","Retry","Ignore");break;case 3:mc.msgBox(complete,title,message,"Yes","No","Cancel");break;case 4:mc.msgBox(complete,title,message,"Yes","No");break;case 5:mc.msgBox(complete,title,message,"Retry","Cancel");break;default:if(title===undefined){mc.msgBox(complete,"",message,"OK")}else{mc.msgBox(complete,title,message,"OK")}break}u=icon;u=defaultButton}function newCurrentPageOnClose(pageId){validateArgs(arguments,"newCurrentPageOnClose",1,1,[String]);mc.currentPage(pageId);setSubjectValue(undefined,"pageStack",[],true)}function notifyAddChannel(callback,channel){validateArgs(arguments,"notifyAddChannel",2,2,[null,String]);mc.notify.service.addChannel(channel,function(error,channel){callback.resume(error?{message:error}:channel)})}function notifyCancelAllMessageNotifications(callback){validateArgs(arguments,"notifyCancelAllMessageNotifications",1,1,[null]);mc.notify.service.cancelAllMessageNotifications(function(error){callback.resume(error?{message:error}:undefined)})}function notifyCancelMessageNotification(callback,receiver){validateArgs(arguments,"notifyCancelMessageNotification",2,2,[null,String]);mc.notify.service.cancelMessageNotification(receiver,function(error,receiver){callback.resume(error?{message:error}:receiver)})}function notifyDeleteMessage(callback,messageId){validateArgs(arguments,"notifyDeleteMessage",2,2,[null,String]);log.debug("notifyDeleteMessage - msgid: "+messageId);mc.notify.service.deleteMessage(messageId,function(error,id){if(error){log.debug("notifyDeleteMessage - msgid: "+id+" error: "+error)}else{log.debug("notifyDeleteMessage - msgid: "+id+" deleted")}callback.resume(error?{message:error}:id)})}function notifyGetMessages(callback,channel,subchannel){validateArgs(arguments,"notifyGetMessages",3,3,[null,String,String]);log.debug("notifyGetMessages - channel: "+channel+" subchannel: "+subchannel);mc.notify.service.getMessages(channel,subchannel,function(error,messages){if(error){log.debug("notifyGetMessages - channel: "+channel+" subchannel: "+subchannel+" error: "+error)}else{log.debug("notifyGetMessages - channel: "+channel+" subchannel: "+subchannel+" count: "+messages.length)}callback.resume(error?{message:error}:messages)})}function notifyGetUnreadMessages(callback,channel,subchannel,receiver){validateArgs(arguments,"notifyGetUnreadMessages",1,4,[null,String,String,String]);log.debug("notifyGetUnreadMessages - rcv: "+receiver+" channel: "+channel+" subchannel: "+subchannel);if(!receiver){receiver=mc.db.getUserInfo().mSuiteUserName}log.debug("notifyGetUnreadMessages - rcv: "+receiver+" channel: "+channel+" subchannel: "+subchannel);mc.notify.service.getUnreadMessages(receiver,channel,subchannel,function(error,messages){if(error){log.debug("notifyGetUnreadMessages - rcv: "+receiver+" channel: "+channel+" subchannel: "+subchannel+" error: "+error)}else{log.debug("notifyGetUnreadMessages - rcv: "+receiver+" channel: "+channel+" subchannel: "+subchannel+" count: "+messages.length)}callback.resume(error?{message:error}:messages)})}function notifyGetUnreadMessageCount(callback,channel,subchannel,receiver){validateArgs(arguments,"notifyGetUnreadMessageCount",1,4,[null,String,String,String]);log.debug("notifyGetUnreadMessageCount - rcv: "+receiver+" channel: "+channel+" subchannel: "+subchannel);if(!receiver){receiver=mc.db.getUserInfo().mSuiteUserName}log.debug("notifyGetUnreadMessageCount - rcv: "+receiver+" channel: "+channel+" subchannel: "+subchannel);mc.notify.service.getUnreadMessages(receiver,channel,subchannel,function(error,messages){if(error){log.debug("notifyGetUnreadMessageCount - rcv: "+receiver+" channel: "+channel+" subchannel: "+subchannel+" error: "+error)}else{log.debug("notifyGetUnreadMessageCount - rcv: "+receiver+" channel: "+channel+" subchannel: "+subchannel+" count: "+messages.length)}callback.resume(error?{message:error}:messages.length)})}function notifyListChannels(callback){validateArgs(arguments,"notifyListChannels",1,1,[null]);mc.notify.service.listChannels(function(error,channels){callback.resume(error?{message:error}:channels)})}function notifyMessageReceived(callback,messageId,receiver){var receivedOn=receiver;log.debug("notifyMessageReceived - rec: "+receiver+" id: "+messageId);validateArgs(arguments,"notifyMessageReceived",2,3,[null,String,String]);if(!receiver){userInfo=mc.db.getUserInfo();receivedOn=userInfo.mSuiteUserName}log.debug("notifyMessageReceived - by: "+receivedOn+" id: "+messageId);mc.notify.service.messageReceivedAck(receivedOn,messageId,function(error){mc.refreshNotificationIndicator();callback.resume(error?{message:error}:undefined)})}function notifyReceiveMessageNotification(callback,formulaName,receiver,channel,subchannel){var e;log.debug("notifyReceiveMessageNotification - rec: "+receiver+" channel: "+channel+" sub: "+subchannel+"call: "+formulaName);validateArgs(arguments,"notifyReceiveMessageNotication",5,5,[null,String,String,String,String]);if(name&&mc.fl[formulaName]===undefined||mc.fl[formulaName].constructor!==Function){throw argumentTypeError('notifyReceiveMessageNotication : invalid function parameter "'+formulaName+'"')}e=mc.notify.service.receiveMessageNotification(receiver,channel,subchannel,function(error,message){log.debug("notifyReceiveMessageNotification - rec: "+receiver+" channel: "+channel+" sub: "+subchannel+" id: "+message.id);log.debug("error = "+JSON.stringify(error));log.debug("message = "+JSON.stringify(message));function markAsRead(result){log.debug("notifyReceiveMessageNotification - rec: "+receiver+" channel: "+channel+" sub: "+subchannel+" id: "+message.id+" call: "+formulaName+" result: "+result);if(result==="success"){try{mc.notify.service.messageReceivedAck(receiver,message.id);mc.refreshNotificationIndicator()}catch(e){log.error("notifyReceiveMessageNotificationAck - rec: "+receiver+" channel: "+channel+" sub: "+subchannel+" id: "+message.id+" call: "+formulaName+" error: "+e)}}}function success(){markAsRead("success")}function fail(){markAsRead("fail")}if(!error&&message){log.debug("notifyReceiveMessageNotification - rec: "+receiver+" channel: "+channel+" sub: "+subchannel+" id: "+message.id+" call: "+formulaName);mc.fl.execFormula(formulaName,success,fail,true,error,message)}else{log.error("notifyReceiveMessageNotification id: "+message.id+" error: "+JSON.stringify(error))}});if(e!==undefined){callback.resume({message:e})}else{callback.resume(undefined)}}function notifyReceiveOutboxNotification(formulaName,receiver,channel,subchannel){}function notifyRemoveChannel(callback,channel){validateArgs(arguments,"notifyRemoveChannel",2,2,[null,String]);mc.notify.service.removeChannel(channel,function(error,channel){callback.resume(error?{message:error}:channel)})}function notifySendMessage(callback,channel,subchannel,content,notification,ttlHours,provider){var message,expiry;validateArgs(arguments,"notifySendMessage",6,7,[null,String,String,null,String,null]);if(ttlHours.constructor!==Number){ttlHours=parseInt(ttlHours,10)}if(!ttlHours||ttlHours===""){ttlHours=0}if(ttlHours===0){expiry=0}else{expiry=(new Date()).addHours(ttlHours).getTime()}message={channel:channel,subchannel:subchannel,content:content,notification:notification,expiry:expiry};if(provider){message.provider=provider}mc.notify.service.sendMessage(message,function(error,messageId){callback.resume(error?{message:error}:messageId)})}function popPage(){var pageId,pageStack;pageStack=getSubjectValue("pageStack");if(pageStack&&pageStack.constructor===Array&&pageStack.length>0){pageId=pageStack.pop();setSubjectValue(undefined,"pageStack",pageStack,true)}else{pageId=""}return pageId}function nextPage(backwards){var formulaName,prevpage;function popSubject(){var guid;function openSubjectFailed(){mc.goHome()}guid=mc.fl.popsubject();if(guid){mc.fl.opensubject({resume:openSubjectFailed},guid)}else{mc.goHome()}}function success(result){var processId;if(result&&typeof result==="string"&&result!=="Start"){$.ui.gotoPage($("#"+result),"jmuiSlide",backwards)}else{processId=mc.db.getCurrentProcess().id;popSubject()}}function error(e){alert(e);popSubject()}if(backwards===true){prevpage=popPage();return success(prevpage)}formulaName="action_"+mc.currentPage()+"_pageForward";mc.fl.execFormula(formulaName,success,error,true)}function now(){return new Date()}function number(numberString){validateArgs(arguments,"number",1,1,[String]);return parseFloat(numberString)}function openSubject(callback,guid,pageId){function gotSubject(subject){var process,processName;if(subject){processName=mc.db.makeProcessName({id:subject._meta.processId,version:subject._meta.processVersion});process=mc.db.getProcess(processName);process.currentSubjectGuid=getSubjectGuid(guid);mc.db.setProcess(processName,process);mc.gotoUrl(process.url,!process.urlProcess)}else{if(callback){callback.resume()}}}function getSubject(){mc.db.getSubject(guid,function(subject){if(pageId&&subject._meta.currentPageId!==pageId){subject._meta.currentPageId=pageId;mc.db.setSubject(guid,subject,true,function(){gotSubject(subject)})}else{gotSubject(subject)}})}validateArgs(arguments,"openSubject",2,3,[null,String,String]);mc.db.evaluateSummaryValues(mc.db.getCurrentProcess().summaryMap,mc.fl.summaries,getSubject)}function pageBack(){nextPage(true)}function pageHome(){mc.goHome()}function pageNext(){nextPage(false)}function getLog(){return log}function popList(list){return list.pop()}function popSubject(){var subjectId,subjectStack;subjectStack=mc.db.getJsonItem("subjectStack")||[];if(subjectStack&&subjectStack.constructor===Array&&subjectStack.length>0){subjectId=subjectStack.pop();mc.db.setJsonItem("subjectStack",subjectStack)}else{subjectId=""}return subjectId}function pushList(list,newItem){return list.push(newItem)}function pushPage(){var pageStack;pageStack=getSubjectValue("pageStack");if(!pageStack||pageStack.constructor!==Array){pageStack=[]}pageStack.push(currentPage());setSubjectValue(undefined,"pageStack",pageStack,true)}function pushSubject(guid){var subjectStack;guid=getSubjectGuid(guid);subjectStack=mc.db.getJsonItem("subjectStack")||[];if(!subjectStack||subjectStack.constructor!==Array){subjectStack=[]}subjectStack.push(guid||currentSubjectGuid());mc.db.setJsonItem("subjectStack",subjectStack)}function querySummaryData(callback,processId,processVersion,summaryItemName){var filters,o,processName,processObj,realArguments,separator,u;function finish(result){if(callback.constructor===Function){callback(result)}else{callback.resume(result)}}separator="";o={};o.id=processId;o.version="";o.version+=mc.db.getLatestProcessVersion(processId);processName=mc.db.makeProcessName(o);processObj=mc.db.getProcess(processName);if(processObj!==undefined&&processObj.separator!==undefined){separator=processObj.separator}realArguments=Array.prototype.slice.call(arguments);filters=realArguments.slice(4);mc.db.querySummaryData(processId,summaryItemName,filters,true,separator,function(arr){var results;results=[];$.each(arr,function(index,item){var summaryValueLabel,summaryValueValue;summaryValueLabel=item;summaryValueValue=item;if(separator!==undefined&&separator.length>0&&item.indexOf(separator)>=0&&item.indexOf(separator)<item.length){summaryValueLabel=item.substring(0,item.indexOf(separator));summaryValueValue=item.substring(1+item.indexOf(separator))}results.push({label:summaryValueLabel,value:summaryValueValue});index=undefined});finish(results)});u=processVersion}function querySummaryValues2(callback,processId,processVersion,summaryItemName,unique,filters){var o,processName,processObj,separator;function finish(results){var finalResult=[];$.each(results,function(index,item){finalResult.push(item.value);index=undefined});if(callback.constructor===Function){callback(finalResult)}else{callback.resume(finalResult)}}separator="";o={};o.id=processId;o.version="";o.version+=mc.db.getLatestProcessVersion(processId);processName=mc.db.makeProcessName(o);processObj=mc.db.getProcess(processName);if(processObj.separator!==undefined){separator=processObj.separator}mc.db.querySummaryData(processId,summaryItemName,filters,unique,separator,function(arr){var results=[];$.each(arr,function(index,item){var summaryValueLabel,summaryValueValue;summaryValueLabel=item;summaryValueValue=item;if(separator!==undefined&&separator.length>0&&item.indexOf(separator)>=0&&item.indexOf(separator)<item.length){summaryValueLabel=item.substring(0,item.indexOf(separator));summaryValueValue=item.substring(1+item.indexOf(separator))}results.push({label:summaryValueLabel,value:summaryValueValue});index=undefined});finish(results)});processVersion=undefined}function querySummaryValuesNonUnique(callback,processId,processVersion,summaryItemName){var realArguments=Array.prototype.slice.call(arguments);querySummaryValues2(callback,processId,processVersion,summaryItemName,false,realArguments.slice(4))}function querySummaryValues(callback,processId,processVersion,summaryItemName){var realArguments=Array.prototype.slice.call(arguments);querySummaryValues2(callback,processId,processVersion,summaryItemName,true,realArguments.slice(4))}var inRefreshCurrentPage=false;function refreshCurrentPage(){if(!inRefreshCurrentPage){inRefreshCurrentPage=true;$(".jmuiLayout.jmuiCurrent .jmuiPage.jmuiCurrent").bind("jmuiPageAnimationStart",function(e){inRefreshCurrentPage=true});$(".jmuiLayout.jmuiCurrent .jmuiPage.jmuiCurrent").bind("jmuiPageAnimationEnd",function(e){inRefreshCurrentPage=false});$(".jmuiLayout.jmuiCurrent .jmuiPage.jmuiCurrent").removeAttr("rowindex");$(".jmuiLayout.jmuiCurrent .jmuiPage.jmuiCurrent").trigger("jmuiPageAnimationStart",{direction:"in"}).trigger("jmuiPageAnimationEnd",{direction:"in"})}}function refreshHidden(){var formula,formulaName;function hidden(){setTimeout(function(){var page;page=$("#"+currentPage());$.ui.refreshScroller(page)},0)}formulaName="pageHide_"+currentPage();formula=mc.fl[formulaName];if(formula!==undefined&&formula.constructor===Function){formula(hidden)}}function refreshQuestion(questionId){var pageId,q,qid;validateArgs(arguments,"refreshQuestion",1,1,[String]);pageId=currentPage();qid=pageId+questionId.replace(" ","_");q=mc.q(pageId,qid);if(q){q.load()}execFormula("questionId_"+qid)}function refreshiScroll(timeout){validateArgs(arguments,"refreshiScroll",1,1,[Number]);setTimeout(function(){$(".jmuiPage.jmuiCurrent").each(function(){$.ui.refreshScroller($(this))})},timeout)}function replicatePage(callback,processId,profileAlias,title,url,timeout){var replInfo,s;if(!mc.repl.isReplicating()){if(!mc.getPreNotifyCount()){replInfo={processId:processId,profileAlias:profileAlias,title:title,timeout:timeout,url:url||location.href};mc.db.setJsonItem("mcReplInfo",replInfo);mc.db.evaluateSummaryValues(mc.db.getCurrentProcess().summaryMap,mc.fl.summaries,function(){mc.gotoUrl("../../replicate.html",false)});callback=undefined}else{s="Cannot start a replication while there are currently running pre-notifications";log.error(s);window.alert(s);callback.resume(false)}}else{s="Cannot start a replication while another replication is in progress";log.error(s);window.alert(s);callback.resume(false)}}function revert(callback){mc.db.restoreCurrentSubject(function(e){refreshCurrentPage();callback.resume(e)})}function right(s,n){validateArgs(arguments,"right",2,2,[String,Number]);return s.slice(-n)}function scan(callback,successMessage,failMessage){var fail,success;success=function(data){if(successMessage){alert(successMessage)}callback.resume(data)};fail=function(message){if(failMessage){alert(failMessage+": "+message)}callback.resume("")};if(navigator.hasOwnProperty("barcodeScanner")){navigator.barcodeScanner.scanBarcode(success,fail)}else{if(window.plugins.barcodeScanner!==undefined){window.plugins.barcodeScanner.scan(success,fail)}else{fail("Not available in Restricted Client")}}}function setAns(pageId,questionId,answer,index){var pid,qid;validateArgs(arguments,"ans",3,4,[String,String,null,Number]);pid=pageId.replace(" ","_");qid=questionId.replace(" ","_");return setAnswer(undefined,pid,qid,answer,index)}function setData(dataId,answer,index){validateArgs(arguments,"setdata",2,3,[String,null,Number]);return setAnswer(dataId,undefined,undefined,answer,index)}function setFocus(questionId){var id,question;function removePseudoFocus(){question.removeClass("jmuiPseudoFocus");question.unbind("click",removePseudoFocus)}id=currentPage()+questionId;id=id.replace(" ","_");question=$("#"+id);if(question.length){if(question[0].previousElementSibling&&question[0].previousElementSibling.nodeName==="H2"){$.ui.scrollToElement(question[0].previousElementSibling)}else{$.ui.scrollToElement(question[0])}$(":focus").blur();$(".jmuiPseudoFocus").removeClass("jmuiPseudoFocus");question.addClass("jmuiPseudoFocus").bind("click",removePseudoFocus)}}function setReturnPage(callback,pageId,clearStack){validateArgs(arguments,"setReturnPage",2,3,[null,String,Boolean]);mc.currentPage(pageId);if(clearStack===undefined){clearStack=true}mc.db.setMetaValue("currentPageId",pageId,true,function(){if(clearStack){setSubjectValue(callback,"pageStack",[],true)}else{callback.resume()}})}function setTitleBarText(title){var pageId;pageId=mc.currentPage();setPageTitleBarText(pageId,title)}function setPageTitleBarText(pageId,title){var headerTitle;headerTitle=$("#"+pageId+" .jmuiHeader > h1");if(headerTitle){headerTitle.item(0).html(title)}}function setObjectValue(o,n,v){validateArgs(arguments,"setObjectValue",3,3,[null,String,null]);o[n]=v}function setSyncInfo(callback,name,value){var syncInfo;function clone(o){var p,c;c={};for(p in o){if(o.hasOwnProperty(p)){c[p]=o[p]}}return c}syncInfo=getSubjectValue("syncInfo");if(!syncInfo||syncInfo[name]!==value){syncInfo=clone(syncInfo);syncInfo[name]=value;setSubjectValue(callback,"syncInfo",syncInfo,false)}else{if(callback&&callback.hasOwnProperty("resume")){callback.resume()}}}function split(str,sep){validateArgs(arguments,"split",2,2,[String,String]);log.warn("using deprecated function split - consider changing to explode");return list(str.split(sep))}function startGpsHeartBeat(callback,successMessage,failMessage){var fail,success;success=function(){if(successMessage){alert(successMessage)}callback.resume(true)};fail=function(message){if(failMessage){alert(failMessage+": "+message)}callback.resume(false)};if(navigator.hasOwnProperty("statusUpdater")){navigator.statusUpdater.start(success,fail)}else{if(window.plugins.location!==undefined){window.plugins.statusUpdater.start(success,fail)}else{fail("GPS Heartbeat Not available in Restricted Client")}}}function startMonitoringRegion(callback,region,successMessage,failMessage){var fail,success;success=function(){if(successMessage){alert(successMessage)}callback.resume(true)};fail=function(message){if(failMessage){alert(failMessage+": "+message)}callback.resume(false)};if(navigator.hasOwnProperty("location")){navigator.location.startMonitoringRegion(region,success,fail)}else{if(window.plugins.location!==undefined){window.plugins.location.startMonitoringRegion(region,success,fail)}else{fail("Geofence Not available in Restricted Client")}}}function stopGpsHeartBeat(callback,successMessage,failMessage){var fail,success;success=function(){if(successMessage){alert(successMessage)}callback.resume(true)};fail=function(message){if(failMessage){alert(failMessage+": "+message)}callback.resume(false)};if(navigator.hasOwnProperty("statusUpdater")){navigator.statusUpdater.stop(success,fail)}else{if(window.plugins.location!==undefined){window.plugins.statusUpdater.stop(success,fail)}else{fail("GPS Heartbeat Not available in Restricted Client")}}}function stopMonitoringRegion(callback,identifier){var fail,success;success=function(){callback.resume(true)};fail=function(message){if(message){alert(message)}callback.resume(false)};if(navigator.hasOwnProperty("location")){navigator.location.stopMonitoringRegion(identifier,success,fail)}else{if(window.plugins.location!==undefined){window.plugins.location.stopMonitoringRegion(identifier,success,fail)}else{fail("Geofence Not available in Restricted Client")}}}function subjectContext(callback){callback.resume(callback.getvar("_arg1"))}function subString(text,startIndex,endIndex){validateArgs(arguments,"subString",2,3,[String,Number,Number]);return text.substring(startIndex,endIndex)}function summaryQuery(callback,processId,options){mc.db.summaryQuery(processId,options,function(result){if(callback.constructor===Function){callback(result)}else{callback.resume(result)}})}function switchCss(title){var b;b=false;validateArgs(arguments,"switchCss",1,1,[String]);$("link[rel*=style][title]").each(function(i){this.disabled=true;if(this.getAttribute("title")==title){this.disabled=false;b=true;mc.db.setMetaValue("currentCss",title)}});return b}function text(item){validateArgs(arguments,"text",1,1,[null]);if(item===null||item===undefined){return"null"}switch(item.constructor){case String:return item;case Number:return item.toString();case Boolean:return item?"true":"false";case Date:return item.toString()}return"Unknown type"}function time(timeString,format){var d,h,m;validateArgs(arguments,"time",1,2,[String,String]);switch(format){case undefined:case null:case"":if(timeString.length===4){h=parseFloat(timeString.slice(0,2));m=parseFloat(timeString.slice(2,4));d=new Date();d.setHours(h,m,0,0)}else{msgBox("time from string can only be HHmm","Error",0)}break;case"t":try{d=Date.parse(timeString);if(isDateTime(d)){h=d.getHours();m=d.getMinutes();d.setHours(h,m,0,0)}}catch(e){msgBox(timeString+":"+e,"Time Conversion Error",0)}break;default:try{d=Date.parseExact(timeString,format);if(isDateTime(d)){h=d.getHours();m=d.getMinutes();d.setHours(h,m,0,0)}}catch(ex){msgBox(timeString+":"+ex,"Time Conversion Error",0)}break}return d}function timeDiff(t1,t2,units){var diff,result;diff=dateDiff(t1,t2,units);if(units==="seconds"){result=diff%(24*60*60);result=Math.round(result)}else{if(units==="minutes"){result=diff%(24*60);result=Math.round(result)}else{if(units==="hours"){result=diff%(24);result=Math.round(result)}else{result=0}}}return result}function today(){return now()}function top(a,n){validateArgs(arguments,"top",2,2,[Array,Number]);return a.slice(-n)}function trim(v){function trimString(s){return s.trim()}function trimArray(a){var i,r,v;r=[];for(i=0;i<a.length;i+=1){v=a[i];if(v&&v.constructor===String){v=trimString(v)}if(r.length){r.push(v)}else{if(v!==null&&v!==undefined&&v!==""&&!(v.constructor===Number&&isNaN(v))){r.push(v)}}}for(i=r.length-1;i>=0;i-=1){v=r[i];if(v===null||v===undefined||v===""||(v.constructor===Number&&isNaN(v))){r.pop()}else{break}}return r}validateArgs(arguments,"trim",1,1,[null]);switch(v.constructor){case Array:v=trimArray(v);break;case String:v=trimString(v);break}return v}function typeofObject(o){var type;validateArgs(arguments,"typeofObject",1,1,[null]);return mc.getobjectclass(o)}function upperCase(text){validateArgs(arguments,"upperCase",1,1,[String]);return text.toUpperCase()}function setDebugFlag(debugFlag){validateArgs(arguments,"setDebugFlag",1,1,[Boolean]);setEnvironment("$$debugFlag",debugFlag?"1":"0")}function getEnvironment(name){validateArgs(arguments,"getEnvironment",1,1,[String]);return localStorage.getItem(name)||""}function setEnvironment(name,value){validateArgs(arguments,"setEnvironment",2,2,[String,null]);try{localStorage.setItem(name,value)}catch(e){if(e.code===22){localStorage.removeItem(name);localStorage.setItem(name,value)}else{throw (e)}}}function setGpsHeartBeatOptions(callback,options,successMessage,failMessage){var fail,success;success=function(){if(successMessage){alert(successMessage)}callback.resume(true)};fail=function(message){if(failMessage){alert(failMessage+": "+message)}callback.resume(false)};if(navigator.hasOwnProperty("statusUpdater")){navigator.statusUpdater.setOptions(options,success,fail)}else{if(window.plugins.location!==undefined){window.plugins.statusUpdater.setOptions(options,success,fail)}else{fail("GPS Heartbeat Not available in Restricted Client")}}}function defaultPostNotification($$result){switch(this.state){case 1:this.state=2;mc.fl.notifygetunreadmessagecount(this,mc.fl.getusername());return this.async();case 2:this.state=3;mc.fl.msgbox(this,"There are "+$$result+" notifications pending. This process is unable to deal with these notifications.");return this.async();case 3:break}return this.done(true)}function viewDocument(subjectGuid,name,launcher,activity,mimeType){validateArgs(arguments,"viewDocument",2,5,[String,String,null,String,String]);var launchObj;function success(){mc.hideActivity(true)}function fail(e){mc.hideActivity(true)}if(mc.fs.availableForAtts){if(typeof launcher==="object"){launchObj=launcher}else{launchObj={};launchObj.app=launcher;launchObj.activity=activity;launchObj.mime=mimeType}window.plugins.viewDocument.viewDocumentDirect(subjectGuid,name,success,fail,launchObj)}else{validateArgs(arguments,"viewDocument",2,5,[String,String,String,String,String]);function gotAttachment(data){var dataParts,mimeParts;dataParts=data.split(";");mimeParts=dataParts[0].split(":");if(mimeParts[1]==="*/*"){if(mimeType){mimeParts[1]=mimeType;dataParts[0]=mimeParts.join(":");data=dataParts.join(";")}}window.plugins.viewDocument.viewDocument(data,success,fail,launcher,activity,mimeType)}mc.showActivity();mc.att.getAttachmentData(subjectGuid,name,gotAttachment)}}function createDocument(callback,subjectGuid,dataId,data,mime){var attachmentName=mc.db.guid();mc.fs.createNewAttachment(subjectGuid,attachmentName,dataId,mime,data,function(result){if(typeof(callback)=="function"){callback(attachmentName)}else{callback.resume(attachmentName)}})}function viewDocumentDirect(subjectGuid,name,launcher){validateArgs(arguments,"viewDocumentDirect",2,3,[String,String,Object]);if(launcher){if(mc.fs.availableForAtts){viewDocument(subjectGuid,name,launcher)}else{viewDocument(subjectGuid,name,launcher.app,launcher.activity,launcher.mime)}}}function uploadLogs(callback,uri){validateArgs(arguments,"uploadLogs",1,2,[null,String]);if(window.plugins.log.uploadLogs){function success(result){if(callback){callback.resume(result)}}function failure(){if(callback){callback.resume(false)}}window.plugins.log.uploadLogs(success,failure,uri)}else{log.error("Missing function: window.plugins.log.uploadLogs")}}function getBatteryLevel(){return mc.battery.getLevel()}function getBatteryPluggedIn(){return mc.battery.getPluggedIn()}function clearSignature(dataid){var jSigjQ=jQuery('ul[dataid="'+dataid+'"] div.jsig');var canvas=jQuery('ul[dataid="'+dataid+'"] div.jsig canvas')[0];if(jSigjQ){if(canvas){canvas.width=canvas.width}jSigjQ.jSignature("reset")}clearData(dataid)}function getSignatureImageData(callback,subjectId,dataId,svg){function gotAnswer(answer){var imgData;if(answer){if(svg){imgData=answer[2]}else{imgData=answer[1]}}else{imgData=answer}if(callback.resume){callback.resume(imgData)}else{callback(imgData)}}dskAns(gotAnswer,subjectId,undefined,undefined,undefined,undefined,dataId)}function saveSettings(callback,data){function done(result){if(callback.constructor===Function){callback(result)}else{callback.resume(result)}}function onError(){log.error("Failed to save settings to file system");done(false)}function onSuccess(){done(true)}validateArgs(arguments,"saveSettings",2,2,[null,null]);var content="@@"+JSON.stringify(data);if(device&&device.platform&&device.platform==="Android"){plugins.settings.setUserPreference("userPrefs",content,onSuccess,onError)}else{if(mc.fs.available){mc.fs.saveUserData("settings",content,onSuccess,onError)}else{onError()}}}function readSettings(callback){function done(result){if(callback.constructor===Function){callback(result)}else{callback.resume(result)}}function onError(){log.error("Failed to read settings from file system");done(null)}function onSuccess(content){var data=content.replace(/^@@/,"");done(JSON.parse(data))}validateArgs(arguments,"readSettings",1,1,[null]);if(device&&device.platform&&device.platform==="Android"){plugins.settings.getUserPreference("userPrefs",onSuccess,onError)}else{if(mc.fs.available){mc.fs.readUserData("settings",onSuccess,onError)}else{onError()}}}function clearOldSubjects(callback){function done(result){if(callback.constructor===Function){callback(result)}else{callback.resume(result)}}function clear(procs){var proc=procs.pop();if(proc){mc.db.deleteAllSubjects(proc.value.id,proc.value.version,function(){clear(procs)})}else{done()}}validateArgs(arguments,"clearOldSubjects",1,1,[null]);clear(mc.db.getOldProcesses())}mc.fl={activitystart:activityStart,activitystop:activityStop,ans:ans,attachfilebyreference:attachFileByReference,bottom:bottom,calculate:calculate,canconnectatleast:canConnectAtLeast,canconnectviawifi:canConnectViaWifi,choicestotext:choicesToText,clearans:clearAns,clearoldsubjects:clearOldSubjects,cleardata:clearData,cleardbandreplicate:clearDbAndReplicate,clearpagestack:clearPageStack,clearsignature:clearSignature,clearsubjectstack:clearSubjectStack,clonecurrentsubject:cloneCurrentSubject,clonesubject:cloneSubject,createdocument:createDocument,combinechoices:combineChoices,composeemail:composeEmail,contains:contains,createchoices:createChoices,created:created,createobject:createObject,createsubject:createSubjectGuid,createsubjectobject:createSubjectObject,currentpage:currentPage,currentprocessid:currentProcessId,currentrowidx:currentRowIdx,currentsubject:currentSubjectGuid,currentsubjectobject:currentSubjectObject,data:data,dataproviderrequest:dataProviderRequest,datarequest:dataRequest,date:date,dateadd:dateAdd,dateaddtime:dateAddTime,datediff:dateDiff,datefromparts:dateFromParts,dateparts:dateParts,datesubtime:dateSubTime,datetimecombine:dateTimeCombine,dbgmsgbox:dbgMsgBox,deletelogfiles:deleteLogFiles,deletesubject:deleteSubject,dskans:dskAns,dskcacheans:dskCacheAns,dskcachedata:dskCacheData,dskcachesummaryvalue:dskCacheSummaryValue,dskclosesubject:dskCloseSubject,dskcurrentpage:dskCurrentPage,dskdata:dskData,dskgetsummaryvalue:dskGetSummaryValue,dskhasdata:dskHasData,dskisanswered:dskIsAnswered,dskisdatapresent:dskHasData,dsksetans:dskSetAns,dsksetdata:dskSetData,dsksetsummaryvalue:dskSetSummaryValue,dynamicchoicestotext:dynamicChoicesToText,element:element,error:error,errortext:errorText,execFormula:execFormula,execjsasync:execJsAsync,execjssync:execJsSync,execjstext:execJsText,exitapp:exitApp,explode:explode,format:format,getfilereference:getFileReference,getbatterylevel:getBatteryLevel,getbatterypluggedin:getBatteryPluggedIn,getcodetype:getCodeType,getcurrentlocation:getCurrentLocation,getdebugflag:getDebugFlag,getdirections:getDirections,getenvironment:getEnvironment,getformattype:getFormatType,getlog:getLog,getloglevel:logGetLevel,getobjectvalue:getObjectValue,getorientation:getOrientation,getplatform:getPlatform,getparentsubject:getParentSubject,getselectedrows:getSelectedRows,getserviceusername:getServiceUserName,getsignatureimagedata:getSignatureImageData,getsubjectguid:getSubjectGuid,getsubjectobject:getSubjectObject,getsubjectvalue:getSubjectValue,getsummaryvalue:getSummaryValue,getsyncinfo:getSyncInfo,getusername:getUserName,getuserinfo:getUserInfo,guidfromsyncid:guidFromSyncID,gotopage:gotoPage,gotoprovisioningurl:gotoProvisioningUrl,gotourl:gotoUrl,hasdata:hasData,implode:implode,isanswered:isAnswered,isboolean:isBoolean,isclientsubject:isClientSubject,isdatapresent:hasData,isdatetime:isDateTime,iserror:isError,ishidden:isHidden,islist:isList,isnull:isNull,isnumber:isNumber,isreachable:isReachable,isreplicating:isReplicating,isrestricted:isRestricted,isserversubject:isServerSubject,istext:isText,isxmldataset:isXmlDataSet,left:left,length:length,list:list,log:logInfo,logaddappender:logAddAppender,logdebug:logDebug,logerror:logError,logfatal:logFatal,loggetlevel:logGetLevel,loginfo:logInfo,logmessage:logInfo,logremoveallappenders:logRemoveAllAppenders,logremoveappender:logRemoveAppender,logshell:logInfo,logtrace:logTrace,logwarn:logWarn,lookup:lookup,lowercase:lowerCase,maillogs:mailLogs,makephonecall:makePhoneCall,matchregex:matchRegEx,media:media,modifysubject:modifySubject,modifysubjectsyncinfo:modifySubjectSyncInfo,msgbox:msgBoxAsync,msgboxasync:msgBoxAsync,newcurrentpageonclose:newCurrentPageOnClose,notifyaddchannel:notifyAddChannel,notifycancelallmessagenotifications:notifyCancelAllMessageNotifications,notifycancelall:notifyCancelAllMessageNotifications,notifycancelmessagenotification:notifyCancelMessageNotification,notifycancelmessage:notifyCancelMessageNotification,notifydeletemessage:notifyDeleteMessage,notifygetmessages:notifyGetMessages,notifygetunreadmessages:notifyGetUnreadMessages,notifygetunreadmessagecount:notifyGetUnreadMessageCount,notifygetunreadcount:notifyGetUnreadMessageCount,notifylistchannels:notifyListChannels,notifymessagereceived:notifyMessageReceived,notifyreceivemessagenotification:notifyReceiveMessageNotification,notifyreceivemessage:notifyReceiveMessageNotification,notifyremovechannel:notifyRemoveChannel,notifysendmessage:notifySendMessage,now:now,number:number,opensubject:openSubject,pageback:pageBack,pagehome:pageHome,pagenext:pageNext,poplist:popList,poppage:popPage,popsubject:popSubject,postNotification:defaultPostNotification,pushlist:pushList,pushpage:pushPage,pushsubject:pushSubject,querysummarydata:querySummaryData,querysummaryvalues:querySummaryValues,querysummaryvaluesnonunique:querySummaryValuesNonUnique,readsettings:readSettings,refreshcurrentpage:refreshCurrentPage,refreshhidden:refreshHidden,refreshquestion:refreshQuestion,refreshiscroll:refreshiScroll,replicate:replicate,replicatedialog:replicateDialog,replicatepage:replicatePage,revert:revert,right:right,savesettings:saveSettings,scan:scan,setans:setAns,setdata:setData,setdebugflag:setDebugFlag,setenvironment:setEnvironment,setfocus:setFocus,setgpsheartbeatoptions:setGpsHeartBeatOptions,setreturnpage:setReturnPage,enablelogging:enableLogging,disablelogging:disableLogging,setobjectvalue:setObjectValue,setpagetitlebartext:setPageTitleBarText,settitlebartext:setTitleBarText,setsubjectvalue:setSubjectValue,setsyncinfo:setSyncInfo,startgpsheartbeat:startGpsHeartBeat,startmonitoringregion:startMonitoringRegion,stopgpsheartbeat:stopGpsHeartBeat,stopmonitoringregion:stopMonitoringRegion,split:split,subjectcontext:subjectContext,substring:subString,summaryitem:getSummaryValue,summaryquery:summaryQuery,switchcss:switchCss,text:text,time:time,timediff:timeDiff,today:today,top:top,trim:trim,typeofobject:typeofObject,uploadlogs:uploadLogs,uppercase:upperCase,viewdocument:viewDocument,viewdocumentdirect:viewDocumentDirect,zumorequest:zumoRequest,zumocleartoken:zumoClearToken}}(window.jmfw,window.mCapture));(function(aU,au,aQ){var U,T,a0,w,O,j,W,aW,V,aY;function I(bk){var bm,bj,Q,bl,bn;bj=bk.attr("class");if(bj!==undefined&&bj!==null){Q=bj.split(" ");bn=Q.length;for(bl=0;bl<bn;bl+=1){bm=W[Q[bl]];if(bm!==undefined){return bm}}}return null}function h(br){var bX,bv,bP;function bo(){return br.question.attr("dataid")}function bG(b2){if(j!==undefined){return j[b2||bo()]}return undefined}function bY(b4,b5){var b3,b2;b3=bG(b5);if(b3!==undefined&&b3!==null){b2=b3[b4]}return b2}function bI(b3,b4){var b2;if(b3){try{b2=aU.tmpl(b3,b4||aQ.db.getCurrentSubject())}catch(b5){b2="Template exception: "+b5+"<BR>"+aU.tmplString(b3)}}return b2}function b1(b2){var b4,b3;b3=br.question.attr("templateid");if(b3===undefined||b3===null){b3=br.question.attr("dataid")}if(b3){b4=bY(b2||"template",b3)}if(!b4){b4=bY(b2||"template")}return b4}function bV(b2,b3){return bI(b1(b2||"template"),b3)}function bD(){aQ.db.deleteValue(bo(),bv)}function bk(b2){aQ.db.ensureValue(bo(),b2)}function bu(){return aQ.db.getValueArrayLength(bo())}function bU(b2,b3){b2=b2||"action";aQ.fl.execFormula(bY(b2),undefined,undefined,b3)}function bR(){return bY("actions")}function bx(){return bY("background")}function bt(b3){var b2;b2=bY("calcval");if(b2!==undefined&&b2!==null&&b2.constructor===Function){b2(b3)}else{b3(b2)}}function bB(b3){var b2;b2=bY("choices");if(b2){switch(b2.constructor){case Array:b3(b2);break;case Function:b2(b3);break;default:b3([]);break}}else{b3([])}}function bN(){var b2;b2=bY("columns");if(b2){switch(b2.constructor){case Array:break;case Function:b2=b2();break;default:b2=[];break}}else{b2=[]}return b2}function bj(b3){var b2;b2=bY("defval");if(b2&&b2.constructor===Function){b2=b2(b3)}else{b3(b2)}}function bw(b2){var b4,b3;b3=br.question.attr("templateid");if(b3===undefined){b3=br.question.attr("dataid")}if(b3){b4=bY("latch",b3)}if(b4===undefined||b4===null){b4=bY("latch")}b2=undefined;return b4}function bH(){return bY("mapcenterlocation")}function bE(){return bY("mapcenterpin")}function bA(){return bY("mapgeocodedelay")}function bL(){return bY("showmylocation")}function bJ(){return bY("mylocationpin")}function bF(){return br.page.attr("id")}function bS(){return br.page}function bq(){return br.question.attr("id")}function bZ(){return br.question}function bp(){return bY("rowHeight")}function bW(){return bv}function bC(){return bY("type")}function bM(b2,b5){var b3,b4;b4=false;b3=bG();if(b3!==undefined){b4=b3.stamps}return aQ.db.setValue(bo(),b2,bv,b4,b5)}function bQ(b5,b4,b3){var b2=aQ.db.getValue(bo(),bv);if(b2===undefined&&b4!==true){bj(function(b6){if(!b3&&b6!==undefined){bM(b6,function(){b5(b6,true)})}else{b5(b6,true)}})}else{b5(b2,false)}}function bn(){}function bm(b2){if(b2===undefined){return bX<=0}if(b2){if(bX>0){bX-=1;if(bX===0){br.question.trigger("questionReady")}}}else{bX+=1}}function bT(b3){function b2(){if(b3&&b3.constructor===Function){b3()}br.question.trigger("questionLoaded")}function b4(b5){br.question.unbind("questionReady",b4);b2();b5=undefined}if(bm()){b2()}else{br.question.bind("questionReady",b4)}}function bs(){}function by(){}function b0(b3){function b2(b4){br.question.unbind("questionLoaded",b2);b3();b4=undefined}if(b3&&b3.constructor===Function){br.question.bind("questionLoaded",b2)}bP.initialize();bP.load()}function bz(){}function bl(b2){bv=b2}function bO(b3,b4){var b2;b4=b4||"placeholder";b2=bY(b4);if(b2){b3.html(b2)}else{b3.empty()}}function Q(){}function bK(){var b2,b3;b2=bq()+"_ValueChanged";aQ.currentPage(bF());b3=aQ.fl[b2];if(b3!==undefined&&b3.constructor===Function){b3()}}bX=0;bP={};bP.applyTemplate=bV;bP.deleteValue=bD;bP.ensureAnswer=bk;bP.execAction=bU;bP.execTemplate=bI;bP.getActionList=bR;bP.getAnswerArrayLength=bu;bP.getBackground=bx;bP.getCalculatedValue=bt;bP.getChoices=bB;bP.getColumns=bN;bP.getDataId=bo;bP.getDefaultValue=bj;bP.getDesignData=bG;bP.getDesignValue=bY;bP.getLatch=bw;bP.getMapCenterLocationQuestionID=bH;bP.getGeoCodeDelay=bA;bP.getMapCenterPinURL=bE;bP.getMapMyLocationPinURL=bJ;bP.getMapShowMyLocation=bL;bP.getPageId=bF;bP.getPageObject=bS;bP.getQuestionId=bq;bP.getQuestionObject=bZ;bP.getRowHeight=bp;bP.getRowIndex=bW;bP.getTemplate=b1;bP.getType=bC;bP.getValue=bQ;bP.initialize=bn;bP.load=bT;bP.postLoad=bs;bP.postUnload=by;bP.ready=bm;bP.refresh=b0;bP.save=bz;bP.setRowIndex=bl;bP.setValue=bM;bP.showPlaceholder=bO;bP.unload=Q;bP.valueChanged=bK;return bP}function K(bj,Q,bl){var bk;bk=bj.find("."+Q);if(bk.length===0){bk=aU(window.document.createElement("div"));bk.addClass("jmuiPage",Q);bk.addClass("md_popupPage");if(aU.isIE){bk.addClass("jmuiPageScroller")}bk.html(O[Q]);bj[0].appendChild(bk[0]);bk[0].id="md_popupPage_"+bl.getQuestionId();container=bk.find("div.md_popupQuestionContainer");if(container.length>0){containerDiv=container[0];containerDiv.id="md_popupQuestion_"+bl.getQuestionId();container.addClass(bl.getDesignValue("usercss"))}aU.ui.bindPage(bk)}return bk}function ar(Q){var bk;function bj(bl){Q.question[0].disabled=!bl}bk=h(Q);bk.enable=bj;return bk}function ba(Q){return j[Q]}function aw(bl,bj){var bk,bm,bn,bp,bo;function Q(br){var bq={x:parseFloat(br[1]),y:parseFloat(br[2])};return bq}if(bj&&bj.constructor===Array){bp=bj.length;if(bp>0){bk=bl[0].getContext("2d");for(bm=0;bm<bp;bm+=1){bo=bj[bm].split("|");if(bo.length===3){switch(bo[0]){case"moveTo":bn=Q(bo);break;case"lineTo":if(bn!==undefined){bk.beginPath();bk.moveTo(bn.x,bn.y);bn=Q(bo);bk.lineTo(bn.x,bn.y);bk.closePath();bk.stroke()}break}}}bk.closePath();bk.stroke()}}}function ag(bj){var Q=bj[0].getContext("2d");Q.clearRect(0,0,bj[0].width,bj[0].height)}function bb(bj){var bk,bl,Q;bl={x:0,y:0};if(bj.offsetX!==undefined){bl.x=bj.offsetX;bl.y=bj.offsetY}else{bk=aU(bj.target).offset();bl.x=bj.pageX-bk.left;bl.y=bj.pageY-bk.top;Q=aU(aU.ui.parentPage(bj.target)).find(".jmuiScroller > div");if(Q.length){if(Q[0].jmuiScroller.x){bl.x+=Q[0].jmuiScroller.x}if(Q[0].jmuiScroller.y){bl.y-=Q[0].jmuiScroller.y}}}return bl}function at(bj,bo){var bk,bl,bq,Q,bm;function bn(br){function bs(bt){if(bt!==true){bq=aU(window.document.createElement("li"));bq.addClass("jmuiArrow");bq.attr("actionIndex",bl);if(bk[bl].template){bq.html(bj.execTemplate(bk[bl].template))}else{if(bk[bl].text){bq.text(bk[bl].text)}}bo[0].appendChild(bq[0])}}aQ.fl.execFormula(bk[br].hideFormula,bs,bs,true)}function bp(bt){var bs;function bu(bv){log.debug("Success executing "+bk[bs.attr("actionIndex")].formulaName);bo.find("li.jmuiSelected").removeClass("jmuiSelected");bv=undefined}function br(bv){log.error("Error executing "+bk[bs.attr("actionIndex")].formulaName);alert(bv);bo.find("li.jmuiSelected").removeClass("jmuiSelected")}if(bt.jmuiTarget){aU(bt.jmuiTarget).addClass("jmuiSelected")}bs=aU(this);log.debug("Action list item hit. After 100ms will execute "+bk[bs.attr("actionIndex")].formulaName);setTimeout(function(){log.debug("Inside timer will now execute "+bk[bs.attr("actionIndex")].formulaName);aQ.fl.execFormula(bk[bs.attr("actionIndex")].formulaName,bu,br,true)},100)}Q=bj.getQuestionObject();bk=bj.getActionList();bo.find("li").remove();bm=aU(aU.ui.parentPage(bo[0]));for(bl=0;bl<bk.length;bl+=1){bn(bl)}aU.ui.generateTaps(bo.find("li").bind(aU.ui.tapEvent,bp))}function aB(Q){var bk,bm,bl,bj;bm=Q.getPageObject();bk=K(aU(aU.ui.parentColumn(bm[0])),"editActionListPage",Q);bl=Q.getQuestionObject();aU.ui.generateTaps(bl);bj=bk.find("ul");bl.bind(aU.ui.tapEvent,function(){function bn(){bk.find(".jmuiBackButton").unbind(aU.ui.tapEvent,bn);aU.ui.gotoPage(bm,"jmuiSlide",true,true)}if(!bl.attr("disabled")){bk.find("h2").text(bl.find("h3").text());bk.find(".jmuiBackButton").bind(aU.ui.tapEvent,bn);at(Q,bj);aU.ui.gotoPage(bk,"jmuiSlide",false,true)}})}function ay(){}function b(Q){j=Q}function aX(Q){var bk;function bj(bl){Q.question.find("*").each(function(){this.disabled=!bl})}bk=h(Q);bk.enable=bj;return bk}function x(Q){var bj;if(Q){switch(Q.constructor){case Object:case Array:case window.NodeList:bj=Q[0].id;break;case String:if(Q[0]==="#"){bj=Q.slice(1)}else{bj=Q}break}}return bj}function am(bj){var Q,bk;Q=false;bk=aU("#md_"+bj+"_container");if(bk&&bk.length){Q=(bk.style("display")==="none")}return Q}function aH(bj){var Q;if(bj){switch(bj.constructor){case Object:case Array:case window.NodeList:Q=bj;break;case String:if(bj[0]!=="#"){bj="#"+bj}Q=aU(bj);break}}return Q}function ae(){delete window.loadMapsCompleteCallback;aY.resolve()}function L(){if(!aY){var bk=document.getElementsByTagName("head")[0],Q=document.createElement("script"),bj=au.defer();Q.src=aQ.mapApi+"&callback=loadMapsCompleteCallback"+(aQ.mapKey?"&"+aQ.mapKey:"");Q.type="text/javascript";Q.onerror=function(){bj.reject()};window.loadMapsCompleteCallback=ae;aY=bj;bk.appendChild(Q)}return aY.promise}function a6(by,bG,bv,bx){var bl,bw,bF,bE,bA,bk,bt,bH,bo,bC,bu,bq,bB,bm,br,bs;function bn(bL){var bK,bJ,bI;bI=bL.split(",");if(bI.length===2){bK=parseFloat(bI[0].trim());bJ=parseFloat(bI[1].trim());return new window.google.maps.LatLng(bK,bJ)}return undefined}function bp(bI,bJ,bK){if(bI.location&&bI.location.length>0){bK(bn(bI.location))}else{log.debug("Geocode '"+bI.address+"'...");bJ.geocode(bI,function(bM,bL){if(bL===window.google.maps.GeocoderStatus.OK){var bN=bM[0].geometry.location;log.debug("Geocode '"+bI.address+"'... Done - "+bN);bK(bN)}else{if(bL===window.google.maps.GeocoderStatus.OVER_QUERY_LIMIT){log.error("Geocode of  '"+bI.address+"'  was not successful for the following reason: "+bL+" - will retry");alert("Geocode of  '"+bI.address+"'  was not successful for the following reason: "+bL+" - will retry");setTimeout(function(){bp(bI,bJ,bK)},250)}else{log.error("Geocode of  '"+bI.address+"' was not successful for the following reason: "+bL);alert("Geocode of  '"+bI.address+"' was not successful for the following reason: "+bL);bK(null)}}})}}function bj(bI,bL,bM,bN,bK){var bJ=new window.google.maps.Marker({position:bI,icon:bM});window.google.maps.event.addListener(bJ,"click",function(){var bO;bO=aU(document.createElement("div"));bO.addClass("bubble-background");bO.html(bL);bO.bind("click",function(bQ){var bR,bP;bx.close();if(bN==="_RowTap"){bq.attr("rowIndex",bK)}bP=by.getQuestionId()+bN;aQ.currentPage(by.getPageId());bR=aQ.fl[bP];if(bR!==undefined&&bR.constructor===Function){if(bN==="_RowTap"){aQ.showActivity();bR(function(bS){aQ.hideActivity();if(bN==="_RowTap"&&bS&&typeof bS==="string"){aU.ui.gotoPage(aU("#"+bS),"jmuiSlide")}})}else{bR()}}bQ=undefined});bx.setContent(bO[0]);bx.open(bG,this)});by.addMarker(bJ);return bJ}function Q(bJ,bK,bL,bI){return function(bN){var bM=bj(bN,bJ,bK,bL,bI);bM.setMap(bG)}}function bD(bM,bJ,bI,bL){if((bJ!==undefined)&&(bJ.length>0)){var bK={};bK.address=aQ.db.getValue(bJ);bp(bK,bv,function(bP){var bO,bN;bM.panTo(bP);bO=by.applyTemplate("mapCenterTemplate");bN=bj(bP,bO,bI,"_CenterTap");bN.setMap(bM)})}else{if(bL!==undefined){bM.panTo(bL)}}}function bz(bM,bK,bJ,bO,bI){if(bK<bM.length){if(bM[bK]&&bM[bK].constructor===Array){bt={};bB=undefined;for(bE=0;bE<bM[bK].length&&bE<bJ.length;bE+=1){if(bJ[bE].type==="pin"){if(bM[bK][bE].length>0){bB=new window.google.maps.MarkerImage(bM[bK][bE])}}if(bJ[bE].location==="address"){bt.address=bM[bK][bE]}else{if(bJ[bE].location==="position"){bt.location=bM[bK][bE]}}}br=aQ.db.getCurrentSubject();br._mapRowIndex=bK;br._columns=bJ;br._answer=bM;bw=by.applyTemplate("bubbleTemplate");delete br._mapRowIndex;delete br._columns;delete br._answer;if(!bw){var bL={};for(bE=0;bE<bJ.length;bE+=1){bL[bJ[bE].id]=bM[bK][bE]}bw=by.applyTemplate("rowTemplate",bL)}br=undefined;try{bp(bt,bO,Q(bw,bB,"_RowTap",bK))}catch(bN){alert("Error:"+bN)}}bK++;setTimeout(function(){bz(bM,bK,bJ,bO,bI)},bI)}}window.google.maps.event.trigger(bG,"resize");bl=by.getColumns();if(bl){bm=by.getRowHeight();bq=aU(aU.ui.parentPage(bG.getDiv()));bq.removeAttr("rowIndex");by.setRowIndex(null);bs=by.getGeoCodeDelay();if(!bs){bs=150}by.getValue(function(bI){if(bI&&bI.constructor===Array){setTimeout(function(){bz(bI,0,bl,bv,bs)},bs)}});bH=aQ.fl.getcurrentlocation(["lat","long"]);if(bH!==undefined){bC=new window.google.maps.LatLng(bH.latitude,bH.longitude)}bA=by.getMapCenterLocationQuestionID();bk=by.getMapCenterPinURL();bD(bG,bA,bk,bC);if(by.getMapShowMyLocation()){bo=by.getMapMyLocationPinURL();bw=by.applyTemplate("myLocactionTemplate");bu=bj(bC,bw,bo,"_MyLocTap");bu.setMap(bG)}aU.ui.refreshScroller(bq)}}function aj(Q,bj){var bk,bm;function bl(bq){var bp,bo,br;function bs(bt){if(!Q.getLatch()){bo.removeClass("jmuiSelected");Q.save()}if(bt){alert(bt)}}if(!aU.ui.defaultPrevented(bq)){bo=aU(this);if(Q.getLatch()){bo.toggleClass("jmuiSelected")}else{bo.parent().find(".jmuiSelected").removeClass("jmuiSelected");bo.addClass("jmuiSelected")}Q.save();bp=Q.getQuestionId()+"_RowTap";if(aQ.fl[bp]&&aQ.fl[bp].constructor===Function){if(Q.getDesignValue("xmlName")){br=bo[0].mdcRow}else{br=bo.attr("rowGuid")}aQ.fl.execFormula(bp,bs,bs,true,br)}else{bs()}}}function bn(bC){var bD,bB,bv,bt,bw,bz,bo,bq,by,bp,bE,bx,bA;function bs(bH){var bF,bG;if(!Q.busy){Q.busy=true;aQ.showActivity();function bI(bJ){if(bH.nodeName==="TD"){bx=bH;while(bx.nodeName!=="TBODY"){bx=bx.parentElement}if(bx){bx=aU(bx);if(bz){bx.empty()}else{bx.find("tr:last-of-type").remove()}}}else{bF=bH;while(bF.nodeName!=="LI"){bF=bF.parentElement}if(bF){bF=aU(bF);if(bz){bG=bF.parent();bG.find("li:not(.searchBar)").remove()}else{bF.remove()}}}bt(bJ);aQ.hideActivity()}if(bA){aQ.db.queryXmlSummaries(bo,bA,bp,bB,bw,bm,bI)}else{aQ.db.querySummaries(bo,bp,bB,bv,by,bw,bm,bI)}}}function bu(){bs(this)}function br(){bm-=bw*2;if(bm<0){bm=0}bs(this)}bt=function(bL){var bJ,bH,bG,bF,bI,bM,bK;bH=Q.applyTemplate("tableTemplate");if(bH){if(!bE||!bE.length){bF=aU(window.document.createElement("li"));bF.html(bH);bE=bF.find("table");if(bE&&bE.length){bx=bE.find("tbody");if(bx.length===0){bx=aU(document.createElement("tbody"));bE[0].appendChild(bx[0])}}}if(bE&&bE.length){bJ=aU(document.createElement("tbody"));for(bG=0;bG<bL.length;bG+=1){bH=Q.applyTemplate("rowTemplate",bL[bG]);bJ.html(bH);bK=bJ.find("tr").item(0);if(bK&&bK.length){if(bC&&bC.length&&bC.indexOf(bL[bG].guid)>=0){bK.addClass("jmuiSelected")}bK.attr("rowIndex",bG+bm);bK.attr("rowGuid",bL[bG].guid);bK[0].mdcRow=bL[bG];if(aU.isAndroid){bK.bind("click",bl)}else{aU.ui.generateTaps(bK.bind(aU.ui.tapEvent,bl))}bx[0].appendChild(bK[0])}}if(bz){bM=Q.applyTemplate("prevBatchRowTemplate")||"";bI=Q.applyTemplate("nextBatchRowTemplate")||"";bK=aU(window.document.createElement("tr"));bK.html(bM+bI);if(bM&&bm>0){aU.ui.generateTaps(bK.find("td:first-of-type")).bind(aU.ui.tapEvent,br)}if(bI&&bL.length===bw){aU.ui.generateTaps(bK.find("td:last-of-type")).bind(aU.ui.tapEvent,bu)}bx[0].appendChild(bK[0])}else{if(bL.length===bw){bH=Q.applyTemplate("nextBatchRowTemplate");bK=aU(document.createElement("tr"));bK.html(bH);aU.ui.generateTaps(bK.find("td").item(0)).bind(aU.ui.tapEvent,bu);bx[0].appendChild(bK[0])}}bm+=bw}if(bF&&bF.length){bj[0].appendChild(bF[0])}}else{for(bG=0;bG<bL.length;bG+=1){bF=aU(window.document.createElement("li"));bF.addClass("jmuiArrow");if(bC&&bC.length&&bC.indexOf(bL[bG].guid)>=0){bF.addClass("jmuiSelected")}bF.attr("rowIndex",bG+bm);bF.attr("rowGuid",bL[bG].guid);bF[0].mdcRow=bL[bG];bF.text(bL[bG][bp[0]]);bj[0].appendChild(bF[0]);if(aU.isAndroid){bF.bind("click",bl)}else{aU.ui.generateTaps(bF.bind(aU.ui.tapEvent,bl))}}if(bz){bM=aU(window.document.createElement("DIV"));bM.style(aU.isIE?"-ms-flex":"-webkit-box-flex",1);if(bm>0){bM.text("Previous "+bw);aU.ui.generateTaps(bM).bind(aU.ui.tapEvent,br)}bI=aU(window.document.createElement("DIV"));bM.style(aU.isIE?"-ms-flex":"-webkit-box-flex",1);bI.style("text-align","right");if(bL.length===bw){bI.text("Next "+bw);aU.ui.generateTaps(bI).bind(aU.ui.tapEvent,bu)}if(bM.text()||bI.text()){bF=aU(window.document.createElement("li"));bF.style("display",aU.isIE?"-ms-flexbox":"-webkit-box");bF.addClass("navBar");bF[0].appendChild(bM[0]);bF[0].appendChild(bI[0]);bj[0].appendChild(bF[0])}}else{if(bL.length===bw){bF=aU(window.document.createElement("li"));bF.text("Next "+bw);bj[0].appendChild(bF[0]);if(aU.isAndroid){bF.bind("click",bu)}else{aU.ui.generateTaps(bF.bind(aU.ui.tapEvent,bu))}}}bm+=bw}aU.ui.refreshScroller(Q.getPageObject());Q.busy=false};bw=Q.getDesignValue("batchSize");if(bw===undefined||bw===null||bw.constructor!==Number){bw=-1}bo=Q.getDesignValue("processId")||aQ.db.getCurrentProcess().id;bp=Q.getDesignValue("summaryNames")||["name"];bA=Q.getDesignValue("xmlName");bq=Q.getDesignValue("searchName")||bp[0];by=Q.getDesignValue("sort")||{column:bq,order:"ASC"};bD=Q.getDesignValue("comparison")||"contains";bB=[{condition:bD,summaryName:bq,value:bk.val()}];bv=!!Q.getDesignValue("distinct");bz=!!Q.getDesignValue("paginate");if(bA){aQ.db.queryXmlSummaries(bo,bA,bp,bB,bw,bm,bt)}else{aQ.db.querySummaries(bo,bp,bB,bv,by,bw,bm,bt)}}bj.find("li:not(.searchBar)").remove();bk=bj.find("input");if(bk.val().length){bm=0;Q.getValue(bn)}else{Q.busy=false}}function aZ(Q,bk){var bm,bp;function bn(){var bu,bs,br,bt;if(!Q.getQuestionObject().attr("disabled")){bt=aU(this);br=bt.attr("mdcRow");if(br!==null&&bt.hasClass("jmuiSelected")===false){bp.find(".jmuiSelected").removeClass("jmuiSelected");bt.addClass("jmuiSelected");bm.attr("rowIndex",br);bs=Q.getQuestionId()+"_RowTap";aQ.currentPage(Q.getPageId());bu=aQ.fl[bs];if(bu!==undefined&&bu.constructor===Function){aQ.showActivity();bu(function(bv){if(Q.getLatch()===false){bt.removeClass("jmuiSelected")}aQ.hideActivity();if(bv&&typeof bv==="string"){aU.ui.gotoPage(aU("#"+bv),"jmuiSlide")}})}else{if(Q.getLatch()===false){bt.removeClass("jmuiSelected")}}}}}function bo(bu,bt,bs){function br(bw){var bv;if(bw){bv="tbody > tr:nth-of-type("+(bu+1)+") > td:nth-of-type("+(bt+1)+") > img";bp.find(bv).attr("src",bw)}}aQ.att.getAttachment(aQ.db.getCurrentSubjectGuid(),bs,br)}function bl(){var br,bs;br=Q.applyTemplate();if(br){bk.html(br);bs=bk.find("table");if(!bs.length){bs=undefined}}return bs}function bj(by){var bu,bx,bt,br,bs,bw,bv;bs=Q.applyTemplate("tableTemplate");if(bs){bk.html("<li>"+bs+"</li>");bv=bk.find("table");if(bv&&by&&by.constructor===Array){bu=Q.getColumns();for(bt=0;bt<by.length;bt+=1){bx={};for(br=0;br<bu.length;br+=1){if(bu[br].id){bx[bu[br].id]=by[bt][br]}}bs=Q.applyTemplate("rowTemplate",bx);if(bs){bw=aU(window.document.createElement("tbody"));bw.html(bs);bw=bw.find("tr").item(0);bw.attr("mdcRow",bt);bv[0].appendChild(bw[0])}}}}return bv}function bq(bx){var bz,bt,bw,bv,bu,br,bs,by;bt=Q.getColumns();if(bt){bk.html("<li><table></table></li>");by=bk.find("table");br=Q.getRowHeight();bw="<thead>";bz=bk.attr("caption");if(bz){bw+="<caption>"+bz+"</caption>"}bw+="<tr>";for(bv=0;bv<bt.length;bv+=1){bw+="<th";if(bt[bv].align||bt[bv].width){bs=' style="';if(bt[bv].align){bs+="text-align:"+bt[bv].align+";"}if(bt[bv].width&&parseFloat(bt[bv].width)){bs+="width:"+bt[bv].width+";"}else{bs+="display:none;"}bs+='"';bw+=bs}bw+=">";if(bt[bv].title){bw+=bt[bv].title}bw+="</th>"}bw+="</tr></thead><tbody>";if(bx&&bx.constructor===Array){for(bv=0;bv<bx.length;bv+=1){if(bx[bv]&&bx[bv].constructor===Array){bw+="<tr";if(br){bw+=' style="height:'+br+";max-height:"+br+";min-height:"+br+';"'}bw+=' mdcRow="'+bv+'">';for(bu=0;bu<bx[bv].length&&bu<bt.length;bu+=1){bw+='<td mdcCol="'+bu+'" ';bs='style="';if(bt[bu].align){bs+="text-align:"+bt[bu].align+";"}if(!bt[bu].width||!parseFloat(bt[bu].width)){bs+="display:none;"}bs+='"';bw+=bs+">";if(bt[bu].type==="image"){bw+='<img src="'+bx[bv][bu]+'"';if(br){bw+=' style="max-height:'+br+';"'}bw+=">"}else{if(bt[bu].type==="imageAtt"){bw+="<img";if(br){bw+=' style="max-height:'+br+';"'}bw+=">";bo(bv,bu,bx[bv][bu])}else{bw+=bx[bv][bu]}}bw+="</td>"}bw+="</tr>"}}}bw+="</tbody>";by.html(bw)}return by}bm=aU(aU.ui.parentPage(bk[0]));bm.removeAttr("rowIndex");Q.setRowIndex(null);Q.getValue(function(br){bp=bl(br)||bj(br)||bq(br);aU.ui.refreshScroller(bm);bk.find("img").bind("load",function(){aU.ui.refreshScroller(bm)});aU.ui.generateTaps(bk.find("tr[mdcRow]").bind(aU.ui.tapEvent,bn))})}function aC(Q){var bj,bl,bk,bm;bl=aQ.db.getCurrentProcess();bj=0;for(bm in bl.pages[Q].qIdMap){bm=Q+bm.replace(" ","_");bk=aQ.q(Q,bm);if(bk){bj=Math.max(bj,bk.getAnswerArrayLength())}}if(bj>0){for(bm in bl.pages[Q].qIdMap){bm=Q+bm.replace(" ","_");bk=aQ.q(Q,bm);if(bk){bk.ensureAnswer(bj-1)}}}}function az(bk,bq){var bx,bw,bp,bt,bj,br,bo,bl,bv,Q,bn;function bs(bA){var bz;function bB(bC){aC(bj[0].id);if(bC===true){bj.find(".jmuiBackButton, .jmuiDeleteButton").unbind(aU.ui.tapEvent,bs);aU.ui.gotoPage(bn,"jmuiSlide",true)}}function by(bC){bC=undefined}if(!aU.ui.defaultPrevented(bA)){if(!bA.jmuiTarget||!aU(bA.jmuiTarget).hasClass("jmuiDeleteButton")){bz="action_"+bk.getQuestionObject().attr("editPageId")+"_Validate";if(aQ.fl[bz]&&aQ.fl[bz].constructor===Function){aQ.fl.execFormula(bz,bB,by,true)}else{bB(true)}}else{bB(true)}}}function bm(){var by;by=bw.push(bp||"")-1;bk.setValue(bw);if(bj.length>0){bj.attr("rowIndex",by);bj.find(".jmuiBackButton, .jmuiDeleteButton").bind(aU.ui.tapEvent,bs);aU.ui.gotoPage(bj,"jmuiSlide")}else{bk.load();bk.postLoad()}}function bu(bB){var bA,bz,by;function bC(bD){if(bD!==false&&!bk.getLatch()){if(bj.length>0){bj.attr("rowIndex",bz.attr("rowIndex"));bj.find(".jmuiBackButton, .jmuiDeleteButton").bind(aU.ui.tapEvent,bs);bj.find(".jmuiDeleteButton").show(bt?"block":"none");aU.ui.gotoPage(bj,"jmuiSlide")}}}if(!aU.ui.defaultPrevented(bB)){bz=aU(this);if(bk.getLatch()){bz.toggleClass("jmuiSelected")}else{bz.addClass("jmuiSelected")}bA=bk.getQuestionId()+"_RowTap";if(aQ.fl[bA]&&aQ.fl[bA].constructor===Function){by=bn.attr("rowIndex");bn.attr("rowIndex",bz.attr("rowIndex"));aQ.fl.execFormula(bA,bC,bC,true);if(by===null||by===undefined){bn.removeAttr("rowIndex")}else{bn.attr("rowIndex",by)}}else{bC()}}}Q=bk.getQuestionObject();bk.getValue(function(bz){var by;bw=bz||[];bj=aU("#"+Q.attr("editPageId"));bq.find("li").remove();br=Q.attr("glyph");bx=Q.attr("addrow");if(bx===""){bx="Add New Row..."}bt=Q.attr("delrow")!=="false";bn=aU(aU.ui.parentPage(bq[0]));bk.getDefaultValue(function(bD){var bB,bC;bp=bD;if(bp&&bp.constructor===Array){bp=bp[0]}bo=bk.applyTemplate("tableTemplate");if(bo){bv=aU(window.document.createElement("li"));bv.html(bo);bC=bv.find("table");if(bC&&bC.length){by=bC.find("tbody");if(by.length===0){by=aU(document.createElement("tbody"));bC[0].appendChild(by[0])}bB=aQ.db.getCurrentSubject();bo="";for(bl=0;bl<bw.length;bl+=1){bB._listIndex=bl;bo+=bk.applyTemplate("rowTemplate")}delete bB._listIndex;by.html(by.html()+bo);by.find("tbody tr").each(function(bE){var bF;bF=aU(this);bF.attr("rowIndex",bE);if(aU.isAndroid){bF.bind("click",bu)}else{aU.ui.generateTaps(bF.bind(aU.ui.tapEvent,bu))}})}bq[0].appendChild(bv[0])}else{for(bl=0;bl<bw.length;bl+=1){bv=aU(window.document.createElement("li"));bv.addClass("jmuiArrow");bv.attr("rowIndex",bl);bo="";if(br!==null){bo+='<div class="tagLabel">';if(bl<52){bo+=U[bl]}else{bo+=""}bo+="</div>"}bo+="<div>"+(bw[bl]||"&nbsp;")+"</div></li>";bv.html(bo);bq[0].appendChild(bv[0])}if(aU.isAndroid){bq.find("li").bind("click",bu)}else{aU.ui.generateTaps(bq.find("li").bind(aU.ui.tapEvent,bu))}}if(bx!==null){function bA(bE){if(!aU(bE.target).hasClass("clicked")){aU(bE.target).addClass("clicked");bm(bE)}}bv=aU(window.document.createElement("li"));bv.addClass("jmuiArrow","listAddRow");bv.text(bx);bq[0].appendChild(bv[0]);if(aU.isAndroid){bq.find("li:last-child").bind("click",bA)}else{aU.ui.generateTaps(bq.find("li:last-child").bind(aU.ui.tapEvent,bA))}}})},true)}function d(bk,bj){var bm,bp,bl,Q,bo;function bn(){var br;function bq(bu){var bt;function bv(bw){aC(br[0].id);if(bw===true){br.find(".jmuiBackButton, .jmuiDeleteButton").unbind(aU.ui.tapEvent,bq);aU.ui.gotoPage(bp,"jmuiSlide",true)}}function bs(bw){bw=undefined}if(!aU.ui.defaultPrevented(bu)){if(!bu.jmuiTarget||!aU(bu.jmuiTarget).hasClass("jmuiDeleteButton")){bt="action_"+bk.getQuestionObject().attr("editPageId")+"_Validate";if(aQ.fl[bt]&&aQ.fl[bt].constructor===Function){aQ.fl.execFormula(bt,bv,bs,true)}else{bv(true)}}else{bv(true)}}}br=aU("#"+bo.attr("editPageId"));if(br.length>0){br.attr("rowIndex",aU(this).attr("index"));br.find(".jmuiBackButton, .jmuiDeleteButton").bind(aU.ui.tapEvent,bq);aU.ui.gotoPage(br,"jmuiSlide")}}bk.getValue(function(bq){bq=bq||[];bo=bk.getQuestionObject();bp=aU(aU.ui.parentPage(bj[0]));Q=aU(bj[0].parentElement);Q.find(".pinLabel").remove();for(bm=0;bm<bq.length;bm+=1){bl=aU(window.document.createElement("div"));bl.addClass("pinLabel");bl.style("position","absolute");bl.style("left",bq[bm].x+"%");bl.style("top",bq[bm].y+"%");bl.style("z-index",1);bl.attr("pc",bq[bm].x+","+bq[bm].y);bl.attr("index",bm);if(bm<52){bl.text(U[bm])}Q[0].appendChild(bl[0]);aU.ui.generateTaps(bl.bind(aU.ui.tapEvent,bn))}})}function bc(bm,bp,br){var bo,bq,bs,Q,bu;function bk(){var bw;Q="restricted";if(aQ.unrestricted){Q="preparing";bo=new window.Media(bw,bu,bs,bq);Q=bw?"idle":"empty"}}function bv(){bo.play();Q="playing"}function bn(){bo.stop();Q="idle"}function bj(){bo.startAudioRecord();Q="recording"}function bt(){bo.stopAudioRecord();Q="idle";if(br&&br.constructor===Function){br()}}function bl(){if(!bo){bk()}switch(Q){case"restricted":alert("Not available in Restricted Client");break;case"preparing":alert("Not ready!");break;case"empty":bp.addClass("jmuiSelected");bj();break;case"idle":bp.addClass("jmuiSelected");bv();break;case"recording":bp.removeClass("jmuiSelected");bt();bp.html("&#x25b8;");break;case"playing":bp.removeClass("jmuiSelected");bn();break;default:bp.removeClass("jmuiSelected");bp.html("&#x25CF;");alert(Q);break}}bu=function(){alert("Media success")};bs=function(){alert("Media error")};bq=function(){alert("Media downloaded")};if(bp.length>0){aU.ui.generateTaps(bp);bp.bind(aU.ui.tapEvent,bl);bp[0]._tapHandler=bl;bp.html("&#x25CF;")}bm=undefined}function aI(bl,Q,bm){var bo,bn,bk;function bj(bv){var bq,br,bw,bp,bt,bu;bw=function(bx){if(bn[0]){bo=bn}if(bk[0]){bo=bk}bo.empty();bo.hide();if(bl.getDesignValue("postScanShowResult")!=="false"){bo.show()}bo.text(bx);if(bm&&bm.constructor===Function){bm()}bt=bl.getDesignValue("postScanSuccessMessage");if(bt!==""){aQ.msgBox(function(by){bl.execAction("postScanAction",true)},"Scan Complete",bt,"OK")}else{bl.execAction("postScanAction",true)}};bq=function(bx){bt=bl.getDesignValue("postScanFailureMessage");if(bt===""){bt=bx}if(bt!==""&&bt!=="Error"){aQ.msgBox(function(by){return},"Scan Failed",bt,"OK")}};if(!aU.ui.defaultPrevented(bv)){aU.ui.cancelEvent(bv);try{if(window.cordova&&window.cordova.exec&&window.plugins&&window.plugins.barcodeScanner!==undefined){window.plugins.barcodeScanner.scan(bw,bq);return}else{log.debug("Scan error -> plugin is missing")}}catch(bs){log.debug("Scan error ->"+bs)}bu=prompt("Not available in this environment","please enter");if(bu!==null){bw(bu)}else{bq("")}}}bo=Q.find("div");bn=Q.find(".jmuiPlaceholder");bk=Q.find(".jmuiScanresult");aU.ui.generateTaps(Q);Q.bind(aU.ui.tapEvent,bj);Q._tapHandler=bj}function q(bj,bm,bk){var bn,bp;function bo(bt){var br;function bq(bv){bj.setValue(bv,function(){bk(bv)})}function bs(){bk()}function bu(bv){var bw;if(bv!==false){bw=bj.getQuestionId()+"_Calculate";aQ.fl.execFormula(bw,bq,bs,true)}else{bn.find(".jmuiBackButton").bind(aU.ui.tapEvent,bo)}}if(!aU.ui.defaultPrevented(bt)){bt.preventDefault();aQ.currentPage(bp);bn.find(".jmuiBackButton").unbind(aU.ui.tapEvent,bo);br=bj.getQuestionId()+"_Validate";aQ.fl.execFormula(br,bu,bu,true)}}function bl(bq){var br,bs;if(bq!==false){if(bn.length){bp=aQ.currentPage();br=aU("#"+bp);bs=br.attr("rowIndex");bn.find(".jmuiBackButton").bind(aU.ui.tapEvent,bo);if(bs){bn.attr("rowIndex",bs)}else{bn.removeAttr("rowIndex")}aU.ui.gotoPage(bn,"jmuiSlide",false,false)}}}function Q(br){var bq;if(!aU.ui.defaultPrevented(br)){aU.ui.cancelEvent(br);bq=bj.getQuestionId()+"_IsEditable";aQ.fl.execFormula(bq,bl,bl,true)}}aU.ui.generateTaps(bm);bm.bind(aU.ui.tapEvent,Q);bm._tapHandler=Q;bn=aU("#"+bm.attr("editPageId"))}function t(bk,bn){var bl,bo;function bm(bq){var bs,br;function bp(bv){var bu;function bw(bx){aC(bl[0].id);if(bx===true){bl.find(".jmuiBackButton, .jmuiDeleteButton").unbind(aU.ui.tapEvent,bp);aU.ui.gotoPage(bo,"jmuiSlide",true)}}function bt(bx){bx=undefined}if(!aU.ui.defaultPrevented(bv)){if(!bv.jmuiTarget||!aU(bv.jmuiTarget).hasClass("jmuiDeleteButton")){bu="action_"+bk.getQuestionObject().attr("editPageId")+"_Validate";if(aQ.fl[bu]&&aQ.fl[bu].constructor===Function){aQ.fl.execFormula(bu,bw,bt,true)}else{bw(true)}}else{bw(true)}}}bk.getValue(function(bt){bt=bt||[];bs=bb(bq);bs.x=bs.x/bn.width()*100;bs.y=bs.y/bn.height()*100;br=bt.push(bs)-1;bk.setValue(bt);if(bl.length>0){bl.attr("rowIndex",br);bl.find(".jmuiBackButton, .jmuiDeleteButton").bind(aU.ui.tapEvent,bp);aU.ui.gotoPage(bl,"jmuiSlide")}else{bk.load();bk.postLoad()}})}function bj(){function bp(){var bq,br,bu,bs,bt;bs=function(bx){var bz,bv;function by(bB){function bA(){log.debug("ATT: generating thumbnail ->"+bB);aQ.att.getThumbnail(bB,bC)}function bC(bD){log.debug("ATT: got thumbnail dataUri <-"+bB);bn.attr("src",bD)}log.debug("ATT: set attachment for subject: "+bz+" attachment : "+bv);aQ.att.setAttachment(bz,bv,"",true,bA)}function bw(bA){log.error("ATT: The file was not moved: "+JSON.stringify(bA))}bz=aQ.db.getCurrentSubjectGuid();bv=bk.getPageId();log.debug("ATT: move temp file for subject: "+bz+" attachment : "+bv);aQ.fs.moveTemporaryFile(bx,bz,bv,by,bw)};bt=function(bv){bv="data:image/jpeg;base64,"+bv;aQ.db.setAttachment(aQ.db.getCurrentSubjectGuid(),bk.getPageId(),bv,true);bn.attr("src",bv)};bq=function(bv){if(bv.toLowerCase().indexOf("cancelled")===-1){log.warn("Camera failed: "+bv)}};if(navigator.hasOwnProperty("camera")){br={quality:20,sourceType:navigator.camera.PictureSourceType.CAMERA,allowEdit:true};if(aQ.fs.availableForAtts){br.destinationType=navigator.camera.DestinationType.FILE_URI;bu=bs}else{br.destinationType=navigator.camera.DestinationType.DATA_URL;bu=bt}navigator.camera.getPicture(bu,bq,br)}else{alert("Not available in Restricted Client")}}if(bk.getDesignValue("canRetakeImage")!==false){bp()}}function Q(bp){if(bp){bn.attr("src",bp)}}aQ.att.getAttachment(aQ.db.getCurrentSubjectGuid(),bk.getPageId(),Q);bl=aU("#"+bk.getQuestionObject().attr("editPageId"));bo=aU(aU.ui.parentPage(bn[0]));aU.ui.generateTaps(bn);bn.bind(aU.ui.tapEvent,bm);bn.bind(aU.ui.tapAndHoldEvent,bj)}function aG(bl,bj,bo,bn){var Q;function bm(){if(Q){Q.scrolling=false}aQ.msgBox(function(bp){if(bp==="Yes"){bl.showPlaceholder(bj);if(bn&&bn.constructor===Function){bn()}}},"Confirm","Clear?","Yes","No")}function bk(br){var bp,bx,bv,bu,bw;bu=function(by){log.debug("ATT: success file...");function bz(bB){function bC(bF){var bE;log.debug("ATT: Showing thumb...");bj.empty();bE=document.createElement("img");bE.setAttribute("width","100%");bE.setAttribute("src",bF);bj[0].appendChild(bE);aQ.fl.refreshiscroll(1500)}function bD(bE){log.debug("ATT: generating thumbnail ->"+bE);aQ.att.getThumbnail(bE,bC)}function bA(bE){log.error("ATT: The file was not moved: "+JSON.stringify(bE))}subject_guid=aQ.db.getCurrentSubjectGuid();log.debug("ATT: move temp file for subject: "+subject_guid+" attachment : "+bB);if(bx.sourceType===navigator.camera.PictureSourceType.CAMERA){aQ.fs.moveTemporaryFile(by,subject_guid,bB,bD,bA)}else{aQ.fs.copyTemporaryFile(by,subject_guid,bB,bD,bA)}}if(bo&&bo.constructor===Function){log.debug("ATT: Saving...");bo(bz)}else{log.error("ATT: cant save : "+bo)}};bw=function(by){bj.empty();bj.html('<img width="100%" src="data:image/jpeg;base64,'+by+'"/>');if(bo&&bo.constructor===Function){log.debug("ATT: Saving data...");bo()}else{log.error("ATT: cant save data: "+bo)}};bp=function(by){if(by.toLowerCase().indexOf("cancelled")===-1){log.warn("Camera failed: "+by)}};if(!aU.ui.defaultPrevented(br)){aU.ui.cancelEvent(br);if(navigator.hasOwnProperty("camera")){var bt={};var bs=bl.getDesignValue("extraPhotoOptions");if(bs.length>0){bt=JSON.parse(bs)}bx={quality:bl.getDesignValue("quality")||20,allowEdit:true,sourceType:navigator.camera.PictureSourceType.CAMERA};for(var bq in bt){bx[bq]=bt[bq]}if(aQ.fs.availableForAtts){bx.destinationType=navigator.camera.DestinationType.FILE_URI;bv=bu}else{bx.destinationType=navigator.camera.DestinationType.DATA_URL;bv=bw}navigator.camera.getPicture(bv,bp,bx)}else{setTimeout(function(){bw("/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcU FhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgo KCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCABQAFADASIA AhEBAxEB/8QAHAAAAgMBAQEBAAAAAAAAAAAABwgABAYFCQMB/8QAPxAAAgEDAwICBQcKBgMAAAAA AQIDBAURAAYSByETMRUiNVRzCBQWcZOy0SMyN0FRVpGUldIXU2F1s9MkYoH/xAAUAQEAAAAAAAAA AAAAAAAAAAAA/8QAFBEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEQMRAD8AL6UFY6KyUlQysMgi MkEfw186umno6WaqrIZIKaBGklllUqkaKMlmJ7AAAkk6Ilp9lUfwU+6NWtAC/prtX95rJ/Pxf3an 012r+81k/n4v7ta/qL0f2lvWzV9O9robbdKhzOtzpKVEnWY5PNyADICSeSse+c5DYYIt1F2fcdi7 ur7FdI5Q0DkwTOnEVMOSElUAkYYDyycHKnuDoHl9HV3udT9k34ano6u9zqfsm/DQ++S91kqt1Y2l umXxbvTwl6OukkHKrjXGUfJy0qjvkZLKrFu6lmYrQDb0dXe51P2TfhriXu92qw1SUt8udDbal0Ei xVlQkLshJAYBiDjIIz/odGTU0AL+mu1f3msn8/F/dr6U+79tVNRFBTbhs808rBI4462JmdicAABs kk/q0IPlkbPt1h3dar7bI4qdr2kxqYY04hpoypaXOcZcSLkADupY5LHTYW/btn2vtaptu3rdTW+i SFj4cCBeTBAvJj5sxCjLMSTjuToOrafZVH8FPujVrVW0+yqP4KfdGrWgmk7+Vpap791z2xaKN4kq bhb6WkiaUkIryVMygsQCcZIzgHTVXzcMFrFSiUtZXVkKJJ82pkAZw7EDi8hWPIwSQXBAx29Zcqv1 9u8z/KR2bWx08AFMKBqcS1BRZAtU7ZkbifD9YsOwfAAbzPEAA7pb7xtLcktHXxVNsvVumBIDFJIZ FIZWVgfqZWU4IwQcYOvQTo71Et3UbaNPcKWaIXSBEjuNKo4mCbHfCkk+GxBKnJyO2eQYBf8A5SEd n3xJSXGnmam3NbqPwpYKemqauGqBw6xpOqBBxLSYbj3LYbjjsEOmG9a7p/vKiv8Ab08bwcxz0xkZ FqImGGRiP/hGQQGVTg4xoPSnU0LennVGs3lQ0dzjtNrjtUuVmeC6vNPA4XPBojToOQOAfWHY8gWG M66zbvpK4ILhSVlmmd+Ecdw8P1/WRVw8bvGCzSKqqWDMQcKQM6ASfKP/AEp9F/8Aej/z0mjrdvZV Z8F/unQK+Uf+lPov/vR/56TR1u3sqs+C/wB06CWn2VR/BT7o1a0LL51k21tO5UtkuMVxmmhhg+dT 00KvHSB1Q5kHIPgCSM5VSDyAGWBUfep6h7c3dQ0w2duqmjusVXmCN+UbyMqEsGp34NLEVJB/V+tW VlDKAyodxXe37gvNNSzQPSC+13KGaLlxQVs5fgVKkM3LzbkBxGF88jLqfcJLx1v2pLcaOOCHlSxh IpzJ4kXzp+5PFeJOT2GcftOt7vGkuqXy63ylho6CoqpvZi1HjUwlKkPKJBCjDkwViuDk+Ic5kygm 3zcKx+o+1KiqpCtbBFS8kx6krrMxynDm3AnsPV5/+uexA110Vt+eTCHbu5PDDFVMM1JwYDtlec3L B8+/fv5Dy0E+reyko5pr5YbNcbda8cqqGren4xOWABj8ORjxJb83Hq/q7HCnD6SW/wDyrt/SKv8A 6tT6SW//ACrt/SKv/q0C/dJepVfsG5spD1dkqGzU0nLyPl4kefJwMf6MBg+SlWTu0k18s3zuouCy Uyy+PSihLQrxJUxOXDEu6fnK6lVyQwUMqkLd1Y21S0d0a57doa6O1SrynWShngSnkLY7c0UBTkYA J75HYcRql053l9HZKm33KnguFjriolpKtvyCSclxKw4OewHcBSTgeZUaA0da7jPuLc3SoXnwqpJL hJG6PGvF1M1OpBGMEEDuPLTIbat7WjpnarbI/N6O0RU7NjHIpCFzjJ/Z+3Sw7ksE9v3B0ZeuuL1s ddfZvCjj8P5tHTith8IwcMsEaJkIVnfiMAYxjTVUtlodv7VqLbaopIqSOOd1WSZ5WLOWdyXclmJZ mOST56DlXbYm2t2UVqqL9aYairpoomhqkZoZ04glVEsZV+ILE8c4z3xnQb3z8nerZKqqsVfDdyQn GmrUEFSUVSXxOmI5JXbtykj8m7t2yWKtPsqj+Cn3Rq1oEFvNl3RseeG2VtVX2iUoixUtaAIJHYgu IGy8DBealn5Ljkc4ORrNXO+Vv01sFxvcav8AMWhw1Oo/LRxzHLKc8WJIYZUhSR2xr0aq6aCspZqW shinpp0aOWKVAySIwwVYHsQQSCDpCuqlw2TW9c6Y2CGjt+1qappoKupoEDQyBWHjTRx8CoABK4VW VuHL1ufcChZeo22rmo5V60MvEsY64eDxwcfnn1CT2OAxOPqONhof3noPcqu1Lc9p11m3TRvE7JPb pxSPPMZCDhSXgKJg9lePyYeYGRHUWGs21d4pZKaKkrliknSlvFCsT+ECVDNBUr4blhnAXn3Bx3XQ MJdL5YIHnoLrdLXGxXhNT1NRGCVYeTKx8iD5HzB0t3UTaL2G4S11rWSr21US/wDiXCGKQ02TyPgr MQVdl4sPVZvzTnBDAMn0a6j7yFmSjfZFDLZ6VIvCehRbaWVm9dkRvyUjsGMmF8Jcg9xyUa3u7t27 E3hZqraW66qttfpCHM0dbTy0vgFPX5eOV8H1WTswdkYrgFgcEFD6dbmuNz3X0ysFY0T0Nmvsb0hC YdRNURM6kjzHJSRkZ9Y9yMAegt29lVnwX+6dIhR7CuOw+tmyKeqlirbXWXaint1zp+8FbCZ4yHUg kZwRlcnGQQSpVi9929lVnwX+6dBLT7Ko/gp90ataGqV9YiKqVdQqqMACQgAfx1++ka73yp+1b8dB qbpsrat3r5a667asldWy48SoqaCKWR8AAZZlJOAAPqA1V/w42P8Aubtv+lwf264HpGu98qftW/HU 9I13vlT9q346DSUmwdnUdVDVUe09vwVMDrJFLFbYVeN1OQykLkEEAgjXbultobvQS0N1oqauopce JT1MSyxvggjKsCDggH6wNYD0jXe+VP2rfjqeka73yp+1b8dB0Lf0ystmuXzrbVRcrHFJK01TQ0c4 ekqSxU4aGVXRAOOB4YQgEgHsMLZ1atG49uX+r+kMPOKqq/ES4RtJFRzKSxiVSS3FgoYeGWLDiQAy Hnpg/SNd75U/at+Op6RrvfKn7Vvx0Co7F3Na7JuW2VN3o0u1HT14uHhDlAYZlPaaIlgFf1E9XPGT iokAIR0dqjv9q3JtipuFir4K6keBvXibJUmMMFYeaNxZSVYAjIyNDO17bsdor4q61Wa20NbFnw6i mpUikTIIOGUAjIJH1E67719Y6Mr1dQysMEGQkEfx0H//2Q== ")},100)}}}aU.ui.generateTaps(bj);bj.bind(aU.ui.tapEvent,bk);bj.bind(aU.ui.tapAndHoldEvent,bm);bj._tapHandler=bk;bj._tapAndHoldHandler=bm;Q=aU(aU.ui.parentPage(bj[0])).find(".jmuiScroller > div, .jmuiNativeScroller > div")[0].jmuiScroller}function aK(bm,bq,bk){var bA,bu,bl,bw,bn,bx,bp;function Q(bC,bF){var bB,bE,bD;bE=bm.offset();bB={x:bC-bE.left,y:bF-bE.top};if(bx){bB.y-=bx.y}bD={x:bm[0].width/bm.width(),y:bm[0].height/bm.height()};bB.x*=bD.x;bB.y*=bD.y;return bB}function by(){bp(false,true,true);aQ.msgBox(function(bB){if(bx){bx.enabled=true}if(bB==="Yes"){bq("erase");if(bk!==undefined){bk()}}},"Confirm","Clear?","Yes","No")}function br(bC){var bB;bB=Q(bC.pageX,bC.pageY);if(bB.x!==bn.x||bB.y!==bn.y){bu.beginPath();bu.moveTo(bn.x,bn.y);bu.lineTo(bB.x,bB.y);bu.closePath();bu.stroke();if(bq!==undefined){bq("lineTo|"+bB.x+"|"+bB.y)}bn=bB}}function bs(bB){bn=Q(bB.pageX,bB.pageY);if(bq!==undefined){bq("moveTo|"+bn.x+"|"+bn.y)}}function bz(){if(bl!==undefined){clearTimeout(bl);bl=undefined}}function bt(bB){return a0?window.event.targetTouches[0]:bB}function bo(bB){var bC;if(!aU.ui.defaultPrevented(bB)){aU.ui.cancelEvent(bB);bC=bt(bB);if(bC){console.log("touchEnd. pageX: "+bC.pageX+", pageY: "+bC.pageY)}else{console.log("touchEnd.")}bz();bp(false,true,true);if(bk!==undefined){bk()}if(bx){bx.enabled=true}return false}}function bv(bB){var bC;if(!aU.ui.defaultPrevented(bB)){aU.ui.cancelEvent(bB);bC=bt(bB);if(bC.pageX!==bw.pageX||bC.pageY!==bw.pageY){console.log("touchMove. pageX: "+bC.pageX+", pageY: "+bC.pageY);bw={pageX:bC.pageX,pageY:bC.pageY};bz();br(bC)}return false}}function bj(bB){var bC;if(!aU.ui.defaultPrevented(bB)){aU.ui.cancelEvent(bB);if(bx){bx.enabled=false}bC=bt(bB);bw={pageX:bC.pageX,pageY:bC.pageY};console.log("touchStart. pageX: "+bC.pageX+", pageY: "+bC.pageY);bs(bC);br({pageX:bC.pageX+1,pageY:bC.pageY+1});bA(false,true,true);bl=setTimeout(by,500);return false}}bA=function(bD,bC,bB){if(a0){if(bD){bm.bind("touchstart",bj);bm._touchStart=bj}if(bC){bm.bind("touchmove",bv)}if(bB){bm.bind("touchend",bo)}}else{if(bD){bm.bind("mousedown",bj);bm._touchStart=bj}if(bC){aU(window).bind("mousemove",bv)}if(bB){aU(window).bind("mouseup",bo)}}};bp=function(bD,bC,bB){if(a0){if(bD){bm.unbind("touchstart",bj);delete bm._touchStart}if(bC){bm.unbind("touchmove",bv)}if(bB){bm.unbind("touchend",bo)}}else{if(bD){bm.unbind("mousedown",bj);delete bm._touchStart}if(bC){aU(window).unbind("mousemove",bv)}if(bB){aU(window).unbind("mouseup",bo)}}};bu=bm[0].getContext("2d");bu.strokeStyle="rgba(0,0,0,0.7)";bu.lineWidth=2;bx=aU(aU.ui.parentPage(bm[0])).find(".jmuiScroller > div, .jmuiNativeScroller > div")[0].jmuiScroller;bA(true,false,false)}function Z(Q){var bj,bl,bk;bl=Q.getPageObject();bj=K(aU(aU.ui.parentColumn(bl[0])),"editAudioPage",Q);bk=Q.getQuestionObject();aU.ui.generateTaps(bk);bk.bind(aU.ui.tapEvent,function(){var bo,bn;function bm(bp){if(!aU.ui.defaultPrevented(bp)){bp.preventDefault();bn();aU.ui.refreshScroller(bl)}}bn=function(){bj.find(".jmuiCancelButton").unbind(aU.ui.tapEvent,bn);bj.find(".jmuiActionButton").unbind(aU.ui.tapEvent,bm);bo.unbind(aU.ui.tapEvent,bo._tapHandler);aU.ui.gotoPage(bl,"jmuiSlide",true,true)};if(!bk.attr("disabled")){bo=bj.find("div");bc(Q,bo);bj.find("h2").text(bk.find("h3").text());bj.find(".jmuiActionButton").bind(aU.ui.tapEvent,bm);bj.find(".jmuiCancelButton").bind(aU.ui.tapEvent,bn);aU.ui.gotoPage(bj,"jmuiSlide",false,true)}})}function ax(Q){var bj,bl,bk;bl=Q.getPageObject();bj=K(aU(aU.ui.parentColumn(bl[0])),"editBarcodePage",Q);bk=Q.getQuestionObject();aU.ui.generateTaps(bk);bk.bind(aU.ui.tapEvent,function(){var br,bp,bm,bq,bn;function bo(bt){var bs;if(!aU.ui.defaultPrevented(bt)){bt.preventDefault();bs=br.text()||"";Q.setValue(bs);if(Q.getDesignValue("postScanShowResult")!=="false"){bk.find("h4").text(bs)}Q.valueChanged();bp();aU.ui.refreshScroller(bl)}}bp=function(){bj.find(".jmuiCancelButton").unbind(aU.ui.tapEvent,bp);bj.find(".jmuiActionButton").unbind(aU.ui.tapEvent,bo);bm.unbind(aU.ui.tapEvent,bm._tapHandler);aU.ui.gotoPage(bl,"jmuiSlide",true,true)};if(!bk.attr("disabled")){bm=bj.find("li");bq=bm.find(".jmuiPlaceholder");bn=bm.find(".jmuiScanresult");br=bm.find("div");aI(Q,bm);bj.find("h2").text(bk.find("h3").text());Q.getValue(function(bs){bs=bs||"";if(bq[0]){br=bq}Q.showPlaceholder(br);if(bn[0]){br=bn}br.hide();if(Q.getDesignValue("postScanShowResult")!=="false"){br.show()}br.text(bs);bj.find(".jmuiActionButton").bind(aU.ui.tapEvent,bo);bj.find(".jmuiCancelButton").bind(aU.ui.tapEvent,bp);aU.ui.gotoPage(bj,"jmuiSlide",false,true)})}})}function aL(Q,bm){var bj,bl,bk;bl=Q.getPageObject();bj=K(aU(aU.ui.parentColumn(bl[0])),"editComboPage",Q);bk=Q.getQuestionObject();aU.ui.generateTaps(bk);bk.bind(aU.ui.tapEvent,function(){var bs,bp,br,bq,bn;function bo(bu){var bt;if(!aU.ui.defaultPrevented(bu)){bu.preventDefault();bt=bs.val();Q.setValue(bt);bk.find("h4").html(bt);Q.valueChanged();bp();aU.ui.refreshScroller(bl)}}bp=function(){bj.find(".jmuiCancelButton").unbind(aU.ui.tapEvent,bp);bj.find(".jmuiActionButton").unbind(aU.ui.tapEvent,bo);aU.ui.gotoPage(bl,"jmuiSlide",true,true)};if(!bk.attr("disabled")){bs=bj.find("input");bn=bj.find("select");br="";for(bq=0;bq<bm.length;bq+=1){br+='<option value="'+bm[bq].value+'">'+bm[bq].label+"</option>"}bn.empty();bn.html(br);bs.val("");bj.find("h2").text(bk.find("h3").text());Q.getValue(function(bt){bs.val(bt);bj.find(".jmuiActionButton").bind(aU.ui.tapEvent,bo);bj.find(".jmuiCancelButton").bind(aU.ui.tapEvent,bp);aU.ui.gotoPage(bj,"jmuiSlide",false,true);bj.trigger("jmuiPageAnimationStart",{direction:"in"})})}})}function P(Q){var bj,bl,bk;bl=Q.getPageObject();bj=K(aU(aU.ui.parentColumn(bl[0])),"editCompoundPage",Q);bk=Q.getQuestionObject();aU.ui.generateTaps(bk);bk.bind(aU.ui.tapEvent,function(){var bo;function bm(){Q.getValue(function(bq){var bp;if(bq===undefined||bq===null||bq===""){bp="unansweredTemplate"}else{bp="answeredTemplate"}bo.html(Q.applyTemplate(bp))},false)}function bn(){bj.find(".jmuiBackButton").unbind(aU.ui.tapEvent,bn);bo.unbind(aU.ui.tapEvent,bo._tapHandler);aU.ui.gotoPage(bl,"jmuiSlide",true,true)}if(!bk.attr("disabled")){bo=bj.find("ul");bo.attr("editPageId",bk.attr("editPageId"));q(Q,bo,function(bp){bm();bk.find("h4").text(bp&&bp.length?"<answered>":"");aU.ui.gotoPage(bj,"jmuiSlide",true,false)});bj.find("h2").text(bk.find("h3").text());bm();bj.find(".jmuiBackButton").bind(aU.ui.tapEvent,bn);aU.ui.gotoPage(bj,"jmuiSlide",false,true)}})}function y(Q){var bj,bl,bk;bl=Q.getPageObject();bj=K(aU(aU.ui.parentColumn(bl[0])),"editDatePage",Q);bk=Q.getQuestionObject();aU.ui.generateTaps(bk);bk.bind(aU.ui.tapEvent,function(){var bo,bn;function bm(bq){var bp;if(!aU.ui.defaultPrevented(bq)){bq.preventDefault();bp=new Date(bo.html()+" 12:00:00 UTC");if(isNaN(bp.getTime())){bp=null;bk.find("h4").html("")}else{bk.find("h4").html(bo.html())}Q.setValue(bp);Q.valueChanged();bn();aU.ui.refreshScroller(bl)}}bn=function(){bj.find(".jmuiCancelButton").unbind(aU.ui.tapEvent,bn);bj.find(".jmuiActionButton").unbind(aU.ui.tapEvent,bm);aU.ui.gotoPage(bl,"jmuiSlide",true,true)};if(!bk.attr("disabled")){bo=bj.find(".jmuiCompositeDate");bj.find("h2").text(bk.find("h3").text());Q.getValue(function(bp){if(bp&&bp.constructor===Date){bp=bp.toLocaleDateString()}else{bp="&nbsp;"}bo.html(bp);bj.find(".jmuiActionButton").bind(aU.ui.tapEvent,bm);bj.find(".jmuiCancelButton").bind(aU.ui.tapEvent,bn);aU.ui.gotoPage(bj,"jmuiSlide",false,true)})}})}function ak(bj){var Q,bl,bn,bm,bk;bn=bj.getPageObject();bl=K(aU(aU.ui.parentColumn(bn[0])),"editGridPage",bj);bm=bj.getQuestionObject();aU.ui.generateTaps(bm);bk=bl.find("ul");bm.bind(aU.ui.tapEvent,function(){function bo(bq){if(bq.direction==="in"){aZ(bj,bk)}}function bp(){bl.find(".jmuiBackButton").unbind(aU.ui.tapEvent,bp);bl.unbind("jmuiPageAnimationStart",bo);aU.ui.gotoPage(bn,"jmuiSlide",true,true);aU.ui.refreshScroller(bn)}if(!bm.attr("disabled")){Q=bm.find("h3").text();if(Q){bk.attr("caption",Q)}else{bk.removeAttr("caption")}bl.find(".jmuiBackButton").bind(aU.ui.tapEvent,bp);bl.bind("jmuiPageAnimationStart",bo);aU.ui.gotoPage(bl,"jmuiSlide",false,false)}})}function u(Q){var bj,bm,bl,bk;bl=Q.getPageObject();bj=K(aU(aU.ui.parentColumn(bl[0])),"editImagePage",Q);bm=bj.find("img");bk=Q.getQuestionObject();aU.ui.generateTaps(bk);bk.bind(aU.ui.tapEvent,function(){function bn(){bj.find(".jmuiBackButton").unbind(aU.ui.tapEvent,bn);aU.ui.gotoPage(bl,"jmuiSlide",true,true)}if(!bk.attr("disabled")){Q.getCalculatedValue(function(bo){function bp(br,bq){br=br||"";switch(Q.getType()){case"att":if(bq){bm.attr("src",br)}else{aQ.att.getAttachment(aQ.db.getCurrentSubjectGuid(),br,function(bs){bm.attr("src",bs)})}break;default:bm.attr("src",br);break}bj.find("h2").text(bk.find("h3").text());bj.find(".jmuiBackButton").bind(aU.ui.tapEvent,bn);aU.ui.gotoPage(bj,"jmuiSlide",false,true)}if(bo===undefined||bo===null){Q.getValue(bp,false,true)}else{bp(bo)}})}})}function S(Q){var bj,bm,bl,bk;bl=Q.getPageObject();bj=K(aU(aU.ui.parentColumn(bl[0])),"editImageMapPage",Q);bm=bj.find("img");t(Q,bm);bk=Q.getQuestionObject();aU.ui.generateTaps(bk);bk.bind(aU.ui.tapEvent,function(){var bo;function bn(bq){if(!aU.ui.defaultPrevented(bq)){bq.preventDefault();Q.getValue(function(br){bk.find("h4").text(br&&br.length?"<answered>":"");Q.valueChanged();bo();aU.ui.refreshScroller(bl)})}}function bp(bq){if(bq.direction==="in"){d(Q,bm)}}bo=function(){bj.find(".jmuiActionButton").unbind(aU.ui.tapEvent,bn);bj.unbind("jmuiPageAnimationEnd",bp);aU.ui.gotoPage(bl,"jmuiSlide",true,true)};if(!bk.attr("disabled")){bm.attr("src",bk.attr("img"));bj.find("h2").text(bk.find("h3").text());bj.find(".jmuiActionButton").bind(aU.ui.tapEvent,bn);bj.bind("jmuiPageAnimationEnd",bp);aU.ui.gotoPage(bj,"jmuiSlide",false,true);d(Q,bm)}})}function E(Q){var bk,bm,bl,bj;bm=Q.getPageObject();bk=K(aU(aU.ui.parentColumn(bm[0])),"editListPage",Q);bl=Q.getQuestionObject();aU.ui.generateTaps(bl);bj=bk.find("ul");bl.bind(aU.ui.tapEvent,function(){var bp;function bo(bq){if(!aU.ui.defaultPrevented(bq)){bq.preventDefault();Q.getValue(function(br){bl.find("h4").text(br&&br.length?"<answered>":"");Q.valueChanged();bp();aU.ui.refreshScroller(bm)})}}function bn(bq){if(bq.direction==="in"){az(Q,bj)}}bp=function(){bk.find(".jmuiActionButton").unbind(aU.ui.tapEvent,bo);bk.unbind("jmuiPageAnimationStart",bn);aU.ui.gotoPage(bm,"jmuiSlide",true,true)};if(!bl.attr("disabled")){bk.find("h2").text(bl.find("h3").text());bk.find(".jmuiActionButton").bind(aU.ui.tapEvent,bo);bk.bind("jmuiPageAnimationStart",bn);aU.ui.gotoPage(bk,"jmuiSlide",false,true);az(Q,bj)}})}function ab(Q){var bj,bl,bk;bl=Q.getPageObject();bj=K(aU(aU.ui.parentColumn(bl[0])),"editNumberPage",Q);bk=Q.getQuestionObject();aU.ui.generateTaps(bk);bk.bind(aU.ui.tapEvent,function(){var bo,bn;function bm(bq){var bp;if(!aU.ui.defaultPrevented(bq)){bq.preventDefault();bp=parseFloat(bo.val());if(!bp&&bp!==0){bp=null}Q.setValue(bp);bk.find("h4").html(bp);Q.valueChanged();bn();aU.ui.refreshScroller(bl)}}bn=function(){bj.find(".jmuiActionButton").unbind(aU.ui.tapEvent,bm);bj.find(".jmuiCancelButton").unbind(aU.ui.tapEvent,bn);aU.ui.gotoPage(bl,"jmuiSlide",true,true)};if(!bk.attr("disabled")){bo=bj.find("input");bj.find("h2").text(bk.find("h3").text());Q.getValue(function(bp){bo.val(bp);bj.find(".jmuiActionButton").bind(aU.ui.tapEvent,bm);bj.find(".jmuiCancelButton").bind(aU.ui.tapEvent,bn);aU.ui.gotoPage(bj,"jmuiSlide",false,true)})}})}function N(Q){var bj,bl,bk;bl=Q.getPageObject();bj=K(aU(aU.ui.parentColumn(bl[0])),"editNumberRangePage",Q);bk=Q.getQuestionObject();aU.ui.generateTaps(bk);bk.bind(aU.ui.tapEvent,function(){var bp,br,bo,bm,bq;function bn(bt){var bs;if(!aU.ui.defaultPrevented(bt)){bt.preventDefault();bs=parseFloat(bp.html());if(!bs&&bs!==0){bs=null}Q.setValue(bs);bk.find("h4").html(bs);Q.valueChanged();bo();aU.ui.refreshScroller(bl)}}bo=function(){bj.find(".jmuiActionButton").unbind(aU.ui.tapEvent,bn);bj.find(".jmuiCancelButton").unbind(aU.ui.tapEvent,bo);aU.ui.gotoPage(bl,"jmuiSlide",true,true)};if(!bk.attr("disabled")){bp=bj.find(".jmuiCompositeNumber");br=parseInt(bk.attr("min"),10);bq=parseInt(bk.attr("max"),10);bm=parseInt(bk.attr("increment"),10);bp.attr("min",br);bp.attr("max",bq);bp.attr("increment",bm);bj.find("h2").text(bk.find("h3").text());Q.getValue(function(bs){if(!bs&&bs!==0){bs="&nbsp;"}bp.html(bs);bj.find(".jmuiActionButton").bind(aU.ui.tapEvent,bn);bj.find(".jmuiCancelButton").bind(aU.ui.tapEvent,bo);aU.ui.gotoPage(bj,"jmuiSlide",false,true)})}})}function l(Q){var bk,bj,bm,bl;bm=Q.getPageObject();bj=K(aU(aU.ui.parentColumn(bm[0])),"editPhotoPage",Q);bl=Q.getQuestionObject();aU.ui.generateTaps(bl);bl.bind(aU.ui.tapEvent,function(){var bq,br,bp,bn;function bs(bu){bk="delete"}function bt(bu){bk="save";br=br||aQ.db.guid();bu(br)}function bo(bu){if(!aU.ui.defaultPrevented(bu)){if(bk){bu.preventDefault();if(bk==="delete"){if(bq){aQ.db.deleteAttachment(aQ.db.getCurrentSubjectGuid(),bq,function(bv){if(!bv){Q.deleteValue();bq=undefined;bl.find("h4").text("");Q.valueChanged();bp();aU.ui.refreshScroller(bm)}})}else{bp()}}else{aQ.att.setAttachment(aQ.db.getCurrentSubjectGuid(),br,bn.find("img").attr("src"),true,function(bv){if(!bv&&br){Q.setValue(br);bq=br;br=undefined;bl.find("h4").text("<answered>");Q.valueChanged();bp();aU.ui.refreshScroller(bm)}else{bp()}})}}else{bp()}}}bp=function(){function bu(){bk=undefined;bj.find(".jmuiCancelButton").unbind(aU.ui.tapEvent,bp);bj.find(".jmuiActionButton").unbind(aU.ui.tapEvent,bo);bn.unbind(aU.ui.tapEvent,bn._tapHandler);bn.unbind(aU.ui.tapAndHoldEvent,bn._tapAndHoldHandler);aU.ui.gotoPage(bm,"jmuiSlide",true,true)}if(br){aQ.db.deleteAttachment(aQ.db.getCurrentSubjectGuid(),br,function(bv){br=undefined;bu()})}else{bu()}};if(!bl.attr("disabled")){bn=bj.find("li");aG(Q,bn,bt,bs);bj.find("h2").text(bl.find("h3").text());Q.getValue(function(bu){bq=bu;if(bu){aQ.att.getAttachment(aQ.db.getCurrentSubjectGuid(),bu,function(bv){if(bv){bn.html('<img width="100%" src="'+bv+'"/>')}else{Q.showPlaceholder(bn)}bj.find(".jmuiActionButton").bind(aU.ui.tapEvent,bo);bj.find(".jmuiCancelButton").bind(aU.ui.tapEvent,bp);aU.ui.gotoPage(bj,"jmuiSlide",false,true)})}else{Q.showPlaceholder(bn);bj.find(".jmuiActionButton").bind(aU.ui.tapEvent,bo);bj.find(".jmuiCancelButton").bind(aU.ui.tapEvent,bp);aU.ui.gotoPage(bj,"jmuiSlide",false,true)}},true)}})}function aa(Q){var bk,bj,bm,bl,bn;bm=Q.getPageObject();bl=Q.getQuestionObject();aU.ui.generateTaps(bl);bj=aU(aU.ui.parentColumn(bm[0]));bn=bl.find("h3").text();bk=bm.find("h1").text();bl.bind(aU.ui.tapEvent,function(){if(!bl.attr("disabled")){Q.getValue(function(bo){function bp(br,bq){var bs;if(bq){bs=bq.value||undefined;if(bs===""){bs=undefined}if(bs!==undefined){bs=[bs]}Q.setValue(bs);if(bs!==undefined){bl.find("h4").html(bq.label)}else{bl.find("h4").html("")}Q.valueChanged()}aU.ui.gotoPage(bm,"jmuiSlide",true,true);br=undefined}if(bo&&bo.length){bo=bo[0]}Q.getChoices(function(bq){aU.ui.showListPage(bj,bq,bo,bn,bk,bp)})})}})}function aV(Q,bp,bj){var bk,bm,bl,bo,bn;bm=Q.getPageObject();bk=K(aU(aU.ui.parentColumn(bm[0])),bj,Q);bl=Q.getQuestionObject();bo=Q.getQuestionId();aU.ui.generateTaps(bl);bl.bind(aU.ui.tapEvent,function(){var bv,bs,bu,bt,br;function bq(bx){var bw;if(!aU.ui.defaultPrevented(bx)){bx.preventDefault();bw=[];bu="";bk.find("input").each(function(){if(this.checked===true){bw.push(this.value);if(bu.length>0){bu+=", "}bu+=this.nextElementSibling.innerHTML}});Q.setValue(bw);bl.find("h4").html(bu);Q.valueChanged();bs();aU.ui.refreshScroller(bm)}}bs=function(){bk.find(".jmuiActionButton").unbind(aU.ui.tapEvent,bq);bk.find(".jmuiCancelButton").unbind(aU.ui.tapEvent,bs);aU.ui.gotoPage(bm,"jmuiSlide",true,true)};if(!bl.attr("disabled")){Q.getValue(function(bw){bu="";for(bt=0;bt<bp.length;bt+=1){bn=bo+"_choice_"+bt;bu+='<li><input type="';bu+=bj==="editCheckboxPage"?"checkbox":"radio";bu+='" name="'+bo+'" value="'+bp[bt].value+'" id="'+bn+'"';if(bw&&bw.length){for(br=0;br<bw.length;br+=1){if(bw[br]===bp[bt].value){bu+=" checked=true"}}}bu+=' /><label for="'+bn+'">'+bp[bt].label+"</label></li>"}bv=bk.find("ul");bv.empty();bv.html(bu);if(bj==="editCheckboxPage"){aU.ui.bindCheckboxes(bv)}else{aU.ui.bindRadios(bv)}bk.find("h2").text(bl.find("h3").text());bk.find(".jmuiActionButton").bind(aU.ui.tapEvent,bq);bk.find(".jmuiCancelButton").bind(aU.ui.tapEvent,bs);aU.ui.gotoPage(bk,"jmuiSlide",false,true)})}})}function aJ(Q){var bj,bl,bk;bl=Q.getPageObject();bj=K(aU(aU.ui.parentColumn(bl[0])),"editSketchPage",Q);bk=Q.getQuestionObject();aU.ui.generateTaps(bk);bk.bind(aU.ui.tapEvent,function(){var bs,bn,bo=6,br=true;function bq(){if(Q.ready()){var bv=bs.jSignature("getData","base30");var bt=bs.jSignature("getData","image");var bu=bs.jSignature("getData","svgbase64");Q.setValue([JSON.stringify(bv),bt[1],bu[1]])}}function bm(bu){var bt;if(!aU.ui.defaultPrevented(bu)){bu.preventDefault();bq();Q.valueChanged();bn();aU.ui.refreshScroller(bl)}}function bp(bt){if(bt.direction==="in"){bj.find("div.jsig").empty();bs.jSignature({showLine:br,sizeRatio:(30/bo)});Q.getValue(function(bu){if(bu){bs.jSignature("setData","data:"+JSON.parse(bu[0]).join(","))}bj.unbind("jmuiPageAnimationStart",bp)})}}bn=function(){bj.find(".jmuiActionButton").unbind(aU.ui.tapEvent,bm);bj.find(".jmuiCancelButton").unbind(aU.ui.tapEvent,bn);aU.ui.gotoPage(bl,"jmuiSlide",true,true)};if(!bk.attr("disabled")){bj.find("h2").text(bk.find("h3").text());Q.getValue(function(bt){bs=jQuery(bj).find("div.jsig");bo=bs.attr("ratio")|bo;br=bk.attr("sketchtype")=="signature";bj.find(".jmuiActionButton").bind(aU.ui.tapEvent,bm);bj.find(".jmuiCancelButton").bind(aU.ui.tapEvent,bn);bj.bind("jmuiPageAnimationStart",bp);aU.ui.gotoPage(bj,"jmuiSlide",false,false)})}return false})}function aO(Q,bj){var bk,bm,bl;bm=Q.getPageObject();bk=K(aU(aU.ui.parentColumn(bm[0])),bj,Q,Q);bl=Q.getQuestionObject();aU.ui.generateTaps(bl);bl.bind(aU.ui.tapEvent,function(){var bp,bo;function bn(br){var bq;if(!aU.ui.defaultPrevented(br)){br.preventDefault();bq=bp.val();Q.setValue(bq);if(bj==="editPasswordPage"){bl.find("h4").html(bq.length?w:"")}else{bl.find("h4").html(bq)}Q.valueChanged();bo();aU.ui.refreshScroller(bm)}}bo=function(){bk.find(".jmuiActionButton").unbind(aU.ui.tapEvent,bn);bk.find(".jmuiCancelButton").unbind(aU.ui.tapEvent,bo);aU.ui.gotoPage(bm,"jmuiSlide",true,true)};if(!bl.attr("disabled")){bp=bk.find("input, textarea");bk.find("h2").text(bl.find("h3").text());Q.getValue(function(bq){bq=bq||"";bp.val(bq);bk.find(".jmuiActionButton").bind(aU.ui.tapEvent,bn);bk.find(".jmuiCancelButton").bind(aU.ui.tapEvent,bo);aU.ui.gotoPage(bk,"jmuiSlide",false,true)})}})}function ah(Q){var bj,bl,bk;bl=Q.getPageObject();bj=K(aU(aU.ui.parentColumn(bl[0])),"editTimePage",Q);bk=Q.getQuestionObject();aU.ui.generateTaps(bk);bk.bind(aU.ui.tapEvent,function(){var bo,bn;function bm(br){var bp,bq;if(!aU.ui.defaultPrevented(br)){br.preventDefault();bp=bo.html().split(":",2);if(bp.length===2){bq=new Date();bq=new Date(bq.getFullYear(),bq.getMonth(),bq.getDate(),bp[0],bp[1],0,0);if(isNaN(bq.getTime())){bq=null;bk.find("h4").html("")}else{bk.find("h4").html(bo.html())}}else{bq=null;bk.find("h4").html("")}Q.setValue(bq);Q.valueChanged();bn();aU.ui.refreshScroller(bl)}}bn=function(){bj.find(".jmuiActionButton").unbind(aU.ui.tapEvent,bm);bj.find(".jmuiCancelButton").unbind(aU.ui.tapEvent,bn);aU.ui.gotoPage(bl,"jmuiSlide",true,true)};if(!bk.attr("disabled")){bo=bj.find(".jmuiCompositeTime");bo.attr("increment",bk.attr("increment"));bj.find("h2").text(bk.find("h3").text());Q.getValue(function(bp){if(bp&&bp.constructor===Date){bp.setMinutes(bp.getMinutes()-bp.getMinutes()%5);bp=bp.toString(Date.CultureInfo.formatPatterns.shortTime)}else{bp="&nbsp;"}bo.html(bp);bj.find(".jmuiActionButton").bind(aU.ui.tapEvent,bm);bj.find(".jmuiCancelButton").bind(aU.ui.tapEvent,bn);aU.ui.gotoPage(bj,"jmuiSlide",false,true)})}})}function k(Q,bm){var bj,bl,bk;bl=Q.getPageObject();bj=K(aU(aU.ui.parentColumn(bl[0])),"editTogglePage",Q);bk=Q.getQuestionObject();aU.ui.generateTaps(bk);bk.bind(aU.ui.tapEvent,function(){var bs,bp,br,bq,bo;function bn(bu){var bt;if(!aU.ui.defaultPrevented(bu)){bu.preventDefault();bt=[];br="";bj.find("input").each(function(){if(this.checked===true){bt.push(this.value);if(br.length>0){br+=", "}br+=this.parentElement.previousElementSibling.innerHTML}});Q.setValue(bt);bk.find("h4").html(br);Q.valueChanged();bp();aU.ui.refreshScroller(bl)}}bp=function(){bj.find(".jmuiActionButton").unbind(aU.ui.tapEvent,bn);bj.find(".jmuiCancelButton").unbind(aU.ui.tapEvent,bp);aU.ui.gotoPage(bl,"jmuiSlide",true,true)};if(!bk.attr("disabled")){Q.getValue(function(bt){br="";for(bq=0;bq<bm.length;bq+=1){br+='<li><span class="jmuiToggleText">'+bm[bq].label+'</span><span class="jmuiToggle"><input type="checkbox" value="'+bm[bq].value+'"';if(bt&&bt.length){for(bo=0;bo<bt.length;bo+=1){if(bt[bo]===bm[bq].value){br+=" checked=true"}}}br+=" /></span></li>"}bs=bj.find("ul");bs.empty();bs.html(br);bs.find("input").each(function(bu,bv){var bw=new Switchery(bv,{size:"small"})});bj.find("h2").text(bk.find("h3").text());bj.find(".jmuiActionButton").bind(aU.ui.tapEvent,bn);bj.find(".jmuiCancelButton").bind(aU.ui.tapEvent,bp);aU.ui.gotoPage(bj,"jmuiSlide",false,true)})}})}function ad(bk){var bn,bj,bl;function Q(){bn()}function bm(){function bo(){at(bl,bk.question)}bj(bo)}bl=aX(bk);bn=bl.initialize;bl.initialize=Q;bj=bl.load;bl.load=bm;return bl}function av(bk){var bn,bj,bl;function Q(){bn();aB(bl)}function bm(){function bo(){bl.getValue(function(bp){bk.question.find("h4").text(bp&&bp.length?"<answered>":"")})}bj(bo)}bl=ar(bk);bn=bl.initialize;bl.initialize=Q;bj=bl.load;bl.load=bm;return bl}function a9(bq){var Q,bl,bo,bn,bk;function bp(){function br(){}bn(br)}function bm(){}function bj(){bo();Q=bq.question.find(".audioButton");bc(bl,Q,bm)}bl=aX(bq);bo=bl.initialize;bl.initialize=bj;bn=bl.load;bl.load=bp;bk=bl.save;bl.save=bm;return bl}function A(bk){var bn,bj,bl;function Q(){bn();Z(bl)}function bm(){function bo(){}bj(bo)}bl=ar(bk);bn=bl.initialize;bl.initialize=Q;bj=bl.load;bl.load=bm;return bl}function g(bt){var Q,bs,bm,bp,bo,bk,bq,bl;function br(){function bu(){bm.getValue(function(bv){bv=bv||"";if(bv){if(bq[0]){Q=bq;bm.showPlaceholder(Q)}if(bl[0]){Q=bl}Q.empty();Q.hide();if(bm.getDesignValue("postScanShowResult")!=="false"){Q.show()}Q.text(bv)}else{if(bq[0]){Q=bq}bm.showPlaceholder(Q)}})}bo(bu)}function bn(){if(bm.ready()){if(bl[0]){Q=bl}bm.setValue(Q.text())}}function bj(){bp();bs=bt.question.find("li");Q=bs.find("div");bq=bs.find(".jmuiPlaceholder");bl=bs.find(".jmuiScanresult");aI(bm,bs,bn)}bm=aX(bt);bp=bm.initialize;bm.initialize=bj;bo=bm.load;bm.load=br;bk=bm.save;bm.save=bn;return bm}function f(bk){var bn,bj,bl;function Q(){bn();ax(bl)}function bm(){function bo(){bl.getValue(function(bp){bp=bp||"";if(bl.getDesignValue("postScanShowResult")!=="false"){bk.question.find("h4").text(bp)}})}bj(bo)}bl=ar(bk);bn=bl.initialize;bl.initialize=Q;bj=bl.load;bl.load=bm;return bl}function a1(bq){var bl,bo,bm,bj,bn;function bp(){function br(){bj.getValue(function(bs){if(Object.prototype.toString.call(bs)==="[object Array]"&&bs.length!==0){bq.question.find("input").each(function(){var bv,bu,bt;bv=false;bt=this.value;for(bu=0;bu<bs.length;bu+=1){if(bs[bu]===bt){bv=true;break}}this.checked=bv})}else{bq.question.find("input").each(function(){this.checked=false})}})}bm(br)}function bk(){var br;if(bj.ready()){br=[];bq.question.find("input").each(function(){if(this.checked){br.push(this.value)}});bj.setValue(br)}}function Q(){function br(bv){var bt,bs,bu;bq.question.empty();bu=bv.length;bt="";for(bs=0;bs<bu;bs+=1){bn=bl+"_choice_"+bs;bt+='<li><input type="checkbox" name="'+bl+'" value="'+bv[bs].value+'"  id="'+bn+'"/>';bt+='<label for="'+bn+'">'+bv[bs].label+"</label></li>"}bq.question.html(bt);aU.ui.bindCheckboxes(bq.question);bq.question.find("input").bind("jmuiChange",bk);bj.ready(true)}bo();bj.ready(false);bj.getChoices(br)}bj=aX(bq);bl=bj.getQuestionId();bo=bj.initialize;bj.initialize=Q;bm=bj.load;bj.load=bp;bj.save=bk;return bj}function aN(bk){var bo,bn,bj,bl;function Q(){function bp(bq){bo=bq;aV(bl,bo,"editCheckboxPage");bl.ready(true)}bn();bl.ready(false);bl.getChoices(bp)}function bm(){function bp(){var br,bq,bs;bl.getValue(function(bt){if(bt){bs=[];if(bo.length>0){for(br=0;br<bt.length;br+=1){for(bq=0;bq<bo.length;bq+=1){if(bt[br]===bo[bq].value){bs.push(bo[bq].label);break}}}bs=bs.join(", ")}else{bs=""}bk.question.find("h4").html(bs)}else{bk.question.find("h4").html("")}})}bj(bp)}bl=ar(bk);bn=bl.initialize;bl.initialize=Q;bj=bl.load;bl.load=bm;return bl}function M(bk){var bo,bj,bm;function bn(bq){function bp(){bm.getValue(function(br){bk.question.find("input").val(br||"")})}bj(bp);bq=undefined}function bl(){if(bm.ready()){bm.setValue(bk.question.find("input").val())}}function Q(){var bp;function bq(bv){var bt,bs,br,bu;bt=bk.question.find("select");bt.empty();bu=bv.length;br="";for(bs=0;bs<bu;bs+=1){br+='<option value="'+bv[bs].value+'">'+bv[bs].label+"</option>"}bt.html(br);bm.ready(true)}bo();bm.ready(false);bm.getChoices(bq);bp=bk.question.find("input");bp.bind("change",bl)}bm=aX(bk);bo=bm.initialize;bm.initialize=Q;bj=bm.load;bm.load=bn;bm.save=bl;return bm}function Y(bk){var bn,bj,bl;function Q(){function bo(bp){aL(bl,bp);bl.ready(true)}bn();bl.ready(false);bl.getChoices(bo)}function bm(){function bo(){bl.getValue(function(bp){bk.question.find("h4").html(bp||"")})}bj(bo)}bl=ar(bk);bn=bl.initialize;bl.initialize=Q;bj=bl.load;bl.load=bm;return bl}function a3(bk){var bn,bj,bl;function Q(){bn();q(bl,bk.question,function(){aU.ui.gotoPage(bk.page,"jmuiSlide",true,false)})}function bm(){function bo(){bl.getValue(function(bq){var bp;if(bq===undefined||bq===null||bq===""){bp="unansweredTemplate"}else{bp="answeredTemplate"}bk.question.html(bl.applyTemplate(bp))},false)}bj(bo)}bl=aX(bk);bn=bl.initialize;bl.initialize=Q;bj=bl.load;bl.load=bm;return bl}function aT(bk){var bn,bj,bl;function Q(){bn();q(bl,bk.question,function(){aU.ui.gotoPage(bk.page,"jmuiSlide",true,false)})}function bm(){function bo(){bl.getValue(function(bq){var bp;if(bq===undefined||bq===null||bq===""){bp="unansweredTemplate"}else{bp="answeredTemplate"}bk.question.html(bl.applyTemplate(bp))},false)}bj(bo)}bl=aX(bk);bn=bl.initialize;bl.initialize=Q;bj=bl.load;bl.load=bm;return bl}function bh(bk){var bo,bj,bm;function bn(){function bp(){var bq;bq=bk.question.find(".jmuiCompositeDate");bm.getValue(function(br){if(br&&br.constructor===Date){bq.text(aQ.fl.format(br,"D"))}else{bq.html("&nbsp;")}})}bj(bp)}function bl(){var bq,bp;if(bm.ready()){bq=bk.question.find(".jmuiCompositeDate");bp=new Date(bq.html()+" 12:00:00 UTC");if(isNaN(bp.getTime())){bp=null}bm.setValue(bp)}}function Q(){bo();bk.question.find(".jmuiCompositeDate").bind("change",bl)}bm=aX(bk);bo=bm.initialize;bm.initialize=Q;bj=bm.load;bm.load=bn;bm.save=bl;return bm}function a8(bk){var bn,bj,bl;function Q(){bn();y(bl)}function bm(){function bo(){var bp;bp=bk.question.find("h4");bl.getValue(function(bq){if(bq&&bq.constructor===Date){bp.html(bq.toLocaleDateString())}else{bp.html("")}})}bj(bo)}bl=ar(bk);bn=bl.initialize;bl.initialize=Q;bj=bl.load;bl.load=bm;return bl}function aE(bk){var bp,bj,bn;function bo(bq){function br(){if(bq&&!bn.busy){bn.busy=true;aj(bn,bk.question);bk.question.find("input").blur();return false}}bj(br)}function bm(){var bq,br;bq=[];br=bk.question;br.find("li.jmuiSelected").each(function(bs,bt){var bu;bu=aU(bt);bq.push(bu.attr("rowGuid"));bs=undefined});bn.setValue(bq)}function bl(bt){var br,bu,bs,bq;bq=bk.question;br=bq.find("input");if(bt&&!aU.ui.defaultPrevented(bt)){bu=br.offset();bs=parseInt(br.style("padding-right"),10);if(bt.pageX>=bu.left+br[0].offsetWidth-bs){if(!bn.busy){aU.ui.cancelEvent(bt);bq.find("li:not(.searchBar)").remove();br.val("");bn.setValue([]);return false}}}}function Q(){var bs,br,bq;bp();bq=bk.question.find(".searchBar");br=bq.find("input");aU.ui.generateTaps(br);br.bind(aU.ui.tapEvent,bl);bs=bq.find("form");bs.bind("submit",function(bt){aU.ui.cancelEvent(bt);bo(true);return false})}bn=aX(bk);bp=bn.initialize;bn.initialize=Q;bj=bn.load;bn.load=bo;bn.save=bm;return bn}function n(Q){var bj;bj=ar(Q);return bj}function c(bk){var bn,bj,bl;function Q(){bn()}function bm(){function bo(){aZ(bl,bk.question)}bj(bo)}bl=aX(bk);bn=bl.initialize;bl.initialize=Q;bj=bl.load;bl.load=bm;return bl}function D(bk){var bn,bj,bl;function Q(){bn();ak(bl)}function bm(){function bo(){bl.getValue(function(bp){bk.question.find("h4").text(bp&&bp.length?"<answered>":"")})}bj(bo)}bl=ar(bk);bn=bl.initialize;bl.initialize=Q;bj=bl.load;bl.load=bm;return bl}function R(bj){var bk,Q;function bl(){function bm(){bk.getCalculatedValue(function(bn){function bo(bq,bp){if(bq!==""){switch(bk.getType()){case"att":if(bp){bj.question.find("img").attr("src",bq)}else{aQ.att.getAttachment(aQ.db.getCurrentSubjectGuid(),bq,function(br){bj.question.find("img").attr("src",br)})}break;default:bj.question.find("img").attr("src",bq);break}}}if(bn===undefined||bn===null){bk.getValue(function(bq,bp){bo(bq||"",bp)},false,true)}else{bo(bn,false)}})}Q(bm)}bk=aX(bj);Q=bk.load;bk.load=bl;return bk}function e(bk){var bl,bn,bj;function Q(){bn();u(bl,"editImagePage")}function bm(){function bo(){bl.getValue(function(bp){bk.question.find("h4").text(bp&&bp.length?"<answered>":"")})}bj(bo)}bl=ar(bk);bn=bl.initialize;bl.initialize=Q;bj=bl.load;bl.load=bm;return bl}function C(bk){var bn,bm,bl;function Q(){bm();bn=bk.question.find("img");t(bl,bn)}function bj(){d(bl,bn)}bl=aX(bk);bm=bl.initialize;bl.initialize=Q;bl.postLoad=bj;return bl}function F(bk){var bn,bj,bl;function Q(){bn();S(bl)}function bm(){function bo(){bl.getValue(function(bp){bk.question.find("h4").text(bp&&bp.length?"<answered>":"")})}bj(bo)}bl=ar(bk);bn=bl.initialize;bl.initialize=Q;bj=bl.load;bl.load=bm;return bl}function al(bj){var Q,bk;function bl(){function bm(){bk.getCalculatedValue(function(bn){function bo(bq){var bp;bj.question.find("li").each(function(){var br,bs;bs=aU(this);bs.html(bq);br=bk.getBackground();if(br){bs.style("background",br)}});bp="questionHide_"+bk.getQuestionId();if(aQ.fl.hasOwnProperty(bp)){aQ.fl[bp]()}else{if(bq){bj.question.show()}else{bj.question.hide()}}}if(bn===undefined||bn===null){bk.getValue(function(bp){bp=bp||"";bo(bp)})}else{bo(bn)}})}Q(bm)}bk=aX(bj);Q=bk.load;bk.load=bl;return bk}function a5(bj){var Q,bk;function bl(){function bm(){bk.getValue(function(bn){bn=bn||"";bj.question.find("h4").html(bn)})}Q(bm)}bk=ar(bj);Q=bk.load;bk.load=bl;return bk}function aS(bk){var bn,bj,bl;function Q(){bn()}function bm(){function bo(){az(bl,bk.question)}bj(bo)}bl=aX(bk);bn=bl.initialize;bl.initialize=Q;bj=bl.load;bl.load=bm;return bl}function v(bk){var bn,bj,bl;function Q(){bn();E(bl)}function bm(){function bo(){bl.getValue(function(bp){bk.question.find("h4").text(bp&&bp.length?"<answered>":"")})}bj(bo)}bl=ar(bk);bn=bl.initialize;bl.initialize=Q;bj=bl.load;bl.load=bm;return bl}function X(bj){var Q,bk;function bl(){function bm(){bk.getCalculatedValue(function(bn){if(bn===undefined||bn===null){bn=bk.getValue()||""}bj.question.find("li").each(function(){var bo,bp;bp=aU(this);bp.html(bn);bo=bk.getBackground();if(bo){bp.style("background",bo)}});if(bn){bj.question.show()}else{bj.question.hide()}})}Q(bm)}bk=aX(bj);Q=bk.load;bk.load=bl;return bk}function ai(bs){var bj,bm,Q,bl,br,bp;bl=[];function bk(){var bu;if(bl){for(bu in bl){bl[bu].setMap(null)}bl.length=0}}function bq(bu){bl.push(bu)}function bt(bu){if(bu.segmentId&&bs.question.parent()[0].id===bu.segmentId){bs.question.trigger("resize")}}function bn(){var bx,bv;br();if(bs.question.parent().hasClass("jmuiSegmentPanel")){bs.question.parent().parent().bind("jmuiChange",bt)}L().then(function bw(){if(typeof(google)!=="undefined"){if(google.maps!==undefined){bx=new google.maps.LatLng(52.93221,-1.475029);bv={zoom:12,center:bx,mapTypeId:window.google.maps.MapTypeId.ROADMAP};Q=new window.google.maps.Map(bs.question.find("div")[0],bv);bj=new window.google.maps.Geocoder();bm=new window.google.maps.InfoWindow();bs.question.find("div").bind(a0?"touchstart":"mousedown",function(by){by.stopPropagation()});return}}},function bu(){console.error("maps api not loaded");alert("maps cannot be loaded")})}function bo(){L().then(function bu(){bk();if(typeof(google)!=="undefined"){if(google.maps!==undefined){a6(bp,Q,bj,bm)}}})}bp=aX(bs);br=bp.initialize;bp.initialize=bn;bp.postLoad=bo;bp.addMarker=bq;bp.clearMarkers=bk;return bp}function a7(bk){var bo,bj,bm;function bn(){function bp(){bm.getValue(function(bq){bk.question.find("textarea").val(bq||"")})}bj(bp)}function bl(){if(bm.ready()){bm.setValue(bk.question.find("textarea").val())}}function Q(){bo();bk.question.find("textarea").bind("change",bl)}bm=aX(bk);bo=bm.initialize;bm.initialize=Q;bj=bm.load;bm.load=bn;bm.save=bl;return bm}function aR(bk){var bn,bj,bl;function Q(){bn();aO(bl,"editNotesPage")}function bm(){function bo(){bl.getValue(function(bp){bk.question.find("h4").html(bp||"")})}bj(bo)}bl=ar(bk);bn=bl.initialize;bl.initialize=Q;bj=bl.load;bl.load=bm;return bl}function bf(bk){var bo,bj,bm;function bn(){function bp(){bm.getValue(function(bq){if(bq!==null&&bq!==undefined){bk.question.find("input").val(bq)}else{bk.question.find("input").val("")}})}bj(bp)}function bl(){var bp;if(bm.ready()){bp=bk.question.find("input").val();bm.setValue(bp.length?parseFloat(bp):null)}}function Q(){bo();bk.question.find("input").bind("change",bl)}bm=aX(bk);bo=bm.initialize;bm.initialize=Q;bj=bm.load;bm.load=bn;bm.save=bl;return bm}function a4(bk){var bn,bj,bl;function Q(){bn();ab(bl)}function bm(){function bo(){bl.getValue(function(bp){if(bp!==undefined&&bp!==null){bk.question.find("h4").html(bp)}else{bk.question.find("h4").html("")}})}bj(bo)}bl=ar(bk);bn=bl.initialize;bl.initialize=Q;bj=bl.load;bl.load=bm;return bl}function aA(bk){var bo,bj,bm;function bn(){function bp(){bm.getValue(function(bq){if(bq!==null&&bq!==undefined){bk.question.find(".jmuiCompositeNumber").html(bq)}else{bk.question.find(".jmuiCompositeNumber").html("&nbsp;")}})}bj(bp)}function bl(){var bp;if(bm.ready()){bp=bk.question.find(".jmuiCompositeNumber").html();bp=bp.length?parseFloat(bp):null;if(isNaN(bp)){bp=null}bm.setValue(bp)}}function Q(){bo();bk.question.find(".jmuiCompositeNumber").bind("change",bl)}bm=aX(bk);bo=bm.initialize;bm.initialize=Q;bj=bm.load;bm.load=bn;bm.save=bl;return bm}function H(bk){var bn,bj,bl;function Q(){bn();N(bl)}function bm(){function bo(){bl.getValue(function(bp){if(bp!==undefined&&bp!==null){bk.question.find("h4").html(bp)}else{bk.question.find("h4").html("")}})}bj(bo)}bl=ar(bk);bn=bl.initialize;bl.initialize=Q;bj=bl.load;bl.load=bm;return bl}function B(bk){var bo,bj,bm;function bn(){function bp(){bm.getValue(function(bq){bk.question.find("input").val(bq||"")})}bj(bp)}function bl(){if(bm.ready()){bm.setValue(bk.question.find("input").val())}}function Q(){bo();bk.question.find("input").bind("change",bl)}bm=aX(bk);bo=bm.initialize;bm.initialize=Q;bj=bm.load;bm.load=bn;bm.save=bl;return bm}function a2(bk){var bn,bj,bl;function Q(){bn();aO(bl,"editPasswordPage")}function bm(){function bo(){bl.getValue(function(bp){bk.question.find("h4").html(bp?w:"")})}bj(bo)}bl=ar(bk);bn=bl.initialize;bl.initialize=Q;bj=bl.load;bl.load=bm;return bl}function ap(bs){var Q,br,bm,bp,bo,bl;function bq(){function bt(){function bu(bv){Q=bv;if(bv){aQ.att.getAttachment(aQ.db.getCurrentSubjectGuid(),bv,function(bw){if(bw){br.html('<img width="100%" src="'+bw+'"/>')}else{bm.showPlaceholder(br)}})}else{bm.showPlaceholder(br)}}bm.getValue(bu,true)}bo(bt)}function bn(bu){var bt;if(bm.ready()){bt=Q||aQ.db.guid();aQ.att.setAttachment(aQ.db.getCurrentSubjectGuid(),bt,br.find("img").attr("src"),true,function(bv){if(!bv){if(!Q){Q=bt;bm.setValue(Q)}bu&&bu(Q);aQ.fl.refreshiscroll(1500)}})}}function bk(){if(bm.ready()){if(Q){aQ.db.deleteAttachment(aQ.db.getCurrentSubjectGuid(),Q,function(bt){if(!bt){bm.deleteValue();Q=undefined}})}}}function bj(){bp();br=bs.question.find("li");aG(bm,br,bn,bk)}bm=aX(bs);bp=bm.initialize;bm.initialize=bj;bo=bm.load;bm.load=bq;bl=bm.save;bm.save=bn;return bm}function ac(bk){var bn,bj,bl;function Q(){bn();l(bl)}function bm(){function bo(){bl.getValue(function(bp){bk.question.find("h4").text(bp?"<answered>":"")},true)}bj(bo)}bl=ar(bk);bn=bl.initialize;bl.initialize=Q;bj=bl.load;bl.load=bm;return bl}function aq(bq){var bo,bn,bl;function bk(br){if(!aU.ui.defaultPrevented(br)){br.preventDefault();aQ.msgBox(function(bs){if(bs==="Yes"){if(window.cordova&&window.cordova.exec&&window.plugins&&window.plugins.settings){window.plugins.settings.getClearURL(function(bt){var bu=URI(bt);bu.addQuery("newguid","yes");window.locationUtils.setURI(bu)})}else{window.locationUtils.setHref(aQ.getRootPath()+"mdesign/0/procs/clear.html?newguid=yes")}}},"Confirm","Clear all data?","Yes","No")}}function bm(bs){var br;if(bl.ready()){br=aU(this);br.parent().find(".jmuiSelected").removeClass("jmuiSelected");br.addClass("jmuiSelected");bl.setValue(aU(this).attr("processId"),bs)}}function bp(){function br(){var bx,bv,bu,bs,by,bt,bw;bq.question.empty();bx=bl.getDesignValue("processes");if(bx&&bx.constructor===Array){bw=[];for(bu=0;bu<bx.length;bu+=1){bt=aQ.db.makeProcessName({id:bx[bu],version:aQ.db.getLatestProcessVersion(bx[bu])});bw.push({name:bt,value:aQ.db.getProcess(bt)})}}else{bw=aQ.db.getLatestProcesses();if(bw!==undefined){bw.sort(function(bA,bz){if(bA.value.title!==undefined&&bz.value.title!==undefined){return bA.value.title.localeCompare(bz.value.title)}return bA.value.id.localeCompare(bz.value.id)})}}if(bw){by=bw.length;for(bu=0;bu<by;bu+=1){if(bw[bu].value!==undefined&&bw[bu].value.hidden!==true&&(aQ.db.isProcessDeployed(bw[bu].value.id)===true||aQ.db.isProcessInUse(bw[bu].value.id)===true)){bv=bl.applyTemplate("template",bw[bu].value);if(bv){bs=aU(window.document.createElement("ul"));bs.html(bv);bs=bs.find("li")}else{bs=aU(window.document.createElement("li"));bs.addClass("jmuiArrow");bs.text(bw[bu].value.title)}bs.addClass("jmuiColorPress");bs.attr("processId",bw[bu].value.id);bq.question[0].appendChild(bs[0])}}aU.ui.generateTaps(bq.question.find("li").bind(aU.ui.tapEvent,function(){var bB,bA;function bz(){var bE,bC,bD;bD=aQ.db.getProcess(aQ.db.makeProcessName({id:bB,version:bA}));if(bD.singleSubject){if(bD.deleteOnOpen){aQ.showActivity();aQ.db.deleteAllSubjects(bD.id,bD.version,function(){aQ.hideActivity();aQ.gotoUrl(bD.url,!bD.urlProcess)})}else{aQ.gotoUrl(bD.url,!bD.urlProcess)}}else{bC=bl.getQuestionId()+"_RowTap";aQ.currentPage(bl.getPageId());bE=aQ.fl[bC];if(bE!==undefined&&bE.constructor===Function){aQ.showActivity();bE(function(bF){aQ.hideActivity();if(bF&&typeof bF==="string"){aU.ui.gotoPage(aU("#"+bF),"jmuiSlide")}})}else{aQ.fl.pagenext()}}}bB=aU(this).attr("processId");bA=aQ.db.getLatestProcessVersion(bB);bm.call(this,bz)}))}}bn(br)}function Q(br){if(!aU.ui.defaultPrevented(br)){br.preventDefault();aQ.fl.replicatedialog()}}function bj(){bo();bq.page.find(".jmuiCancelButton").bind(aU.ui.tapEvent,bk);bq.page.find(".jmuiActionButton").bind(aU.ui.tapEvent,Q)}bl=aX(bq);bo=bl.initialize;bl.initialize=bj;bn=bl.load;bl.load=bp;bl.save=bm;return bl}function aD(bj){var bm,bk;function Q(){bm()}function bl(){}bk=ar(bj);bm=bk.initialize;bk.initialize=Q;bk.load=bl;return bk}function an(bk){var bp,bo,bj,bm;function bl(){var bq;if(bm.ready()){bq=[];bk.question.find("input").each(function(){if(this.checked){bq.push(this.value)}});bm.setValue(bq)}}function Q(){function bq(bv){var bs,br,bu,bt;bk.question.empty();bu=bv.length;bs="";for(br=0;br<bu;br+=1){bt=bp+"_choice_"+br;bs+='<li><input type="radio" name="'+bp+'" value="'+bv[br].value+'" id="'+bt+'"/>';bs+='<label for="'+bt+'">'+bv[br].label+"</label></li>"}bk.question.html(bs);aU.ui.bindRadios(bk.question);bk.question.find("input").bind("change",bl);bm.ready(true)}bo();bm.ready(false);bm.getChoices(bq)}function bn(){function bq(){bm.getValue(function(br){if(Object.prototype.toString.call(br)==="[object Array]"&&br.length!==0){bk.question.find("input").each(function(){var bu,bt,bs;bu=false;bs=this.value;for(bt=0;bt<br.length;bt+=1){if(br[bt]===bs){bu=true;break}}this.checked=bu})}else{bk.question.find("input").each(function(){this.checked=false})}})}bj(bq)}bm=aX(bk);bp=bm.getQuestionId();bo=bm.initialize;bm.initialize=Q;bj=bm.load;bm.load=bn;bm.save=bl;return bm}function bi(bk){var bo,bn,bj,bl;function Q(){function bp(bq){bo=bq;aV(bl,bo,"editRadioPage");bl.ready(true)}bn();bl.ready(false);bl.getChoices(bp)}function bm(){function bp(){var br,bq,bs;bl.getValue(function(bt){if(bt){bs=[];if(bo.length>0){for(br=0;br<bt.length;br+=1){for(bq=0;bq<bo.length;bq+=1){if(bt[br]===bo[bq].value){bs.push(bo[bq].label);break}}}bs=bs.join(", ")}else{bs=""}bk.question.find("h4").html(bs)}else{bk.question.find("h4").html("")}})}bj(bp)}bl=ar(bk);bn=bl.initialize;bl.initialize=Q;bj=bl.load;bl.load=bm;return bl}function G(Q){ay();b(Q)}function aF(bk){var bo,bj,bm;function Q(){bo()}function bl(){var bp;if(bm.ready()){bp=bk.question.find("select").val();if(bp===""){bp=undefined}if(bp!==undefined){bp=[bp]}bm.setValue(bp)}}function bn(){function bp(){function bq(bv){var bt,bs,br,bu;bu=bv.length;br="";for(bs=0;bs<bu;bs+=1){br+='<option value="'+bv[bs].value+'">'+bv[bs].label+"</option>"}bt=bk.question.find("select");bt.empty();bt.html(br);bt.bind("change",bl);bm.getValue(function(bw){if(bw&&bw.constructor===Array&&bw.length>0){bw=bw[0]}else{bw=undefined}bk.question.find("select").val(bw);bl()})}bm.getChoices(bq)}bj(bp)}bm=aX(bk);bo=bm.initialize;bm.initialize=Q;bj=bm.load;bm.load=bn;bm.save=bl;return bm}function bd(bk){var bn,bj,bl;function Q(){bn();aa(bl)}function bm(){function bo(){bl.getValue(function(bp){bp=bp||"";if(bp){if(bp.constructor===Array){if(bp.length>0){bp=bp[0]}else{bp=""}}bl.getChoices(function(br){var bq;if(br.length>0){for(bq=0;bq<br.length;bq+=1){if(br[bq].value===bp){bp=br[bq].label;break}}}bk.question.find("h4").html(bp)})}else{bk.question.find("h4").html("")}})}bj(bo)}bl=ar(bk);bn=bl.initialize;bl.initialize=Q;bj=bl.load;bl.load=bm;return bl}function o(Q,bj){var bl,bm,bk;bk=aU("#md_"+Q+"_container");if(bk&&bk.length){bl=bk[0].previousElementSibling;if(bl&&bl.nodeName==="H2"){bl=aU(bl);if(bj===true){bl.show()}else{bl.hide()}}if(bj===true){if(I(bk)===W.labelInline){bm=aW(aU.ui.parentPage(bk[0]).id,Q);bm.getCalculatedValue(function(bn){if(bn===undefined||bn===null){bm.getValue(function(bo){if(bo){bk.show()}else{bk.hide()}})}else{bk.show()}})}else{bk.show();if(bk.find(".jSignature").length>0){if(jQuery){jQuery(".jsig").resize()}}}}else{bk.hide()}}}function s(bl){var bj,bp,bk,bn;function Q(){function bq(){var br;if(bn.ready()){br=aU("#mdcPlugin");if(br.length>0){bn.getValue(function(bs){try{bs=br[0].signatureDialog(bs);bn.setValue(bs)}catch(bt){alert(bt)}})}}}bp();bj=bl.question.find("li");if(aU.isZetakey){aU.ui.generateTaps(bj);bj.bind(aU.ui.tapEvent,bq)}else{bj.attr("disabled","disabled")}}function bo(){function bq(){}bk(bq)}function bm(){}bn=aX(bl);bp=bn.initialize;bn.initialize=Q;bk=bn.load;bn.load=bo;bn.save=bm;return bn}function aM(bk){var bp,bo,bj,bm;function bn(){function bq(){function br(bs){if(bs.direction==="in"){bm.getValue(function(bt){if(bt){bp.jSignature("setData","data:"+JSON.parse(bt[0]).join(","))}});bk.page.unbind("jmuiPageAnimationEnd",br)}}bk.page.bind("jmuiPageAnimationEnd",br)}bj(bq)}function bl(){if(bm.ready()){var bs=bp.jSignature("getData","base30");var bq=bp.jSignature("getData","image");var br=bp.jSignature("getData","svgbase64");bm.setValue([JSON.stringify(bs),bq[1],br[1]])}}function Q(){var bq=false;bo();bk.page.bind("jmuiPageAnimationEnd",function(bt){if(bt.direction==="in"&&!bq){var bs=true;var br=7;bq=true;bp=jQuery(bk.question[0]).find(".jsig");br=bp.attr("ratio");bs=bk.question.attr("sketchtype")=="signature";bp.jSignature({showLine:bs,sizeRatio:(30/br)});bp.bind("change",function(bu){bl()});bk.question.find(".jsig").bind("touchstart",function(){aU("div.jmuiPage.jmuiCurrent div.jmuiNativeScroller").addClass("noscroll")});bk.question.find(".jsig").bind("touchend",function(){aU("div.jmuiPage.jmuiCurrent div.jmuiNativeScroller").removeClass("noscroll")});bk.question.find(".jsig").bind("mousedown",function(){aU("div.jmuiPage.jmuiCurrent div.jmuiNativeScroller").addClass("noscroll")});bk.question.find(".jsig").bind("mouseup",function(){aU("div.jmuiPage.jmuiCurrent div.jmuiNativeScroller").removeClass("noscroll")})}})}bm=aX(bk);bo=bm.initialize;bm.initialize=Q;bj=bm.load;bm.load=bn;bm.save=bl;return bm}function m(bk){var bn,bj,bl;function Q(){bn();aJ(bl)}function bm(){function bo(){bl.getValue(function(bp){var bq;bq=(bp&&bp.length)?"<answered>":"";bk.question.find("h4").text(bq)})}bj(bo)}bl=ar(bk);bn=bl.initialize;bl.initialize=Q;bj=bl.load;bl.load=bm;return bl}function bg(bv){var bs,bt,Q,br,bq,bo,bm;function bp(bA,bx){var by,bz;function bw(bB){if(bB!==false){aQ.fl.pushsubject();aQ.fl.opensubject(undefined,bx)}}if(!bA||!bA.jmuiTarget||!aU(bA.jmuiTarget).hasClass("subjectDelete")){if(bo.ready()){if(bx===undefined){bz=aU(this);bx=bz.attr("subjectGuid");bz.parent().find(".jmuiSelected").removeClass("jmuiSelected");bz.addClass("jmuiSelected");bo.setValue(bx);by=bo.getQuestionId()+"_RowTap";aQ.fl.execFormula(by,bw,bw,true,bx)}else{bw(true)}}}}function bn(by){var bx;function bz(){}function bw(){var bA;if(!aU.ui.defaultPrevented(by)&&Q!==undefined){by.preventDefault();bA=aQ.db.getLatestProcessVersion(Q);aQ.db.createSubject(Q,bA,undefined,function(bB){bp(undefined,bB.guid)})}}bx="action_"+aQ.currentPage()+"_NewSubject";aQ.fl.execFormula(bx,bz,bw,true)}function bk(bB,bw){var by,bx,bA;function bz(){aQ.db.deleteSubject(bw);bA.remove()}function bC(bD){if(bD!==false){if(bD===true){bz()}else{aQ.msgBox(function(bE){if(bE==="Yes"){bz()}},"Confirm","Delete subject?","Yes","No")}}bx.removeClass("subjectConfirmDelete")}bx=aU(this);bx.addClass("subjectConfirmDelete");bA=aU(aU.ui.parentElement(this,"subjectRow"));if(bw===undefined){bw=bA.attr("subjectGuid")}by=bo.getQuestionId()+"_RowDelete";aQ.fl.execFormula(by,bC,bC,true,bw);bB=undefined}function bj(bw){if(!bm){bm=true;bn(bw);bs.disabled=true;setTimeout(function(){bm=false},500)}}function bl(){br();bs=bv.page.find(".NewSubject");bs.bind(aU.ui.tapEvent,bj);bv.page.find(".jmuiBackButton").bind(aU.ui.tapEvent,function(bw){if(!aU.ui.defaultPrevented(bw)){bw.preventDefault();bo.deleteValue();aU.ui.gotoPage(aU("#processesPage"),"jmuiSlide",true)}});bt=aQ.db.getCurrentSubjectGuid().toLowerCase()}function bu(){function bw(){var bA,by,bx,bD,bC;function bB(bF,bG){function bE(bJ){var bI,bH,bK;if(bJ!==false){bI=bo.applyTemplate("rowTemplate",bG);if(bI){bK=aU(window.document.createElement("tbody"));bK.html(bI);bK=bK.find("tr").item(0)}if(bK===undefined){bK=aU(window.document.createElement("tr"));bK.addClass("jmuiArrow");bH=bG.name||bG.guid;if(bI===undefined){bI='<span class="subjectDelete"></span>'+bH}bK.html(bI)}bK.addClass("subjectRow");bK.attr("subjectGuid",bG.guid);bD[0].appendChild(bK[0]);aU.ui.generateTaps(bK.bind(aU.ui.tapEvent,bp));aU.ui.generateTaps(bK.find(".subjectDelete").bind(aU.ui.tapEvent,bk))}by-=1;if(by<=0){aU.ui.refreshScroller(bv.page)}}aQ.fl.execFormula(bF,bE,bE,true,bG,Q)}function bz(bE){aQ.db.getSubjectSummaries(Q,undefined,bx,bE,function(bH){var bF,bG;if(bH&&bH.length){by=bH.length;bG=bo.getDesignValue("selection");for(bF=0;bF<bH.length;bF+=1){bB(bG,bH[bF])}}})}bv.question.html("<li></li>");bv.question.find("li").html(bo.applyTemplate("tableTemplate")||"<table><tbody></tbody></table>");bD=bv.question.find("tbody");bD.empty();Q=bv.question.attr("processDataId");if(!Q){Q=bo.getDesignValue("processDataId")}if(!Q){Q=bo.getDesignValue("processId")}else{Q=aQ.db.getValue(Q)}bx=bo.getDesignValue("summaryNames");bC=bo.getDesignValue("filterformula");if(bC!==undefined){aQ.fl.execFormula(bC,bz,bz,true)}else{bA=bo.getDesignValue("filter");bz(bA)}}bq(bw)}bm=false;bo=aX(bv);br=bo.initialize;bo.initialize=bl;bq=bo.load;bo.load=bu;bo.save=bp;return bo}function be(bj){var bm,bk;function Q(){bm()}function bl(){}bk=ar(bj);bm=bk.initialize;bk.initialize=Q;bk.load=bl;return bk}function aP(bk){var bo,bj,bm;function bn(){function bp(){bm.getValue(function(bq){bk.question.find("input").val(bq||"")})}bj(bp)}function bl(){if(bm.ready()){bm.setValue(bk.question.find("input").val())}}function Q(){bo();bk.question.find("input").bind("change",bl)}bm=aX(bk);bo=bm.initialize;bm.initialize=Q;bj=bm.load;bm.load=bn;bm.save=bl;return bm}function z(bk){var bn,bj,bl;function Q(){bn();aO(bl,"editTextPage")}function bm(){function bo(){bl.getValue(function(bp){bk.question.find("h4").html(bp||"")})}bj(bo)}bl=ar(bk);bn=bl.initialize;bl.initialize=Q;bj=bl.load;bl.load=bm;return bl}function J(bk){var bo,bj,bm;function bn(){function bp(){var bq;bq=bk.question.find(".jmuiCompositeTime");bm.getValue(function(br){if(br&&br.constructor===Date){bq.text(aQ.fl.format(br,"t"))}else{bq.html("&nbsp;")}})}bj(bp)}function bl(){var bs,br,bp,bt,bq;if(bm.ready()){bq=null;bs=bk.question.find(".jmuiCompositeTime");bt=bs.html().split(":");if(bt.length===2){br=parseInt(bt[0],10);bp=parseInt(bt[1],10);if(br>=0&&br<24&&bp>=0&&bp<60){bq=new Date();bq.setHours(br);bq.setMinutes(bp);bq.setSeconds(0);bq.setMilliseconds(0)}}bm.setValue(bq)}}function Q(){bo();bk.question.find(".jmuiCompositeTime").bind("change",bl)}bm=aX(bk);bo=bm.initialize;bm.initialize=Q;bj=bm.load;bm.load=bn;bm.save=bl;return bm}function ao(bk){var bn,bj,bl;function Q(){bn();ah(bl)}function bm(){function bo(){var bp;bp=bk.question.find("h4");bl.getValue(function(bq){if(bq&&bq.constructor===Date){bp.text(bq.toString(Date.CultureInfo.formatPatterns.shortTime))}else{bp.html("")}})}bj(bo)}bl=ar(bk);bn=bl.initialize;bl.initialize=Q;bj=bl.load;bl.load=bm;return bl}function a(bk){var bo,bj,bm;function bn(){function bp(){bm.getValue(function(br){function bq(bt,bs){if(bt.checked!==bs){bt.checked=bs;aU(bt).trigger("change")}}if(Object.prototype.toString.call(br)==="[object Array]"&&br.length!==0){bk.question.find("input").each(function(){var bu,bt,bs;bu=false;bs=this.value;for(bt=0;bt<br.length;bt+=1){if(br[bt]===bs){bu=true;break}}bq(this,bu)})}else{bk.question.find("input").each(function(){bq(this,false)})}})}bj(bp)}function bl(){}function Q(){function bp(bt){var br,bq,bs;bk.question.empty();br="";bs=bt.length;for(bq=0;bq<bs;bq+=1){br+='<li><span class="jmuiToggleText">'+bt[bq].label+'</span><span class="jmuiToggle"><input type="checkbox" value="'+bt[bq].value+'" /></span></li>'}bk.question.html(br);bk.question.find("input").bind("jmuiChange",bl).each(function(bv,bw){var by=new Switchery(bw,{size:"small"});var bu=jQuery(bw).closest("ul").attr("dataid");var bx=jQuery(bw).val();jQuery(bw).next("span").click(function(){if(jQuery(this).siblings("input").is(":checked")){mCapture.fl.setdata(bu,bx,bv)}else{mCapture.fl.cleardata(bu,bv)}mCapture.fl.refreshhidden()})});bm.ready(true)}bo();bm.ready(false);bm.getChoices(bp)}bm=aX(bk);bo=bm.initialize;bm.initialize=Q;bj=bm.load;bm.load=bn;bm.save=bl;return bm}function af(bk){var bo,bn,bj,bl;function Q(){function bp(bq){bo=bq;k(bl,bo);bl.ready(true)}bn();bl.ready(false);bl.getChoices(bp)}function bm(){function bp(){var br,bq,bs;bl.getValue(function(bt){if(bt){bs=[];if(bo.length>0){for(br=0;br<bt.length;br+=1){for(bq=0;bq<bo.length;bq+=1){if(bt[br]===bo[bq].value){bs.push(bo[bq].label);break}}}bs=bs.join(", ")}else{bs=""}bk.question.find("h4").html(bs)}else{bk.question.find("h4").html("")}})}bj(bp)}bl=ar(bk);bn=bl.initialize;bl.initialize=Q;bj=bl.load;bl.load=bm;return bl}aW=function(bn,bl){var bj,bm,Q,bk;if(!bn||!bl){return}bm=x(bl);bj=V[bm];if(bj!==undefined){return bj}Q={};Q.page=aH(bn);Q.question=aH(bl);switch(I(Q.question)){case W.actionListInline:bk=ad(Q);break;case W.actionListPopup:bk=av(Q);break;case W.audioInline:bk=a9(Q);break;case W.audioPopup:bk=A(Q);break;case W.barcodeInline:bk=g(Q);break;case W.barcodePopup:bk=f(Q);break;case W.checkboxInline:bk=a1(Q);break;case W.checkboxPopup:bk=aN(Q);break;case W.comboInline:bk=M(Q);break;case W.comboPopup:bk=Y(Q);break;case W.compoundInline:bk=a3(Q);break;case W.compoundPopup:bk=aT(Q);break;case W.dateInline:bk=bh(Q);break;case W.datePopup:bk=a8(Q);break;case W.filteredListInline:bk=aE(Q);break;case W.filteredListPopup:bk=n(Q);break;case W.gridInline:bk=c(Q);break;case W.gridPopup:bk=D(Q);break;case W.imageInline:bk=R(Q);break;case W.imagePopup:bk=e(Q);break;case W.imageMapInline:bk=C(Q);break;case W.imageMapPopup:bk=F(Q);break;case W.labelInline:bk=al(Q);break;case W.labelPopup:bk=a5(Q);break;case W.listInline:bk=aS(Q);break;case W.listPopup:bk=v(Q);break;case W.locationInline:bk=X(Q);break;case W.mapInline:bk=ai(Q);break;case W.mapPopup:break;case W.notesInline:bk=a7(Q);break;case W.notesPopup:bk=aR(Q);break;case W.numberInline:bk=bf(Q);break;case W.numberPopup:bk=a4(Q);break;case W.numberRangeInline:bk=aA(Q);break;case W.numberRangePopup:bk=H(Q);break;case W.passwordInline:bk=B(Q);break;case W.passwordPopup:bk=a2(Q);break;case W.photoInline:bk=ap(Q);break;case W.photoPopup:bk=ac(Q);break;case W.processSelectorInline:bk=aq(Q);break;case W.processSelectorPopup:bk=aD(Q);break;case W.radioInline:bk=an(Q);break;case W.radioPopup:bk=bi(Q);break;case W.selectionInline:bk=aF(Q);break;case W.selectionPopup:bk=bd(Q);break;case W.signatureInline:bk=s(Q);break;case W.sketchInline:bk=aM(Q);break;case W.sketchPopup:bk=m(Q);break;case W.subjectSelectorInline:bk=bg(Q);break;case W.subjectSelectorPopup:bk=be(Q);break;case W.textInline:bk=aP(Q);break;case W.textPopup:bk=z(Q);break;case W.timeInline:bk=J(Q);break;case W.timePopup:bk=ao(Q);break;case W.toggleInline:bk=a(Q);break;case W.togglePopup:bk=af(Q);break}V[bm]=bk;return bk};V=[];U="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";if(aU.isTouch){a0=(new RegExp("iPhone","i")).test(navigator.userAgent);if(a0===true){T=(new RegExp("iPhone OS 4","i")).test(navigator.userAgent)}else{a0=(new RegExp("iPad","i")).test(navigator.userAgent);if(a0===true){T=true}else{a0=(new RegExp("Android","i")).test(navigator.userAgent);T=false}}}W={actionListInline:"actionListInline",actionListPopup:"actionListPopup",audioInline:"audioInline",audioPopup:"audioPopup",barcodeInline:"barcodeInline",barcodePopup:"barcodePopup",checkboxInline:"checkboxInline",checkboxPopup:"checkboxPopup",comboInline:"comboInline",comboPopup:"comboPopup",compoundInline:"compoundInline",compoundPopup:"compoundPopup",dateInline:"dateInline",datePopup:"datePopup",filteredListInline:"filteredListInline",filteredListPopup:"filteredListPopup",gridInline:"gridInline",gridPopup:"gridPopup",imageInline:"imageInline",imagePopup:"imagePopup",imageMapInline:"imageMapInline",imageMapPopup:"imageMapPopup",labelInline:"labelInline",labelPopup:"labelPopup",listInline:"listInline",listPopup:"listPopup",locationInline:"locationInline",mapInline:"mapInline",mapPopup:"mapPopup",notesInline:"notesInline",notesPopup:"notesPopup",numberInline:"numberInline",numberPopup:"numberPopup",numberRangeInline:"numberRangeInline",numberRangePopup:"numberRangePopup",passwordInline:"passwordInline",passwordPopup:"passwordPopup",photoInline:"photoInline",photoPopup:"photoPopup",processSelectorInline:"processSelectorInline",processSelectorPopup:"processSelectorPopup",radioInline:"radioInline",radioPopup:"radioPopup",selectionInline:"selectionInline",selectionPopup:"selectionPopup",signatureInline:"signatureInline",sketchInline:"sketchInline",sketchPopup:"sketchPopup",subjectSelectorInline:"subjectSelectorInline",subjectSelectorPopup:"subectSelectorPopup",textInline:"textInline",textPopup:"textPopup",timeInline:"timeInline",timePopup:"timePopup",toggleInline:"toggleInline",togglePopup:"togglePopup"};aQ.q=aW;aQ.q.designData=ba;aQ.q.ready=G;aQ.q.refresh=function(bj,Q,bl){var bk;bk=aQ.q(bj,Q);if(bk){bk.refresh(bl)}};aQ.q.show=function(Q){o(Q,true)};aQ.q.hide=function(Q){o(Q,false)};aQ.q.isHidden=am;aQ.q.enable=function(bj,Q){var bk;bk=aQ.q(bj,Q);if(bk){bk.enable(true)}};aQ.q.disable=function(bj,Q){var bk;bk=aQ.q(bj,Q);if(bk){bk.enable(false)}};w="&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;";if(aU.isIE||aU.isBlackberry){O={editActionListPage:'<div class="jmuiHeader"><div class="jmuiToolbar"><h1>Info</h1><div class="jmuiBackButton">Back</div></div></div><div class="jmuiNativeScroller"><div><div class="md_popupQuestionContainer"><h2></h2><ul></ul></div></div></div></div>',editBarcodePage:'<div class="jmuiHeader"><div class="jmuiToolbar"><h1>Edit</h1><div class="jmuiCancelButton">Cancel</div><div class="jmuiActionButton">Save</div></div></div><div class="jmuiNativeScroller"><div><div class="md_popupQuestionContainer"><h2></h2><ul><li><div class="jmuiPlaceholder"></div><div class="jmuiScanresult"></div></li></ul></div></div></div></div>',editCheckboxPage:'<div class="jmuiHeader"><div class="jmuiToolbar"><h1>Edit</h1><div class="jmuiCancelButton">Cancel</div><div class="jmuiActionButton">Save</div></div></div><div class="jmuiNativeScroller"><div><div class="md_popupQuestionContainer"><h2></h2><ul></ul></div></div></div>',editComboPage:'<div class="jmuiHeader"><div class="jmuiToolbar"><h1>Edit</h1><div class="jmuiCancelButton">Cancel</div><div class="jmuiActionButton">Save</div></div></div><div class="jmuiNativeScroller"><div><div class="md_popupQuestionContainer"><h2></h2><ul><li><div class="jmuiCompositeArrow"></div><div class="jmuiCompositeInput"><select style="display:none"></select><input type="text" value="" /></div><div class="jmuiMask"></div></li></ul></div></div></div>',editCompoundPage:'<div class="jmuiHeader"><div class="jmuiToolbar"><h1>Edit</h1><div class="jmuiBackButton">Back</div></div></div><div class="jmuiNativeScroller"><div><div class="md_popupQuestionContainer"><h2></h2><ul></ul></div></div></div>',editDatePage:'<div class="jmuiHeader"><div class="jmuiToolbar"><h1>Edit</h1><div class="jmuiCancelButton">Cancel</div><div class="jmuiActionButton">Save</div></div></div><div class="jmuiNativeScroller"><div><div class="md_popupQuestionContainer"><h2></h2><ul><li><div class="jmuiCompositeClear"></div><div class="jmuiCompositeDate">&nbsp;</div></li></ul></div></div></div>',editGridPage:'<div class="jmuiHeader"><div class="jmuiToolbar"><h1>Info</h1><div class="jmuiBackButton">Back</div></div></div><div class="jmuiNativeScroller"><div><ul></ul></div></div></div></div>',editImagePage:'<div class="jmuiHeader"><div class="jmuiToolbar"><h1>Info</h1><div class="jmuiBackButton">Back</div></div></div><div class="jmuiNativeScroller"><div><div class="md_popupQuestionContainer"><h2></h2><ul><li><img width="100%"></li></ul></div></div></div></div>',editImageMapPage:'<div class="jmuiHeader"><div class="jmuiToolbar"><h1>Edit</h1><div class="jmuiActionButton">Done</div></div></div><div class="jmuiNativeScroller"><div><div class="md_popupQuestionContainer"><h2></h2><ul><li><div style="position:relative"><img width="100%"></div></li></ul></div></div></div></div>',editListPage:'<div class="jmuiHeader"><div class="jmuiToolbar"><h1>Edit</h1><div class="jmuiActionButton">Done</div></div></div><div class="jmuiNativeScroller"><div><div class="md_popupQuestionContainer"><h2></h2><ul></ul></div></div></div></div>',editNotesPage:'<div class="jmuiHeader"><div class="jmuiToolbar"><h1>Edit</h1><div class="jmuiCancelButton">Cancel</div><div class="jmuiActionButton">Save</div></div></div><div class="jmuiNativeScroller"><div><div class="md_popupQuestionContainer"><h2></h2><ul><li><textarea style="height:8em;"></textarea><div class="jmuiMask"></div></li></ul></div></div></div></div>',editNumberPage:'<div class="jmuiHeader"><div class="jmuiToolbar"><h1>Edit</h1><div class="jmuiCancelButton">Cancel</div><div class="jmuiActionButton">Save</div></div></div><div class="jmuiNativeScroller"><div><div class="md_popupQuestionContainer"><h2></h2><ul><li><input type="text" value="" pattern="[0-9]*"/><div class="jmuiMask"></div></li></ul></div></div></div></div>',editNumberRangePage:'<div class="jmuiHeader"><div class="jmuiToolbar"><h1>Edit</h1><div class="jmuiCancelButton">Cancel</div><div class="jmuiActionButton">Save</div></div></div><div class="jmuiNativeScroller"><div><div class="md_popupQuestionContainer"><h2></h2><ul><li><div class="jmuiCompositeClear"></div><div class="jmuiCompositeNumber">&nbsp;</div></li></ul></div></div></div>',editPasswordPage:'<div class="jmuiHeader"><div class="jmuiToolbar"><h1>Edit</h1><div class="jmuiCancelButton">Cancel</div><div class="jmuiActionButton">Save</div></div></div><div class="jmuiNativeScroller"><div><div class="md_popupQuestionContainer"><h2></h2><ul><li><input type="password" value=""/><div class="jmuiMask"></div></li></ul></div></div></div></div>',editRadioPage:'<div class="jmuiHeader"><div class="jmuiToolbar"><h1>Edit</h1><div class="jmuiCancelButton">Cancel</div><div class="jmuiActionButton">Save</div></div></div><div class="jmuiNativeScroller"><div><div class="md_popupQuestionContainer"><h2></h2><ul></ul></div></div></div>',editPhotoPage:'<div class="jmuiHeader"><div class="jmuiToolbar"><h1>Edit</h1><div class="jmuiCancelButton">Cancel</div><div class="jmuiActionButton">Save</div></div></div><div class="jmuiNativeScroller"><div><div class="md_popupQuestionContainer"><h2></h2><ul><li><img alt="add photo"/></li></ul></div></div></div></div>',editSketchPage:'<div class="jmuiHeader"><div class="jmuiToolbar"><h1>Edit</h1><div class="jmuiCancelButton">Cancel</div><div class="jmuiActionButton">Save</div></div></div><div class="jmuiNativeScroller"><div><div class="md_popupQuestionContainer"><h2></h2><ul><li class="jmuiColorPress"><div class="jsig"></div></li></ul></div></div></div>',editTextPage:'<div class="jmuiHeader"><div class="jmuiToolbar"><h1>Edit</h1><div class="jmuiCancelButton">Cancel</div><div class="jmuiActionButton">Save</div></div></div><div class="jmuiNativeScroller"><div><div class="md_popupQuestionContainer"><h2></h2><ul><li><input type="text" value=""/><div class="jmuiMask"></div></li></ul></div></div></div></div>',editTimePage:'<div class="jmuiHeader"><div class="jmuiToolbar"><h1>Edit</h1><div class="jmuiCancelButton">Cancel</div><div class="jmuiActionButton">Save</div></div></div><div class="jmuiNativeScroller"><div><div class="md_popupQuestionContainer"><h2></h2><ul><li><div class="jmuiCompositeClear"></div><div class="jmuiCompositeTime">&nbsp;</div></li></ul></div></div></div>',editTogglePage:'<div class="jmuiHeader"><div class="jmuiToolbar"><h1>Edit</h1><div class="jmuiCancelButton">Cancel</div><div class="jmuiActionButton">Save</div></div></div><div class="jmuiNativeScroller"><div><div class="md_popupQuestionContainer"><h2></h2><ul></ul></div></div></div>'}}else{O={editActionListPage:'<div class="jmuiHeader"><div class="jmuiToolbar"><h1>Info</h1><div class="jmuiBackButton">Back</div></div></div><div class="jmuiScroller"><div><div class="md_popupQuestionContainer"><h2></h2><ul></ul></div></div></div></div>',editBarcodePage:'<div class="jmuiHeader"><div class="jmuiToolbar"><h1>Edit</h1><div class="jmuiCancelButton">Cancel</div><div class="jmuiActionButton">Save</div></div></div><div class="jmuiScroller"><div><div class="md_popupQuestionContainer"><h2></h2><ul><li><div class="jmuiPlaceholder"></div><div class="jmuiScanresult"></div></li></ul></div></div></div></div>',editCheckboxPage:'<div class="jmuiHeader"><div class="jmuiToolbar"><h1>Edit</h1><div class="jmuiCancelButton">Cancel</div><div class="jmuiActionButton">Save</div></div></div><div class="jmuiScroller"><div><div class="md_popupQuestionContainer"><h2></h2><ul></ul></div></div></div>',editComboPage:'<div class="jmuiHeader"><div class="jmuiToolbar"><h1>Edit</h1><div class="jmuiCancelButton">Cancel</div><div class="jmuiActionButton">Save</div></div></div><div class="jmuiScroller"><div><div class="md_popupQuestionContainer"><h2></h2><ul><li><div class="jmuiCompositeArrow"></div><div class="jmuiCompositeInput"><select style="display:none"></select><input type="text" value="" /></div><div class="jmuiMask"></div></li></ul></div></div></div>',editCompoundPage:'<div class="jmuiHeader"><div class="jmuiToolbar"><h1>Edit</h1><div class="jmuiBackButton">Back</div></div></div><div class="jmuiScroller"><div><div class="md_popupQuestionContainer"><h2></h2><ul></ul></div></div></div>',editDatePage:'<div class="jmuiHeader"><div class="jmuiToolbar"><h1>Edit</h1><div class="jmuiCancelButton">Cancel</div><div class="jmuiActionButton">Save</div></div></div><div class="jmuiScroller"><div><div class="md_popupQuestionContainer"><h2></h2><ul><li><div class="jmuiCompositeClear"></div><div class="jmuiCompositeDate">&nbsp;</div></li></ul></div></div></div>',editGridPage:'<div class="jmuiHeader"><div class="jmuiToolbar"><h1>Info</h1><div class="jmuiBackButton">Back</div></div></div><div class="jmuiScroller"><div><ul></ul></div></div></div></div>',editImagePage:'<div class="jmuiHeader"><div class="jmuiToolbar"><h1>Info</h1><div class="jmuiBackButton">Back</div></div></div><div class="jmuiScroller"><div><div class="md_popupQuestionContainer"><h2></h2><ul><li><img width="100%"></li></ul></div></div></div></div>',editImageMapPage:'<div class="jmuiHeader"><div class="jmuiToolbar"><h1>Edit</h1><div class="jmuiActionButton">Done</div></div></div><div class="jmuiScroller"><div><div class="md_popupQuestionContainer"><h2></h2><ul><li><div style="position:relative"><img width="100%"></div></li></ul></div></div></div></div>',editListPage:'<div class="jmuiHeader"><div class="jmuiToolbar"><h1>Edit</h1><div class="jmuiActionButton">Done</div></div></div><div class="jmuiScroller"><div><div class="md_popupQuestionContainer"><h2></h2><ul></ul></div></div></div></div>',editNotesPage:'<div class="jmuiHeader"><div class="jmuiToolbar"><h1>Edit</h1><div class="jmuiCancelButton">Cancel</div><div class="jmuiActionButton">Save</div></div></div><div class="jmuiScroller"><div><div class="md_popupQuestionContainer"><h2></h2><ul><li><textarea style="height:8em;"></textarea><div class="jmuiMask"></div></li></ul></div></div></div></div>',editNumberPage:'<div class="jmuiHeader"><div class="jmuiToolbar"><h1>Edit</h1><div class="jmuiCancelButton">Cancel</div><div class="jmuiActionButton">Save</div></div></div><div class="jmuiScroller"><div><div class="md_popupQuestionContainer"><h2></h2><ul><li><input type="text" value="" pattern="[0-9]*"/><div class="jmuiMask"></div></li></ul></div></div></div></div>',editNumberRangePage:'<div class="jmuiHeader"><div class="jmuiToolbar"><h1>Edit</h1><div class="jmuiCancelButton">Cancel</div><div class="jmuiActionButton">Save</div></div></div><div class="jmuiScroller"><div><div class="md_popupQuestionContainer"><h2></h2><ul><li><div class="jmuiCompositeClear"></div><div class="jmuiCompositeNumber">&nbsp;</div></li></ul></div></div></div>',editPasswordPage:'<div class="jmuiHeader"><div class="jmuiToolbar"><h1>Edit</h1><div class="jmuiCancelButton">Cancel</div><div class="jmuiActionButton">Save</div></div></div><div class="jmuiScroller"><div><div class="md_popupQuestionContainer"><h2></h2><ul><li><input type="password" value=""/><div class="jmuiMask"></div></li></ul></div></div></div></div>',editRadioPage:'<div class="jmuiHeader"><div class="jmuiToolbar"><h1>Edit</h1><div class="jmuiCancelButton">Cancel</div><div class="jmuiActionButton">Save</div></div></div><div class="jmuiScroller"><div><div class="md_popupQuestionContainer"><h2></h2><ul></ul></div></div></div>',editPhotoPage:'<div class="jmuiHeader"><div class="jmuiToolbar"><h1>Edit</h1><div class="jmuiCancelButton">Cancel</div><div class="jmuiActionButton">Save</div></div></div><div class="jmuiScroller"><div><div class="md_popupQuestionContainer"><h2></h2><ul><li><img alt="add photo"/></li></ul></div></div></div></div>',editSketchPage:'<div class="jmuiHeader"><div class="jmuiToolbar"><h1>Edit</h1><div class="jmuiCancelButton">Cancel</div><div class="jmuiActionButton">Save</div></div></div><div class="jmuiScroller"><div><div class="md_popupQuestionContainer"><h2></h2><ul><li class="jmuiColorPress"><div class="jsig"></div></li></ul></div></div></div>',editTextPage:'<div class="jmuiHeader"><div class="jmuiToolbar"><h1>Edit</h1><div class="jmuiCancelButton">Cancel</div><div class="jmuiActionButton">Save</div></div></div><div class="jmuiScroller"><div><div class="md_popupQuestionContainer"><h2></h2><ul><li><input type="text" value=""/><div class="jmuiMask"></div></li></ul></div></div></div></div>',editTimePage:'<div class="jmuiHeader"><div class="jmuiToolbar"><h1>Edit</h1><div class="jmuiCancelButton">Cancel</div><div class="jmuiActionButton">Save</div></div></div><div class="jmuiScroller"><div><div class="md_popupQuestionContainer"><h2></h2><ul><li><div class="jmuiCompositeClear"></div><div class="jmuiCompositeTime">&nbsp;</div></li></ul></div></div></div>',editTogglePage:'<div class="jmuiHeader"><div class="jmuiToolbar"><h1>Edit</h1><div class="jmuiCancelButton">Cancel</div><div class="jmuiActionButton">Save</div></div></div><div class="jmuiScroller"><div><div class="md_popupQuestionContainer"><h2></h2><ul></ul></div></div></div>'}}}(window.jmfw,window.Q,window.mCapture));function make_formula(b){var a,c;a={ExecState:{EXEC_CONTINUE:1,EXEC_ASYNC:2,EXECE_DONE:3},locals:{},state:1,is_done:false,invalid:function(d){if(this.is_done){var e="called "+d+" after done";alert(e);throw (e)}return this.is_done},onsuccess:null,onfailure:null,closure:undefined,getvar:function(d){return this.locals[d]},setvar:function(d,e){this.locals[d]=e},async:function(){return this.ExecState.EXEC_ASYNC},go_to:function(d){if(!this.invalid("go_to")){this.state=d;return this.ExecState.EXEC_CONTINUE}},exec:function(d){var f=this.ExecState.EXEC_CONTINUE;try{while(f===this.ExecState.EXEC_CONTINUE){f=this.generated(d)}switch(f){case this.ExecState.EXEC_ASYNC:break;case this.ExecState.EXEC_DONE:break;default:break}}catch(g){alert("Exception name: "+g.name+". Error message: "+g.message);this.onfailure(g)}},execute:function(f,d){var e;this.onsuccess=f;this.onfailure=d;for(e=2;e<arguments.length;e+=1){this.setvar("_arg"+(e-1),arguments[e])}this.exec()},done:function(d){if(!this.invalid("done")){this.is_done=true;this.onsuccess(d);return this.ExecState.EXEC_DONE}},resume:function(d){if(!this.invalid("resume")){this.exec(d)}}};a.generated=b;c={execute:function(){a.execute.apply(a,arguments)},resume:function(d){a.resume(d)}};a.closure=c;return c}var _bin2hex=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];var _hex2bin=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,0,0,0,0,0,0,0,10,11,12,13,14,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,11,12,13,14,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,];function bin2hex(d){var a=d.length;var f="";var b=0;var e;while(a-->0){e=d.charCodeAt(b++);f+=_bin2hex[(e&240)>>4];f+=_bin2hex[(e&15)]}return f}function hex2bin(e){var a=e.length;var f="";var c=0;var d;var b;while(a>1){h1=e.charAt(c++);d=h1.charCodeAt(0);h2=e.charAt(c++);b=h2.charCodeAt(0);f+=String.fromCharCode((_hex2bin[d]<<4)+_hex2bin[b]);a-=2}return f}BinaryParser=function(b,a){this.bigEndian=b,this.allowExceptions=a};with({p:BinaryParser.prototype}){p.encodeFloat=function(a,y,f){var d=Math.pow(2,f-1)-1,c=-d+1,m=d,x=c-y,l=isNaN(k=parseFloat(a))||k==-Infinity||k==+Infinity?k:0,e=0,t=2*d+1+y+3,h=new Array(t),u=(k=l!==0?0:k)<0,k=Math.abs(k),o=Math.floor(k),b=k-o,s,w,v,q,g;for(s=t;s;h[--s]=0){}for(s=d+2;o&&s;h[--s]=o%2,o=Math.floor(o/2)){}for(s=d+1;b>0&&s;(h[++s]=((b*=2)>=1)-0)&&--b){}for(s=-1;++s<t&&!h[s];){}if(h[(w=y-1+(s=(e=d+1-s)>=c&&e<=m?s+1:d+1-(e=c-1)))+1]){if(!(v=h[w])){for(q=w+2;!v&&q<t;v=h[q++]){}}for(q=w+1;v&&--q>=0;(h[q]=!h[q]-0)&&(v=0)){}}for(s=s-2<0?-1:s-3;++s<t&&!h[s];){}(e=d+1-s)>=c&&e<=m?++s:e<c&&(e!=d+1-t&&e<x&&this.warn("encodeFloat::float underflow"),s=d+1-(e=c-1));(o||l!==0)&&(this.warn(o?"encodeFloat::float overflow":"encodeFloat::"+l),e=m+1,s=d+2,l==-Infinity?u=1:isNaN(l)&&(h[s]=1));for(k=Math.abs(e+d),q=f+1,g="";--q;g=(k%2)+g,k=k>>=1){}for(k=0,q=0,s=(g=(u?"1":"0")+g+h.slice(s,s+y).join("")).length,r=[];s;k+=(1<<q)*g.charAt(--s),q==7&&(r[r.length]=String.fromCharCode(k),k=0),q=(q+1)%8){}r[r.length]=k?String.fromCharCode(k):"";return(this.bigEndian?r.reverse():r).join("")};p.encodeInt=function(d,e,b){var a=Math.pow(2,e),c=[];(d>=a||d<-(a>>1))&&this.warn("encodeInt::overflow")&&(d=0);d<0&&(d+=a);for(;d;c[c.length]=String.fromCharCode(d%256),d=Math.floor(d/256)){}for(e=-(-e>>3)-c.length;e--;c[c.length]="\0"){}return(this.bigEndian?c.reverse():c).join("")};p.decodeFloat=function(f,c,o){var m=((m=new this.Buffer(this.bigEndian,f)).checkBuffer(c+o+1),m),g=Math.pow(2,o-1)-1,k=m.readBits(c+o,1),l=m.readBits(c,o),j=0,d=2,a=m.buffer.length+(-c>>3)-1,e,h,n;do{for(e=m.buffer[++a],h=c%8||8,n=1<<h;n>>=1;(e&n)&&(j+=1/d),d*=2){}}while(c-=h);return l==(g<<1)+1?j?NaN:k?-Infinity:+Infinity:(1+k*-2)*(l||j?!l?Math.pow(2,-g+1)*j:Math.pow(2,l-g)*(1+j):0)};p.decodeInt=function(g,f,e){var d=new this.Buffer(this.bigEndian,g),c=d.readBits(0,f),a=Math.pow(2,f);return e&&c>=a/2?c-a:c};with({p:(p.Buffer=function(b,a){this.bigEndian=b||0,this.buffer=[],this.setBuffer(a)}).prototype}){p.readBits=function(b,d){function c(l,k){for(++k;--k;l=((l%=2147483647+1)&1073741824)==1073741824?l*2:(l-1073741824)*2+2147483647+1){}return l}if(b<0||d<=0){return 0}this.checkBuffer(b+d);for(var e,f=b%8,a=this.buffer.length-(b>>3)-1,j=this.buffer.length+(-(b+d)>>3),h=a-j,g=((this.buffer[a]>>f)&((1<<(h?8-f:d))-1))+(h&&(e=(b+d)%8)?(this.buffer[j++]&((1<<e)-1))<<(h--<<3)-f:0);h;g+=c(this.buffer[j++],(h--<<3)-f)){}return g};p.setBuffer=function(e){if(e){for(var c,d=c=e.length,a=this.buffer=new Array(c);d;a[c-d]=e.charCodeAt(--d)){}this.bigEndian&&a.reverse()}};p.hasNeededBits=function(a){return this.buffer.length>=-(-a>>3)};p.checkBuffer=function(a){if(!this.hasNeededBits(a)){throw new Error("checkBuffer::missing bytes")}}}p.warn=function(a){if(this.allowExceptions){throw new Error(a)}return 1};p.toSmall=function(a){return this.decodeInt(a,8,true)};p.fromSmall=function(a){return this.encodeInt(a,8,true)};p.toByte=function(a){return this.decodeInt(a,8,false)};p.fromByte=function(a){return this.encodeInt(a,8,false)};p.toShort=function(a){return this.decodeInt(a,16,true)};p.fromShort=function(a){return this.encodeInt(a,16,true)};p.toWord=function(a){return this.decodeInt(a,16,false)};p.fromWord=function(a){return this.encodeInt(a,16,false)};p.toInt=function(a){return this.decodeInt(a,32,true)};p.fromInt=function(a){return this.encodeInt(a,32,true)};p.toDWord=function(a){return this.decodeInt(a,32,false)};p.fromDWord=function(a){return this.encodeInt(a,32,false)};p.toFloat=function(a){return this.decodeFloat(a,23,8)};p.fromFloat=function(a){return this.encodeFloat(a,23,8)};p.toDouble=function(a){return this.decodeFloat(a,52,11)};p.fromDouble=function(a){return this.encodeFloat(a,52,11)}}function encode_utf8(a){return unescape(encodeURIComponent(a))}function decode_utf8(a){return decodeURIComponent(escape(a))}function encode_base64(e){var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var c="";var b=e.length;var a,g;var f=0;while(b-->0){a=e.charCodeAt(f++)&255;c+=d.charAt((a>>2)&63);if(b--<=0){c+=d.charAt((a<<4)&63);c+="==";break}g=e.charCodeAt(f++)&255;c+=d.charAt(((a<<4)|((g>>4)&15))&63);if(b--<=0){c+=d.charAt((g<<2)&63);c+="=";break}a=e.charCodeAt(f++)&255;c+=d.charAt(((g<<2)|((a>>6)&3))&63);c+=d.charAt(a&63)}return c}function encode_base64_arr(e){var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var c="";var b=e.length;var a,g;var f=0;while(b-->0){a=e[f++];c+=d.charAt((a>>2)&63);if(b--<=0){c+=d.charAt((a<<4)&63);c+="==";break}g=e[f++];c+=d.charAt(((a<<4)|((g>>4)&15))&63);if(b--<=0){c+=d.charAt((g<<2)&63);c+="=";break}a=e[f++];c+=d.charAt(((g<<2)|((a>>6)&3))&63);c+=d.charAt(a&63)}return c}function decode_base64(d){var e=new Array(255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,62,255,255,255,63,52,53,54,55,56,57,58,59,60,61,255,255,255,255,255,255,255,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,255,255,255,255,255,255,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,255,255,255,255,255);var c="";var b=d.length;var a,g;var f=0;while(!isNaN(a=d.charCodeAt(f++))){if(a==13||a==10){continue}if((a>127)||((a=e[a])==255)){return false}if((isNaN(g=d.charCodeAt(f++)))||((g=e[g])==255)){return false}c+=String.fromCharCode((a<<2)|(g>>4));if((a=d.charCodeAt(f++))==61){if((d.charCodeAt(f++)!=61)||(!isNaN(d.charCodeAt(f)))){return false}}else{if((a>127)||((a=e[a])==255)){return false}c+=String.fromCharCode((g<<4)|(a>>2));if((g=d.charCodeAt(f++))==61){if(!isNaN(d.charCodeAt(f))){return false}}else{if((g>127)||((g=e[g])==255)){return false}c+=String.fromCharCode((a<<6)|g)}}}return c}function wrap76(c){var a="";var b;for(b=0;b<c.length;b+=76){a+=c.substring(b,b+76)+String.fromCharCode(13)+String.fromCharCode(10)}return a}function dec2hex(f){f=parseInt(f);var e="ABCDEF";var a=f/16;var d=f%16;a=a-(d/16);a=((a>=0)&&(a<=9))?a:e.charAt(a-10);return((d>=0)&&(d<=9))?a+""+d:a+""+e.charAt(d-10)}function hex2dec(a){return hexchars.indexOf(a.toUpperCase())}function fromInteger(a){return encodeInt(a,32,false)}function encodeInt(d,e,b){var f=true;var a=Math.pow(2,e),c=[];(d>=a||d<-(a>>1))&&this.warn("encodeInt::overflow")&&(d=0);d<0&&(d+=a);for(;d;c[c.length]=String.fromCharCode(d%256),d=Math.floor(d/256)){}for(e=-(-e>>3)-c.length;e--;c[c.length]="\0"){}return(f?c.reverse():c).join("")}function parseIsoDate(a){return Date.parseExact(a,"yyyy-MM-dd HH:mm:ssZ")}function parseIsoDateOld(d){var c=/(\d\d\d\d)\D?(\d\d)\D?(\d\d)\D?(\d\d)\D?(\d\d\D?(\d\d\.?(\d*))?)(Z|[+-]\d\d?(:\d\d)?)?/;var b=c(d).slice(1).map(function(a,e){if(e==6&&a){a=parseInt(a,10)/Math.pow(10,a.length)*1000}return parseInt(a,10)||0});return new Date(Date.UTC(b[0],b[1]-1,b[2],b[3]-(b[7]||0),b[4],b[5],b[6]))}function isJSONDate(c){var b=/^(\d{4})-(\d{2})-(\d{2})[T\s](\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)Z$/.exec(c);return b}function makeDateFromJSONString(c){var b=/^(\d{4})-(\d{2})-(\d{2})[T\s](\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)Z$/.exec(c);if(b){return new Date(Date.UTC(+b[1],+b[2]-1,+b[3],+b[4],+b[5],+b[6]))}}function removeBOM(a){var d=a.charCodeAt(0);var c=a.charCodeAt(1);var b=a.charCodeAt(2);if((d==63471&&c==63419&&b==63423)||(d==239&&c==187&&b==191)){a=a.substr(3)}return a}function getUrlVars(){return window.locationUtils.getURI().query(true)}function removeF7s(b){var d="";for(var a=0;a<b.length;a+=1){var e=b.charCodeAt(a);if(e>63232){e=e-63232}d+=String.fromCharCode(e)}return d}var CTBinaryReader,Protocol,ReplicationResult;Protocol={EndSessionRequestTag:"00",GetNotificationRequestTag:"01",KeepAliveRequestTag:"02",LogMessageRequestTag:"03",ReplicateRequestTag:"04",RetrieveRequestTag:"05",StartSessionRequestTag:"06",FastLookupRequestTag:"07",EndSessionResponseTag:"10",GetNotificationResponseTag:"11",KeepAliveResponseTag:"12",ReplicateResponseTag:"14",RetrieveResponseTag:"15",StartSessionResponseTag:"16",FastLookupResponseTag:"17",AcknowledgementsTag:"20",CommandsTag:"21",SyncItemTag:"22",SyncListTag:"23",CreateItemTag:"30",DeleteItemTag:"31",ModifyItemTag:"32",ItemCreatedTag:"40",ItemDeletedTag:"41",ItemModifiedTag:"42",ApplicationIdTag:"50",ContextTag:"51",ErrorTag:"52",ItemDataTag:"53",ItemIdTag:"54",NotificationTag:"55",SyncDataTag:"56",UsernameTag:"57",GetServerChangesTag:"60",IsPartialTag:"61",MaxNumCommandsTag:"62",MoreAvailableTag:"63",ShouldContinueTag:"64"};ReplicationResult={Completed:0,Unknown:1,Aborted:2,EngineRequiredToRun:3,GenricEngineFailure:4,EngineException:5,NoPluginsRegistered:6,FailedToLoadPlugin:7,NoCommandsToProcess:8,ConnectionFailure:9,ConnectionLost:10,TimeoutWaitingForServer:11,UnknownNotificationCode:12,FailedToStartSession:13,UserTimeout:14,FailedToLaunchEngine:15,NotAuthenticated:16};CTBinaryReader=function(a){this._buffer=a;this._pos=0};CTBinaryReader.prototype={peekTag:function(){return window.dec2hex(this._peekUInt8())},readTag:function(){return window.dec2hex(this._readUInt8())},readInteger:function(){return this._readUInt32BE()},readBinary:function(){var a=this.readInteger();return this._readString(a)},readString:function(){var b,a;b=this.readBinary();a=window.decode_utf8(b);return a},seek:function(a){this._pos=a;this._checkSize(0)},getPosition:function(){return this._pos},getSize:function(){return this._buffer.length},_readInt8:function(){return this._decodeInt(8,true)},_readUInt8:function(){return this._decodeInt(8,false)},_readInt16:function(){return this._decodeInt(16,true)},_readUInt16:function(){return this._decodeInt(16,false)},_readInt32:function(){return this._decodeInt(32,true)},_readUInt32:function(){return this._decodeInt(32,false)},_readFloat:function(){return this._decodeFloat(23,8)},_readDouble:function(){return this._decodeFloat(52,11)},_readChar:function(){return this._readString(1)},_readString:function(b){if(b==0){return""}this._checkSize(b*8);var a=this._buffer.substr(this._pos,b);this._pos+=b;return a},_readUInt32BE:function(){var d,c,b,a,e;d=this._readUInt8();c=this._readUInt8();b=this._readUInt8();a=this._readUInt8();e=a+(b*256)+(c*65536)+(d*16777216);return e},_peekUInt8:function(){var a=this._readUInt8();this.seek(this.getPosition()-1);return a},_decodeFloat:function(b,n){var f,e,a,c,k,d,m,j,h,l,g;d=b+n+1;l=d>>3;this._checkSize(d);f=Math.pow(2,n-1)-1;j=this._readBits(b+n,1,l);k=this._readBits(b,n,l);h=0;c=2;a=d+(-b>>3)-1;do{e=this._readByte(++a,l);g=b%8||8;m=1<<g;while((m>>=1)!==0){if(e&m){h+=1/c}c*=2}}while((b-=g)!==0);this._pos+=l;return k==(f<<1)+1?h?NaN:j?-Infinity:+Infinity:(1+j*-2)*(k||h?!k?Math.pow(2,-f+1)*h:Math.pow(2,k-f)*(1+h):0)},_decodeInt:function(e,d){var c,b,a;a=this._readBits(0,e,e/8);c=Math.pow(2,e);b=d&&a>=c/2?a-c:a;this._pos+=e/8;return b},_shl:function(d,c){++c;while(--c){d=((d%=2147483647+1)&1073741824)==1073741824?d*2:(d-1073741824)*2+2147483647+1}return d},_readByte:function(b,a){return this._buffer.charCodeAt(this._pos+a-b-1)&255},_readBits:function(b,c,j){var a,g,h,d,e,f;d=(b+c)%8;e=b%8;a=j-(b>>3)-1;h=j+(-(b+c)>>3);g=a-h;f=(this._readByte(a,j)>>e)&((1<<(g?8-e:c))-1);if(g&&d){f+=(this._readByte(h++,j)&((1<<d)-1))<<(g--<<3)-e}while(g){f+=this._shl(this._readByte(h++,j),(g--<<3)-e)}return f},_checkSize:function(a){if((this._pos+Math.ceil(a/8))>this._buffer.length){throw new Error("Index out of bound")}}};function makeBinary(e,b){var d,a,c;d=new window.BinaryParser(true,true);c="";if(!b){a=e.length;c+=d.fromInt(a)}c+=e;return c}(function(f,h){var e;function b(){var j;j=localStorage.getItem("synclist");if(j==null){e=[]}else{e=JSON.parse(j)}}function d(){if(e){return e}b();return d()}function g(j,k){h.profiler.profileSync("replicatorSyncDataAdd",function(){var l=d();if(l.indexOf(j)!=-1){l.splice(l.indexOf(j),1)}l.push(j);h.db.setJsonItem("synclist",l);h.db.setJsonItem(j,k);b()})}function a(j){h.profiler.profileSync("replicatorSyncDataRemove",function(){var l,k;k=d();l=k.indexOf(j);if(l!=-1){k.splice(l,1);h.db.setJsonItem("synclist",k);localStorage.removeItem(j)}b()})}function c(j){return h.profiler.profileSync("replicatorSyncDataGetSyncData",function(){var k=h.db.getJsonItem(j);return k})}h.replsyncstore={add:g,remove:a,list:d,get_sync_data:c,refresh:b};f=undefined}(window.jmfw,window.mCapture));(function(L,t){var X,h,V,R,o,af,O,s,l,D,j,K,G,ac,e,F,N,b,Q,U;function T(){}function x(ag){G=ag}function B(ag){ac=ag}function E(ag){return ag.substr(45,8).toLowerCase()!==".subject"}function u(ag){Q=ag;if(ag==0){U=0}else{O()}}function ad(){return(Q==U)}function Y(ai){var ah,ag;ag=ai.substr(ai.indexOf("\\")+1,"0b7dd96e-4ac7-10c9-bb73-ff50f41a6c5c".length).toLowerCase();ah=ai.substring("subjects\\0b7dd96e-4ac7-10c9-bb73-ff50f41a6c5c\\".length).toLowerCase();return{subjectGuid:ag,attachmentName:ah}}function a(ag,ai,aj){var ah,ak;ah=t.db.getJsonItem("attachmentList");if(ah===undefined){ah={}}if(ah[ag]==undefined){ah[ag]={}}ak=undefined;if(aj.constructor==Date){ak=aj}else{ak=window.parseIsoDate(aj)}ah[ag][ai]=ak;t.db.setJsonItem("attachmentList",ah)}function Z(am,al,an){var ai,ah;function ag(ao){if(ao){an(ao)}else{an()}}try{if(al.substr(0,8).toLowerCase()=="subjects"){if(!E(al)){ah=al.substring(al.indexOf("\\")+1,al.indexOf("."));t.db.deleteSubjectInTransaction(am,ah,ag,false)}else{var aj=Y(al);t.db.deleteAttachmentInTransaction(am,aj.subjectGuid,aj.attachmentName,ag)}}else{throw ("Item: "+al+" is not a subject/attachment")}}catch(ak){log.error(ak);an(ak)}}function d(ai,ak,ao,ah,aq){var an,am,ag,al,ap;t.profiler.profileSync("DOMNodes2SubjectAndSummaries",function(){function av(ax,aw){var az,ay;az=L(ax).find("answer");if(az.length==0){ao.value[aw]=undefined}else{ay=az.text();ao.value[aw]=ay}}function at(ax,aw){var aA,az,ay;aA=L(ax).find("answer");if(aA.length==0){ao.value[aw]=undefined}else{az=aA.text();ay=window.makeDateFromJSONString(az);ao.value[aw]=ay}}function ar(ax,aw){var az,ay;az=L(ax).find("answer");if(az.length==0){ao.value[aw]=undefined}else{ay=az.text();ao.value[aw]=parseInt(ay,10)}}function au(ay,aw){var aB,ax,az,aA,aC;aB=[];aC=L(ay).find("answer > subtype").text();az=L(ay).find("answer > item");L(az).each(function(aE,aF){var aD;if(aC.constructor&&aC.constructor===String||typeof aC==="string"){if(aC=="number"){aD=parseInt(aF.textContent,10)}else{if(aC=="date"){if(window.isJSONDate(aF.textContent)){aD=window.makeDateFromJSONString(aF.textContent)}else{log.warn("Array subtype denotes date, but date not found in answer")}}else{aD=aF.textContent}}}else{log.warn("Array subtype is a non-string type: does subtype exist?- object = "+args[i].constructor)}aB.push(aD);aE=undefined});aA=L(ay).find("answer > object-item");L(aA).each(function(aD,aE){var aF={};L(aE.childNodes).each(function(aG,aH){if(aH.nodeType==document.ELEMENT_NODE){aF[aH.tagName]=aH.textContent}aG=undefined});aB.push(aF);aD=undefined});ax=L(ay).find("answer > array-item");L(ax).each(function(aD,aE){var aF=[];L(aE.childNodes).each(function(aH,aI){var aG;if(aI.nodeType==document.ELEMENT_NODE){aG=aI.textContent;if(window.isJSONDate(aG)){aG=window.makeDateFromJSONString(aG)}aF.push(aG)}aH=undefined});aB.push(aF);aD=undefined});ao.value[aw]=aB}log.trace("Importing into subject: "+ao.guid);ag=L(ak).find("answers metadata > *");L(ag).each(function(ax,aw){if(aw.nodeType!=document.TEXT_NODE){ap=aw.textContent;if(window.isJSONDate(ap)){ap=window.makeDateFromJSONString(ap)}ao.value._meta[aw.tagName]=ap}ax=undefined});an=[];am=[];ao.value._meta.summaries={};L(ah.summaryMap).each(function(aC,aA){var aB,ax,ay,aw,az;ay=L(ak).find("answers > summaries > summary");aw="";az="";aB=false;L(ay).each(function(aE,aD){aw=L(aD).find("alias").text();az=L(aD).find("value").text()||"";if(aw==aA){aB=true;return false}ax=false;L(ah.summaryMap).each(function(aF,aG){if(aG==aw){ax=true;return false}aF=undefined});if(!ax){am.push(az)}aE=undefined});if(aB){ao.value._meta.summaries[aw]=az;an.push(az)}else{log.warn("Subject Summary in summaryMap does not exist in subject: "+aA)}aC=undefined});an=an.concat(am);ag=L(ak).find("answers > syncinfo > item");ao.value._meta.syncInfo={};L(ag).each(function(aw,ay){var ax,az;ax=L(ay).find("alias").text();az=L(ay).find("value").text();if(az===undefined){az=""}ao.value._meta.syncInfo[ax]=az;aw=undefined});ag=L(ak).find("answers > stamps > question");ao.value._meta.positions={};L(ag).each(function(ay,aA){var ax,az,aw;az=L(aA).find("stamps");aw=L(az).find("version").text();if(aw!="1"){log.warn("stamp with version != 1");return true}ax=L(aA).find("dataid").text();ao.value._meta.positions[ax]={};ao.value._meta.positions[ax].coords={};ao.value._meta.positions[ax].coords.accuracy=L(az).find("coords > accuracy").text();ao.value._meta.positions[ax].coords.altitude=L(az).find("coords > altitude").text();ao.value._meta.positions[ax].coords.altitudeaccuracy=L(az).find("coords > altitudeaccuracy").text();ao.value._meta.positions[ax].coords.heading=L(az).find("coords > heading").text();ao.value._meta.positions[ax].coords.latitude=L(az).find("coords > latitude").text();ao.value._meta.positions[ax].coords.longitude=L(az).find("coords > longitude").text();ao.value._meta.positions[ax].coords.speed=L(az).find("coords > speed").text();ao.value._meta.positions[ax].timestamp=window.parseIsoDate(L(az).find("timestamp").text());ay=undefined});al=L(ak).find("answers > answers > question");L(al).each(function(az,ay){var aw,aB,aA,ax;aB=L(ay).find("dataid");if(aB.length==0){log.warn("Question "+az+" has no dataid.");return true}aw=aB.text();ax=L(ay).find("type");if(ax.length==0){log.warn("Question "+aw+" has no type.");return true}aA=ax.text();switch(aA){case"string":av(ay,aw);break;case"number":ar(ay,aw);break;case"array":au(ay,aw);break;case"date":at(ay,aw);break;default:log.warn("Unknown question type: "+aA+", on dataid: "+aw)}})});function aj(ar){if(ar!==undefined){aq("Failed to setSubject: "+ar)}else{aq(undefined)}}if(ai!==undefined){t.db.setSubjectInTransaction(ai,ao.guid,ao.value,true,aj,an)}else{t.db.setSubject(ao.guid,ao.value,true,aj,an)}}function m(al,ag,av,ap,au){var ah,ai,aj,aq,at,ar,ao,ak;ak=av;ak=window.removeBOM(ak);ao=t.profiler.profileSync("DOMParseFromString",function(){var ax=removeF7s(ak);var aw=decode_utf8(ax);return(new window.DOMParser()).parseFromString(aw,"text/xml")});ai=L(ao).find("answers > metadata > processId").text();ar=L(ao).find("answers > metadata > processVersion").text();aq={id:ai,version:ar};at=t.db.makeProcessName(aq);aj=t.db.getProcess(at);if(aj===undefined||aj===null){log.error("Process does not exist on device: "+at+", "+ag);au("Process does not exist on device: "+at+", "+ag,true);return}try{ah=L.Event;function an(aw){try{d(al,ao,aw,aj,au)}catch(ax){log.error("completeImport Failed: "+at+", "+ag);au("completeImport Failed: "+at+", "+ag+": "+ax)}}if(al!==undefined){t.db.createSubjectInTransaction(al,ai,ar,ag,an)}else{t.db.createSubject(ai,ar,ag,an)}}catch(am){log.error("createSubject Failed: "+at+", "+ag+": "+am.message);au("createSubject Failed: "+at+", "+ag+": "+am.message)}ap=undefined}function J(ak,ah,ai,ag,aj,al){a(ah,ai,aj);t.db.setAttachmentInTransaction(ak,ah,ai,ag,false,al)}function S(ag,ai){var ah=t.db.getJsonItem("attachmentList");if(ah!==undefined){if(ai===undefined){ah[ag]=undefined;t.db.setJsonItem("attachmentList",ah)}else{if(ah[ag]!==undefined&&ah[ag][ai]!==undefined){ah[ag][ai]=undefined;t.db.setJsonItem("attachmentList",ah)}}}}function c(ah,al,ap,ak,ao){var am,ag;function aj(aq){ao(aq)}try{if(al.substr(0,8).toLowerCase()=="subjects"){if(!E(al)){ag=al.substring(al.indexOf("\\")+1,al.indexOf("."));m(ah,ag,ap,ak,aj)}else{var an=Y(al);J(ah,an.subjectGuid,an.attachmentName,ap,ak,aj)}}else{throw ("Item: "+al+" is not a subject/attachment")}}catch(ai){log.error(ai);log.error(ai);aj(ai)}}function M(){if(s.length==0){return false}if(t.fs.availableForAtts){if(K){return true}if(N>=F){return true}if(ad()){log.debug("true - all requests in");return true}return false}return true}function y(ah){function ag(){K=false;log.warn("Fake Transaction Success");while(D.length>0){var ak=D.shift();ak.callback()}O()}function aj(ak){log.debug("Transaction depth: "+l);log.debug("Queue length: "+s.length);log.debug("Wait length: "+e);e++;var am=s.shift();N-=am.itemsize;function al(ao,an){log.debug("Data stored for : "+am.itemid+": "+(ao===undefined));X++;G(X);if(ao===undefined){log.debug("Pushing item onto _transaction_items");D.push(am)}else{if(typeof an=="undefined"||!an){D=[]}am.callback(ao)}o--;O(ak);setTimeout(function(){e--;if(e==0){ag(undefined)}},500)}o++;if(am.operation===R.Delete){log.debug("Deleting data for : "+am.itemid);Z(ak,am.itemid,al)}else{if(am.operation===R.Set){log.debug("Setting data for : "+am.itemid);c(ak,am.itemid,am.itemdata,am.syncdata,al)}}}if(M()){if(ah===undefined){function ai(ak){log.warn("Really exiting transaction here")}if(!K){K=true;e=0;t.db.startTransaction(function(ak){log.warn("Entered Transaction");l=0;if(s.length>0){aj(ak)}},ai);log.warn("Exited Transaction")}}else{l++;aj(ah)}}}function z(ai,aj){function ag(){aj()}var ah=Y(ai);t.fs.deleteAttachment(ah.subjectGuid,ah.attachmentName,ag,ag)}function f(ag){if(!ag){return false}if(ag.constructor==Array){return true}return !(!ag||(!ag.length||ag.length==0)||typeof ag!=="object"||!ag.constructor||ag.nodeType||ag.item)}function g(an){try{var aj,ao,ap,ak,ar,ag,av,aq,am,at,ai,al,au;ao=new window.DOMParser().parseFromString('<?xml version="1.0" encoding="utf-8"?><answers></answers>',"text/xml");av=ao.firstChild;au=ao.createElement("version");au.appendChild(ao.createTextNode("1"));av.appendChild(au);at=ao.createElement("summaries");av.appendChild(at);ai=ao.createElement("syncinfo");av.appendChild(ai);ak=ao.createElement("stamps");av.appendChild(ak);ap=ao.createElement("metadata");av.appendChild(ap);L.each(an._meta,function(aw,az){var ax,ay;switch(aw){case"summaries":L.each(az,function(aA,aB){var aD,aE,aC;aE=ao.createElement("summary");at.appendChild(aE);aD=ao.createElement("alias");aD.appendChild(ao.createTextNode(aA));aE.appendChild(aD);aC=ao.createElement("value");aC.appendChild(ao.createTextNode(aB));aE.appendChild(aC)});break;case"syncInfo":L.each(az,function(aA,aB){var aD,aE,aC;aE=ao.createElement("item");ai.appendChild(aE);aD=ao.createElement("alias");aD.appendChild(ao.createTextNode(aA));aE.appendChild(aD);aC=ao.createElement("value");aC.appendChild(ao.createTextNode(aB));aE.appendChild(aC)});break;case"positions":L.each(az,function(aB,aA){var aH,aE,aK,aI,aD,aN,aJ,aC,aL,aG,aF,aO,aM;aG=ao.createElement("question");ak.appendChild(aG);aD=ao.createElement("dataid");aD.appendChild(ao.createTextNode(aB));aG.appendChild(aD);aL=ao.createElement("stamps");aG.appendChild(aL);aM=ao.createElement("version");aM.appendChild(ao.createTextNode("1"));aL.appendChild(aM);aI=ao.createElement("coords");aL.appendChild(aI);aH=ao.createElement("accuracy");aH.appendChild(ao.createTextNode(aA.coords.accuracy));aI.appendChild(aH);aE=ao.createElement("altitude");aE.appendChild(ao.createTextNode(aA.coords.altitude));aI.appendChild(aE);aK=ao.createElement("altitudeaccuracy");aK.appendChild(ao.createTextNode(aA.coords.altitudeAccuracy));aI.appendChild(aK);aN=ao.createElement("heading");aN.appendChild(ao.createTextNode(aA.coords.heading));aI.appendChild(aN);aJ=ao.createElement("latitude");aJ.appendChild(ao.createTextNode(aA.coords.latitude));aI.appendChild(aJ);aC=ao.createElement("longitude");aC.appendChild(ao.createTextNode(aA.coords.longitude));aI.appendChild(aC);aF=ao.createElement("speed");aF.appendChild(ao.createTextNode(aA.coords.speed));aI.appendChild(aF);aO=ao.createElement("timestamp");aO.appendChild(ao.createTextNode(JSON.stringify(new Date(aA.timestamp)).replace(/\"/g,"")));aL.appendChild(aO)});break;default:if(az&&az.constructore==Date){az=JSON.stringify(az);az=az.replace(/\"/g,"")}ax=ao.createElement(aw);ay=ao.createTextNode(az);ax.appendChild(ay);ap.appendChild(ax)}});ar=ao.createElement("processId");ag=ao.createTextNode(an._meta.processId);ar.appendChild(ag);ap.appendChild(ar);aj=ao.createElement("answers");av.appendChild(aj);L.each(an,function(aP,aH){var ay,aK,aI,ax,aG,aw,aJ,aD,aF,aC,aL,aA,aN,aO,aB,aM,az;function aE(aT,aR){var aS,aQ;aS=ao.createElement(aT);aQ=ao.createTextNode(aR);aS.appendChild(aQ);aG.appendChild(aS)}aO=ao.createElement("question");if(aP=="_meta"){return true}aI=ao.createElement("dataid");ax=ao.createTextNode(aP);aI.appendChild(ax);aO.appendChild(aI);az=ao.createElement("answer");if(!L.isIE){az.setAttribute("xml:space","preserve")}aO.appendChild(az);if(aH!==undefined&&aH!==null){aB=typeof aH;if(f(aH)){aB="array"}if(aH.constructor==Date){aB="date"}aM=ao.createElement("type");aM.appendChild(ao.createTextNode(aB));aO.appendChild(aM);if(f(aH)){for(aK=0;aK<aH.length;aK++){ay=aH[aK];aL=typeof ay;if(f(ay)){aG=ao.createElement("array-item");for(aJ=0;aJ<ay.length;aJ++){aC=ay[aJ];aL=typeof aC;if(aC&&aC.constructor==Date){aC=JSON.stringify(aC);aC=aC.replace(/\"/g,"")}aD=ao.createElement("subitem");aF=ao.createTextNode(aC);aD.appendChild(aF);aG.appendChild(aD)}}else{if(ay&&ay.constructor.name=="Object"){aG=ao.createElement("object-item");L.each(ay,aE)}else{aG=ao.createElement("item");if(ay&&ay.constructor==Date){ay=JSON.stringify(ay);ay=ay.replace(/\"/g,"");aL="date"}if(ay===null||ay===undefined){aw=ao.createTextNode("")}else{aw=ao.createTextNode(ay)}aG.appendChild(aw)}}az.appendChild(aG)}aA=ao.createElement("subtype");aN=ao.createTextNode(aL);aA.appendChild(aN);az.appendChild(aA)}else{if(aH.constructor==Date){aH=JSON.stringify(aH);aH=aH.replace(/\"/g,"");aw=ao.createTextNode(aH);az.appendChild(aw)}else{aw=ao.createTextNode(aH);az.appendChild(aw)}}}aj.appendChild(aO)});aq=new window.XMLSerializer();am=aq.serializeToString(ao);al=window.encode_utf8(am);return al}catch(ah){return undefined}}function C(ag,ai){var ah;t.db.getSubject(ag,function(ak,aj){if(aj!==undefined){ai("",aj)}ah=g(ak);ai(ah)})}function ab(){var ag,ah;ah=[];lists=t.db.getProcessNames();ag=t.db.getJsonItem("attachmentList");if(ag!==undefined){L.each(ag,function(aj,ai){L.each(ai,function(ak){var al="subjects\\"+aj+"\\"+ak;ah.push(al)})})}return ah}function w(ah){var ai,ag,aj;aj=[];ag=t.db.getProcessNames();ai=t.db.getJsonItem("attachmentList");if(ai!==undefined){L.each(ai,function(al,ak){L.each(ak,function(am){var an="subjects\\"+al+"\\"+am;aj.push(an)})})}if(ag){L.each(ag,function(al,am){var ak,an;an=t.db.getProcess(am);if(an){if(an.home!==true){if(ah===true){if(an.isaprocess!==true){return true}}if(an.subjectGuids!==undefined){ak=an.subjectGuids.length;L.each(an.subjectGuids,function(ao,ap){var aq="subjects\\"+ap+".subject";aj.push(aq);ao=undefined})}}}else{log.warn("Process in process list does not exist on device: "+am)}al=undefined})}return aj}function q(){log.debug("clearing storage queues");s=[];N=0;X=0;Q=0;U=0}function I(ag){return t.fs.availableForAtts&&E(ag)}function H(ah,ai){var ag={operation:R.Delete,itemid:ah,itemsize:b};if(I(ah)){ag.callback=function(){z(ah,ai)}}else{ag.callback=ai}N+=ag.itemsize;s.push(ag);U++;O()}function A(ai,ag,ak,aj){var ah={operation:R.Set,itemid:ai,callback:aj,itemdata:ag,syncdata:ak,itemsize:(ag&&ag.length)?ag.length:b};N+=ah.itemsize;s.push(ah);U++;O()}O=function(ag){T();if(o<1&&t.repl.isReplicating()){y(ag)}};function ae(ah){var ai=[],ag=null;ag=t.db.getProcessNames();if(ag){L.each(ag,function(ak,al){var am=t.db.getProcess(al);if(am.home!==true){if(ah===true){if(am.isaprocess!==true){return true}}if(am.subjectGuids!==undefined){var aj=am.subjectGuids.length;L.each(am.subjectGuids,function(ao,ap){var an={};an.proc=am;an.sub=ap;ai.push(an)})}}})}return ai}function P(an,aj){function ah(aw,ap,au,at){var ar="",aq="",av="";if(aj===undefined||!aj){ar=t.fl.getenvironment("replicationErrorGuids");aq=t.fl.getenvironment("replicationErrorReports");av=t.fl.getenvironment("replicationErrorCodes")}L.each(aw,function(ay,aA){var ax=ap[ay];var az=au[ay];if(ar.length>0){ar+="|";aq+="|";av+="|"}ar+=ax;aq+=aA;av+=az});t.fl.setenvironment("replicationErrorGuids",ar);t.fl.setenvironment("replicationErrorReports",aq);t.fl.setenvironment("replicationErrorCodes",av);an(aw,at)}var ak,al=[],am=[],ag=[];if(an===undefined){throw"validateSubjects must be called with a callback"}try{ak=ae(false);if(ak===undefined){throw"16/data_list was undefined"}}catch(ai){ag.push(W(ai));al.push(ai);am.push("");ah(al,am,ag,true)}if(L.isIE){an([],false)}else{log.info("Validating: "+ak.length+" subjects...");var ao=window.openDatabase("mDesign","","mDesign",1048576);try{k(ao,ak,ah,al,am,ag)}catch(ai){ag.push(W(ai));al.push(ai);am.push("");ah(al,am,ag,true)}}}function k(au,al,ar,am,an,ah){if(al.length<=0){ar(am,an,ah);return}var ap=al.shift();var at=ap.sub;var ag=ap.proc;log.info("Validating: "+at);try{if(at.length!=36){throw"17/Subject guid: "+at+" has wrong length"}n(au,at,function(ax,aw){function az(){try{k(au,al,ar,am,an,ah)}catch(aC){am.push(aC);an.push(at);ah.push(W(aC));ar(am,an,ah,true);return}}try{if(aw!==undefined){throw"18/Could not get subject: "+at+" from the database: "+aw}if(ax===undefined){throw"19/Subject: "+at+" was undefined when fetched from database"}v(at,ax)}catch(aB){var av="Single subject problem found after receiving subject from callback: "+aB;am.push(aB);an.push(at);ah.push(W(aB));console.error(av);try{aa(at,ag,am,an,ah,az);return}catch(aA){var ay="23/Failed trying to fix error: "+aA+".  Original error: "+av;am.push(ay);an.push(at);ah.push(W(ay));ar(am,an,ah,true);return}}az()})}catch(ai){function aj(){try{k(au,al,ar,am,an,ah)}catch(av){am.push(av);an.push("");ah.push(W(av));ar(am,an,ah,true);return}}var ak="Single subject problem found before receiving subject from callback: "+ai;am.push(ai);an.push(at);ah.push(W(ai));console.error(ak);try{aa(at,ag,am,an,ah,aj);return}catch(ao){var aq="27/Failed trying to fix error: "+ao+".  Original error: "+ak;am.push(aq);an.push(at);ah.push(W(aq));ar(am,an,ah);return}aj()}}function v(ah,ag){if(ag._meta===undefined){throw"1/_meta property does not exist on subject"}if(ag._meta.completed===undefined||ag._meta.completed.constructor!==Boolean){throw"2/_meta.completed does not appear to be boolean"}if(ag._meta.created===undefined||ag._meta.created.constructor!==Date){throw"3/_meta.created does not appear to be a date"}if(ag._meta.deleted===undefined||ag._meta.deleted.constructor!==Boolean){throw"4/_meta.deleted does not appear to be a boolean"}if(ag._meta.guid===undefined||ag._meta.guid.constructor!==String){throw"5/_meta.guid does not appear to be a String"}if(ag._meta.guid.length!=36){throw"6/_meta.guid does not appear to be a valid guid"}if(ag._meta.modified===undefined||ag._meta.modified.constructor!==Date){throw"7/_meta.modified does not appear to be a date"}if(ag._meta.processId===undefined||ag._meta.processId.constructor!==String){throw"11/_meta.processid does not appear to be a String"}if(ag._meta.processId.length<45){throw"12/_meta.processId does not appear to be a valid processId"}if(ag._meta.processVersion===undefined||ag._meta.processVersion.constructor!==String){throw"13/_meta.processVersion does not appear to be a String"}if(ag._meta.summaries===undefined||ag._meta.summaries.constructor!==Object){throw"14/_meta.summaries does not appear to be an Object"}if(ag._meta.syncInfo===undefined||ag._meta.syncInfo.constructor!==Object){throw"15/_meta.syncInfo does not appear to be an Object"}}function W(ag){if(!ag.indexOf||ag.indexOf("/")<0){return"-1"}var ah=ag.split("/")[0];return parseInt(ah)}function aa(av,ag,ao,ap,ah,ar){function at(){console.warn("Removed database rows for guid: "+av);ao.push("24/Successfully erased all traces of "+av);ap.push(av);ah.push(24);ar(ao,ap,ah)}function an(aw){var ax="25/Failed to delete row in DB for "+av;console.error(ax);ao.push(ax);ap.push(av);ah.push(W(ax));ar(ao,ap,ah)}console.warn("Attempting to remove subject guid: "+av+" from process: "+ag.id);try{console.warn("Attempting to remove subject guid: "+av+" from sync list");var am=t.replsyncstore.list();L.each(am,function(aw,ax){if(ax.indexOf(av)>=0){t.replsyncstore.remove(ax);console.warn("Removed item id: "+ax+" from sync list")}})}catch(aq){var ak="20/Failed removing item from sync list: "+aq;console.error(ak);throw ak}try{var al=ag.subjectGuids.indexOf(av);ag.subjectGuids.splice(al,1);var aj=t.db.makeProcessName({id:ag.id,version:ag.version});t.db.setProcess(aj,ag);console.warn("Removed subject guid: "+av+" from process: "+ag.id);S(av);console.warn("Removed attachments on guid: "+av);console.warn("Removing database rows for guid: "+av);var au=window.openDatabase("mDesign","","mDesign",1048576);var ai=[av];au.transaction(function(aw){aw.executeSql("DELETE FROM attachment WHERE subjectGuid=?;",ai);aw.executeSql("DELETE FROM subject WHERE guid=?;",ai)},an,function(){if(t.fs.availableForAtts){t.fs.deleteAttachments(av,at,at)}else{at()}})}catch(aq){var ak="21/Failed removing item from data list: "+aq;console.error(ak);throw ak}}function n(ah,ag,aj,ai){ah.readTransaction(function(ap){var al,ao,an;function am(ar,aq){try{var au;if(aq&&aq.rows.length>0){au=L.jsonParse(aq.rows.item(0).answers);if(ai){ai=aq.rows.item(0);delete ai.answers}}aj(au,undefined,ai)}catch(at){aj(undefined,at)}}function ak(aq,ar){aj(undefined,ar)}ao=[ag];an="SELECT answers ";if(ai){for(al=0;al<50;al+=1){an+=", col"+al.toString()}}an+=" FROM subject WHERE guid = ?";ap.executeSql(an,ao,am,ak)})}V=parseInt(window.getUrlVars().debug,10);h=window.getUrlVars().dbtest;Q=0;U=0;K=false;D=[];s=[];N=0;F=256*1024;b=50;o=0;j=false;l=0;X=0;R={Delete:0,Set:1};t.replstore={set_command_count:u,profileResults:af,clear_storage_queue:q,delete_attachment_date:S,is_attachment:E,set_data:c,queue_delete_data:H,queue_set_data:A,get_subject_data_from_subject:g,get_subject_data:C,delete_data:Z,list:w,listofAttachments:ab,split_attachment_id:Y,store_attachment_date:a,setProgressCallback:x,setProgressMessageCallback:B,validateSubjects:P}}(window.jmfw,window.mCapture));(function(aQ,aL){var av,aV,k,aj,aK,v,az,a0,al,h,n,ak,ao,g,e,I,a9,aJ,aa,aE,w,aC,G,t,y,f,aF,aB,ai,a4,R,F,d,J,ae,j,ac,aZ,l,a3,B,aG,O,m,H,ah,at,aY,aH,ar,aX;function P(){var ba;log.trace("-> reset");log.debug("Resetting...");window.clearTimeout(ar);window.clearTimeout(aX);v=[];aL.replstore.clear_storage_queue();av=false;n=true;ak=false;ai=0;a4=0;R=0;F=0;d=[];J=0;ac=false;g=false;aZ=false;I=false;w=0;aC=0;G=0;aF=false;for(ba=0;ba<al.length;ba++){al[0].abort()}al=[];ah&&ah.refresh();W();log.info("Reset.");log.trace("<- reset")}function Q(bf,bc,be,bd){var bb,ba;ba={};ba.current=bf;ba.size=bc;ba.action=be;ba.overall=bd;if(isNaN(ba.overall)){ba.overall=0}for(bb=0;bb<a3.length;bb++){a3[0](ba)}}function a2(){log.trace("-> _timeoutReplication");if(!aE){if(av){log.fatal("Aborting replication due to timeout");P();Q(0,0,"Timed Out",0);B(window.ReplicationResult.TimeoutWaitingForServer)}}log.trace("<- _timeoutReplication")}function aW(ba){log.debug("Notification Received: "+ba.responseText)}function b(){var bc,bb,ba;bc=window.hex2bin(window.Protocol.GetNotificationRequestTag);bc+=window.fromInteger(60);bc=window.encode_base64(bc);ba=aL.db.getUserInfo();bb=new XMLHttpRequest();if(ba.mSuiteSerialNo==0){bb.open("POST",aB+"/CommonTime-Data-Replication?uniq="+Math.random(),true)}else{bb.open("POST",aB+"/CommonTime-Data-Replication?mcid="+ba.mSuiteSerialNo+"&uniq="+Math.random(),true)}bb.onreadystatechange=function(){aW(bb)};bb.setRequestHeader("Content-Type","application/x-commontime-data-replication-1.0");bb.overrideMimeType("text/plain; charset=x-user-defined");bb.send(bc);ao=true}function u(){log.trace("-> _notify_complete");log.info("Replication Finished");Q(100,0,"Finished",100);B(window.ReplicationResult.Completed);if(window.plugins&&window.plugins.sleep&&window.plugins.sleep.Enable){log.info("Enabling sleep");window.plugins.sleep.Enable(function(){log.info("Sleep enabled")},function(ba){log.warn("Sleep enable failed.")})}log.trace("<- _notify_complete")}function ay(){P();u()}function x(){var ba;ak=false;ba=window.hex2bin(window.Protocol.EndSessionRequestTag);log.debug("Sending End Session... ("+ba.length+")");k(ba)}function af(){var bd,ba,bc,bb,be;bd=window.hex2bin(window.Protocol.SyncListTag);bb=ah.list();for(ba in bb){bc=bb[ba];be=ah.get_sync_data(bc);log.debug("SyncList:  "+bc+": "+be);bd+=window.hex2bin(window.Protocol.SyncItemTag);bd+=window.hex2bin(window.Protocol.ItemIdTag);bd+=window.makeBinary(bc);bd+=window.hex2bin(window.Protocol.SyncDataTag);bd+=window.makeBinary(be)}return bd}function U(bc,ba){var bb;bb=window.hex2bin(window.Protocol.CreateItemTag);bb+=window.hex2bin(window.Protocol.ItemIdTag);bb+=window.makeBinary(bc);bb+=window.hex2bin(window.Protocol.ItemDataTag);bb+=window.makeBinary(ba);return bb}function E(bc,ba){var bb;bb=window.hex2bin(ba);bb+=window.hex2bin(window.Protocol.ItemIdTag);bb+=window.makeBinary(bc);return bb}function an(bc,ba){var bb;bb=window.hex2bin(window.Protocol.ModifyItemTag);bb+=window.hex2bin(window.Protocol.ItemIdTag);bb+=window.makeBinary(bc);bb+=window.hex2bin(window.Protocol.ItemDataTag);bb+=window.makeBinary(ba);return bb}function c(bb){var ba;ba=window.hex2bin(window.Protocol.DeleteItemTag);ba+=window.hex2bin(window.Protocol.ItemIdTag);ba+=window.makeBinary(bb);return ba}function aR(bc,bb,bd){var ba;if(t){ba=f/y}else{ba=G/aC}Q(Math.ceil(ba*100),bb,bd,Math.ceil(ba*100));bc=undefined}function aN(){log.info("Restarting replication");P();aV(B,aY);aZ=true}function aS(be){var ba,bd,bb;bb=plugins.authenticator;if(bb===undefined){bb=plugins.authenticate}bd=function(){log.debug("authentication success -> _restart_replication()");be(true)};ba=function(){if(be){log.debug("authentication failed -> callback()");be(false)}else{log.debug("authentication failed NO callback")}};try{log.warn("Using shell authenticator.auth");bb.auth(bd,ba)}catch(bc){log.error("authentication error : "+bc);if(be){log.error("authentication error -> callback()");be()}else{log.error("authentication error NO callback")}}}function V(){log.trace("-> abortReplication");if(av){log.error("Aborting replication");P();Q(0,0,"Aborted",0);B(window.ReplicationResult.Aborted)}log.trace("<- abortReplication")}function ap(bf,bb,bi,bh){var bm,bn,bt,bs,br,bd,bl,bk,be,bq,bg,bo,bj;function bp(bu){ai++;br=an(bj,bu)+br;log.info("Sending Modify: "+bj+" ("+br.length+")");ap(bf,bb,br,bh)}function bc(bu){aR(0,0,"Storing...");C(bj,bu);ai++;ap(bf,bb,br,bh)}function ba(bu){log.debug("Error Uploading Attachment (Modification): "+bd+" Error: "+JSON.stringify(bu));V()}if(bf%50==0){log.debug("Searching for client-side modifications ("+bf+"/"+bb.length+")");be=bf/bb.length;Q(Math.ceil(be*100),bb.length,"Calculating changes...",Math.ceil(be*100))}br=bi;if(bf>=bb.length){bh(br)}else{bq=bb[bf++];bj=bq.syncid;bo=bq.syncdata;bd=bq.dataitem;bg=bd.substr(bd.indexOf("\\")+1,36);if(bd.indexOf(".")>=0){aL.db.getSubject(bg,function(bw,bv){var bu,bx;if(bv!==undefined||bw===undefined){log.error("Failed to retreive subject from db: "+bd);ap(bf,bb,br,bh);return}aL.db.ensureReplDataPresent(bw);bx=bw._meta.syncInfo.cseq+":"+bw._meta.syncInfo.sseq;if(bo!=bx){bu=at.get_subject_data_from_subject(bw);if(bu!==undefined){ai++;br+=an(bj,bu);log.debug("Sending Modify: "+bj+" ("+br.length+")")}}ap(bf,bb,br,bh)})}else{bn=bd.substr(46);bm=aL.db.getJsonItem("attachmentList");if(bm!==undefined){bl=window.parseIsoDate(bo);bk=bm[bg][bn];console.log("modloop: "+bd+"syncdata1: "+bo+" date1: "+bl+" syncdata2: "+bm[bg][bn]+" date2: "+bk);bt=bl.getTime();bs=bk.getTime();if(bt!=bs){if(aL.fs.availableForAtts){log.debug("Uploading Attachment (Modified): "+bd);aR(0,0,"Sending modified attachment... ");aL.fs.uploadAttachment(bg,bn,bo,bc,ba)}else{aL.db.getAttachment(bg,bn,bp)}}else{ap(bf,bb,br,bh)}}else{ap(bf,bb,br,bh)}}}}function aI(bb,bf){var bd,ba,bc,be;log.trace("-> _build_device_created");var bd="";ba=at.list(true);bc=ah.list();be=ba.length;log.debug("Searching for client-side creates...");if(be==0){bf(bb)}if(ba){aQ.each(ba,function(bl,bg){var bj,bp,bo;function bk(br,bq){var bs;ai++;if(br===undefined){log.warn(1,"Ignoring corrupt subject: "+bg);if(--be==0){bf(bb+bd)}return}bs=bg;if(bq){bd=U(bs,br)+bd}else{bd+=U(bs,br)}log.info("Sending Create: "+bs+" ("+bd.length+")");if(--be==0){bf(bb+bd)}}function bi(bq){bk(bq,false)}function bh(bq){bk(bq,true)}function bm(bq){aR(0,0,"Storing...");C(bg,bq);if(--be==0){bf(bb+bd)}}function bn(bq){log.debug("Error Uploading Attachment (Create): "+bg+" Error: "+JSON.stringify(bq));V()}bp=bc.indexOf(bg)>=0;if(!bp){bo=bg.substr(bg.indexOf("\\")+1,36);if(bg.indexOf(".")>=0){at.get_subject_data(bo,bi)}else{bj=bg.substring(36+10,bg.length);if(aL.fs.availableForAtts){log.debug("Uploading Attachment (Create): "+bg);aR(0,0,"Sending new attachment...");aL.fs.uploadAttachment(bo,bj,null,bm,bn)}else{aL.db.getAttachment(bo,bj,bh)}}}else{if(--be==0){bf(bb+bd)}}bl=undefined})}log.trace("<- _build_device_created")}function T(bb,bf){var bd,ba,bc,be;bd=bb;log.debug("Searching for client-side deletes...");ba=at.list();bc=ah.list();be=bc.length;if(be==0){bf(bd)}if(bc){aQ.each(bc,function(bg,bj){var bi,bh,bk;bk=bj;bh=ba.indexOf(bk)>=0;if(!bh){bi=bj;ai++;bd+=c(bi);log.info("Sending Delete: "+bi+" ("+bd.length+")")}be--;if(be==0){bf(bd)}})}}function ad(bd,bf){var ba,bc,bb,be;log.debug("Searching for client-side modifications...");ba=at.list(true);bc=ah.list();bb=[];be=bc.length;if(be==0){bf(bd)}if(bc){aQ.each(bc,function(bg,bj){var bk,bi,bl;bl=bj;bi=ah.get_sync_data(bj);var bh=ba.indexOf(bl);if(bh>=0){bb.push({dataitem:ba[bh],syncid:bj,syncdata:bi})}if(--be==0){bk=0;ap(bk,bb,"",function(bm){bf(bd+bm)})}bg=undefined})}}function a7(bf){var bc,be,ba,bd,bb;g=true;bc="";ba=at.list();bb=ah.list();be="subjects\\"+aL.db.getCurrentSubjectGuid()+".subject";bd=true;aL.db.getSubject(aL.db.getCurrentSubjectGuid(),function(bj,bi){var bm,bh,bl,bn,bk,bg;if(bi!==undefined){log.error("Failed to retrieve item from database: "+be)}bm=false;aQ.each(bb,function(bo,bp){if(be==bp){bg=bp;bm=true;return false}bo=undefined});if(!bm){bl=be;bh=at.get_subject_data_from_subject(bj);log.debug("Sending Single Item Create: "+bl);ai++;bf(U(bl,bh));bd=false}bm=false;aQ.each(ba,function(bp,bo){if(be==bo){bm=true;return false}bp=undefined});if(!bm){bl=be;log.debug("Should be sending Single Item Delete, but I won't: "+bl)}if(bd){bk=ah.get_sync_data(bg);if(bk!==undefined&&bk.length>0){aL.db.ensureReplDataPresent(bj);bn=bj._meta.syncInfo.cseq+":"+bj._meta.syncInfo.sseq;if(bk!=bn){bh=at.get_subject_data_from_subject(bj);log.debug("Sending Single Item Modify: "+bg);ai++;bf(an(bg,bh));bd=false}}}if(bd){bf("")}})}function aM(bc){var bb;q();bb=window.hex2bin(window.Protocol.CommandsTag);if(aH.type=="normal"){log.debug("Started building commands");var ba=new Date().getTime();T(bb,function(bd){var be=new Date().getTime();log.debug("Completed deleted in "+(be-ba)+"ms");aI(bd,function(bg){var bf=new Date().getTime();log.debug("Completed created in "+(bf-be)+"ms");ad(bg,function(bi){var bh=new Date().getTime();log.debug("Completed modified in "+(bh-bf)+"ms");log.debug("Completed all in "+(bh-ba)+"ms");log.debug("Completed building commands ("+bi.length+")");bc(bi);W()})})})}else{a7(function(bd){bb+=bd;bc(bb);W()})}}function a6(bb){aF=false;var ba;ba=window.hex2bin(window.Protocol.ReplicateRequestTag);ba+=window.hex2bin(window.Protocol.GetServerChangesTag);ba+=window.hex2bin(window.Protocol.MaxNumCommandsTag);ba+=window.fromInteger(aK);ba+=af();k(ba);log.debug("Sending Get Server Changes... ("+ba.length+")");aR(0,0,"Waiting for server changes...");bb()}function D(bb){aF=true;var ba;ba=window.hex2bin(window.Protocol.ReplicateRequestTag);ba+=window.hex2bin(window.Protocol.MaxNumCommandsTag);ba+=window.fromInteger(aK);ba+=af();aR(0,0,"Calculating changes...");aM(function(bc){ba+=bc;k(ba);log.debug("Sending Replicate Request... ("+ba.length+")");aR(0,0,"Waiting for server...");bb()})}function a1(){var bb=0;var ba=at.listofAttachments();var bc=ah.list();aQ.each(ba,function(bd,be){found=false;if(bc){aQ.each(bc,function(bf,bg){var bh;bh=bg;if(be==bh){found=true;return false}bf=undefined})}if(!found){bb++}});return bb}function am(bh){var bf,be,bc,bd,bg,bb,ba;ba=true;bf=window.hex2bin(window.Protocol.ReplicateRequestTag);bf+=window.hex2bin(window.Protocol.CommandsTag);bc=at.listofAttachments();bd=ah.list();if(typeof bc==="undefined"){bh()}aQ.each(bc,function(bj,bm){function bl(bn){var bo;ai++;if(bn===undefined){return false}bo=bm;bf+=U(bo,bn);log.debug(1,"Sending Create (Attachment): "+bo+" ("+bf.length+")");k(bf);bh();return false}function bk(bn){ai++;aR(0,0,"Storing...");C(bm,bn);f++;aR(f,y,"Uploaded "+f+"/"+y+" attachments");am(bh);return false}function bi(bn){log.debug("Error Uploading Attachment (Create): "+bm+" Error: "+JSON.stringify(bn));V()}be=false;if(bd){aQ.each(bd,function(bn,bo){var bp;bp=bo;if(bm==bp){be=true;return false}bn=undefined})}if(!be){bg=bm.substr(bm.indexOf("\\")+1,36);bb=bm.substring(36+10,bm.length);if(aL.fs.availableForAtts){log.debug("Uploading Attachment (Create): "+bm);aR(0,0,"Sending attachment "+(f+1)+" of "+y+"...");aL.fs.uploadAttachment(bg,bb,null,bk,bi)}else{aL.db.getAttachment(bg,bb,bl)}ba=false;return false}});if(ba){t=false;D(bh)}}function Z(bc,bh){var bb,bf,bg,bd,ba,be;log.trace("-> _read_start_session");ba=bc.readTag();if(ba==window.Protocol.ErrorTag){bg=bc.readString();V();log.error(bg);return}ak=true;bf=bc.readBinary();bf=window.removeBOM(bf);log.trace("Context Read: "+bf);be=(new window.DOMParser()).parseFromString(bf,"text/xml");bb=aQ(be).find("CDRContext continue").text();bd=aQ(be).find("CDRContext > *");aQ(bd).each(function(){var bi;bi=this;aL.fl.setenvironment(bi.tagName,bi.textContent)});if(e===true){x();e=false;bh();return}y=a1();f=0;t=true;am(bh);log.trace("<- _read_start_session")}function s(bb){var bc,be,bd,ba;log.trace("-> _ack_delete_item");be=bb.readTag();bc=bb.readBinary();log.debug("Delete of "+bc+" acknowledged:");a4++;ba=bb.peekTag();if(ba==window.Protocol.ErrorTag){bb.readTag();bd=bb.readString();log.error("Server has failed to delete: "+bd);return false}ah.remove(bc);log.debug("Server has removed:  "+bc);return false;log.trace("<- _ack_delete_item")}function aA(bb){var bc,be,bd,bf,ba;log.trace("-> _ack_modify_item");be=bb.readTag();bc=bb.readBinary();log.debug("Modification of "+bc+" acknowledged:");a4++;ba=bb.peekTag();if(ba==window.Protocol.ErrorTag){bb.readTag();bd=bb.readString();log.error("Server has failed to modify: "+bd);return false}if(ba==window.Protocol.SyncDataTag){bb.readTag();bf=bb.readBinary();C(bc,bf);log.debug("Server has modified:  "+bc+": "+bf)}log.trace("<- _ack_modify_item");return false}function X(bb){var bc,be,bd,bf,ba;log.trace("-> _ack_create_item");be=bb.readTag();bc=bb.readBinary();log.debug("Creation of "+bc+" acknowledged:");a4++;ba=bb.peekTag();if(ba==window.Protocol.ErrorTag){bb.readTag();bd=bb.readString();log.error("Server has failed to create: "+bd);return false}if(ba==window.Protocol.SyncDataTag){bb.readTag();bf=bb.readBinary();C(bc,bf);log.debug("Server has created:  "+bc+": "+bf)}log.trace("<- _ack_create_item");return false}function C(bb,bc){log.trace("-> _store_ack_item: "+JSON.stringify([bb,bc]));var ba;ah.add(bb,bc);if(aL.replstore.is_attachment(bb)){ba=aL.replstore.split_attachment_id(bb);aL.replstore.store_attachment_date(ba.subjectGuid,ba.attachmentName,bc)}}function aw(bb){var bc,ba;log.trace("-> _read_acks");bb.readTag();bc=false;while(!bc){ba=bb.peekTag();switch(ba){case window.Protocol.ItemCreatedTag:bb.readTag();bc=X(bb);break;case window.Protocol.ItemModifiedTag:bb.readTag();bc=aA(bb);break;case window.Protocol.ItemDeletedTag:bb.readTag();bc=s(bb);break;default:bc=true;break}}log.trace("<- _read_acks")}function aO(bd,ba){var bc,bb;bc={};bc.itemid=bd;bc.tag=ba;az.push(bc);if((v.length===0)&&(az.length>50)){bc=window.hex2bin(window.Protocol.ReplicateRequestTag);bc+=window.hex2bin(window.Protocol.AcknowledgementsTag);while(az.length>0){bb=az.shift();bc+=E(bb.itemid,bb.tag)}k(bc,true)}aj()}function aU(bd,ba,bb){var bc;bc=window.hex2bin(window.Protocol.ReplicateRequestTag);bc+=window.hex2bin(window.Protocol.AcknowledgementsTag);bc+=window.hex2bin(ba);bc+=window.hex2bin(window.Protocol.ItemIdTag);bc+=window.makeBinary(bd);bc+=window.hex2bin(window.Protocol.ErrorTag);bc+=window.makeBinary(window.encode_utf8(bb));log.debug("Sending failed ack for "+bd);k(bc)}function aq(ba){var bb,bc;log.trace("-> _delete_item");bc=ba.readTag();bb=ba.readBinary();log.info("Server wants to delete: "+bb);F++;at.queue_delete_data(bb,function(bd){F--;if(bd===undefined){ah.remove(bb);aO(bb,window.Protocol.ItemDeletedTag);log.info("Deleted: "+bb)}else{log.error("Failed to delete: "+bb+" : "+bd);aU(bb,window.Protocol.ItemDeletedTag,bd);if(g==true){V()}}});return false}function M(bc,ba){var bb;if(aL.replstore.is_attachment(bc)&&aL.fs.availableForAtts){d.push({itemid:bc,tag:ba});ae()}else{a0[bc]=ba;bb=window.hex2bin(window.Protocol.RetrieveRequestTag);bb+=window.hex2bin(window.Protocol.ItemIdTag);bb+=window.makeBinary(bc);log.debug("Sending data request for "+bc);ai++;k(bb)}}function a8(bb){var bc,bd,be,bf,ba;log.trace("-> _create_item");be=bb.readTag();bd=bb.readBinary();bf="";bc="";log.info("Server wants to create: "+bd);ba=bb.peekTag();if(ba==window.Protocol.SyncDataTag){bb.readTag();bf=bb.readBinary();bb.readTag();bc=bb.readBinary();a4++;F++;at.queue_set_data(bd,bc,bf,function(bg){F--;if(bg===undefined){ah.add(bd,bf);aO(bd,window.Protocol.ItemCreatedTag);log.info("Created: "+bd)}else{log.error("Failed to create: "+bd+" : "+bg);aU(bd,window.Protocol.ItemCreatedTag,bg);if(g==true){V()}}})}else{M(bd,window.Protocol.ItemCreatedTag);return false}}function z(bb){var bc,bd,be,bf,ba;log.trace("-> _modify_item");be=bb.readTag();bd=bb.readBinary();bf="";bc="";log.info("Server wants to modify: "+bd);ba=bb.peekTag();if(ba==window.Protocol.SyncDataTag){bb.readTag();bf=bb.readBinary();bb.readTag();bc=bb.readBinary();a4++;F++;at.queue_set_data(bd,bc,bf,function(bg){F--;if(bg===undefined){ah.add(bd,bf);aO(bd,window.Protocol.ItemCreatedTag);log.info("Modified: "+bd)}else{log.error("Failed to modify: "+bd+" : "+bg);aU(bd,window.Protocol.ItemCreatedTag,bg);if(g==true){V()}}})}else{M(bd,window.Protocol.ItemModifiedTag);return false}}function L(bc){var bb,bd,ba;log.trace("-> _read_commands");bb=0;at.set_command_count(0);bc.readTag();bd=false;while(!bd){ba=bc.peekTag();switch(ba){case window.Protocol.CreateItemTag:bc.readTag();bd=a8(bc);break;case window.Protocol.ModifyItemTag:bc.readTag();bd=z(bc);break;case window.Protocol.DeleteItemTag:bc.readTag();bd=aq(bc);break;default:bd=true;break}bb++}at.set_command_count(bb-1);log.trace("<- _read_commands");return bb}function A(bc,bf){var bb,bd,be,ba;log.trace("-> _read_replicate_response");ba=bc.peekTag();log.debug("Reading replicate response:"+ba);if(ba==window.Protocol.ErrorTag){bc.readTag();be=bc.readString();V();log.error("Error reading replicate response: "+be);return}if(ba==window.Protocol.AcknowledgementsTag){log.trace("Reading acks...");aw(bc);if(t){f++;aR(f,y,"Uploaded "+f+"/"+y+" attachments");am(bf);return}if(aF){a6(bf);return}}ba=bc.peekTag();if(ba==window.Protocol.EndSessionRequestTag){if(aF){a6(bf);return}}ba=bc.peekTag();bb=0;if(ba==window.Protocol.CommandsTag){log.trace("Reading commands...");bb=L(bc)}ba=bc.peekTag();if(ba==window.Protocol.MoreAvailableTag){w=0;bc.readTag();bd=bc.readInteger();log.debug("There are more subjects to retrieve: "+bd);w=bd;if(aC==0){aC=bd+aK}}if(aC==0){aC=bb}bf();log.trace("<- _read_replicate_response")}function au(be,bi){var bc,bk,ba,bh,bf,bg,bd,bb,bj;bg=be.readTag();bf=be.readBinary();bj=be.peekTag();if(bj==window.Protocol.ErrorTag){be.readTag();bc=be.readString();V();log.error("Error reading retrieve response: "+bc)}else{bb=be.readTag();bd=be.readBinary();bh=be.readTag();bk=be.readBinary();ba=bk.length;log.debug("Retrieved: "+bf+": "+bd);a4++;F++;at.queue_set_data(bf,bk,bd,function(bl){F--;aR(0,0,"Stored");if(bl===undefined){ah.add(bf,bd);aO(bf,a0[bf]);log.debug("Created: "+bf+": "+bd)}else{aU(bf,a0[bf],bl)}});bi()}log.trace("<- _read_retrieve_response")}function S(bb,bh){var bc,bf,bd,be,bg,ba;log.debug("Reading fast lookup response...");ba=bb.readTag();bd=bb.readBinary();if(ba==window.Protocol.ErrorTag){bb.readTag();be=bb.readString();V();log.error("Error reading fast lookup response: "+be);return}bg="";bc="";log.info("Server wants to modify: "+bd);bf=bb.readTag();bc=bb.readBinary();a4++;F++;at.set_data(undefined,bd,bc,"",function(bi){F--;if(bi===undefined){log.info("Fast lookup finished: "+bd);bh()}else{log.error("Failed to fast lookup: "+bd+" : "+bi);ay();bh()}})}function ab(bd,bf){var bb,bc,ba;if(!av){return}try{if(bd.status!=200){if(av){log.error("Request Response: "+bd.status);if(bd.status==409&&!aZ){aN()}else{if(bd.status==401){aS(function(bg){if(bg){aN()}else{bf()}})}else{if(bd.status==403){aS(function(bg){if(bg){aN()}else{bf()}})}else{log.error("status: "+bd.status);log.error("responseText: "+bd.responseText);if(!aZ){aN()}}}}return}bf();return}bc=bd.responseText;if(bc.length===0){if(ak==true){bf()}return}if(bd.getResponseHeader("Transfer-Encoding")==="base64"){bc=atob(bc)}log.trace("Response length: "+bc.length);bb=new window.CTBinaryReader(bc);ba=bb.readTag();switch(ba){case window.Protocol.EndSessionResponseTag:ay();ak=false;bf();break;case window.Protocol.StartSessionResponseTag:Z(bb,bf);break;case window.Protocol.ReplicateResponseTag:A(bb,bf);break;case window.Protocol.RetrieveResponseTag:au(bb,bf);break;case window.Protocol.KeepAliveResponseTag:log.info("Ignoring Keep-alive Response");break;case window.Protocol.FastLookupResponseTag:S(bb,bf);break;default:throw ("Unknown Tag: "+ba)}}catch(be){V();log.error("Failed Receiving Response: "+be)}log.trace("<- _receive_message")}function ax(){log.trace("-> _reset_timeout");window.clearTimeout(ar);ar=window.setTimeout(function(){log.error("Replication timeout reached ("+aY.timeout+")");a2()},aY.timeout*1000)}function a5(bb){log.trace("-> _receive_response");log.debug("Response Received.  Outstanding requests: "+al.length);ax();var ba;ba=al.indexOf(bb);al.splice(ba,1);ab(bb,function(){ba=null;aj()});log.trace("<- _receive_response")}function K(ba){var bb;log.trace("-> _receive_state_change");bb="?";switch(ba.readyState){case 0:bb="Initialising";break;case 1:bb="Sending";break;case 2:bb="Sent";break;default:return}log.trace("<- _receive_state_change")}function aT(bk){var bh;var bm;var be=false;var bc=new Date().getTime();var bi=0;var bn=0;function bf(){be=true;if(bn<4096){aR(bn,bn,"Downloaded")}else{aR(bn,bn,"Downloaded... ("+Math.ceil(bn/1024)+"k of "+Math.ceil(bn/1024)+"k)")}if(bh){bh();bh=undefined}a5(this)}function ba(bo){bi=bo.loaded;bn=bo.total}function bl(){K(this)}function bg(){log.error("Aborted replication due to error connection: ");be=true;V()}function bj(bo){log.error("XHR Timeout")}function bb(){if(!be){setTimeout(bb,500);if(bi==0){if(!t){aR(bi,bn,"Waiting for server..")}}else{if((new Date().getTime())-bc>500){aR(bi,bn,"Downloading... ("+Math.ceil(bi/1024)+"k of "+Math.ceil(bn/1024)+"k)")}else{aR(bi,bn,"Downloading...")}}}}function bd(){var bp,bo;try{bo=aL.db.getUserInfo();bp=new XMLHttpRequest();if(bo.mSuiteSerialNo==0){bp.open("POST",aB+"/CommonTime-Data-Replication?uniq="+Math.random(),true)}else{bp.open("POST",aB+"/CommonTime-Data-Replication?mcid="+bo.mSuiteSerialNo+"&uniq="+Math.random(),true)}bp.onprogress=ba;bp.onload=bf;bp.onreadystatechange=bl;bp.onerror=bg;bp.ontimeout=bj;bp.setRequestHeader("Content-Type","application/x-commontime-data-replication-1.0");if(aQ.isIE){bp.setRequestHeader("X-Accept-Encoding","base64")}else{bp.overrideMimeType("text/plain; charset=x-user-defined")}al.push(bp);log.debug("Sending request, outstanding requests: "+al.length+", storage requests outstanding: "+F);bp.send(bm);setTimeout(bb,100)}catch(bq){V();log.error("Failed during send_request: "+bq)}}bm=window.encode_base64(bk);aL.profiler.profileAsync("replicator server request",function(bo){bh=bo;bd(bm)})}function N(){var bc,bb;log.trace("-> _execute_next_request");if(aG>3){log.trace("isReplicatingNow: "+av);log.trace("_session_ended: "+n);log.trace("_request_queue.length: "+v.length);log.trace("_outstanding_requests.length: "+al.length);log.trace("_waiting_on_download: "+J);log.trace("_waiting_on_storage: "+F)}if(av&&!n&&v.length==0&&al.length==0&&J==0&&F==0){if(w>0){log.debug("Continuing replication of "+w+" more subjects");w=0;bc=window.hex2bin(window.Protocol.ReplicateRequestTag);bc+=window.hex2bin(window.Protocol.ShouldContinueTag);k(bc,true)}else{if(I){ay()}else{if(ac){x()}else{ac=true;log.info("Re-validating");aR(0,0,"Validating subjects...");var ba=new Date();at.validateSubjects(function(bg,bf){var be=new Date();var bd=(be.getTime()-ba.getTime())/1000;log.info("Time taken to validate: "+bd);localStorage.timeTakenToValidate=bd;if(bf!==undefined&&bf===true){V(ReplicationResult.UnrecoverableError);return}log.debug("Starting secondary replication...");bc=window.hex2bin(window.Protocol.ReplicateRequestTag);bc+=window.hex2bin(window.Protocol.GetServerChangesTag);bc+=af();bc+=window.hex2bin(window.Protocol.AcknowledgementsTag);while(az.length>0){bb=az.shift();bc+=E(bb.itemid,bb.tag)}k(bc,true);if(!t){aR(0,0,"Waiting for server....")}},false)}}}}if(v.length>0){bc=v.shift();aT(bc)}log.trace("<- _execute_next_request")}function q(){log.debug("Starting Keepalive");window.clearTimeout(aX);aX=window.setTimeout(function(){var ba;log.debug("Sending Keepalive");ba=window.hex2bin(window.Protocol.KeepAliveRequestTag);k(ba,true);aj();q()},30*1000)}function W(){log.debug("Stopping Keepalive");window.clearTimeout(aX)}function a(){var ba;ba="<context>";aQ.each(aH.context,function(bb,bc){ba+="<"+bb+">";if(bc.substr(0,1)=="$"){bc=aL.fl.getenvironment(bc.substr(1))}ba+=bc;ba+="</"+bb+">"});ba+="</context>";return ba}function aP(){var bf,bc,bd,bb,ba,be;bf=window.hex2bin(H.replace(/-/g,""));bd=window.hex2bin(window.Protocol.FastLookupRequestTag);bd+=window.hex2bin(window.Protocol.ApplicationIdTag);bd+=bf;ba=aL.db.getUserInfo();be=aL.fs.availableForAtts?"true":"false";bc=a();seclog.trace("Internal context to send: "+bc);bb="subjects\\"+aL.db.getCurrentSubjectGuid()+".subject";aL.db.getSubject(aL.db.getCurrentSubjectGuid(),function(bk,bi){var bj,bg,bl,bh;if(bi!==undefined){log.error("Failed to retreive subject from db: "+bl);V();return}bg='<?xml version="1.0" encoding="utf-8"?><CDRContext>';bg+="<DefaultUserName>"+ba.mSuiteUserName+"</DefaultUserName>";bg+="<ReplicationType>"+aH.type+"</ReplicationType>";bg+="<Capabilities><clienttype>html</clienttype><CapabilityFlags><binaryfilesystem>"+be+"</binaryfilesystem></CapabilityFlags></Capabilities>";bg+="<CDRReplicationProfileContext>";bg+=window.encode_base64(bc);bg+="</CDRReplicationProfileContext>";bg+="</CDRContext>";seclog.trace("External context to send: "+bg);bj=window.encode_utf8(bg);bd+=window.hex2bin(window.Protocol.ContextTag);bd+=window.fromInteger(bj.length);bd+=bj;bh=at.get_subject_data_from_subject(bk);bd+=window.hex2bin(window.Protocol.ItemIdTag);bd+=window.makeBinary(bb);bd+=window.hex2bin(window.Protocol.ItemDataTag);bd+=window.makeBinary(bh);log.debug("Sending fast lookup... ("+bd.length+")");k(bd)})}function ag(){var bg,bd,bb,bc,be,ba,bf;bg=window.hex2bin(H.replace(/-/g,""));be=window.hex2bin(window.Protocol.StartSessionRequestTag);be+=window.hex2bin(window.Protocol.ApplicationIdTag);be+=bg;ba=aL.db.getUserInfo();bf=aL.fs.availableForAtts?"true":"false";bc=a();seclog.trace("Internal context to send: "+bc);bb='<?xml version="1.0" encoding="utf-8"?><CDRContext>';bb+="<DefaultUserName>"+ba.mSuiteUserName+"</DefaultUserName>";bb+="<ReplicationType>"+aH.type+"</ReplicationType>";bb+="<Capabilities><clienttype>html</clienttype><CapabilityFlags><binaryfilesystem>"+bf+"</binaryfilesystem></CapabilityFlags></Capabilities>";bb+="<CDRReplicationProfileContext>";bb+=window.encode_base64(bc);bb+="</CDRReplicationProfileContext>";bb+="</CDRContext>";seclog.trace("External context to send: "+bb);bd=window.encode_utf8(bb);be+=window.hex2bin(window.Protocol.ContextTag);be+=window.fromInteger(bd.length);be+=bd;if(aH.type==="login"){e=true}log.debug("Sending start session... ("+be.length+")");aL.db.setCookie("session-id",null);k(be)}function Y(){return av}function o(ba){if(typeof ba!="function"){throw"Callback must be a function: function( status, progress )"}l.push(ba);if(!ao){b()}}function aD(ba){if(typeof ba!="function"){throw"Callback must be a function: function( progress )"}a3.push(ba)}aV=function(bf,bd){var bc,bg,ba,be;function bb(bh){bf(bh)}log.trace("-> replicate");if(O>0){aL.db.dbTest(bf,O);return}log.trace("Device: "+navigator.appName+" "+navigator.appVersion+")");if(typeof bf!="function"){throw"Callback must be a function: function( bool )"}if(av){bf(window.ReplicationResult.FailedToStartSession);throw"Already Syncing"}if(window.plugins&&window.plugins.sleep&&window.plugins.sleep.Disable){log.info("Disabling sleep");window.plugins.sleep.Disable(function(){log.info("Sleep disabled")},function(bh){log.warn("Sleep failed.")})}ba=function(bh){aB=bh;aR(0,0,"Validating subjects...");aL.replstore.validateSubjects(function(bj,bi){if(bi!==undefined&&bi===true){V();return}B=bb;ah=aL.replsyncstore;at=aL.replstore;at.setProgressCallback(function(bk){G=bk;aR(0,0,"Storing...")});at.setProgressMessageCallback(function(bk){aR(0,0,"Storing...")});aY=bd;if(bd===undefined||bd.profileAlias===undefined){aY={processId:"all",profileAlias:"defaultRepProfile",title:"Syncing",url:"",timeout:600}}bc="replContext_"+aY.profileAlias;bc=bc.replace(/-/g,"_");aH=aL.fl[bc];log.debug("Starting replication...");log.trace("processId:    "+aY.processId);log.trace("profileAlias: "+aY.profileAlias);log.trace("title:        "+aY.title);log.trace("url:          "+aY.url);log.trace("timeout:      "+aY.timeout);P();av=true;n=false;ar=window.setTimeout(function(){log.error("Replication timeout reached ("+aY.timeout+")");a2()},aY.timeout*1000);if(aH.type==="fastlookup"){I=true;aP()}else{I=false;ag()}aR(0,0,"Starting session");log.trace("<- replicate")})};be=function(){aL.fl.isreachable(function(bh){if(bh){log.debug("Server is reachable - authenticating...");aS(function(bi){setTimeout(function(){if(bi){log.debug("Authenticated - starting retrieving username...");window.plugins.settings.getUsername(function(bk){log.debug("Received username: "+bk);var bj=aL.db.getUserInfo();bj.mSuiteUserName=bk;aL.db.setUserInfo(bj);log.debug("Stored username. Replicating...");window.plugins.settings.getURL(ba)})}else{log.debug("Authentication failed - retrying...");be()}},0)})}else{log.debug("Server is unreachable - no replication...");bf(window.ReplicationResult.ConnectionFailure)}},undefined)};if(window.locationUtils.isPPA()){be()}else{ba("")}};k=function(bb,ba){log.trace("-> _queue_request");if(av){if(ba){v.splice(0,0,bb)}else{v.push(bb)}aj()}log.trace("<- _queue_request")};aj=function(){log.trace("-> _pump_request_queue");if(al.length<1){N()}log.trace("<- _pump_request_queue")};ae=function(){log.trace("-> _pump_download_queue");if(J<1){j()}log.trace("<- _pump_download_queue")};j=function(){var bd,bb;function bc(be){ax();F++;at.queue_set_data(bd.itemid,"",be,function(bf){F--;if(bf===undefined){ah.add(bd.itemid,be);aO(bd.itemid,window.Protocol.ItemCreatedTag);log.info("Created: "+bd.itemid)}else{log.error("Failed to create: "+bd.itemid+" : "+bf);aU(bd.itemid,window.Protocol.ItemCreatedTag,bf);if(g==true){V()}}});J--;ae()}function ba(be){log.debug("Error Downloading Attachment: "+bd.itemid+" Error: "+JSON.stringify(be));V()}log.trace("-> _execute_next_download");bd=d.shift();if(bd){log.debug("Downloading next attachment: "+JSON.stringify(bd));J++;bb=at.split_attachment_id(bd.itemid);Q(0,0,"Downloading attachments...");aL.fs.downloadAttachment(bb.subjectGuid,bb.attachmentName,bc,ba)}log.trace("<- _execute_next_download")};av=false;aK=100;v=[];az=[];a0=[];al=[];h=new Date().getTime();n=false;ak=false;ao=false;g=false;e=false;I=false;a9=0;aJ=(/android/gi).test(window.navigator.appVersion);aa=(/iphone|ipad/gi).test(navigator.appVersion);aE=(/blackberry/gi).test(window.navigator.appVersion);w=0;aC=0;G=0;ai=0;a4=0;R=0;F=0;d=[];J=0;ac=false;aZ=false;l=[];a3=[];B=null;aG=parseInt(window.getUrlVars().debug,10);O=window.getUrlVars().dbtest;m=window.getUrlVars().serverlog;H="b6e9d230-897c-654a-b291-d05e4c11fed8";aL.repl={abortReplication:V,isReplicating:Y,replicate:aV,subscribeNotify:o,subscribeStatus:aD,store:undefined,syncstore:undefined}}(window.jmfw,window.mCapture));(function(e,h){var m=-1;var l=undefined;var b=false;var k="lastBatteryLevel";var j="lastBatteryTime";function d(){if(b){return}if(localStorage[j]){var n=(new Date()).getTime()-localStorage[j];if(n<60*60*1000){m=localStorage[k]}}log.debug("Registering for Battery status");b=true;window.addEventListener("batterystatus",g,false);window.addEventListener("beforeunload",c,false)}function c(){if(!b){return}b=false;log.debug("Stopping battery monitoring");window.removeEventListener("batterystatus",g,false);log.debug("Stopped battery monitoring")}function g(n){log.debug("Battery level: "+n.level+", plugged in: "+n.isPlugged);m=n.level;l=n.isPlugged;localStorage[k]=m;localStorage[j]=(new Date()).getTime()}function f(){log.debug("Current Level is "+m);return m}function a(){return l}h.battery={getLevel:f,getPluggedIn:a};log.debug("Registering for Device ready");document.addEventListener("deviceready",d,false)}(window.jmfw,window.mCapture));function X2JS(v){var q="1.1.0";v=v||{};g();function g(){if(v.escapeMode===undefined){v.escapeMode=true}if(v.attributePrefix===undefined){v.attributePrefix="_"}if(v.arrayAccessForm===undefined){v.arrayAccessForm="none"}}var f={ELEMENT_NODE:1,TEXT_NODE:3,CDATA_SECTION_NODE:4,DOCUMENT_NODE:9};function t(x){var y=x.localName;if(y==null){y=x.baseName}if(y==null||y==""){y=x.nodeName}return y}function n(x){return x.prefix}function o(x){if(typeof(x)=="string"){return x.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")}else{return x}}function j(x){return x.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&#x2F;/g,"/")}function k(y,x){switch(v.arrayAccessForm){case"property":if(!(y[x] instanceof Array)){y[x+"_asArray"]=[y[x]]}else{y[x+"_asArray"]=y[x]}break}}function w(z){if(z.nodeType==f.DOCUMENT_NODE){var G=new Object;var y=z.firstChild;var F=t(y);G[F]=w(y);return G}else{if(z.nodeType==f.ELEMENT_NODE){var G=new Object;G.__cnt=0;var x=z.childNodes;for(var H=0;H<x.length;H++){var y=x.item(H);var F=t(y);G.__cnt++;if(G[F]==null){G[F]=w(y);k(G,F)}else{if(G[F]!=null){if(!(G[F] instanceof Array)){var A=G[F];G[F]=new Array();G[F][0]=A;k(G,F)}}var D=0;while(G[F][D]!=null){D++}(G[F])[D]=w(y)}}for(var B=0;B<z.attributes.length;B++){var C=z.attributes.item(B);G.__cnt++;G[v.attributePrefix+C.name]=C.value}var E=n(z);if(E!=null&&E!=""){G.__cnt++;G.__prefix=E}if(G.__cnt==1&&G["#text"]!=null){G=G["#text"]}if(G["#text"]!=null){G.__text=G["#text"];if(G.__text instanceof Array){G.__text=G.__text.join("\n")}if(v.escapeMode){G.__text=j(G.__text)}delete G["#text"];delete G["#text_asArray"]}if(G["#cdata-section"]!=null){G.__cdata=G["#cdata-section"];delete G["#cdata-section"];delete G["#cdata-section_asArray"]}if(G.__cnt!=undefined){delete G.__cnt}if(G.__text!=null||G.__cdata!=null){G.toString=function(){return(this.__text!=null?this.__text:"")+(this.__cdata!=null?this.__cdata:"")}}return G}else{if(z.nodeType==f.TEXT_NODE||z.nodeType==f.CDATA_SECTION_NODE){return z.nodeValue}}}}function l(E,B,D,y){var A="<"+((E!=null&&E.__prefix!=null)?(E.__prefix+":"):"")+B;if(D!=null){for(var C=0;C<D.length;C++){var z=D[C];var x=E[z];A+=" "+z.substr(1)+"='"+x+"'"}}if(!y){A+=">"}else{A+="/>"}return A}function h(y,x){return"</"+(y.__prefix!=null?(y.__prefix+":"):"")+x+">"}function s(y,x){return y.indexOf(x,y.length-x.length)!==-1}function u(y,x){if((v.arrayAccessForm=="property"&&s(x.toString(),("_asArray")))||x.toString().indexOf(v.attributePrefix)==0||x.toString().indexOf("__")==0||(y[x] instanceof Function)){return true}else{return false}}function m(z){var y=0;if(z instanceof Object){for(var x in z){if(u(z,x)){continue}y++}}return y}function a(z){var y=[];if(z instanceof Object){for(var x in z){if(x.toString().indexOf("__")==-1&&x.toString().indexOf(v.attributePrefix)==0){y.push(x)}}}return y}function e(y){var x="";if(y.__cdata!=null){x+="<![CDATA["+y.__cdata+"]]>"}if(y.__text!=null){if(v.escapeMode){x+=o(y.__text)}else{x+=y.__text}}return x}function b(y){var x="";if(y instanceof Object){x+=e(y)}else{if(y!=null){if(v.escapeMode){x+=o(y)}else{x+=y}}}return x}function d(z,B,A){var x="";if(z.length==0){x+=l(z,B,A,true)}else{for(var y=0;y<z.length;y++){x+=l(z[y],B,a(z[y]),false);x+=c(z[y]);x+=h(z[y],B)}}return x}function c(D){var x="";var B=m(D);if(B>0){for(var A in D){if(u(D,A)){continue}var z=D[A];var C=a(z);if(z==null||z==undefined){x+=l(z,A,C,true)}else{if(z instanceof Object){if(z instanceof Array){x+=d(z,A,C)}else{var y=m(z);if(y>0||z.__text!=null||z.__cdata!=null){x+=l(z,A,C,false);x+=c(z);x+=h(z,A)}else{x+=l(z,A,C,true)}}}else{x+=l(z,A,C,false);x+=b(z);x+=h(z,A)}}}}x+=b(D);return x}this.parseXmlString=function(x){if(x===undefined){return null}var y;if(window.DOMParser){var z=new window.DOMParser();y=z.parseFromString(x,"text/xml")}else{if(x.indexOf("<?")==0){x=x.substr(x.indexOf("?>")+2)}y=new ActiveXObject("Microsoft.XMLDOM");y.async="false";y.loadXML(x)}return y};this.asArray=function(x){if(x instanceof Array){return x}else{return[x]}};this.xml2json=function(x){return w(x)};this.xml_str2json=function(x){var y=this.parseXmlString(x);return this.xml2json(y)};this.json2xml_str=function(x){return c(x)};this.json2xml=function(y){var x=this.json2xml_str(y);return this.parseXmlString(x)};this.getVersion=function(){return q}}(function(b,g){var e,d;function j(){var k,l;if(!window.ppaData){return false}k=window.localStorage.getItem("ppaDataVersion");l=window.ppaData.version;return(k!==l)}function c(n,m,q,l){var k;function o(){window.localStorage.setItem("ppaDataVersion",window.ppaData.version);log.info("PPA: data load complete");l()}log.info("PPA: data load starting...");k=window.ppaData;d=0;e=k.attachments.length+k.subjects.length;f(k.attachments,n,q,function(){h(k.subjects,m,q,o)})}function f(l,o,s,m){var q;function k(){var w,t,u,z;function v(){log.info("PPA: attachment loaded: "+z);g.db.setAttachment(t,u,"",false,n)}function y(A){log.error("PPA: error importing attachment file: "+JSON.stringify(A))}function x(A){z="data/attachments/"+t+"/"+u;window.plugins.resource.copyAssetFromWWWFolder(z,A,v,y)}w=q.itemid.split("\\");t=w[1];u=w[2];log.debug("PPA: loading attachment: "+q.itemid);g.fs.getAttachmentPath(t,u,x,y)}function n(){s(d++/e*100);q=l.shift();if(q){k()}else{m()}}log.info("PPA: loading "+l.length+" attachment(s)...");n()}function h(n,m,s,l){var q;function k(){function t(v){g.db.startTransaction(function(w){g.replstore.set_data(w,q.itemid,v,q.syncdata,function(){})},function(){log.info("PPA: subject loaded: "+q.itemid);setTimeout(o)})}log.debug("PPA: loading subject: "+q.itemid);var u=m+q.itemid.replace(/\\/g,"/");a(u,t)}function o(){s(d++/e*100);q=n.shift();if(q){k()}else{l()}}log.info("PPA: loading "+n.length+" subject(s)...");o()}function a(l,m){console.log("PPA: downloading : "+l);window.ppaLoadSubjectCallback=function(n){console.log("PPA: downloaded : "+l);m(n);delete window.ppaLoadSubjectCallback};var k=document.createElement("script");k.type="text/javascript";k.src=l;document.getElementsByTagName("head")[0].appendChild(k)}g.ppa={dataLoadRequired:j,loadData:c}})(window.jmfw,window.mCapture);(function(k,n){var o="jenkins-7.11.127";var f=false;var c=false;var j={device:"not reported",framework:"not reported",logging:"not reported",idb:"not reported"};function b(){function t(){log.info("versionInfo reported to shell")}function q(u){log.error("Unable to report versionInfo to shell reason: "+u)}if(f){if(typeof(window.plugins)!=="undefined"){if(typeof(window.plugins.settings)!=="undefined"){if(typeof(window.plugins.settings.setVersions)==="function"){try{window.plugins.settings.setVersions(t,q,j);c=true}catch(s){q(s)}return}log.debug("typeof(window.plugins.settings.setVersions) = "+typeof(window.plugins.settings.setVersions))}log.debug("plugins.settings not ready: "+typeof(window.plugins)+" - "+typeof(window.plugins.settings))}log.debug("plugins not ready: "+typeof(window.plugins))}log.debug("Unable to report versionInfo to shell reason: cordova not ready")}function a(t){var s=t.toLowerCase();var q=j[s];log.info("Component : "+s+" Version : "+q);b()}function h(){k.each(j,function(q,s){a(s)})}function e(s,q){j[s.toLowerCase()]=q;a(s)}function d(){return j}function g(q){return j[q]}function m(){n=mCapture;n.version.setversion("framework",o)}function l(){f=true;if(!c){b()}}window.document.addEventListener("mcready",m,false);window.document.addEventListener("deviceready",l,false);n.version={setversion:e,getversion:g,getinfo:d,logversion:a,loginfo:h}}(window.jmfw,window.mCapture));